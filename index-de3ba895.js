var xS=(l,t)=>()=>(t||l((t={exports:{}}).exports,t),t.exports);var Dk=xS(kn=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function e(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(o){if(o.ep)return;o.ep=!0;const c=e(o);fetch(o.href,c)}})();/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Hp="151",bS={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},wS={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Jx=0,jg=1,Kx=2,MS=3,SS=0,N_=1,Qx=2,Ih=3,Ea=0,Ps=1,Vr=2,AS=2,Ta=0,cl=1,Zg=2,Xg=3,Yg=4,t1=5,nl=100,e1=101,i1=102,Jg=103,Kg=104,n1=200,s1=201,r1=202,a1=203,U_=204,V_=205,o1=206,l1=207,h1=208,c1=209,u1=210,d1=0,f1=1,p1=2,zp=3,m1=4,g1=5,_1=6,y1=7,rd=0,v1=1,x1=2,Hr=0,b1=1,w1=2,M1=3,S1=4,A1=5,Wp=300,po=301,mo=302,Bu=303,Ou=304,Xh=306,Nu=1e3,gs=1001,Uu=1002,Rn=1003,kp=1004,TS=1004,Eu=1005,ES=1005,Dn=1006,G_=1007,CS=1007,go=1008,IS=1008,_o=1009,T1=1010,E1=1011,H_=1012,C1=1013,ho=1014,Aa=1015,Gh=1016,I1=1017,P1=1018,ul=1020,L1=1021,Qs=1023,R1=1024,D1=1025,co=1026,fl=1027,z1=1028,k1=1029,F1=1030,B1=1031,O1=1033,Mp=33776,Sp=33777,Ap=33778,Tp=33779,Qg=35840,t_=35841,e_=35842,i_=35843,N1=36196,n_=37492,s_=37496,r_=37808,a_=37809,o_=37810,l_=37811,h_=37812,c_=37813,u_=37814,d_=37815,f_=37816,p_=37817,m_=37818,g_=37819,__=37820,y_=37821,Ep=36492,U1=36283,v_=36284,x_=36285,b_=36286,V1=2200,G1=2201,H1=2202,Vu=2300,Gu=2301,Cp=2302,rl=2400,al=2401,Hu=2402,qp=2500,W_=2501,PS=0,LS=1,RS=2,yo=3e3,on=3001,W1=3200,q1=3201,wo=0,$1=1,DS="",Tr="srgb",Hh="srgb-linear",q_="display-p3",zS=0,Ip=7680,kS=7681,FS=7682,BS=7683,OS=34055,NS=34056,US=5386,VS=512,GS=513,HS=514,WS=515,qS=516,$S=517,jS=518,j1=519,Wu=35044,ZS=35048,XS=35040,YS=35045,JS=35049,KS=35041,QS=35046,t2=35050,e2=35042,i2="100",w_="300 es",Fp=1035;class Ca{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const o=this._listeners[t];if(o!==void 0){const c=o.indexOf(e);c!==-1&&o.splice(c,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const s=this._listeners[t.type];if(s!==void 0){t.target=this;const o=s.slice(0);for(let c=0,d=o.length;c<d;c++)o[c].call(this,t);t.target=null}}}const fs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let rv=1234567;const dl=Math.PI/180,Wh=180/Math.PI;function er(){const l=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(fs[l&255]+fs[l>>8&255]+fs[l>>16&255]+fs[l>>24&255]+"-"+fs[t&255]+fs[t>>8&255]+"-"+fs[t>>16&15|64]+fs[t>>24&255]+"-"+fs[e&63|128]+fs[e>>8&255]+"-"+fs[e>>16&255]+fs[e>>24&255]+fs[s&255]+fs[s>>8&255]+fs[s>>16&255]+fs[s>>24&255]).toLowerCase()}function wn(l,t,e){return Math.max(t,Math.min(e,l))}function $_(l,t){return(l%t+t)%t}function n2(l,t,e,s,o){return s+(l-t)*(o-s)/(e-t)}function s2(l,t,e){return l!==t?(e-l)/(t-l):0}function Cu(l,t,e){return(1-e)*l+e*t}function r2(l,t,e,s){return Cu(l,t,1-Math.exp(-e*s))}function a2(l,t=1){return t-Math.abs($_(l,t*2)-t)}function o2(l,t,e){return l<=t?0:l>=e?1:(l=(l-t)/(e-t),l*l*(3-2*l))}function l2(l,t,e){return l<=t?0:l>=e?1:(l=(l-t)/(e-t),l*l*l*(l*(l*6-15)+10))}function h2(l,t){return l+Math.floor(Math.random()*(t-l+1))}function c2(l,t){return l+Math.random()*(t-l)}function u2(l){return l*(.5-Math.random())}function d2(l){l!==void 0&&(rv=l);let t=rv+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function f2(l){return l*dl}function p2(l){return l*Wh}function M_(l){return(l&l-1)===0&&l!==0}function Z1(l){return Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function X1(l){return Math.pow(2,Math.floor(Math.log(l)/Math.LN2))}function m2(l,t,e,s,o){const c=Math.cos,d=Math.sin,a=c(e/2),_=d(e/2),v=c((t+s)/2),S=d((t+s)/2),M=c((t-s)/2),A=d((t-s)/2),C=c((s-t)/2),R=d((s-t)/2);switch(o){case"XYX":l.set(a*S,_*M,_*A,a*v);break;case"YZY":l.set(_*A,a*S,_*M,a*v);break;case"ZXZ":l.set(_*M,_*A,a*S,a*v);break;case"XZX":l.set(a*S,_*R,_*C,a*v);break;case"YXY":l.set(_*C,a*S,_*R,a*v);break;case"ZYZ":l.set(_*R,_*C,a*S,a*v);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}function tr(l,t){switch(t.constructor){case Float32Array:return l;case Uint16Array:return l/65535;case Uint8Array:return l/255;case Int16Array:return Math.max(l/32767,-1);case Int8Array:return Math.max(l/127,-1);default:throw new Error("Invalid component type.")}}function Ri(l,t){switch(t.constructor){case Float32Array:return l;case Uint16Array:return Math.round(l*65535);case Uint8Array:return Math.round(l*255);case Int16Array:return Math.round(l*32767);case Int8Array:return Math.round(l*127);default:throw new Error("Invalid component type.")}}const g2={DEG2RAD:dl,RAD2DEG:Wh,generateUUID:er,clamp:wn,euclideanModulo:$_,mapLinear:n2,inverseLerp:s2,lerp:Cu,damp:r2,pingpong:a2,smoothstep:o2,smootherstep:l2,randInt:h2,randFloat:c2,randFloatSpread:u2,seededRandom:d2,degToRad:f2,radToDeg:p2,isPowerOfTwo:M_,ceilPowerOfTwo:Z1,floorPowerOfTwo:X1,setQuaternionFromProperEuler:m2,normalize:Ri,denormalize:tr};class me{constructor(t=0,e=0){me.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,o=t.elements;return this.x=o[0]*e+o[3]*s+o[6],this.y=o[1]*e+o[4]*s+o[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(wn(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),o=Math.sin(e),c=this.x-t.x,d=this.y-t.y;return this.x=c*s-d*o+t.x,this.y=c*o+d*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ki{constructor(){ki.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,s,o,c,d,a,_,v){const S=this.elements;return S[0]=t,S[1]=o,S[2]=a,S[3]=e,S[4]=c,S[5]=_,S[6]=s,S[7]=d,S[8]=v,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,o=e.elements,c=this.elements,d=s[0],a=s[3],_=s[6],v=s[1],S=s[4],M=s[7],A=s[2],C=s[5],R=s[8],F=o[0],z=o[3],L=o[6],W=o[1],G=o[4],H=o[7],Q=o[2],nt=o[5],pt=o[8];return c[0]=d*F+a*W+_*Q,c[3]=d*z+a*G+_*nt,c[6]=d*L+a*H+_*pt,c[1]=v*F+S*W+M*Q,c[4]=v*z+S*G+M*nt,c[7]=v*L+S*H+M*pt,c[2]=A*F+C*W+R*Q,c[5]=A*z+C*G+R*nt,c[8]=A*L+C*H+R*pt,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],o=t[2],c=t[3],d=t[4],a=t[5],_=t[6],v=t[7],S=t[8];return e*d*S-e*a*v-s*c*S+s*a*_+o*c*v-o*d*_}invert(){const t=this.elements,e=t[0],s=t[1],o=t[2],c=t[3],d=t[4],a=t[5],_=t[6],v=t[7],S=t[8],M=S*d-a*v,A=a*_-S*c,C=v*c-d*_,R=e*M+s*A+o*C;if(R===0)return this.set(0,0,0,0,0,0,0,0,0);const F=1/R;return t[0]=M*F,t[1]=(o*v-S*s)*F,t[2]=(a*s-o*d)*F,t[3]=A*F,t[4]=(S*e-o*_)*F,t[5]=(o*c-a*e)*F,t[6]=C*F,t[7]=(s*_-v*e)*F,t[8]=(d*e-s*c)*F,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,o,c,d,a){const _=Math.cos(c),v=Math.sin(c);return this.set(s*_,s*v,-s*(_*d+v*a)+d+t,-o*v,o*_,-o*(-v*d+_*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(ug.makeScale(t,e)),this}rotate(t){return this.premultiply(ug.makeRotation(-t)),this}translate(t,e){return this.premultiply(ug.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let o=0;o<9;o++)if(e[o]!==s[o])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const ug=new ki;function Y1(l){for(let t=l.length-1;t>=0;--t)if(l[t]>=65535)return!0;return!1}const _2={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ph(l,t){return new _2[l](t)}function qu(l){return document.createElementNS("http://www.w3.org/1999/xhtml",l)}function Oh(l){return l<.04045?l*.0773993808:Math.pow(l*.9478672986+.0521327014,2.4)}function dg(l){return l<.0031308?l*12.92:1.055*Math.pow(l,.41666)-.055}const y2=new ki().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),v2=new ki().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function x2(l){return l.convertSRGBToLinear().applyMatrix3(v2)}function b2(l){return l.applyMatrix3(y2).convertLinearToSRGB()}const w2={[Hh]:l=>l,[Tr]:l=>l.convertSRGBToLinear(),[q_]:x2},M2={[Hh]:l=>l,[Tr]:l=>l.convertLinearToSRGB(),[q_]:b2},zs={enabled:!1,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(l){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!l},get workingColorSpace(){return Hh},set workingColorSpace(l){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(l,t,e){if(this.enabled===!1||t===e||!t||!e)return l;const s=w2[t],o=M2[e];if(s===void 0||o===void 0)throw new Error(`Unsupported color space conversion, "${t}" to "${e}".`);return o(s(l))},fromWorkingColorSpace:function(l,t){return this.convert(l,this.workingColorSpace,t)},toWorkingColorSpace:function(l,t){return this.convert(l,t,this.workingColorSpace)}};let ah;class j_{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{ah===void 0&&(ah=qu("canvas")),ah.width=t.width,ah.height=t.height;const s=ah.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=ah}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=qu("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const o=s.getImageData(0,0,t.width,t.height),c=o.data;for(let d=0;d<c.length;d++)c[d]=Oh(c[d]/255)*255;return s.putImageData(o,0,0),e}else if(t.data){const e=t.data.slice(0);for(let s=0;s<e.length;s++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[s]=Math.floor(Oh(e[s]/255)*255):e[s]=Oh(e[s]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class ol{constructor(t=null){this.isSource=!0,this.uuid=er(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const s={uuid:this.uuid,url:""},o=this.data;if(o!==null){let c;if(Array.isArray(o)){c=[];for(let d=0,a=o.length;d<a;d++)o[d].isDataTexture?c.push(fg(o[d].image)):c.push(fg(o[d]))}else c=fg(o);s.url=c}return e||(t.images[this.uuid]=s),s}}function fg(l){return typeof HTMLImageElement<"u"&&l instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&l instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&l instanceof ImageBitmap?j_.getDataURL(l):l.data?{data:Array.from(l.data),width:l.width,height:l.height,type:l.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let S2=0;class zn extends Ca{constructor(t=zn.DEFAULT_IMAGE,e=zn.DEFAULT_MAPPING,s=gs,o=gs,c=Dn,d=go,a=Qs,_=_o,v=zn.DEFAULT_ANISOTROPY,S=yo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:S2++}),this.uuid=er(),this.name="",this.source=new ol(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=o,this.magFilter=c,this.minFilter=d,this.anisotropy=v,this.format=a,this.internalFormat=null,this.type=_,this.offset=new me(0,0),this.repeat=new me(1,1),this.center=new me(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ki,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=S,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Wp)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Nu:t.x=t.x-Math.floor(t.x);break;case gs:t.x=t.x<0?0:1;break;case Uu:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Nu:t.y=t.y-Math.floor(t.y);break;case gs:t.y=t.y<0?0:1;break;case Uu:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}zn.DEFAULT_IMAGE=null;zn.DEFAULT_MAPPING=Wp;zn.DEFAULT_ANISOTROPY=1;class Ji{constructor(t=0,e=0,s=0,o=1){Ji.prototype.isVector4=!0,this.x=t,this.y=e,this.z=s,this.w=o}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,s,o){return this.x=t,this.y=e,this.z=s,this.w=o,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,s=this.y,o=this.z,c=this.w,d=t.elements;return this.x=d[0]*e+d[4]*s+d[8]*o+d[12]*c,this.y=d[1]*e+d[5]*s+d[9]*o+d[13]*c,this.z=d[2]*e+d[6]*s+d[10]*o+d[14]*c,this.w=d[3]*e+d[7]*s+d[11]*o+d[15]*c,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,s,o,c;const _=t.elements,v=_[0],S=_[4],M=_[8],A=_[1],C=_[5],R=_[9],F=_[2],z=_[6],L=_[10];if(Math.abs(S-A)<.01&&Math.abs(M-F)<.01&&Math.abs(R-z)<.01){if(Math.abs(S+A)<.1&&Math.abs(M+F)<.1&&Math.abs(R+z)<.1&&Math.abs(v+C+L-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const G=(v+1)/2,H=(C+1)/2,Q=(L+1)/2,nt=(S+A)/4,pt=(M+F)/4,ft=(R+z)/4;return G>H&&G>Q?G<.01?(s=0,o=.707106781,c=.707106781):(s=Math.sqrt(G),o=nt/s,c=pt/s):H>Q?H<.01?(s=.707106781,o=0,c=.707106781):(o=Math.sqrt(H),s=nt/o,c=ft/o):Q<.01?(s=.707106781,o=.707106781,c=0):(c=Math.sqrt(Q),s=pt/c,o=ft/c),this.set(s,o,c,e),this}let W=Math.sqrt((z-R)*(z-R)+(M-F)*(M-F)+(A-S)*(A-S));return Math.abs(W)<.001&&(W=1),this.x=(z-R)/W,this.y=(M-F)/W,this.z=(A-S)/W,this.w=Math.acos((v+C+L-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this.w=t.w+(e.w-t.w)*s,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ir extends Ca{constructor(t=1,e=1,s={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Ji(0,0,t,e),this.scissorTest=!1,this.viewport=new Ji(0,0,t,e);const o={width:t,height:e,depth:1};this.texture=new zn(o,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=s.generateMipmaps!==void 0?s.generateMipmaps:!1,this.texture.internalFormat=s.internalFormat!==void 0?s.internalFormat:null,this.texture.minFilter=s.minFilter!==void 0?s.minFilter:Dn,this.depthBuffer=s.depthBuffer!==void 0?s.depthBuffer:!0,this.stencilBuffer=s.stencilBuffer!==void 0?s.stencilBuffer:!1,this.depthTexture=s.depthTexture!==void 0?s.depthTexture:null,this.samples=s.samples!==void 0?s.samples:0}setSize(t,e,s=1){(this.width!==t||this.height!==e||this.depth!==s)&&(this.width=t,this.height=e,this.depth=s,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=s,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new ol(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class $p extends zn{constructor(t=null,e=1,s=1,o=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:s,depth:o},this.magFilter=Rn,this.minFilter=Rn,this.wrapR=gs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class A2 extends Ir{constructor(t=1,e=1,s=1){super(t,e),this.isWebGLArrayRenderTarget=!0,this.depth=s,this.texture=new $p(null,t,e,s),this.texture.isRenderTargetTexture=!0}}class Z_ extends zn{constructor(t=null,e=1,s=1,o=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:s,depth:o},this.magFilter=Rn,this.minFilter=Rn,this.wrapR=gs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class T2 extends Ir{constructor(t=1,e=1,s=1){super(t,e),this.isWebGL3DRenderTarget=!0,this.depth=s,this.texture=new Z_(null,t,e,s),this.texture.isRenderTargetTexture=!0}}class E2 extends Ir{constructor(t=1,e=1,s=1,o={}){super(t,e,o),this.isWebGLMultipleRenderTargets=!0;const c=this.texture;this.texture=[];for(let d=0;d<s;d++)this.texture[d]=c.clone(),this.texture[d].isRenderTargetTexture=!0}setSize(t,e,s=1){if(this.width!==t||this.height!==e||this.depth!==s){this.width=t,this.height=e,this.depth=s;for(let o=0,c=this.texture.length;o<c;o++)this.texture[o].image.width=t,this.texture[o].image.height=e,this.texture[o].image.depth=s;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,s=t.texture.length;e<s;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}}class Os{constructor(t=0,e=0,s=0,o=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=o}static slerpFlat(t,e,s,o,c,d,a){let _=s[o+0],v=s[o+1],S=s[o+2],M=s[o+3];const A=c[d+0],C=c[d+1],R=c[d+2],F=c[d+3];if(a===0){t[e+0]=_,t[e+1]=v,t[e+2]=S,t[e+3]=M;return}if(a===1){t[e+0]=A,t[e+1]=C,t[e+2]=R,t[e+3]=F;return}if(M!==F||_!==A||v!==C||S!==R){let z=1-a;const L=_*A+v*C+S*R+M*F,W=L>=0?1:-1,G=1-L*L;if(G>Number.EPSILON){const Q=Math.sqrt(G),nt=Math.atan2(Q,L*W);z=Math.sin(z*nt)/Q,a=Math.sin(a*nt)/Q}const H=a*W;if(_=_*z+A*H,v=v*z+C*H,S=S*z+R*H,M=M*z+F*H,z===1-a){const Q=1/Math.sqrt(_*_+v*v+S*S+M*M);_*=Q,v*=Q,S*=Q,M*=Q}}t[e]=_,t[e+1]=v,t[e+2]=S,t[e+3]=M}static multiplyQuaternionsFlat(t,e,s,o,c,d){const a=s[o],_=s[o+1],v=s[o+2],S=s[o+3],M=c[d],A=c[d+1],C=c[d+2],R=c[d+3];return t[e]=a*R+S*M+_*C-v*A,t[e+1]=_*R+S*A+v*M-a*C,t[e+2]=v*R+S*C+a*A-_*M,t[e+3]=S*R-a*M-_*A-v*C,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,o){return this._x=t,this._y=e,this._z=s,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const s=t._x,o=t._y,c=t._z,d=t._order,a=Math.cos,_=Math.sin,v=a(s/2),S=a(o/2),M=a(c/2),A=_(s/2),C=_(o/2),R=_(c/2);switch(d){case"XYZ":this._x=A*S*M+v*C*R,this._y=v*C*M-A*S*R,this._z=v*S*R+A*C*M,this._w=v*S*M-A*C*R;break;case"YXZ":this._x=A*S*M+v*C*R,this._y=v*C*M-A*S*R,this._z=v*S*R-A*C*M,this._w=v*S*M+A*C*R;break;case"ZXY":this._x=A*S*M-v*C*R,this._y=v*C*M+A*S*R,this._z=v*S*R+A*C*M,this._w=v*S*M-A*C*R;break;case"ZYX":this._x=A*S*M-v*C*R,this._y=v*C*M+A*S*R,this._z=v*S*R-A*C*M,this._w=v*S*M+A*C*R;break;case"YZX":this._x=A*S*M+v*C*R,this._y=v*C*M+A*S*R,this._z=v*S*R-A*C*M,this._w=v*S*M-A*C*R;break;case"XZY":this._x=A*S*M-v*C*R,this._y=v*C*M-A*S*R,this._z=v*S*R+A*C*M,this._w=v*S*M+A*C*R;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+d)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,o=Math.sin(s);return this._x=t.x*o,this._y=t.y*o,this._z=t.z*o,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],o=e[4],c=e[8],d=e[1],a=e[5],_=e[9],v=e[2],S=e[6],M=e[10],A=s+a+M;if(A>0){const C=.5/Math.sqrt(A+1);this._w=.25/C,this._x=(S-_)*C,this._y=(c-v)*C,this._z=(d-o)*C}else if(s>a&&s>M){const C=2*Math.sqrt(1+s-a-M);this._w=(S-_)/C,this._x=.25*C,this._y=(o+d)/C,this._z=(c+v)/C}else if(a>M){const C=2*Math.sqrt(1+a-s-M);this._w=(c-v)/C,this._x=(o+d)/C,this._y=.25*C,this._z=(_+S)/C}else{const C=2*Math.sqrt(1+M-s-a);this._w=(d-o)/C,this._x=(c+v)/C,this._y=(_+S)/C,this._z=.25*C}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(wn(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(s===0)return this;const o=Math.min(1,e/s);return this.slerp(t,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,o=t._y,c=t._z,d=t._w,a=e._x,_=e._y,v=e._z,S=e._w;return this._x=s*S+d*a+o*v-c*_,this._y=o*S+d*_+c*a-s*v,this._z=c*S+d*v+s*_-o*a,this._w=d*S-s*a-o*_-c*v,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const s=this._x,o=this._y,c=this._z,d=this._w;let a=d*t._w+s*t._x+o*t._y+c*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=d,this._x=s,this._y=o,this._z=c,this;const _=1-a*a;if(_<=Number.EPSILON){const C=1-e;return this._w=C*d+e*this._w,this._x=C*s+e*this._x,this._y=C*o+e*this._y,this._z=C*c+e*this._z,this.normalize(),this._onChangeCallback(),this}const v=Math.sqrt(_),S=Math.atan2(v,a),M=Math.sin((1-e)*S)/v,A=Math.sin(e*S)/v;return this._w=d*M+this._w*A,this._x=s*M+this._x*A,this._y=o*M+this._y*A,this._z=c*M+this._z*A,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=Math.random(),e=Math.sqrt(1-t),s=Math.sqrt(t),o=2*Math.PI*Math.random(),c=2*Math.PI*Math.random();return this.set(e*Math.cos(o),s*Math.sin(c),s*Math.cos(c),e*Math.sin(o))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ut{constructor(t=0,e=0,s=0){ut.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return s===void 0&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(av.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(av.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,o=this.z,c=t.elements;return this.x=c[0]*e+c[3]*s+c[6]*o,this.y=c[1]*e+c[4]*s+c[7]*o,this.z=c[2]*e+c[5]*s+c[8]*o,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,o=this.z,c=t.elements,d=1/(c[3]*e+c[7]*s+c[11]*o+c[15]);return this.x=(c[0]*e+c[4]*s+c[8]*o+c[12])*d,this.y=(c[1]*e+c[5]*s+c[9]*o+c[13])*d,this.z=(c[2]*e+c[6]*s+c[10]*o+c[14])*d,this}applyQuaternion(t){const e=this.x,s=this.y,o=this.z,c=t.x,d=t.y,a=t.z,_=t.w,v=_*e+d*o-a*s,S=_*s+a*e-c*o,M=_*o+c*s-d*e,A=-c*e-d*s-a*o;return this.x=v*_+A*-c+S*-a-M*-d,this.y=S*_+A*-d+M*-c-v*-a,this.z=M*_+A*-a+v*-d-S*-c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,o=this.z,c=t.elements;return this.x=c[0]*e+c[4]*s+c[8]*o,this.y=c[1]*e+c[5]*s+c[9]*o,this.z=c[2]*e+c[6]*s+c[10]*o,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,o=t.y,c=t.z,d=e.x,a=e.y,_=e.z;return this.x=o*_-c*a,this.y=c*d-s*_,this.z=s*a-o*d,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return pg.copy(this).projectOnVector(t),this.sub(pg)}reflect(t){return this.sub(pg.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(wn(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,o=this.z-t.z;return e*e+s*s+o*o}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const o=Math.sin(e)*t;return this.x=o*Math.sin(s),this.y=Math.cos(e)*t,this.z=o*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),o=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=o,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,s=Math.sqrt(1-t**2);return this.x=s*Math.cos(e),this.y=s*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const pg=new ut,av=new Os;class Yr{constructor(t=new ut(1/0,1/0,1/0),e=new ut(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(_a.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(_a.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=_a.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){if(t.updateWorldMatrix(!1,!1),t.boundingBox!==void 0)t.boundingBox===null&&t.computeBoundingBox(),oh.copy(t.boundingBox),oh.applyMatrix4(t.matrixWorld),this.union(oh);else{const o=t.geometry;if(o!==void 0)if(e&&o.attributes!==void 0&&o.attributes.position!==void 0){const c=o.attributes.position;for(let d=0,a=c.count;d<a;d++)_a.fromBufferAttribute(c,d).applyMatrix4(t.matrixWorld),this.expandByPoint(_a)}else o.boundingBox===null&&o.computeBoundingBox(),oh.copy(o.boundingBox),oh.applyMatrix4(t.matrixWorld),this.union(oh)}const s=t.children;for(let o=0,c=s.length;o<c;o++)this.expandByObject(s[o],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,_a),_a.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(uu),Df.subVectors(this.max,uu),lh.subVectors(t.a,uu),hh.subVectors(t.b,uu),ch.subVectors(t.c,uu),no.subVectors(hh,lh),so.subVectors(ch,hh),Zo.subVectors(lh,ch);let e=[0,-no.z,no.y,0,-so.z,so.y,0,-Zo.z,Zo.y,no.z,0,-no.x,so.z,0,-so.x,Zo.z,0,-Zo.x,-no.y,no.x,0,-so.y,so.x,0,-Zo.y,Zo.x,0];return!mg(e,lh,hh,ch,Df)||(e=[1,0,0,0,1,0,0,0,1],!mg(e,lh,hh,ch,Df))?!1:(zf.crossVectors(no,so),e=[zf.x,zf.y,zf.z],mg(e,lh,hh,ch,Df))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_a).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(_a).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(ga[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ga[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ga[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ga[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ga[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ga[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ga[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ga[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ga),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const ga=[new ut,new ut,new ut,new ut,new ut,new ut,new ut,new ut],_a=new ut,oh=new Yr,lh=new ut,hh=new ut,ch=new ut,no=new ut,so=new ut,Zo=new ut,uu=new ut,Df=new ut,zf=new ut,Xo=new ut;function mg(l,t,e,s,o){for(let c=0,d=l.length-3;c<=d;c+=3){Xo.fromArray(l,c);const a=o.x*Math.abs(Xo.x)+o.y*Math.abs(Xo.y)+o.z*Math.abs(Xo.z),_=t.dot(Xo),v=e.dot(Xo),S=s.dot(Xo);if(Math.max(-Math.max(_,v,S),Math.min(_,v,S))>a)return!1}return!0}const C2=new Yr,du=new ut,gg=new ut;class Jr{constructor(t=new ut,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;e!==void 0?s.copy(e):C2.setFromPoints(t).getCenter(s);let o=0;for(let c=0,d=t.length;c<d;c++)o=Math.max(o,s.distanceToSquared(t[c]));return this.radius=Math.sqrt(o),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;du.subVectors(t,this.center);const e=du.lengthSq();if(e>this.radius*this.radius){const s=Math.sqrt(e),o=(s-this.radius)*.5;this.center.addScaledVector(du,o/s),this.radius+=o}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(gg.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(du.copy(t.center).add(gg)),this.expandByPoint(du.copy(t.center).sub(gg))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ya=new ut,_g=new ut,kf=new ut,ro=new ut,yg=new ut,Ff=new ut,vg=new ut;class ad{constructor(t=new ut,e=new ut(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ya)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=ya.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ya.copy(this.origin).addScaledVector(this.direction,e),ya.distanceToSquared(t))}distanceSqToSegment(t,e,s,o){_g.copy(t).add(e).multiplyScalar(.5),kf.copy(e).sub(t).normalize(),ro.copy(this.origin).sub(_g);const c=t.distanceTo(e)*.5,d=-this.direction.dot(kf),a=ro.dot(this.direction),_=-ro.dot(kf),v=ro.lengthSq(),S=Math.abs(1-d*d);let M,A,C,R;if(S>0)if(M=d*_-a,A=d*a-_,R=c*S,M>=0)if(A>=-R)if(A<=R){const F=1/S;M*=F,A*=F,C=M*(M+d*A+2*a)+A*(d*M+A+2*_)+v}else A=c,M=Math.max(0,-(d*A+a)),C=-M*M+A*(A+2*_)+v;else A=-c,M=Math.max(0,-(d*A+a)),C=-M*M+A*(A+2*_)+v;else A<=-R?(M=Math.max(0,-(-d*c+a)),A=M>0?-c:Math.min(Math.max(-c,-_),c),C=-M*M+A*(A+2*_)+v):A<=R?(M=0,A=Math.min(Math.max(-c,-_),c),C=A*(A+2*_)+v):(M=Math.max(0,-(d*c+a)),A=M>0?c:Math.min(Math.max(-c,-_),c),C=-M*M+A*(A+2*_)+v);else A=d>0?-c:c,M=Math.max(0,-(d*A+a)),C=-M*M+A*(A+2*_)+v;return s&&s.copy(this.origin).addScaledVector(this.direction,M),o&&o.copy(_g).addScaledVector(kf,A),C}intersectSphere(t,e){ya.subVectors(t.center,this.origin);const s=ya.dot(this.direction),o=ya.dot(ya)-s*s,c=t.radius*t.radius;if(o>c)return null;const d=Math.sqrt(c-o),a=s-d,_=s+d;return _<0?null:a<0?this.at(_,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null}intersectPlane(t,e){const s=this.distanceToPlane(t);return s===null?null:this.at(s,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let s,o,c,d,a,_;const v=1/this.direction.x,S=1/this.direction.y,M=1/this.direction.z,A=this.origin;return v>=0?(s=(t.min.x-A.x)*v,o=(t.max.x-A.x)*v):(s=(t.max.x-A.x)*v,o=(t.min.x-A.x)*v),S>=0?(c=(t.min.y-A.y)*S,d=(t.max.y-A.y)*S):(c=(t.max.y-A.y)*S,d=(t.min.y-A.y)*S),s>d||c>o||((c>s||isNaN(s))&&(s=c),(d<o||isNaN(o))&&(o=d),M>=0?(a=(t.min.z-A.z)*M,_=(t.max.z-A.z)*M):(a=(t.max.z-A.z)*M,_=(t.min.z-A.z)*M),s>_||a>o)||((a>s||s!==s)&&(s=a),(_<o||o!==o)&&(o=_),o<0)?null:this.at(s>=0?s:o,e)}intersectsBox(t){return this.intersectBox(t,ya)!==null}intersectTriangle(t,e,s,o,c){yg.subVectors(e,t),Ff.subVectors(s,t),vg.crossVectors(yg,Ff);let d=this.direction.dot(vg),a;if(d>0){if(o)return null;a=1}else if(d<0)a=-1,d=-d;else return null;ro.subVectors(this.origin,t);const _=a*this.direction.dot(Ff.crossVectors(ro,Ff));if(_<0)return null;const v=a*this.direction.dot(yg.cross(ro));if(v<0||_+v>d)return null;const S=-a*ro.dot(vg);return S<0?null:this.at(S/d,c)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class xi{constructor(){xi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,s,o,c,d,a,_,v,S,M,A,C,R,F,z){const L=this.elements;return L[0]=t,L[4]=e,L[8]=s,L[12]=o,L[1]=c,L[5]=d,L[9]=a,L[13]=_,L[2]=v,L[6]=S,L[10]=M,L[14]=A,L[3]=C,L[7]=R,L[11]=F,L[15]=z,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new xi().fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,o=1/uh.setFromMatrixColumn(t,0).length(),c=1/uh.setFromMatrixColumn(t,1).length(),d=1/uh.setFromMatrixColumn(t,2).length();return e[0]=s[0]*o,e[1]=s[1]*o,e[2]=s[2]*o,e[3]=0,e[4]=s[4]*c,e[5]=s[5]*c,e[6]=s[6]*c,e[7]=0,e[8]=s[8]*d,e[9]=s[9]*d,e[10]=s[10]*d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,o=t.y,c=t.z,d=Math.cos(s),a=Math.sin(s),_=Math.cos(o),v=Math.sin(o),S=Math.cos(c),M=Math.sin(c);if(t.order==="XYZ"){const A=d*S,C=d*M,R=a*S,F=a*M;e[0]=_*S,e[4]=-_*M,e[8]=v,e[1]=C+R*v,e[5]=A-F*v,e[9]=-a*_,e[2]=F-A*v,e[6]=R+C*v,e[10]=d*_}else if(t.order==="YXZ"){const A=_*S,C=_*M,R=v*S,F=v*M;e[0]=A+F*a,e[4]=R*a-C,e[8]=d*v,e[1]=d*M,e[5]=d*S,e[9]=-a,e[2]=C*a-R,e[6]=F+A*a,e[10]=d*_}else if(t.order==="ZXY"){const A=_*S,C=_*M,R=v*S,F=v*M;e[0]=A-F*a,e[4]=-d*M,e[8]=R+C*a,e[1]=C+R*a,e[5]=d*S,e[9]=F-A*a,e[2]=-d*v,e[6]=a,e[10]=d*_}else if(t.order==="ZYX"){const A=d*S,C=d*M,R=a*S,F=a*M;e[0]=_*S,e[4]=R*v-C,e[8]=A*v+F,e[1]=_*M,e[5]=F*v+A,e[9]=C*v-R,e[2]=-v,e[6]=a*_,e[10]=d*_}else if(t.order==="YZX"){const A=d*_,C=d*v,R=a*_,F=a*v;e[0]=_*S,e[4]=F-A*M,e[8]=R*M+C,e[1]=M,e[5]=d*S,e[9]=-a*S,e[2]=-v*S,e[6]=C*M+R,e[10]=A-F*M}else if(t.order==="XZY"){const A=d*_,C=d*v,R=a*_,F=a*v;e[0]=_*S,e[4]=-M,e[8]=v*S,e[1]=A*M+F,e[5]=d*S,e[9]=C*M-R,e[2]=R*M-C,e[6]=a*S,e[10]=F*M+A}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(I2,t,P2)}lookAt(t,e,s){const o=this.elements;return Js.subVectors(t,e),Js.lengthSq()===0&&(Js.z=1),Js.normalize(),ao.crossVectors(s,Js),ao.lengthSq()===0&&(Math.abs(s.z)===1?Js.x+=1e-4:Js.z+=1e-4,Js.normalize(),ao.crossVectors(s,Js)),ao.normalize(),Bf.crossVectors(Js,ao),o[0]=ao.x,o[4]=Bf.x,o[8]=Js.x,o[1]=ao.y,o[5]=Bf.y,o[9]=Js.y,o[2]=ao.z,o[6]=Bf.z,o[10]=Js.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,o=e.elements,c=this.elements,d=s[0],a=s[4],_=s[8],v=s[12],S=s[1],M=s[5],A=s[9],C=s[13],R=s[2],F=s[6],z=s[10],L=s[14],W=s[3],G=s[7],H=s[11],Q=s[15],nt=o[0],pt=o[4],ft=o[8],K=o[12],ot=o[1],kt=o[5],zt=o[9],It=o[13],Dt=o[2],Wt=o[6],se=o[10],ce=o[14],ie=o[3],be=o[7],de=o[11],$e=o[15];return c[0]=d*nt+a*ot+_*Dt+v*ie,c[4]=d*pt+a*kt+_*Wt+v*be,c[8]=d*ft+a*zt+_*se+v*de,c[12]=d*K+a*It+_*ce+v*$e,c[1]=S*nt+M*ot+A*Dt+C*ie,c[5]=S*pt+M*kt+A*Wt+C*be,c[9]=S*ft+M*zt+A*se+C*de,c[13]=S*K+M*It+A*ce+C*$e,c[2]=R*nt+F*ot+z*Dt+L*ie,c[6]=R*pt+F*kt+z*Wt+L*be,c[10]=R*ft+F*zt+z*se+L*de,c[14]=R*K+F*It+z*ce+L*$e,c[3]=W*nt+G*ot+H*Dt+Q*ie,c[7]=W*pt+G*kt+H*Wt+Q*be,c[11]=W*ft+G*zt+H*se+Q*de,c[15]=W*K+G*It+H*ce+Q*$e,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],o=t[8],c=t[12],d=t[1],a=t[5],_=t[9],v=t[13],S=t[2],M=t[6],A=t[10],C=t[14],R=t[3],F=t[7],z=t[11],L=t[15];return R*(+c*_*M-o*v*M-c*a*A+s*v*A+o*a*C-s*_*C)+F*(+e*_*C-e*v*A+c*d*A-o*d*C+o*v*S-c*_*S)+z*(+e*v*M-e*a*C-c*d*M+s*d*C+c*a*S-s*v*S)+L*(-o*a*S-e*_*M+e*a*A+o*d*M-s*d*A+s*_*S)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const o=this.elements;return t.isVector3?(o[12]=t.x,o[13]=t.y,o[14]=t.z):(o[12]=t,o[13]=e,o[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],o=t[2],c=t[3],d=t[4],a=t[5],_=t[6],v=t[7],S=t[8],M=t[9],A=t[10],C=t[11],R=t[12],F=t[13],z=t[14],L=t[15],W=M*z*v-F*A*v+F*_*C-a*z*C-M*_*L+a*A*L,G=R*A*v-S*z*v-R*_*C+d*z*C+S*_*L-d*A*L,H=S*F*v-R*M*v+R*a*C-d*F*C-S*a*L+d*M*L,Q=R*M*_-S*F*_-R*a*A+d*F*A+S*a*z-d*M*z,nt=e*W+s*G+o*H+c*Q;if(nt===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const pt=1/nt;return t[0]=W*pt,t[1]=(F*A*c-M*z*c-F*o*C+s*z*C+M*o*L-s*A*L)*pt,t[2]=(a*z*c-F*_*c+F*o*v-s*z*v-a*o*L+s*_*L)*pt,t[3]=(M*_*c-a*A*c-M*o*v+s*A*v+a*o*C-s*_*C)*pt,t[4]=G*pt,t[5]=(S*z*c-R*A*c+R*o*C-e*z*C-S*o*L+e*A*L)*pt,t[6]=(R*_*c-d*z*c-R*o*v+e*z*v+d*o*L-e*_*L)*pt,t[7]=(d*A*c-S*_*c+S*o*v-e*A*v-d*o*C+e*_*C)*pt,t[8]=H*pt,t[9]=(R*M*c-S*F*c-R*s*C+e*F*C+S*s*L-e*M*L)*pt,t[10]=(d*F*c-R*a*c+R*s*v-e*F*v-d*s*L+e*a*L)*pt,t[11]=(S*a*c-d*M*c-S*s*v+e*M*v+d*s*C-e*a*C)*pt,t[12]=Q*pt,t[13]=(S*F*o-R*M*o+R*s*A-e*F*A-S*s*z+e*M*z)*pt,t[14]=(R*a*o-d*F*o-R*s*_+e*F*_+d*s*z-e*a*z)*pt,t[15]=(d*M*o-S*a*o+S*s*_-e*M*_-d*s*A+e*a*A)*pt,this}scale(t){const e=this.elements,s=t.x,o=t.y,c=t.z;return e[0]*=s,e[4]*=o,e[8]*=c,e[1]*=s,e[5]*=o,e[9]*=c,e[2]*=s,e[6]*=o,e[10]*=c,e[3]*=s,e[7]*=o,e[11]*=c,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],o=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,o))}makeTranslation(t,e,s){return this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),o=Math.sin(e),c=1-s,d=t.x,a=t.y,_=t.z,v=c*d,S=c*a;return this.set(v*d+s,v*a-o*_,v*_+o*a,0,v*a+o*_,S*a+s,S*_-o*d,0,v*_-o*a,S*_+o*d,c*_*_+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,o,c,d){return this.set(1,s,c,0,t,1,d,0,e,o,1,0,0,0,0,1),this}compose(t,e,s){const o=this.elements,c=e._x,d=e._y,a=e._z,_=e._w,v=c+c,S=d+d,M=a+a,A=c*v,C=c*S,R=c*M,F=d*S,z=d*M,L=a*M,W=_*v,G=_*S,H=_*M,Q=s.x,nt=s.y,pt=s.z;return o[0]=(1-(F+L))*Q,o[1]=(C+H)*Q,o[2]=(R-G)*Q,o[3]=0,o[4]=(C-H)*nt,o[5]=(1-(A+L))*nt,o[6]=(z+W)*nt,o[7]=0,o[8]=(R+G)*pt,o[9]=(z-W)*pt,o[10]=(1-(A+F))*pt,o[11]=0,o[12]=t.x,o[13]=t.y,o[14]=t.z,o[15]=1,this}decompose(t,e,s){const o=this.elements;let c=uh.set(o[0],o[1],o[2]).length();const d=uh.set(o[4],o[5],o[6]).length(),a=uh.set(o[8],o[9],o[10]).length();this.determinant()<0&&(c=-c),t.x=o[12],t.y=o[13],t.z=o[14],Mr.copy(this);const v=1/c,S=1/d,M=1/a;return Mr.elements[0]*=v,Mr.elements[1]*=v,Mr.elements[2]*=v,Mr.elements[4]*=S,Mr.elements[5]*=S,Mr.elements[6]*=S,Mr.elements[8]*=M,Mr.elements[9]*=M,Mr.elements[10]*=M,e.setFromRotationMatrix(Mr),s.x=c,s.y=d,s.z=a,this}makePerspective(t,e,s,o,c,d){const a=this.elements,_=2*c/(e-t),v=2*c/(s-o),S=(e+t)/(e-t),M=(s+o)/(s-o),A=-(d+c)/(d-c),C=-2*d*c/(d-c);return a[0]=_,a[4]=0,a[8]=S,a[12]=0,a[1]=0,a[5]=v,a[9]=M,a[13]=0,a[2]=0,a[6]=0,a[10]=A,a[14]=C,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,s,o,c,d){const a=this.elements,_=1/(e-t),v=1/(s-o),S=1/(d-c),M=(e+t)*_,A=(s+o)*v,C=(d+c)*S;return a[0]=2*_,a[4]=0,a[8]=0,a[12]=-M,a[1]=0,a[5]=2*v,a[9]=0,a[13]=-A,a[2]=0,a[6]=0,a[10]=-2*S,a[14]=-C,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let o=0;o<16;o++)if(e[o]!==s[o])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const uh=new ut,Mr=new xi,I2=new ut(0,0,0),P2=new ut(1,1,1),ao=new ut,Bf=new ut,Js=new ut,ov=new xi,lv=new Os;class od{constructor(t=0,e=0,s=0,o=od.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=o}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,o=this._order){return this._x=t,this._y=e,this._z=s,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const o=t.elements,c=o[0],d=o[4],a=o[8],_=o[1],v=o[5],S=o[9],M=o[2],A=o[6],C=o[10];switch(e){case"XYZ":this._y=Math.asin(wn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-S,C),this._z=Math.atan2(-d,c)):(this._x=Math.atan2(A,v),this._z=0);break;case"YXZ":this._x=Math.asin(-wn(S,-1,1)),Math.abs(S)<.9999999?(this._y=Math.atan2(a,C),this._z=Math.atan2(_,v)):(this._y=Math.atan2(-M,c),this._z=0);break;case"ZXY":this._x=Math.asin(wn(A,-1,1)),Math.abs(A)<.9999999?(this._y=Math.atan2(-M,C),this._z=Math.atan2(-d,v)):(this._y=0,this._z=Math.atan2(_,c));break;case"ZYX":this._y=Math.asin(-wn(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(A,C),this._z=Math.atan2(_,c)):(this._x=0,this._z=Math.atan2(-d,v));break;case"YZX":this._z=Math.asin(wn(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(-S,v),this._y=Math.atan2(-M,c)):(this._x=0,this._y=Math.atan2(a,C));break;case"XZY":this._z=Math.asin(-wn(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(A,v),this._y=Math.atan2(a,c)):(this._x=Math.atan2(-S,C),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return ov.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ov,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return lv.setFromEuler(this),this.setFromQuaternion(lv,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}od.DEFAULT_ORDER="XYZ";class jp{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let L2=0;const hv=new ut,dh=new Os,va=new xi,Of=new ut,fu=new ut,R2=new ut,D2=new Os,cv=new ut(1,0,0),uv=new ut(0,1,0),dv=new ut(0,0,1),z2={type:"added"},fv={type:"removed"};class Vi extends Ca{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:L2++}),this.uuid=er(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Vi.DEFAULT_UP.clone();const t=new ut,e=new od,s=new Os,o=new ut(1,1,1);function c(){s.setFromEuler(e,!1)}function d(){e.setFromQuaternion(s,void 0,!1)}e._onChange(c),s._onChange(d),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new xi},normalMatrix:{value:new ki}}),this.matrix=new xi,this.matrixWorld=new xi,this.matrixAutoUpdate=Vi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Vi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new jp,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return dh.setFromAxisAngle(t,e),this.quaternion.multiply(dh),this}rotateOnWorldAxis(t,e){return dh.setFromAxisAngle(t,e),this.quaternion.premultiply(dh),this}rotateX(t){return this.rotateOnAxis(cv,t)}rotateY(t){return this.rotateOnAxis(uv,t)}rotateZ(t){return this.rotateOnAxis(dv,t)}translateOnAxis(t,e){return hv.copy(t).applyQuaternion(this.quaternion),this.position.add(hv.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(cv,t)}translateY(t){return this.translateOnAxis(uv,t)}translateZ(t){return this.translateOnAxis(dv,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(va.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?Of.copy(t):Of.set(t,e,s);const o=this.parent;this.updateWorldMatrix(!0,!1),fu.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?va.lookAt(fu,Of,this.up):va.lookAt(Of,fu,this.up),this.quaternion.setFromRotationMatrix(va),o&&(va.extractRotation(o.matrixWorld),dh.setFromRotationMatrix(va),this.quaternion.premultiply(dh.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(z2)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(fv)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(fv)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),va.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),va.multiply(t.parent.matrixWorld)),t.applyMatrix4(va),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,o=this.children.length;s<o;s++){const d=this.children[s].getObjectByProperty(t,e);if(d!==void 0)return d}}getObjectsByProperty(t,e){let s=[];this[t]===e&&s.push(this);for(let o=0,c=this.children.length;o<c;o++){const d=this.children[o].getObjectsByProperty(t,e);d.length>0&&(s=s.concat(d))}return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fu,t,R2),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fu,D2,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,o=e.length;s<o;s++)e[s].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let s=0,o=e.length;s<o;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,o=e.length;s<o;s++){const c=e[s];(c.matrixWorldAutoUpdate===!0||t===!0)&&c.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const s=this.parent;if(t===!0&&s!==null&&s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const o=this.children;for(let c=0,d=o.length;c<d;c++){const a=o[c];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const o={};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),o.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON()));function c(a,_){return a[_.uuid]===void 0&&(a[_.uuid]=_.toJSON(t)),_.uuid}if(this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=c(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const _=a.shapes;if(Array.isArray(_))for(let v=0,S=_.length;v<S;v++){const M=_[v];c(t.shapes,M)}else c(t.shapes,_)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(c(t.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let _=0,v=this.material.length;_<v;_++)a.push(c(t.materials,this.material[_]));o.material=a}else o.material=c(t.materials,this.material);if(this.children.length>0){o.children=[];for(let a=0;a<this.children.length;a++)o.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){o.animations=[];for(let a=0;a<this.animations.length;a++){const _=this.animations[a];o.animations.push(c(t.animations,_))}}if(e){const a=d(t.geometries),_=d(t.materials),v=d(t.textures),S=d(t.images),M=d(t.shapes),A=d(t.skeletons),C=d(t.animations),R=d(t.nodes);a.length>0&&(s.geometries=a),_.length>0&&(s.materials=_),v.length>0&&(s.textures=v),S.length>0&&(s.images=S),M.length>0&&(s.shapes=M),A.length>0&&(s.skeletons=A),C.length>0&&(s.animations=C),R.length>0&&(s.nodes=R)}return s.object=o,s;function d(a){const _=[];for(const v in a){const S=a[v];delete S.metadata,_.push(S)}return _}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let s=0;s<t.children.length;s++){const o=t.children[s];this.add(o.clone())}return this}}Vi.DEFAULT_UP=new ut(0,1,0);Vi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Vi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Sr=new ut,xa=new ut,xg=new ut,ba=new ut,fh=new ut,ph=new ut,pv=new ut,bg=new ut,wg=new ut,Mg=new ut;let Nf=!1;class Bs{constructor(t=new ut,e=new ut,s=new ut){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,o){o.subVectors(s,e),Sr.subVectors(t,e),o.cross(Sr);const c=o.lengthSq();return c>0?o.multiplyScalar(1/Math.sqrt(c)):o.set(0,0,0)}static getBarycoord(t,e,s,o,c){Sr.subVectors(o,e),xa.subVectors(s,e),xg.subVectors(t,e);const d=Sr.dot(Sr),a=Sr.dot(xa),_=Sr.dot(xg),v=xa.dot(xa),S=xa.dot(xg),M=d*v-a*a;if(M===0)return c.set(-2,-1,-1);const A=1/M,C=(v*_-a*S)*A,R=(d*S-a*_)*A;return c.set(1-C-R,R,C)}static containsPoint(t,e,s,o){return this.getBarycoord(t,e,s,o,ba),ba.x>=0&&ba.y>=0&&ba.x+ba.y<=1}static getUV(t,e,s,o,c,d,a,_){return Nf===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Nf=!0),this.getInterpolation(t,e,s,o,c,d,a,_)}static getInterpolation(t,e,s,o,c,d,a,_){return this.getBarycoord(t,e,s,o,ba),_.setScalar(0),_.addScaledVector(c,ba.x),_.addScaledVector(d,ba.y),_.addScaledVector(a,ba.z),_}static isFrontFacing(t,e,s,o){return Sr.subVectors(s,e),xa.subVectors(t,e),Sr.cross(xa).dot(o)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,o){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[o]),this}setFromAttributeAndIndices(t,e,s,o){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,o),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Sr.subVectors(this.c,this.b),xa.subVectors(this.a,this.b),Sr.cross(xa).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Bs.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Bs.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,s,o,c){return Nf===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Nf=!0),Bs.getInterpolation(t,this.a,this.b,this.c,e,s,o,c)}getInterpolation(t,e,s,o,c){return Bs.getInterpolation(t,this.a,this.b,this.c,e,s,o,c)}containsPoint(t){return Bs.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Bs.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,o=this.b,c=this.c;let d,a;fh.subVectors(o,s),ph.subVectors(c,s),bg.subVectors(t,s);const _=fh.dot(bg),v=ph.dot(bg);if(_<=0&&v<=0)return e.copy(s);wg.subVectors(t,o);const S=fh.dot(wg),M=ph.dot(wg);if(S>=0&&M<=S)return e.copy(o);const A=_*M-S*v;if(A<=0&&_>=0&&S<=0)return d=_/(_-S),e.copy(s).addScaledVector(fh,d);Mg.subVectors(t,c);const C=fh.dot(Mg),R=ph.dot(Mg);if(R>=0&&C<=R)return e.copy(c);const F=C*v-_*R;if(F<=0&&v>=0&&R<=0)return a=v/(v-R),e.copy(s).addScaledVector(ph,a);const z=S*R-C*M;if(z<=0&&M-S>=0&&C-R>=0)return pv.subVectors(c,o),a=(M-S)/(M-S+(C-R)),e.copy(o).addScaledVector(pv,a);const L=1/(z+F+A);return d=F*L,a=A*L,e.copy(s).addScaledVector(fh,d).addScaledVector(ph,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let k2=0;class _s extends Ca{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:k2++}),this.uuid=er(),this.name="",this.type="Material",this.blending=cl,this.side=Ea,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=U_,this.blendDst=V_,this.blendEquation=nl,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=zp,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=j1,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ip,this.stencilZFail=Ip,this.stencilZPass=Ip,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const s=t[e];if(s===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const o=this[e];if(o===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}o&&o.isColor?o.set(s):o&&o.isVector3&&s&&s.isVector3?o.copy(s):this[e]=s}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const s={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(t).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(t).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(t).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(t).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(t).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==cl&&(s.blending=this.blending),this.side!==Ea&&(s.side=this.side),this.vertexColors&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=this.transparent),s.depthFunc=this.depthFunc,s.depthTest=this.depthTest,s.depthWrite=this.depthWrite,s.colorWrite=this.colorWrite,s.stencilWrite=this.stencilWrite,s.stencilWriteMask=this.stencilWriteMask,s.stencilFunc=this.stencilFunc,s.stencilRef=this.stencilRef,s.stencilFuncMask=this.stencilFuncMask,s.stencilFail=this.stencilFail,s.stencilZFail=this.stencilZFail,s.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(s.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(s.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(s.wireframe=this.wireframe),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=this.flatShading),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function o(c){const d=[];for(const a in c){const _=c[a];delete _.metadata,d.push(_)}return d}if(e){const c=o(t.textures),d=o(t.images);c.length>0&&(s.textures=c),d.length>0&&(s.images=d)}return s}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let s=null;if(e!==null){const o=e.length;s=new Array(o);for(let c=0;c!==o;++c)s[c]=e[c].clone()}return this.clippingPlanes=s,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}const J1={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ar={h:0,s:0,l:0},Uf={h:0,s:0,l:0};function Sg(l,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?l+(t-l)*6*e:e<1/2?t:e<2/3?l+(t-l)*6*(2/3-e):l}class Je{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,e===void 0&&s===void 0?this.set(t):this.setRGB(t,e,s)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Tr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,zs.toWorkingColorSpace(this,e),this}setRGB(t,e,s,o=zs.workingColorSpace){return this.r=t,this.g=e,this.b=s,zs.toWorkingColorSpace(this,o),this}setHSL(t,e,s,o=zs.workingColorSpace){if(t=$_(t,1),e=wn(e,0,1),s=wn(s,0,1),e===0)this.r=this.g=this.b=s;else{const c=s<=.5?s*(1+e):s+e-s*e,d=2*s-c;this.r=Sg(d,c,t+1/3),this.g=Sg(d,c,t),this.b=Sg(d,c,t-1/3)}return zs.toWorkingColorSpace(this,o),this}setStyle(t,e=Tr){function s(c){c!==void 0&&parseFloat(c)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let o;if(o=/^(\w+)\(([^\)]*)\)/.exec(t)){let c;const d=o[1],a=o[2];switch(d){case"rgb":case"rgba":if(c=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,zs.toWorkingColorSpace(this,e),s(c[4]),this;if(c=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,zs.toWorkingColorSpace(this,e),s(c[4]),this;break;case"hsl":case"hsla":if(c=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const _=parseFloat(c[1])/360,v=parseFloat(c[2])/100,S=parseFloat(c[3])/100;return s(c[4]),this.setHSL(_,v,S,e)}break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(t)){const c=o[1],d=c.length;if(d===3)return this.setRGB(parseInt(c.charAt(0),16)/15,parseInt(c.charAt(1),16)/15,parseInt(c.charAt(2),16)/15,e);if(d===6)return this.setHex(parseInt(c,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Tr){const s=J1[t.toLowerCase()];return s!==void 0?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Oh(t.r),this.g=Oh(t.g),this.b=Oh(t.b),this}copyLinearToSRGB(t){return this.r=dg(t.r),this.g=dg(t.g),this.b=dg(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Tr){return zs.fromWorkingColorSpace(ps.copy(this),t),wn(ps.r*255,0,255)<<16^wn(ps.g*255,0,255)<<8^wn(ps.b*255,0,255)<<0}getHexString(t=Tr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=zs.workingColorSpace){zs.fromWorkingColorSpace(ps.copy(this),e);const s=ps.r,o=ps.g,c=ps.b,d=Math.max(s,o,c),a=Math.min(s,o,c);let _,v;const S=(a+d)/2;if(a===d)_=0,v=0;else{const M=d-a;switch(v=S<=.5?M/(d+a):M/(2-d-a),d){case s:_=(o-c)/M+(o<c?6:0);break;case o:_=(c-s)/M+2;break;case c:_=(s-o)/M+4;break}_/=6}return t.h=_,t.s=v,t.l=S,t}getRGB(t,e=zs.workingColorSpace){return zs.fromWorkingColorSpace(ps.copy(this),e),t.r=ps.r,t.g=ps.g,t.b=ps.b,t}getStyle(t=Tr){zs.fromWorkingColorSpace(ps.copy(this),t);const e=ps.r,s=ps.g,o=ps.b;return t!==Tr?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${o.toFixed(3)})`:`rgb(${e*255|0},${s*255|0},${o*255|0})`}offsetHSL(t,e,s){return this.getHSL(Ar),Ar.h+=t,Ar.s+=e,Ar.l+=s,this.setHSL(Ar.h,Ar.s,Ar.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(Ar),t.getHSL(Uf);const s=Cu(Ar.h,Uf.h,e),o=Cu(Ar.s,Uf.s,e),c=Cu(Ar.l,Uf.l,e);return this.setHSL(s,o,c),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,o=this.b,c=t.elements;return this.r=c[0]*e+c[3]*s+c[6]*o,this.g=c[1]*e+c[4]*s+c[7]*o,this.b=c[2]*e+c[5]*s+c[8]*o,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ps=new Je;Je.NAMES=J1;class Mo extends _s{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Je(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=rd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Sa=F2();function F2(){const l=new ArrayBuffer(4),t=new Float32Array(l),e=new Uint32Array(l),s=new Uint32Array(512),o=new Uint32Array(512);for(let _=0;_<256;++_){const v=_-127;v<-27?(s[_]=0,s[_|256]=32768,o[_]=24,o[_|256]=24):v<-14?(s[_]=1024>>-v-14,s[_|256]=1024>>-v-14|32768,o[_]=-v-1,o[_|256]=-v-1):v<=15?(s[_]=v+15<<10,s[_|256]=v+15<<10|32768,o[_]=13,o[_|256]=13):v<128?(s[_]=31744,s[_|256]=64512,o[_]=24,o[_|256]=24):(s[_]=31744,s[_|256]=64512,o[_]=13,o[_|256]=13)}const c=new Uint32Array(2048),d=new Uint32Array(64),a=new Uint32Array(64);for(let _=1;_<1024;++_){let v=_<<13,S=0;for(;!(v&8388608);)v<<=1,S-=8388608;v&=-8388609,S+=947912704,c[_]=v|S}for(let _=1024;_<2048;++_)c[_]=939524096+(_-1024<<13);for(let _=1;_<31;++_)d[_]=_<<23;d[31]=1199570944,d[32]=2147483648;for(let _=33;_<63;++_)d[_]=2147483648+(_-32<<23);d[63]=3347054592;for(let _=1;_<64;++_)_!==32&&(a[_]=1024);return{floatView:t,uint32View:e,baseTable:s,shiftTable:o,mantissaTable:c,exponentTable:d,offsetTable:a}}function ks(l){Math.abs(l)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),l=wn(l,-65504,65504),Sa.floatView[0]=l;const t=Sa.uint32View[0],e=t>>23&511;return Sa.baseTable[e]+((t&8388607)>>Sa.shiftTable[e])}function wu(l){const t=l>>10;return Sa.uint32View[0]=Sa.mantissaTable[Sa.offsetTable[t]+(l&1023)]+Sa.exponentTable[t],Sa.floatView[0]}const B2={toHalfFloat:ks,fromHalfFloat:wu},Nn=new ut,Vf=new me;class Zi{constructor(t,e,s=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=s,this.usage=Wu,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,s){t*=this.itemSize,s*=e.itemSize;for(let o=0,c=this.itemSize;o<c;o++)this.array[t+o]=e.array[s+o];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,s=this.count;e<s;e++)Vf.fromBufferAttribute(this,e),Vf.applyMatrix3(t),this.setXY(e,Vf.x,Vf.y);else if(this.itemSize===3)for(let e=0,s=this.count;e<s;e++)Nn.fromBufferAttribute(this,e),Nn.applyMatrix3(t),this.setXYZ(e,Nn.x,Nn.y,Nn.z);return this}applyMatrix4(t){for(let e=0,s=this.count;e<s;e++)Nn.fromBufferAttribute(this,e),Nn.applyMatrix4(t),this.setXYZ(e,Nn.x,Nn.y,Nn.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)Nn.fromBufferAttribute(this,e),Nn.applyNormalMatrix(t),this.setXYZ(e,Nn.x,Nn.y,Nn.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)Nn.fromBufferAttribute(this,e),Nn.transformDirection(t),this.setXYZ(e,Nn.x,Nn.y,Nn.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=tr(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ri(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=tr(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ri(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=tr(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ri(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=tr(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ri(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=Ri(e,this.array),s=Ri(s,this.array)),this.array[t+0]=e,this.array[t+1]=s,this}setXYZ(t,e,s,o){return t*=this.itemSize,this.normalized&&(e=Ri(e,this.array),s=Ri(s,this.array),o=Ri(o,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=o,this}setXYZW(t,e,s,o,c){return t*=this.itemSize,this.normalized&&(e=Ri(e,this.array),s=Ri(s,this.array),o=Ri(o,this.array),c=Ri(c,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=o,this.array[t+3]=c,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Wu&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class O2 extends Zi{constructor(t,e,s){super(new Int8Array(t),e,s)}}class N2 extends Zi{constructor(t,e,s){super(new Uint8Array(t),e,s)}}class U2 extends Zi{constructor(t,e,s){super(new Uint8ClampedArray(t),e,s)}}class V2 extends Zi{constructor(t,e,s){super(new Int16Array(t),e,s)}}class X_ extends Zi{constructor(t,e,s){super(new Uint16Array(t),e,s)}}class G2 extends Zi{constructor(t,e,s){super(new Int32Array(t),e,s)}}class Y_ extends Zi{constructor(t,e,s){super(new Uint32Array(t),e,s)}}class H2 extends Zi{constructor(t,e,s){super(new Uint16Array(t),e,s),this.isFloat16BufferAttribute=!0}getX(t){let e=wu(this.array[t*this.itemSize]);return this.normalized&&(e=tr(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ri(e,this.array)),this.array[t*this.itemSize]=ks(e),this}getY(t){let e=wu(this.array[t*this.itemSize+1]);return this.normalized&&(e=tr(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ri(e,this.array)),this.array[t*this.itemSize+1]=ks(e),this}getZ(t){let e=wu(this.array[t*this.itemSize+2]);return this.normalized&&(e=tr(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ri(e,this.array)),this.array[t*this.itemSize+2]=ks(e),this}getW(t){let e=wu(this.array[t*this.itemSize+3]);return this.normalized&&(e=tr(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ri(e,this.array)),this.array[t*this.itemSize+3]=ks(e),this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=Ri(e,this.array),s=Ri(s,this.array)),this.array[t+0]=ks(e),this.array[t+1]=ks(s),this}setXYZ(t,e,s,o){return t*=this.itemSize,this.normalized&&(e=Ri(e,this.array),s=Ri(s,this.array),o=Ri(o,this.array)),this.array[t+0]=ks(e),this.array[t+1]=ks(s),this.array[t+2]=ks(o),this}setXYZW(t,e,s,o,c){return t*=this.itemSize,this.normalized&&(e=Ri(e,this.array),s=Ri(s,this.array),o=Ri(o,this.array),c=Ri(c,this.array)),this.array[t+0]=ks(e),this.array[t+1]=ks(s),this.array[t+2]=ks(o),this.array[t+3]=ks(c),this}}class ii extends Zi{constructor(t,e,s){super(new Float32Array(t),e,s)}}class W2 extends Zi{constructor(t,e,s){super(new Float64Array(t),e,s)}}let q2=0;const dr=new xi,Ag=new Vi,mh=new ut,Ks=new Yr,pu=new Yr,Yn=new ut;class Ii extends Ca{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:q2++}),this.uuid=er(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Y1(t)?Y_:X_)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,s=0){this.groups.push({start:t,count:e,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const c=new ki().getNormalMatrix(t);s.applyNormalMatrix(c),s.needsUpdate=!0}const o=this.attributes.tangent;return o!==void 0&&(o.transformDirection(t),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return dr.makeRotationFromQuaternion(t),this.applyMatrix4(dr),this}rotateX(t){return dr.makeRotationX(t),this.applyMatrix4(dr),this}rotateY(t){return dr.makeRotationY(t),this.applyMatrix4(dr),this}rotateZ(t){return dr.makeRotationZ(t),this.applyMatrix4(dr),this}translate(t,e,s){return dr.makeTranslation(t,e,s),this.applyMatrix4(dr),this}scale(t,e,s){return dr.makeScale(t,e,s),this.applyMatrix4(dr),this}lookAt(t){return Ag.lookAt(t),Ag.updateMatrix(),this.applyMatrix4(Ag.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(mh).negate(),this.translate(mh.x,mh.y,mh.z),this}setFromPoints(t){const e=[];for(let s=0,o=t.length;s<o;s++){const c=t[s];e.push(c.x,c.y,c.z||0)}return this.setAttribute("position",new ii(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Yr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new ut(-1/0,-1/0,-1/0),new ut(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let s=0,o=e.length;s<o;s++){const c=e[s];Ks.setFromBufferAttribute(c),this.morphTargetsRelative?(Yn.addVectors(this.boundingBox.min,Ks.min),this.boundingBox.expandByPoint(Yn),Yn.addVectors(this.boundingBox.max,Ks.max),this.boundingBox.expandByPoint(Yn)):(this.boundingBox.expandByPoint(Ks.min),this.boundingBox.expandByPoint(Ks.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Jr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new ut,1/0);return}if(t){const s=this.boundingSphere.center;if(Ks.setFromBufferAttribute(t),e)for(let c=0,d=e.length;c<d;c++){const a=e[c];pu.setFromBufferAttribute(a),this.morphTargetsRelative?(Yn.addVectors(Ks.min,pu.min),Ks.expandByPoint(Yn),Yn.addVectors(Ks.max,pu.max),Ks.expandByPoint(Yn)):(Ks.expandByPoint(pu.min),Ks.expandByPoint(pu.max))}Ks.getCenter(s);let o=0;for(let c=0,d=t.count;c<d;c++)Yn.fromBufferAttribute(t,c),o=Math.max(o,s.distanceToSquared(Yn));if(e)for(let c=0,d=e.length;c<d;c++){const a=e[c],_=this.morphTargetsRelative;for(let v=0,S=a.count;v<S;v++)Yn.fromBufferAttribute(a,v),_&&(mh.fromBufferAttribute(t,v),Yn.add(mh)),o=Math.max(o,s.distanceToSquared(Yn))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=t.array,o=e.position.array,c=e.normal.array,d=e.uv.array,a=o.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Zi(new Float32Array(4*a),4));const _=this.getAttribute("tangent").array,v=[],S=[];for(let ot=0;ot<a;ot++)v[ot]=new ut,S[ot]=new ut;const M=new ut,A=new ut,C=new ut,R=new me,F=new me,z=new me,L=new ut,W=new ut;function G(ot,kt,zt){M.fromArray(o,ot*3),A.fromArray(o,kt*3),C.fromArray(o,zt*3),R.fromArray(d,ot*2),F.fromArray(d,kt*2),z.fromArray(d,zt*2),A.sub(M),C.sub(M),F.sub(R),z.sub(R);const It=1/(F.x*z.y-z.x*F.y);isFinite(It)&&(L.copy(A).multiplyScalar(z.y).addScaledVector(C,-F.y).multiplyScalar(It),W.copy(C).multiplyScalar(F.x).addScaledVector(A,-z.x).multiplyScalar(It),v[ot].add(L),v[kt].add(L),v[zt].add(L),S[ot].add(W),S[kt].add(W),S[zt].add(W))}let H=this.groups;H.length===0&&(H=[{start:0,count:s.length}]);for(let ot=0,kt=H.length;ot<kt;++ot){const zt=H[ot],It=zt.start,Dt=zt.count;for(let Wt=It,se=It+Dt;Wt<se;Wt+=3)G(s[Wt+0],s[Wt+1],s[Wt+2])}const Q=new ut,nt=new ut,pt=new ut,ft=new ut;function K(ot){pt.fromArray(c,ot*3),ft.copy(pt);const kt=v[ot];Q.copy(kt),Q.sub(pt.multiplyScalar(pt.dot(kt))).normalize(),nt.crossVectors(ft,kt);const It=nt.dot(S[ot])<0?-1:1;_[ot*4]=Q.x,_[ot*4+1]=Q.y,_[ot*4+2]=Q.z,_[ot*4+3]=It}for(let ot=0,kt=H.length;ot<kt;++ot){const zt=H[ot],It=zt.start,Dt=zt.count;for(let Wt=It,se=It+Dt;Wt<se;Wt+=3)K(s[Wt+0]),K(s[Wt+1]),K(s[Wt+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new Zi(new Float32Array(e.count*3),3),this.setAttribute("normal",s);else for(let A=0,C=s.count;A<C;A++)s.setXYZ(A,0,0,0);const o=new ut,c=new ut,d=new ut,a=new ut,_=new ut,v=new ut,S=new ut,M=new ut;if(t)for(let A=0,C=t.count;A<C;A+=3){const R=t.getX(A+0),F=t.getX(A+1),z=t.getX(A+2);o.fromBufferAttribute(e,R),c.fromBufferAttribute(e,F),d.fromBufferAttribute(e,z),S.subVectors(d,c),M.subVectors(o,c),S.cross(M),a.fromBufferAttribute(s,R),_.fromBufferAttribute(s,F),v.fromBufferAttribute(s,z),a.add(S),_.add(S),v.add(S),s.setXYZ(R,a.x,a.y,a.z),s.setXYZ(F,_.x,_.y,_.z),s.setXYZ(z,v.x,v.y,v.z)}else for(let A=0,C=e.count;A<C;A+=3)o.fromBufferAttribute(e,A+0),c.fromBufferAttribute(e,A+1),d.fromBufferAttribute(e,A+2),S.subVectors(d,c),M.subVectors(o,c),S.cross(M),s.setXYZ(A+0,S.x,S.y,S.z),s.setXYZ(A+1,S.x,S.y,S.z),s.setXYZ(A+2,S.x,S.y,S.z);this.normalizeNormals(),s.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,s=t.count;e<s;e++)Yn.fromBufferAttribute(t,e),Yn.normalize(),t.setXYZ(e,Yn.x,Yn.y,Yn.z)}toNonIndexed(){function t(a,_){const v=a.array,S=a.itemSize,M=a.normalized,A=new v.constructor(_.length*S);let C=0,R=0;for(let F=0,z=_.length;F<z;F++){a.isInterleavedBufferAttribute?C=_[F]*a.data.stride+a.offset:C=_[F]*S;for(let L=0;L<S;L++)A[R++]=v[C++]}return new Zi(A,S,M)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Ii,s=this.index.array,o=this.attributes;for(const a in o){const _=o[a],v=t(_,s);e.setAttribute(a,v)}const c=this.morphAttributes;for(const a in c){const _=[],v=c[a];for(let S=0,M=v.length;S<M;S++){const A=v[S],C=t(A,s);_.push(C)}e.morphAttributes[a]=_}e.morphTargetsRelative=this.morphTargetsRelative;const d=this.groups;for(let a=0,_=d.length;a<_;a++){const v=d[a];e.addGroup(v.start,v.count,v.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const _=this.parameters;for(const v in _)_[v]!==void 0&&(t[v]=_[v]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const s=this.attributes;for(const _ in s){const v=s[_];t.data.attributes[_]=v.toJSON(t.data)}const o={};let c=!1;for(const _ in this.morphAttributes){const v=this.morphAttributes[_],S=[];for(let M=0,A=v.length;M<A;M++){const C=v[M];S.push(C.toJSON(t.data))}S.length>0&&(o[_]=S,c=!0)}c&&(t.data.morphAttributes=o,t.data.morphTargetsRelative=this.morphTargetsRelative);const d=this.groups;d.length>0&&(t.data.groups=JSON.parse(JSON.stringify(d)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const s=t.index;s!==null&&this.setIndex(s.clone(e));const o=t.attributes;for(const v in o){const S=o[v];this.setAttribute(v,S.clone(e))}const c=t.morphAttributes;for(const v in c){const S=[],M=c[v];for(let A=0,C=M.length;A<C;A++)S.push(M[A].clone(e));this.morphAttributes[v]=S}this.morphTargetsRelative=t.morphTargetsRelative;const d=t.groups;for(let v=0,S=d.length;v<S;v++){const M=d[v];this.addGroup(M.start,M.count,M.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const _=t.boundingSphere;return _!==null&&(this.boundingSphere=_.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const mv=new xi,Nr=new ad,Gf=new Jr,gv=new ut,gh=new ut,_h=new ut,yh=new ut,Tg=new ut,Hf=new ut,Wf=new me,qf=new me,$f=new me,_v=new ut,yv=new ut,vv=new ut,jf=new ut,Zf=new ut;class Vn extends Vi{constructor(t=new Ii,e=new Mo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const o=e[s[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,d=o.length;c<d;c++){const a=o[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=c}}}}getVertexPosition(t,e){const s=this.geometry,o=s.attributes.position,c=s.morphAttributes.position,d=s.morphTargetsRelative;e.fromBufferAttribute(o,t);const a=this.morphTargetInfluences;if(c&&a){Hf.set(0,0,0);for(let _=0,v=c.length;_<v;_++){const S=a[_],M=c[_];S!==0&&(Tg.fromBufferAttribute(M,t),d?Hf.addScaledVector(Tg,S):Hf.addScaledVector(Tg.sub(e),S))}e.add(Hf)}return this.isSkinnedMesh&&this.applyBoneTransform(t,e),e}raycast(t,e){const s=this.geometry,o=this.material,c=this.matrixWorld;if(o===void 0||(s.boundingSphere===null&&s.computeBoundingSphere(),Gf.copy(s.boundingSphere),Gf.applyMatrix4(c),Nr.copy(t.ray).recast(t.near),Gf.containsPoint(Nr.origin)===!1&&(Nr.intersectSphere(Gf,gv)===null||Nr.origin.distanceToSquared(gv)>(t.far-t.near)**2))||(mv.copy(c).invert(),Nr.copy(t.ray).applyMatrix4(mv),s.boundingBox!==null&&Nr.intersectsBox(s.boundingBox)===!1))return;let d;const a=s.index,_=s.attributes.position,v=s.attributes.uv,S=s.attributes.uv2,M=s.attributes.normal,A=s.groups,C=s.drawRange;if(a!==null)if(Array.isArray(o))for(let R=0,F=A.length;R<F;R++){const z=A[R],L=o[z.materialIndex],W=Math.max(z.start,C.start),G=Math.min(a.count,Math.min(z.start+z.count,C.start+C.count));for(let H=W,Q=G;H<Q;H+=3){const nt=a.getX(H),pt=a.getX(H+1),ft=a.getX(H+2);d=Xf(this,L,t,Nr,v,S,M,nt,pt,ft),d&&(d.faceIndex=Math.floor(H/3),d.face.materialIndex=z.materialIndex,e.push(d))}}else{const R=Math.max(0,C.start),F=Math.min(a.count,C.start+C.count);for(let z=R,L=F;z<L;z+=3){const W=a.getX(z),G=a.getX(z+1),H=a.getX(z+2);d=Xf(this,o,t,Nr,v,S,M,W,G,H),d&&(d.faceIndex=Math.floor(z/3),e.push(d))}}else if(_!==void 0)if(Array.isArray(o))for(let R=0,F=A.length;R<F;R++){const z=A[R],L=o[z.materialIndex],W=Math.max(z.start,C.start),G=Math.min(_.count,Math.min(z.start+z.count,C.start+C.count));for(let H=W,Q=G;H<Q;H+=3){const nt=H,pt=H+1,ft=H+2;d=Xf(this,L,t,Nr,v,S,M,nt,pt,ft),d&&(d.faceIndex=Math.floor(H/3),d.face.materialIndex=z.materialIndex,e.push(d))}}else{const R=Math.max(0,C.start),F=Math.min(_.count,C.start+C.count);for(let z=R,L=F;z<L;z+=3){const W=z,G=z+1,H=z+2;d=Xf(this,o,t,Nr,v,S,M,W,G,H),d&&(d.faceIndex=Math.floor(z/3),e.push(d))}}}}function $2(l,t,e,s,o,c,d,a){let _;if(t.side===Ps?_=s.intersectTriangle(d,c,o,!0,a):_=s.intersectTriangle(o,c,d,t.side===Ea,a),_===null)return null;Zf.copy(a),Zf.applyMatrix4(l.matrixWorld);const v=e.ray.origin.distanceTo(Zf);return v<e.near||v>e.far?null:{distance:v,point:Zf.clone(),object:l}}function Xf(l,t,e,s,o,c,d,a,_,v){l.getVertexPosition(a,gh),l.getVertexPosition(_,_h),l.getVertexPosition(v,yh);const S=$2(l,t,e,s,gh,_h,yh,jf);if(S){o&&(Wf.fromBufferAttribute(o,a),qf.fromBufferAttribute(o,_),$f.fromBufferAttribute(o,v),S.uv=Bs.getInterpolation(jf,gh,_h,yh,Wf,qf,$f,new me)),c&&(Wf.fromBufferAttribute(c,a),qf.fromBufferAttribute(c,_),$f.fromBufferAttribute(c,v),S.uv2=Bs.getInterpolation(jf,gh,_h,yh,Wf,qf,$f,new me)),d&&(_v.fromBufferAttribute(d,a),yv.fromBufferAttribute(d,_),vv.fromBufferAttribute(d,v),S.normal=Bs.getInterpolation(jf,gh,_h,yh,_v,yv,vv,new ut),S.normal.dot(s.direction)>0&&S.normal.multiplyScalar(-1));const M={a,b:_,c:v,normal:new ut,materialIndex:0};Bs.getNormal(gh,_h,yh,M.normal),S.face=M}return S}class So extends Ii{constructor(t=1,e=1,s=1,o=1,c=1,d=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:s,widthSegments:o,heightSegments:c,depthSegments:d};const a=this;o=Math.floor(o),c=Math.floor(c),d=Math.floor(d);const _=[],v=[],S=[],M=[];let A=0,C=0;R("z","y","x",-1,-1,s,e,t,d,c,0),R("z","y","x",1,-1,s,e,-t,d,c,1),R("x","z","y",1,1,t,s,e,o,d,2),R("x","z","y",1,-1,t,s,-e,o,d,3),R("x","y","z",1,-1,t,e,s,o,c,4),R("x","y","z",-1,-1,t,e,-s,o,c,5),this.setIndex(_),this.setAttribute("position",new ii(v,3)),this.setAttribute("normal",new ii(S,3)),this.setAttribute("uv",new ii(M,2));function R(F,z,L,W,G,H,Q,nt,pt,ft,K){const ot=H/pt,kt=Q/ft,zt=H/2,It=Q/2,Dt=nt/2,Wt=pt+1,se=ft+1;let ce=0,ie=0;const be=new ut;for(let de=0;de<se;de++){const $e=de*kt-It;for(let _e=0;_e<Wt;_e++){const Yt=_e*ot-zt;be[F]=Yt*W,be[z]=$e*G,be[L]=Dt,v.push(be.x,be.y,be.z),be[F]=0,be[z]=0,be[L]=nt>0?1:-1,S.push(be.x,be.y,be.z),M.push(_e/pt),M.push(1-de/ft),ce+=1}}for(let de=0;de<ft;de++)for(let $e=0;$e<pt;$e++){const _e=A+$e+Wt*de,Yt=A+$e+Wt*(de+1),re=A+($e+1)+Wt*(de+1),Re=A+($e+1)+Wt*de;_.push(_e,Yt,Re),_.push(Yt,re,Re),ie+=6}a.addGroup(C,ie,K),C+=ie,A+=ce}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new So(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function qh(l){const t={};for(const e in l){t[e]={};for(const s in l[e]){const o=l[e][s];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?o.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][s]=null):t[e][s]=o.clone():Array.isArray(o)?t[e][s]=o.slice():t[e][s]=o}}return t}function Es(l){const t={};for(let e=0;e<l.length;e++){const s=qh(l[e]);for(const o in s)t[o]=s[o]}return t}function j2(l){const t=[];for(let e=0;e<l.length;e++)t.push(l[e].clone());return t}function K1(l){return l.getRenderTarget()===null&&l.outputEncoding===on?Tr:Hh}const Q1={clone:qh,merge:Es};var Z2=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,X2=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class jr extends _s{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Z2,this.fragmentShader=X2,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=qh(t.uniforms),this.uniformsGroups=j2(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const o in this.uniforms){const d=this.uniforms[o].value;d&&d.isTexture?e.uniforms[o]={type:"t",value:d.toJSON(t).uuid}:d&&d.isColor?e.uniforms[o]={type:"c",value:d.getHex()}:d&&d.isVector2?e.uniforms[o]={type:"v2",value:d.toArray()}:d&&d.isVector3?e.uniforms[o]={type:"v3",value:d.toArray()}:d&&d.isVector4?e.uniforms[o]={type:"v4",value:d.toArray()}:d&&d.isMatrix3?e.uniforms[o]={type:"m3",value:d.toArray()}:d&&d.isMatrix4?e.uniforms[o]={type:"m4",value:d.toArray()}:e.uniforms[o]={value:d}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const s={};for(const o in this.extensions)this.extensions[o]===!0&&(s[o]=!0);return Object.keys(s).length>0&&(e.extensions=s),e}}class ld extends Vi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new xi,this.projectionMatrix=new xi,this.projectionMatrixInverse=new xi}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class ns extends ld{constructor(t=50,e=1,s=.1,o=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=s,this.far=o,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=Wh*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(dl*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Wh*2*Math.atan(Math.tan(dl*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,s,o,c,d){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=o,this.view.width=c,this.view.height=d,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(dl*.5*this.fov)/this.zoom,s=2*e,o=this.aspect*s,c=-.5*o;const d=this.view;if(this.view!==null&&this.view.enabled){const _=d.fullWidth,v=d.fullHeight;c+=d.offsetX*o/_,e-=d.offsetY*s/v,o*=d.width/_,s*=d.height/v}const a=this.filmOffset;a!==0&&(c+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(c,c+o,e,e-s,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const vh=-90,xh=1;class tb extends Vi{constructor(t,e,s){super(),this.type="CubeCamera",this.renderTarget=s;const o=new ns(vh,xh,t,e);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(1,0,0),this.add(o);const c=new ns(vh,xh,t,e);c.layers=this.layers,c.up.set(0,1,0),c.lookAt(-1,0,0),this.add(c);const d=new ns(vh,xh,t,e);d.layers=this.layers,d.up.set(0,0,-1),d.lookAt(0,1,0),this.add(d);const a=new ns(vh,xh,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);const _=new ns(vh,xh,t,e);_.layers=this.layers,_.up.set(0,1,0),_.lookAt(0,0,1),this.add(_);const v=new ns(vh,xh,t,e);v.layers=this.layers,v.up.set(0,1,0),v.lookAt(0,0,-1),this.add(v)}update(t,e){this.parent===null&&this.updateMatrixWorld();const s=this.renderTarget,[o,c,d,a,_,v]=this.children,S=t.getRenderTarget(),M=t.toneMapping,A=t.xr.enabled;t.toneMapping=Hr,t.xr.enabled=!1;const C=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,t.setRenderTarget(s,0),t.render(e,o),t.setRenderTarget(s,1),t.render(e,c),t.setRenderTarget(s,2),t.render(e,d),t.setRenderTarget(s,3),t.render(e,a),t.setRenderTarget(s,4),t.render(e,_),s.texture.generateMipmaps=C,t.setRenderTarget(s,5),t.render(e,v),t.setRenderTarget(S),t.toneMapping=M,t.xr.enabled=A,s.texture.needsPMREMUpdate=!0}}class hd extends zn{constructor(t,e,s,o,c,d,a,_,v,S){t=t!==void 0?t:[],e=e!==void 0?e:po,super(t,e,s,o,c,d,a,_,v,S),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class eb extends Ir{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const s={width:t,height:t,depth:1},o=[s,s,s,s,s,s];this.texture=new hd(o,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:Dn}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const s={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},o=new So(5,5,5),c=new jr({name:"CubemapFromEquirect",uniforms:qh(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,side:Ps,blending:Ta});c.uniforms.tEquirect.value=e;const d=new Vn(o,c),a=e.minFilter;return e.minFilter===go&&(e.minFilter=Dn),new tb(1,10,this).update(t,d),e.minFilter=a,d.geometry.dispose(),d.material.dispose(),this}clear(t,e,s,o){const c=t.getRenderTarget();for(let d=0;d<6;d++)t.setRenderTarget(this,d),t.clear(e,s,o);t.setRenderTarget(c)}}const Eg=new ut,Y2=new ut,J2=new ki;class lo{constructor(t=new ut(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,o){return this.normal.set(t,e,s),this.constant=o,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const o=Eg.subVectors(s,e).cross(Y2.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(o,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(Eg),o=this.normal.dot(s);if(o===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const c=-(t.start.dot(this.normal)+this.constant)/o;return c<0||c>1?null:e.copy(t.start).addScaledVector(s,c)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||J2.getNormalMatrix(t),o=this.coplanarPoint(Eg).applyMatrix4(t),c=this.normal.applyMatrix3(s).normalize();return this.constant=-o.dot(c),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Yo=new Jr,Yf=new ut;class Zp{constructor(t=new lo,e=new lo,s=new lo,o=new lo,c=new lo,d=new lo){this.planes=[t,e,s,o,c,d]}set(t,e,s,o,c,d){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(s),a[3].copy(o),a[4].copy(c),a[5].copy(d),this}copy(t){const e=this.planes;for(let s=0;s<6;s++)e[s].copy(t.planes[s]);return this}setFromProjectionMatrix(t){const e=this.planes,s=t.elements,o=s[0],c=s[1],d=s[2],a=s[3],_=s[4],v=s[5],S=s[6],M=s[7],A=s[8],C=s[9],R=s[10],F=s[11],z=s[12],L=s[13],W=s[14],G=s[15];return e[0].setComponents(a-o,M-_,F-A,G-z).normalize(),e[1].setComponents(a+o,M+_,F+A,G+z).normalize(),e[2].setComponents(a+c,M+v,F+C,G+L).normalize(),e[3].setComponents(a-c,M-v,F-C,G-L).normalize(),e[4].setComponents(a-d,M-S,F-R,G-W).normalize(),e[5].setComponents(a+d,M+S,F+R,G+W).normalize(),this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),Yo.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Yo.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Yo)}intersectsSprite(t){return Yo.center.set(0,0,0),Yo.radius=.7071067811865476,Yo.applyMatrix4(t.matrixWorld),this.intersectsSphere(Yo)}intersectsSphere(t){const e=this.planes,s=t.center,o=-t.radius;for(let c=0;c<6;c++)if(e[c].distanceToPoint(s)<o)return!1;return!0}intersectsBox(t){const e=this.planes;for(let s=0;s<6;s++){const o=e[s];if(Yf.x=o.normal.x>0?t.max.x:t.min.x,Yf.y=o.normal.y>0?t.max.y:t.min.y,Yf.z=o.normal.z>0?t.max.z:t.min.z,o.distanceToPoint(Yf)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ib(){let l=null,t=!1,e=null,s=null;function o(c,d){e(c,d),s=l.requestAnimationFrame(o)}return{start:function(){t!==!0&&e!==null&&(s=l.requestAnimationFrame(o),t=!0)},stop:function(){l.cancelAnimationFrame(s),t=!1},setAnimationLoop:function(c){e=c},setContext:function(c){l=c}}}function K2(l,t){const e=t.isWebGL2,s=new WeakMap;function o(v,S){const M=v.array,A=v.usage,C=l.createBuffer();l.bindBuffer(S,C),l.bufferData(S,M,A),v.onUploadCallback();let R;if(M instanceof Float32Array)R=5126;else if(M instanceof Uint16Array)if(v.isFloat16BufferAttribute)if(e)R=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else R=5123;else if(M instanceof Int16Array)R=5122;else if(M instanceof Uint32Array)R=5125;else if(M instanceof Int32Array)R=5124;else if(M instanceof Int8Array)R=5120;else if(M instanceof Uint8Array)R=5121;else if(M instanceof Uint8ClampedArray)R=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+M);return{buffer:C,type:R,bytesPerElement:M.BYTES_PER_ELEMENT,version:v.version}}function c(v,S,M){const A=S.array,C=S.updateRange;l.bindBuffer(M,v),C.count===-1?l.bufferSubData(M,0,A):(e?l.bufferSubData(M,C.offset*A.BYTES_PER_ELEMENT,A,C.offset,C.count):l.bufferSubData(M,C.offset*A.BYTES_PER_ELEMENT,A.subarray(C.offset,C.offset+C.count)),C.count=-1),S.onUploadCallback()}function d(v){return v.isInterleavedBufferAttribute&&(v=v.data),s.get(v)}function a(v){v.isInterleavedBufferAttribute&&(v=v.data);const S=s.get(v);S&&(l.deleteBuffer(S.buffer),s.delete(v))}function _(v,S){if(v.isGLBufferAttribute){const A=s.get(v);(!A||A.version<v.version)&&s.set(v,{buffer:v.buffer,type:v.type,bytesPerElement:v.elementSize,version:v.version});return}v.isInterleavedBufferAttribute&&(v=v.data);const M=s.get(v);M===void 0?s.set(v,o(v,S)):M.version<v.version&&(c(M.buffer,v,S),M.version=v.version)}return{get:d,remove:a,update:_}}class Yh extends Ii{constructor(t=1,e=1,s=1,o=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:s,heightSegments:o};const c=t/2,d=e/2,a=Math.floor(s),_=Math.floor(o),v=a+1,S=_+1,M=t/a,A=e/_,C=[],R=[],F=[],z=[];for(let L=0;L<S;L++){const W=L*A-d;for(let G=0;G<v;G++){const H=G*M-c;R.push(H,-W,0),F.push(0,0,1),z.push(G/a),z.push(1-L/_)}}for(let L=0;L<_;L++)for(let W=0;W<a;W++){const G=W+v*L,H=W+v*(L+1),Q=W+1+v*(L+1),nt=W+1+v*L;C.push(G,H,nt),C.push(H,Q,nt)}this.setIndex(C),this.setAttribute("position",new ii(R,3)),this.setAttribute("normal",new ii(F,3)),this.setAttribute("uv",new ii(z,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Yh(t.width,t.height,t.widthSegments,t.heightSegments)}}var Q2=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,tA=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,eA=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,iA=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,nA=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,sA=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,rA="vec3 transformed = vec3( position );",aA=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,oA=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,lA=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,hA=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,cA=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,uA=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,dA=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,fA=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,pA=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,mA=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,gA=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,_A=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,yA=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,vA=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,xA=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,bA=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,wA=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,MA=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,SA=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,AA="gl_FragColor = linearToOutputTexel( gl_FragColor );",TA=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,EA=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,CA=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,IA=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,PA=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,LA=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,RA=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,DA=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,zA=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,kA=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,FA=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,BA=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,OA=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,NA=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,UA=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,VA=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,GA=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,HA=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,WA=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,qA=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,$A=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,jA=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif`,ZA=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,XA=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,YA=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,JA=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,KA=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,QA=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,tT=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,eT=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,iT=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,nT=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,sT=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,rT=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,aT=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,oT=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,lT=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,hT=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,cT=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,uT=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,dT=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#ifdef USE_NORMALMAP_TANGENTSPACE
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,fT=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,pT=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,mT=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,gT=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,_T=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,yT=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,vT=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,xT=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,bT=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,wT=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,MT=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,ST=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,AT=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,TT=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,ET=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,CT=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,IT=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,PT=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,LT=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,RT=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,DT=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,zT=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,kT=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,FT=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,BT=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,OT=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,NT=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,UT=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,VT=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,GT=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,HT=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, vec2 fullSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		
		vec2 lodFudge = pow( 1.95, lod ) / fullSize;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec2 fullSize = vec2( textureSize( sampler, 0 ) );
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), fullSize, floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), fullSize, ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,WT=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,qT=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_UV2
	attribute vec2 uv2;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,$T=`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,jT=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const ZT=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,XT=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,YT=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,JT=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,KT=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,QT=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,tE=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,eE=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,iE=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,nE=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,sE=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,rE=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,aE=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,oE=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,lE=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,hE=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cE=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,uE=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dE=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fE=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pE=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,mE=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,gE=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_E=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yE=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,vE=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xE=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bE=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wE=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,ME=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,SE=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,AE=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,TE=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,EE=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Li={alphamap_fragment:Q2,alphamap_pars_fragment:tA,alphatest_fragment:eA,alphatest_pars_fragment:iA,aomap_fragment:nA,aomap_pars_fragment:sA,begin_vertex:rA,beginnormal_vertex:aA,bsdfs:oA,iridescence_fragment:lA,bumpmap_pars_fragment:hA,clipping_planes_fragment:cA,clipping_planes_pars_fragment:uA,clipping_planes_pars_vertex:dA,clipping_planes_vertex:fA,color_fragment:pA,color_pars_fragment:mA,color_pars_vertex:gA,color_vertex:_A,common:yA,cube_uv_reflection_fragment:vA,defaultnormal_vertex:xA,displacementmap_pars_vertex:bA,displacementmap_vertex:wA,emissivemap_fragment:MA,emissivemap_pars_fragment:SA,encodings_fragment:AA,encodings_pars_fragment:TA,envmap_fragment:EA,envmap_common_pars_fragment:CA,envmap_pars_fragment:IA,envmap_pars_vertex:PA,envmap_physical_pars_fragment:GA,envmap_vertex:LA,fog_vertex:RA,fog_pars_vertex:DA,fog_fragment:zA,fog_pars_fragment:kA,gradientmap_pars_fragment:FA,lightmap_fragment:BA,lightmap_pars_fragment:OA,lights_lambert_fragment:NA,lights_lambert_pars_fragment:UA,lights_pars_begin:VA,lights_toon_fragment:HA,lights_toon_pars_fragment:WA,lights_phong_fragment:qA,lights_phong_pars_fragment:$A,lights_physical_fragment:jA,lights_physical_pars_fragment:ZA,lights_fragment_begin:XA,lights_fragment_maps:YA,lights_fragment_end:JA,logdepthbuf_fragment:KA,logdepthbuf_pars_fragment:QA,logdepthbuf_pars_vertex:tT,logdepthbuf_vertex:eT,map_fragment:iT,map_pars_fragment:nT,map_particle_fragment:sT,map_particle_pars_fragment:rT,metalnessmap_fragment:aT,metalnessmap_pars_fragment:oT,morphcolor_vertex:lT,morphnormal_vertex:hT,morphtarget_pars_vertex:cT,morphtarget_vertex:uT,normal_fragment_begin:dT,normal_fragment_maps:fT,normal_pars_fragment:pT,normal_pars_vertex:mT,normal_vertex:gT,normalmap_pars_fragment:_T,clearcoat_normal_fragment_begin:yT,clearcoat_normal_fragment_maps:vT,clearcoat_pars_fragment:xT,iridescence_pars_fragment:bT,output_fragment:wT,packing:MT,premultiplied_alpha_fragment:ST,project_vertex:AT,dithering_fragment:TT,dithering_pars_fragment:ET,roughnessmap_fragment:CT,roughnessmap_pars_fragment:IT,shadowmap_pars_fragment:PT,shadowmap_pars_vertex:LT,shadowmap_vertex:RT,shadowmask_pars_fragment:DT,skinbase_vertex:zT,skinning_pars_vertex:kT,skinning_vertex:FT,skinnormal_vertex:BT,specularmap_fragment:OT,specularmap_pars_fragment:NT,tonemapping_fragment:UT,tonemapping_pars_fragment:VT,transmission_fragment:GT,transmission_pars_fragment:HT,uv_pars_fragment:WT,uv_pars_vertex:qT,uv_vertex:$T,worldpos_vertex:jT,background_vert:ZT,background_frag:XT,backgroundCube_vert:YT,backgroundCube_frag:JT,cube_vert:KT,cube_frag:QT,depth_vert:tE,depth_frag:eE,distanceRGBA_vert:iE,distanceRGBA_frag:nE,equirect_vert:sE,equirect_frag:rE,linedashed_vert:aE,linedashed_frag:oE,meshbasic_vert:lE,meshbasic_frag:hE,meshlambert_vert:cE,meshlambert_frag:uE,meshmatcap_vert:dE,meshmatcap_frag:fE,meshnormal_vert:pE,meshnormal_frag:mE,meshphong_vert:gE,meshphong_frag:_E,meshphysical_vert:yE,meshphysical_frag:vE,meshtoon_vert:xE,meshtoon_frag:bE,points_vert:wE,points_frag:ME,shadow_vert:SE,shadow_frag:AE,sprite_vert:TE,sprite_frag:EE},Ue={common:{diffuse:{value:new Je(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ki},alphaMap:{value:null},alphaMapTransform:{value:new ki},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ki}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ki}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ki}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ki},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ki},normalScale:{value:new me(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ki},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ki}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ki}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ki}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Je(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Je(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ki}},sprite:{diffuse:{value:new Je(16777215)},opacity:{value:1},center:{value:new me(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ki},alphaMap:{value:null},alphaTest:{value:0}}},Er={basic:{uniforms:Es([Ue.common,Ue.specularmap,Ue.envmap,Ue.aomap,Ue.lightmap,Ue.fog]),vertexShader:Li.meshbasic_vert,fragmentShader:Li.meshbasic_frag},lambert:{uniforms:Es([Ue.common,Ue.specularmap,Ue.envmap,Ue.aomap,Ue.lightmap,Ue.emissivemap,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,Ue.fog,Ue.lights,{emissive:{value:new Je(0)}}]),vertexShader:Li.meshlambert_vert,fragmentShader:Li.meshlambert_frag},phong:{uniforms:Es([Ue.common,Ue.specularmap,Ue.envmap,Ue.aomap,Ue.lightmap,Ue.emissivemap,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,Ue.fog,Ue.lights,{emissive:{value:new Je(0)},specular:{value:new Je(1118481)},shininess:{value:30}}]),vertexShader:Li.meshphong_vert,fragmentShader:Li.meshphong_frag},standard:{uniforms:Es([Ue.common,Ue.envmap,Ue.aomap,Ue.lightmap,Ue.emissivemap,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,Ue.roughnessmap,Ue.metalnessmap,Ue.fog,Ue.lights,{emissive:{value:new Je(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Li.meshphysical_vert,fragmentShader:Li.meshphysical_frag},toon:{uniforms:Es([Ue.common,Ue.aomap,Ue.lightmap,Ue.emissivemap,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,Ue.gradientmap,Ue.fog,Ue.lights,{emissive:{value:new Je(0)}}]),vertexShader:Li.meshtoon_vert,fragmentShader:Li.meshtoon_frag},matcap:{uniforms:Es([Ue.common,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,Ue.fog,{matcap:{value:null}}]),vertexShader:Li.meshmatcap_vert,fragmentShader:Li.meshmatcap_frag},points:{uniforms:Es([Ue.points,Ue.fog]),vertexShader:Li.points_vert,fragmentShader:Li.points_frag},dashed:{uniforms:Es([Ue.common,Ue.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Li.linedashed_vert,fragmentShader:Li.linedashed_frag},depth:{uniforms:Es([Ue.common,Ue.displacementmap]),vertexShader:Li.depth_vert,fragmentShader:Li.depth_frag},normal:{uniforms:Es([Ue.common,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,{opacity:{value:1}}]),vertexShader:Li.meshnormal_vert,fragmentShader:Li.meshnormal_frag},sprite:{uniforms:Es([Ue.sprite,Ue.fog]),vertexShader:Li.sprite_vert,fragmentShader:Li.sprite_frag},background:{uniforms:{uvTransform:{value:new ki},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Li.background_vert,fragmentShader:Li.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Li.backgroundCube_vert,fragmentShader:Li.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Li.cube_vert,fragmentShader:Li.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Li.equirect_vert,fragmentShader:Li.equirect_frag},distanceRGBA:{uniforms:Es([Ue.common,Ue.displacementmap,{referencePosition:{value:new ut},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Li.distanceRGBA_vert,fragmentShader:Li.distanceRGBA_frag},shadow:{uniforms:Es([Ue.lights,Ue.fog,{color:{value:new Je(0)},opacity:{value:1}}]),vertexShader:Li.shadow_vert,fragmentShader:Li.shadow_frag}};Er.physical={uniforms:Es([Er.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ki},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ki},clearcoatNormalScale:{value:new me(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ki},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ki},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ki},sheen:{value:0},sheenColor:{value:new Je(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ki},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ki},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ki},transmissionSamplerSize:{value:new me},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ki},attenuationDistance:{value:0},attenuationColor:{value:new Je(0)},specularColor:{value:new Je(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ki},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ki}}]),vertexShader:Li.meshphysical_vert,fragmentShader:Li.meshphysical_frag};const Jf={r:0,b:0,g:0};function CE(l,t,e,s,o,c,d){const a=new Je(0);let _=c===!0?0:1,v,S,M=null,A=0,C=null;function R(z,L){let W=!1,G=L.isScene===!0?L.background:null;G&&G.isTexture&&(G=(L.backgroundBlurriness>0?e:t).get(G));const H=l.xr,Q=H.getSession&&H.getSession();Q&&Q.environmentBlendMode==="additive"&&(G=null),G===null?F(a,_):G&&G.isColor&&(F(G,1),W=!0),(l.autoClear||W)&&l.clear(l.autoClearColor,l.autoClearDepth,l.autoClearStencil),G&&(G.isCubeTexture||G.mapping===Xh)?(S===void 0&&(S=new Vn(new So(1,1,1),new jr({name:"BackgroundCubeMaterial",uniforms:qh(Er.backgroundCube.uniforms),vertexShader:Er.backgroundCube.vertexShader,fragmentShader:Er.backgroundCube.fragmentShader,side:Ps,depthTest:!1,depthWrite:!1,fog:!1})),S.geometry.deleteAttribute("normal"),S.geometry.deleteAttribute("uv"),S.onBeforeRender=function(nt,pt,ft){this.matrixWorld.copyPosition(ft.matrixWorld)},Object.defineProperty(S.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(S)),S.material.uniforms.envMap.value=G,S.material.uniforms.flipEnvMap.value=G.isCubeTexture&&G.isRenderTargetTexture===!1?-1:1,S.material.uniforms.backgroundBlurriness.value=L.backgroundBlurriness,S.material.uniforms.backgroundIntensity.value=L.backgroundIntensity,S.material.toneMapped=G.encoding!==on,(M!==G||A!==G.version||C!==l.toneMapping)&&(S.material.needsUpdate=!0,M=G,A=G.version,C=l.toneMapping),S.layers.enableAll(),z.unshift(S,S.geometry,S.material,0,0,null)):G&&G.isTexture&&(v===void 0&&(v=new Vn(new Yh(2,2),new jr({name:"BackgroundMaterial",uniforms:qh(Er.background.uniforms),vertexShader:Er.background.vertexShader,fragmentShader:Er.background.fragmentShader,side:Ea,depthTest:!1,depthWrite:!1,fog:!1})),v.geometry.deleteAttribute("normal"),Object.defineProperty(v.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(v)),v.material.uniforms.t2D.value=G,v.material.uniforms.backgroundIntensity.value=L.backgroundIntensity,v.material.toneMapped=G.encoding!==on,G.matrixAutoUpdate===!0&&G.updateMatrix(),v.material.uniforms.uvTransform.value.copy(G.matrix),(M!==G||A!==G.version||C!==l.toneMapping)&&(v.material.needsUpdate=!0,M=G,A=G.version,C=l.toneMapping),v.layers.enableAll(),z.unshift(v,v.geometry,v.material,0,0,null))}function F(z,L){z.getRGB(Jf,K1(l)),s.buffers.color.setClear(Jf.r,Jf.g,Jf.b,L,d)}return{getClearColor:function(){return a},setClearColor:function(z,L=1){a.set(z),_=L,F(a,_)},getClearAlpha:function(){return _},setClearAlpha:function(z){_=z,F(a,_)},render:R}}function IE(l,t,e,s){const o=l.getParameter(34921),c=s.isWebGL2?null:t.get("OES_vertex_array_object"),d=s.isWebGL2||c!==null,a={},_=z(null);let v=_,S=!1;function M(Dt,Wt,se,ce,ie){let be=!1;if(d){const de=F(ce,se,Wt);v!==de&&(v=de,C(v.object)),be=L(Dt,ce,se,ie),be&&W(Dt,ce,se,ie)}else{const de=Wt.wireframe===!0;(v.geometry!==ce.id||v.program!==se.id||v.wireframe!==de)&&(v.geometry=ce.id,v.program=se.id,v.wireframe=de,be=!0)}ie!==null&&e.update(ie,34963),(be||S)&&(S=!1,ft(Dt,Wt,se,ce),ie!==null&&l.bindBuffer(34963,e.get(ie).buffer))}function A(){return s.isWebGL2?l.createVertexArray():c.createVertexArrayOES()}function C(Dt){return s.isWebGL2?l.bindVertexArray(Dt):c.bindVertexArrayOES(Dt)}function R(Dt){return s.isWebGL2?l.deleteVertexArray(Dt):c.deleteVertexArrayOES(Dt)}function F(Dt,Wt,se){const ce=se.wireframe===!0;let ie=a[Dt.id];ie===void 0&&(ie={},a[Dt.id]=ie);let be=ie[Wt.id];be===void 0&&(be={},ie[Wt.id]=be);let de=be[ce];return de===void 0&&(de=z(A()),be[ce]=de),de}function z(Dt){const Wt=[],se=[],ce=[];for(let ie=0;ie<o;ie++)Wt[ie]=0,se[ie]=0,ce[ie]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Wt,enabledAttributes:se,attributeDivisors:ce,object:Dt,attributes:{},index:null}}function L(Dt,Wt,se,ce){const ie=v.attributes,be=Wt.attributes;let de=0;const $e=se.getAttributes();for(const _e in $e)if($e[_e].location>=0){const re=ie[_e];let Re=be[_e];if(Re===void 0&&(_e==="instanceMatrix"&&Dt.instanceMatrix&&(Re=Dt.instanceMatrix),_e==="instanceColor"&&Dt.instanceColor&&(Re=Dt.instanceColor)),re===void 0||re.attribute!==Re||Re&&re.data!==Re.data)return!0;de++}return v.attributesNum!==de||v.index!==ce}function W(Dt,Wt,se,ce){const ie={},be=Wt.attributes;let de=0;const $e=se.getAttributes();for(const _e in $e)if($e[_e].location>=0){let re=be[_e];re===void 0&&(_e==="instanceMatrix"&&Dt.instanceMatrix&&(re=Dt.instanceMatrix),_e==="instanceColor"&&Dt.instanceColor&&(re=Dt.instanceColor));const Re={};Re.attribute=re,re&&re.data&&(Re.data=re.data),ie[_e]=Re,de++}v.attributes=ie,v.attributesNum=de,v.index=ce}function G(){const Dt=v.newAttributes;for(let Wt=0,se=Dt.length;Wt<se;Wt++)Dt[Wt]=0}function H(Dt){Q(Dt,0)}function Q(Dt,Wt){const se=v.newAttributes,ce=v.enabledAttributes,ie=v.attributeDivisors;se[Dt]=1,ce[Dt]===0&&(l.enableVertexAttribArray(Dt),ce[Dt]=1),ie[Dt]!==Wt&&((s.isWebGL2?l:t.get("ANGLE_instanced_arrays"))[s.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Dt,Wt),ie[Dt]=Wt)}function nt(){const Dt=v.newAttributes,Wt=v.enabledAttributes;for(let se=0,ce=Wt.length;se<ce;se++)Wt[se]!==Dt[se]&&(l.disableVertexAttribArray(se),Wt[se]=0)}function pt(Dt,Wt,se,ce,ie,be){s.isWebGL2===!0&&(se===5124||se===5125)?l.vertexAttribIPointer(Dt,Wt,se,ie,be):l.vertexAttribPointer(Dt,Wt,se,ce,ie,be)}function ft(Dt,Wt,se,ce){if(s.isWebGL2===!1&&(Dt.isInstancedMesh||ce.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;G();const ie=ce.attributes,be=se.getAttributes(),de=Wt.defaultAttributeValues;for(const $e in be){const _e=be[$e];if(_e.location>=0){let Yt=ie[$e];if(Yt===void 0&&($e==="instanceMatrix"&&Dt.instanceMatrix&&(Yt=Dt.instanceMatrix),$e==="instanceColor"&&Dt.instanceColor&&(Yt=Dt.instanceColor)),Yt!==void 0){const re=Yt.normalized,Re=Yt.itemSize,Fe=e.get(Yt);if(Fe===void 0)continue;const Gt=Fe.buffer,ei=Fe.type,ci=Fe.bytesPerElement;if(Yt.isInterleavedBufferAttribute){const xe=Yt.data,Qe=xe.stride,le=Yt.offset;if(xe.isInstancedInterleavedBuffer){for(let Kt=0;Kt<_e.locationSize;Kt++)Q(_e.location+Kt,xe.meshPerAttribute);Dt.isInstancedMesh!==!0&&ce._maxInstanceCount===void 0&&(ce._maxInstanceCount=xe.meshPerAttribute*xe.count)}else for(let Kt=0;Kt<_e.locationSize;Kt++)H(_e.location+Kt);l.bindBuffer(34962,Gt);for(let Kt=0;Kt<_e.locationSize;Kt++)pt(_e.location+Kt,Re/_e.locationSize,ei,re,Qe*ci,(le+Re/_e.locationSize*Kt)*ci)}else{if(Yt.isInstancedBufferAttribute){for(let xe=0;xe<_e.locationSize;xe++)Q(_e.location+xe,Yt.meshPerAttribute);Dt.isInstancedMesh!==!0&&ce._maxInstanceCount===void 0&&(ce._maxInstanceCount=Yt.meshPerAttribute*Yt.count)}else for(let xe=0;xe<_e.locationSize;xe++)H(_e.location+xe);l.bindBuffer(34962,Gt);for(let xe=0;xe<_e.locationSize;xe++)pt(_e.location+xe,Re/_e.locationSize,ei,re,Re*ci,Re/_e.locationSize*xe*ci)}}else if(de!==void 0){const re=de[$e];if(re!==void 0)switch(re.length){case 2:l.vertexAttrib2fv(_e.location,re);break;case 3:l.vertexAttrib3fv(_e.location,re);break;case 4:l.vertexAttrib4fv(_e.location,re);break;default:l.vertexAttrib1fv(_e.location,re)}}}}nt()}function K(){zt();for(const Dt in a){const Wt=a[Dt];for(const se in Wt){const ce=Wt[se];for(const ie in ce)R(ce[ie].object),delete ce[ie];delete Wt[se]}delete a[Dt]}}function ot(Dt){if(a[Dt.id]===void 0)return;const Wt=a[Dt.id];for(const se in Wt){const ce=Wt[se];for(const ie in ce)R(ce[ie].object),delete ce[ie];delete Wt[se]}delete a[Dt.id]}function kt(Dt){for(const Wt in a){const se=a[Wt];if(se[Dt.id]===void 0)continue;const ce=se[Dt.id];for(const ie in ce)R(ce[ie].object),delete ce[ie];delete se[Dt.id]}}function zt(){It(),S=!0,v!==_&&(v=_,C(v.object))}function It(){_.geometry=null,_.program=null,_.wireframe=!1}return{setup:M,reset:zt,resetDefaultState:It,dispose:K,releaseStatesOfGeometry:ot,releaseStatesOfProgram:kt,initAttributes:G,enableAttribute:H,disableUnusedAttributes:nt}}function PE(l,t,e,s){const o=s.isWebGL2;let c;function d(v){c=v}function a(v,S){l.drawArrays(c,v,S),e.update(S,c,1)}function _(v,S,M){if(M===0)return;let A,C;if(o)A=l,C="drawArraysInstanced";else if(A=t.get("ANGLE_instanced_arrays"),C="drawArraysInstancedANGLE",A===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}A[C](c,v,S,M),e.update(S,c,M)}this.setMode=d,this.render=a,this.renderInstances=_}function LE(l,t,e){let s;function o(){if(s!==void 0)return s;if(t.has("EXT_texture_filter_anisotropic")===!0){const pt=t.get("EXT_texture_filter_anisotropic");s=l.getParameter(pt.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function c(pt){if(pt==="highp"){if(l.getShaderPrecisionFormat(35633,36338).precision>0&&l.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";pt="mediump"}return pt==="mediump"&&l.getShaderPrecisionFormat(35633,36337).precision>0&&l.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const d=typeof WebGL2RenderingContext<"u"&&l.constructor.name==="WebGL2RenderingContext";let a=e.precision!==void 0?e.precision:"highp";const _=c(a);_!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",_,"instead."),a=_);const v=d||t.has("WEBGL_draw_buffers"),S=e.logarithmicDepthBuffer===!0,M=l.getParameter(34930),A=l.getParameter(35660),C=l.getParameter(3379),R=l.getParameter(34076),F=l.getParameter(34921),z=l.getParameter(36347),L=l.getParameter(36348),W=l.getParameter(36349),G=A>0,H=d||t.has("OES_texture_float"),Q=G&&H,nt=d?l.getParameter(36183):0;return{isWebGL2:d,drawBuffers:v,getMaxAnisotropy:o,getMaxPrecision:c,precision:a,logarithmicDepthBuffer:S,maxTextures:M,maxVertexTextures:A,maxTextureSize:C,maxCubemapSize:R,maxAttributes:F,maxVertexUniforms:z,maxVaryings:L,maxFragmentUniforms:W,vertexTextures:G,floatFragmentTextures:H,floatVertexTextures:Q,maxSamples:nt}}function RE(l){const t=this;let e=null,s=0,o=!1,c=!1;const d=new lo,a=new ki,_={value:null,needsUpdate:!1};this.uniform=_,this.numPlanes=0,this.numIntersection=0,this.init=function(M,A){const C=M.length!==0||A||s!==0||o;return o=A,s=M.length,C},this.beginShadows=function(){c=!0,S(null)},this.endShadows=function(){c=!1},this.setGlobalState=function(M,A){e=S(M,A,0)},this.setState=function(M,A,C){const R=M.clippingPlanes,F=M.clipIntersection,z=M.clipShadows,L=l.get(M);if(!o||R===null||R.length===0||c&&!z)c?S(null):v();else{const W=c?0:s,G=W*4;let H=L.clippingState||null;_.value=H,H=S(R,A,G,C);for(let Q=0;Q!==G;++Q)H[Q]=e[Q];L.clippingState=H,this.numIntersection=F?this.numPlanes:0,this.numPlanes+=W}};function v(){_.value!==e&&(_.value=e,_.needsUpdate=s>0),t.numPlanes=s,t.numIntersection=0}function S(M,A,C,R){const F=M!==null?M.length:0;let z=null;if(F!==0){if(z=_.value,R!==!0||z===null){const L=C+F*4,W=A.matrixWorldInverse;a.getNormalMatrix(W),(z===null||z.length<L)&&(z=new Float32Array(L));for(let G=0,H=C;G!==F;++G,H+=4)d.copy(M[G]).applyMatrix4(W,a),d.normal.toArray(z,H),z[H+3]=d.constant}_.value=z,_.needsUpdate=!0}return t.numPlanes=F,t.numIntersection=0,z}}function DE(l){let t=new WeakMap;function e(d,a){return a===Bu?d.mapping=po:a===Ou&&(d.mapping=mo),d}function s(d){if(d&&d.isTexture&&d.isRenderTargetTexture===!1){const a=d.mapping;if(a===Bu||a===Ou)if(t.has(d)){const _=t.get(d).texture;return e(_,d.mapping)}else{const _=d.image;if(_&&_.height>0){const v=new eb(_.height/2);return v.fromEquirectangularTexture(l,d),t.set(d,v),d.addEventListener("dispose",o),e(v.texture,d.mapping)}else return null}}return d}function o(d){const a=d.target;a.removeEventListener("dispose",o);const _=t.get(a);_!==void 0&&(t.delete(a),_.dispose())}function c(){t=new WeakMap}return{get:s,dispose:c}}class Xp extends ld{constructor(t=-1,e=1,s=1,o=-1,c=.1,d=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=s,this.bottom=o,this.near=c,this.far=d,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,s,o,c,d){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=o,this.view.width=c,this.view.height=d,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let c=s-t,d=s+t,a=o+e,_=o-e;if(this.view!==null&&this.view.enabled){const v=(this.right-this.left)/this.view.fullWidth/this.zoom,S=(this.top-this.bottom)/this.view.fullHeight/this.zoom;c+=v*this.view.offsetX,d=c+v*this.view.width,a-=S*this.view.offsetY,_=a-S*this.view.height}this.projectionMatrix.makeOrthographic(c,d,a,_,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}const Lh=4,xv=[.125,.215,.35,.446,.526,.582],sl=20,Cg=new Xp,bv=new Je;let Ig=null;const il=(1+Math.sqrt(5))/2,bh=1/il,wv=[new ut(1,1,1),new ut(-1,1,1),new ut(1,1,-1),new ut(-1,1,-1),new ut(0,il,bh),new ut(0,il,-bh),new ut(bh,0,il),new ut(-bh,0,il),new ut(il,bh,0),new ut(-il,bh,0)];class S_{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,s=.1,o=100){Ig=this._renderer.getRenderTarget(),this._setSize(256);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(t,s,o,c),e>0&&this._blur(c,0,0,e),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Av(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Sv(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Ig),t.scissorTest=!1,Kf(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===po||t.mapping===mo?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Ig=this._renderer.getRenderTarget();const s=e||this._allocateTargets();return this._textureToCubeUV(t,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,s={magFilter:Dn,minFilter:Dn,generateMipmaps:!1,type:Gh,format:Qs,encoding:yo,depthBuffer:!1},o=Mv(t,e,s);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Mv(t,e,s);const{_lodMax:c}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=zE(c)),this._blurMaterial=kE(c,t,e)}return o}_compileMaterial(t){const e=new Vn(this._lodPlanes[0],t);this._renderer.compile(e,Cg)}_sceneToCubeUV(t,e,s,o){const a=new ns(90,1,e,s),_=[1,-1,1,1,1,1],v=[1,1,1,-1,-1,-1],S=this._renderer,M=S.autoClear,A=S.toneMapping;S.getClearColor(bv),S.toneMapping=Hr,S.autoClear=!1;const C=new Mo({name:"PMREM.Background",side:Ps,depthWrite:!1,depthTest:!1}),R=new Vn(new So,C);let F=!1;const z=t.background;z?z.isColor&&(C.color.copy(z),t.background=null,F=!0):(C.color.copy(bv),F=!0);for(let L=0;L<6;L++){const W=L%3;W===0?(a.up.set(0,_[L],0),a.lookAt(v[L],0,0)):W===1?(a.up.set(0,0,_[L]),a.lookAt(0,v[L],0)):(a.up.set(0,_[L],0),a.lookAt(0,0,v[L]));const G=this._cubeSize;Kf(o,W*G,L>2?G:0,G,G),S.setRenderTarget(o),F&&S.render(R,a),S.render(t,a)}R.geometry.dispose(),R.material.dispose(),S.toneMapping=A,S.autoClear=M,t.background=z}_textureToCubeUV(t,e){const s=this._renderer,o=t.mapping===po||t.mapping===mo;o?(this._cubemapMaterial===null&&(this._cubemapMaterial=Av()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Sv());const c=o?this._cubemapMaterial:this._equirectMaterial,d=new Vn(this._lodPlanes[0],c),a=c.uniforms;a.envMap.value=t;const _=this._cubeSize;Kf(e,0,0,3*_,2*_),s.setRenderTarget(e),s.render(d,Cg)}_applyPMREM(t){const e=this._renderer,s=e.autoClear;e.autoClear=!1;for(let o=1;o<this._lodPlanes.length;o++){const c=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),d=wv[(o-1)%wv.length];this._blur(t,o-1,o,c,d)}e.autoClear=s}_blur(t,e,s,o,c){const d=this._pingPongRenderTarget;this._halfBlur(t,d,e,s,o,"latitudinal",c),this._halfBlur(d,t,s,s,o,"longitudinal",c)}_halfBlur(t,e,s,o,c,d,a){const _=this._renderer,v=this._blurMaterial;d!=="latitudinal"&&d!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const S=3,M=new Vn(this._lodPlanes[o],v),A=v.uniforms,C=this._sizeLods[s]-1,R=isFinite(c)?Math.PI/(2*C):2*Math.PI/(2*sl-1),F=c/R,z=isFinite(c)?1+Math.floor(S*F):sl;z>sl&&console.warn(`sigmaRadians, ${c}, is too large and will clip, as it requested ${z} samples when the maximum is set to ${sl}`);const L=[];let W=0;for(let pt=0;pt<sl;++pt){const ft=pt/F,K=Math.exp(-ft*ft/2);L.push(K),pt===0?W+=K:pt<z&&(W+=2*K)}for(let pt=0;pt<L.length;pt++)L[pt]=L[pt]/W;A.envMap.value=t.texture,A.samples.value=z,A.weights.value=L,A.latitudinal.value=d==="latitudinal",a&&(A.poleAxis.value=a);const{_lodMax:G}=this;A.dTheta.value=R,A.mipInt.value=G-s;const H=this._sizeLods[o],Q=3*H*(o>G-Lh?o-G+Lh:0),nt=4*(this._cubeSize-H);Kf(e,Q,nt,3*H,2*H),_.setRenderTarget(e),_.render(M,Cg)}}function zE(l){const t=[],e=[],s=[];let o=l;const c=l-Lh+1+xv.length;for(let d=0;d<c;d++){const a=Math.pow(2,o);e.push(a);let _=1/a;d>l-Lh?_=xv[d-l+Lh-1]:d===0&&(_=0),s.push(_);const v=1/(a-2),S=-v,M=1+v,A=[S,S,M,S,M,M,S,S,M,M,S,M],C=6,R=6,F=3,z=2,L=1,W=new Float32Array(F*R*C),G=new Float32Array(z*R*C),H=new Float32Array(L*R*C);for(let nt=0;nt<C;nt++){const pt=nt%3*2/3-1,ft=nt>2?0:-1,K=[pt,ft,0,pt+2/3,ft,0,pt+2/3,ft+1,0,pt,ft,0,pt+2/3,ft+1,0,pt,ft+1,0];W.set(K,F*R*nt),G.set(A,z*R*nt);const ot=[nt,nt,nt,nt,nt,nt];H.set(ot,L*R*nt)}const Q=new Ii;Q.setAttribute("position",new Zi(W,F)),Q.setAttribute("uv",new Zi(G,z)),Q.setAttribute("faceIndex",new Zi(H,L)),t.push(Q),o>Lh&&o--}return{lodPlanes:t,sizeLods:e,sigmas:s}}function Mv(l,t,e){const s=new Ir(l,t,e);return s.texture.mapping=Xh,s.texture.name="PMREM.cubeUv",s.scissorTest=!0,s}function Kf(l,t,e,s,o){l.viewport.set(t,e,s,o),l.scissor.set(t,e,s,o)}function kE(l,t,e){const s=new Float32Array(sl),o=new ut(0,1,0);return new jr({name:"SphericalGaussianBlur",defines:{n:sl,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${l}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:s},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o}},vertexShader:J_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ta,depthTest:!1,depthWrite:!1})}function Sv(){return new jr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:J_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ta,depthTest:!1,depthWrite:!1})}function Av(){return new jr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:J_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ta,depthTest:!1,depthWrite:!1})}function J_(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function FE(l){let t=new WeakMap,e=null;function s(a){if(a&&a.isTexture){const _=a.mapping,v=_===Bu||_===Ou,S=_===po||_===mo;if(v||S)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let M=t.get(a);return e===null&&(e=new S_(l)),M=v?e.fromEquirectangular(a,M):e.fromCubemap(a,M),t.set(a,M),M.texture}else{if(t.has(a))return t.get(a).texture;{const M=a.image;if(v&&M&&M.height>0||S&&M&&o(M)){e===null&&(e=new S_(l));const A=v?e.fromEquirectangular(a):e.fromCubemap(a);return t.set(a,A),a.addEventListener("dispose",c),A.texture}else return null}}}return a}function o(a){let _=0;const v=6;for(let S=0;S<v;S++)a[S]!==void 0&&_++;return _===v}function c(a){const _=a.target;_.removeEventListener("dispose",c);const v=t.get(_);v!==void 0&&(t.delete(_),v.dispose())}function d(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:s,dispose:d}}function BE(l){const t={};function e(s){if(t[s]!==void 0)return t[s];let o;switch(s){case"WEBGL_depth_texture":o=l.getExtension("WEBGL_depth_texture")||l.getExtension("MOZ_WEBGL_depth_texture")||l.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=l.getExtension("WEBGL_compressed_texture_s3tc")||l.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||l.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=l.getExtension("WEBGL_compressed_texture_pvrtc")||l.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=l.getExtension(s)}return t[s]=o,o}return{has:function(s){return e(s)!==null},init:function(s){s.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(s){const o=e(s);return o===null&&console.warn("THREE.WebGLRenderer: "+s+" extension not supported."),o}}}function OE(l,t,e,s){const o={},c=new WeakMap;function d(M){const A=M.target;A.index!==null&&t.remove(A.index);for(const R in A.attributes)t.remove(A.attributes[R]);A.removeEventListener("dispose",d),delete o[A.id];const C=c.get(A);C&&(t.remove(C),c.delete(A)),s.releaseStatesOfGeometry(A),A.isInstancedBufferGeometry===!0&&delete A._maxInstanceCount,e.memory.geometries--}function a(M,A){return o[A.id]===!0||(A.addEventListener("dispose",d),o[A.id]=!0,e.memory.geometries++),A}function _(M){const A=M.attributes;for(const R in A)t.update(A[R],34962);const C=M.morphAttributes;for(const R in C){const F=C[R];for(let z=0,L=F.length;z<L;z++)t.update(F[z],34962)}}function v(M){const A=[],C=M.index,R=M.attributes.position;let F=0;if(C!==null){const W=C.array;F=C.version;for(let G=0,H=W.length;G<H;G+=3){const Q=W[G+0],nt=W[G+1],pt=W[G+2];A.push(Q,nt,nt,pt,pt,Q)}}else{const W=R.array;F=R.version;for(let G=0,H=W.length/3-1;G<H;G+=3){const Q=G+0,nt=G+1,pt=G+2;A.push(Q,nt,nt,pt,pt,Q)}}const z=new(Y1(A)?Y_:X_)(A,1);z.version=F;const L=c.get(M);L&&t.remove(L),c.set(M,z)}function S(M){const A=c.get(M);if(A){const C=M.index;C!==null&&A.version<C.version&&v(M)}else v(M);return c.get(M)}return{get:a,update:_,getWireframeAttribute:S}}function NE(l,t,e,s){const o=s.isWebGL2;let c;function d(A){c=A}let a,_;function v(A){a=A.type,_=A.bytesPerElement}function S(A,C){l.drawElements(c,C,a,A*_),e.update(C,c,1)}function M(A,C,R){if(R===0)return;let F,z;if(o)F=l,z="drawElementsInstanced";else if(F=t.get("ANGLE_instanced_arrays"),z="drawElementsInstancedANGLE",F===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}F[z](c,C,a,A*_,R),e.update(C,c,R)}this.setMode=d,this.setIndex=v,this.render=S,this.renderInstances=M}function UE(l){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function s(c,d,a){switch(e.calls++,d){case 4:e.triangles+=a*(c/3);break;case 1:e.lines+=a*(c/2);break;case 3:e.lines+=a*(c-1);break;case 2:e.lines+=a*c;break;case 0:e.points+=a*c;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",d);break}}function o(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:o,update:s}}function VE(l,t){return l[0]-t[0]}function GE(l,t){return Math.abs(t[1])-Math.abs(l[1])}function HE(l,t,e){const s={},o=new Float32Array(8),c=new WeakMap,d=new Ji,a=[];for(let v=0;v<8;v++)a[v]=[v,0];function _(v,S,M){const A=v.morphTargetInfluences;if(t.isWebGL2===!0){const R=S.morphAttributes.position||S.morphAttributes.normal||S.morphAttributes.color,F=R!==void 0?R.length:0;let z=c.get(S);if(z===void 0||z.count!==F){let Wt=function(){It.dispose(),c.delete(S),S.removeEventListener("dispose",Wt)};var C=Wt;z!==void 0&&z.texture.dispose();const G=S.morphAttributes.position!==void 0,H=S.morphAttributes.normal!==void 0,Q=S.morphAttributes.color!==void 0,nt=S.morphAttributes.position||[],pt=S.morphAttributes.normal||[],ft=S.morphAttributes.color||[];let K=0;G===!0&&(K=1),H===!0&&(K=2),Q===!0&&(K=3);let ot=S.attributes.position.count*K,kt=1;ot>t.maxTextureSize&&(kt=Math.ceil(ot/t.maxTextureSize),ot=t.maxTextureSize);const zt=new Float32Array(ot*kt*4*F),It=new $p(zt,ot,kt,F);It.type=Aa,It.needsUpdate=!0;const Dt=K*4;for(let se=0;se<F;se++){const ce=nt[se],ie=pt[se],be=ft[se],de=ot*kt*4*se;for(let $e=0;$e<ce.count;$e++){const _e=$e*Dt;G===!0&&(d.fromBufferAttribute(ce,$e),zt[de+_e+0]=d.x,zt[de+_e+1]=d.y,zt[de+_e+2]=d.z,zt[de+_e+3]=0),H===!0&&(d.fromBufferAttribute(ie,$e),zt[de+_e+4]=d.x,zt[de+_e+5]=d.y,zt[de+_e+6]=d.z,zt[de+_e+7]=0),Q===!0&&(d.fromBufferAttribute(be,$e),zt[de+_e+8]=d.x,zt[de+_e+9]=d.y,zt[de+_e+10]=d.z,zt[de+_e+11]=be.itemSize===4?d.w:1)}}z={count:F,texture:It,size:new me(ot,kt)},c.set(S,z),S.addEventListener("dispose",Wt)}let L=0;for(let G=0;G<A.length;G++)L+=A[G];const W=S.morphTargetsRelative?1:1-L;M.getUniforms().setValue(l,"morphTargetBaseInfluence",W),M.getUniforms().setValue(l,"morphTargetInfluences",A),M.getUniforms().setValue(l,"morphTargetsTexture",z.texture,e),M.getUniforms().setValue(l,"morphTargetsTextureSize",z.size)}else{const R=A===void 0?0:A.length;let F=s[S.id];if(F===void 0||F.length!==R){F=[];for(let H=0;H<R;H++)F[H]=[H,0];s[S.id]=F}for(let H=0;H<R;H++){const Q=F[H];Q[0]=H,Q[1]=A[H]}F.sort(GE);for(let H=0;H<8;H++)H<R&&F[H][1]?(a[H][0]=F[H][0],a[H][1]=F[H][1]):(a[H][0]=Number.MAX_SAFE_INTEGER,a[H][1]=0);a.sort(VE);const z=S.morphAttributes.position,L=S.morphAttributes.normal;let W=0;for(let H=0;H<8;H++){const Q=a[H],nt=Q[0],pt=Q[1];nt!==Number.MAX_SAFE_INTEGER&&pt?(z&&S.getAttribute("morphTarget"+H)!==z[nt]&&S.setAttribute("morphTarget"+H,z[nt]),L&&S.getAttribute("morphNormal"+H)!==L[nt]&&S.setAttribute("morphNormal"+H,L[nt]),o[H]=pt,W+=pt):(z&&S.hasAttribute("morphTarget"+H)===!0&&S.deleteAttribute("morphTarget"+H),L&&S.hasAttribute("morphNormal"+H)===!0&&S.deleteAttribute("morphNormal"+H),o[H]=0)}const G=S.morphTargetsRelative?1:1-W;M.getUniforms().setValue(l,"morphTargetBaseInfluence",G),M.getUniforms().setValue(l,"morphTargetInfluences",o)}}return{update:_}}function WE(l,t,e,s){let o=new WeakMap;function c(_){const v=s.render.frame,S=_.geometry,M=t.get(_,S);return o.get(M)!==v&&(t.update(M),o.set(M,v)),_.isInstancedMesh&&(_.hasEventListener("dispose",a)===!1&&_.addEventListener("dispose",a),e.update(_.instanceMatrix,34962),_.instanceColor!==null&&e.update(_.instanceColor,34962)),M}function d(){o=new WeakMap}function a(_){const v=_.target;v.removeEventListener("dispose",a),e.remove(v.instanceMatrix),v.instanceColor!==null&&e.remove(v.instanceColor)}return{update:c,dispose:d}}const nb=new zn,sb=new $p,rb=new Z_,ab=new hd,Tv=[],Ev=[],Cv=new Float32Array(16),Iv=new Float32Array(9),Pv=new Float32Array(4);function Jh(l,t,e){const s=l[0];if(s<=0||s>0)return l;const o=t*e;let c=Tv[o];if(c===void 0&&(c=new Float32Array(o),Tv[o]=c),t!==0){s.toArray(c,0);for(let d=1,a=0;d!==t;++d)a+=e,l[d].toArray(c,a)}return c}function Gn(l,t){if(l.length!==t.length)return!1;for(let e=0,s=l.length;e<s;e++)if(l[e]!==t[e])return!1;return!0}function Hn(l,t){for(let e=0,s=t.length;e<s;e++)l[e]=t[e]}function Yp(l,t){let e=Ev[t];e===void 0&&(e=new Int32Array(t),Ev[t]=e);for(let s=0;s!==t;++s)e[s]=l.allocateTextureUnit();return e}function qE(l,t){const e=this.cache;e[0]!==t&&(l.uniform1f(this.addr,t),e[0]=t)}function $E(l,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(l.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Gn(e,t))return;l.uniform2fv(this.addr,t),Hn(e,t)}}function jE(l,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(l.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(l.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(Gn(e,t))return;l.uniform3fv(this.addr,t),Hn(e,t)}}function ZE(l,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(l.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Gn(e,t))return;l.uniform4fv(this.addr,t),Hn(e,t)}}function XE(l,t){const e=this.cache,s=t.elements;if(s===void 0){if(Gn(e,t))return;l.uniformMatrix2fv(this.addr,!1,t),Hn(e,t)}else{if(Gn(e,s))return;Pv.set(s),l.uniformMatrix2fv(this.addr,!1,Pv),Hn(e,s)}}function YE(l,t){const e=this.cache,s=t.elements;if(s===void 0){if(Gn(e,t))return;l.uniformMatrix3fv(this.addr,!1,t),Hn(e,t)}else{if(Gn(e,s))return;Iv.set(s),l.uniformMatrix3fv(this.addr,!1,Iv),Hn(e,s)}}function JE(l,t){const e=this.cache,s=t.elements;if(s===void 0){if(Gn(e,t))return;l.uniformMatrix4fv(this.addr,!1,t),Hn(e,t)}else{if(Gn(e,s))return;Cv.set(s),l.uniformMatrix4fv(this.addr,!1,Cv),Hn(e,s)}}function KE(l,t){const e=this.cache;e[0]!==t&&(l.uniform1i(this.addr,t),e[0]=t)}function QE(l,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(l.uniform2i(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Gn(e,t))return;l.uniform2iv(this.addr,t),Hn(e,t)}}function tC(l,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(l.uniform3i(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(Gn(e,t))return;l.uniform3iv(this.addr,t),Hn(e,t)}}function eC(l,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(l.uniform4i(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Gn(e,t))return;l.uniform4iv(this.addr,t),Hn(e,t)}}function iC(l,t){const e=this.cache;e[0]!==t&&(l.uniform1ui(this.addr,t),e[0]=t)}function nC(l,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(l.uniform2ui(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Gn(e,t))return;l.uniform2uiv(this.addr,t),Hn(e,t)}}function sC(l,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(l.uniform3ui(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(Gn(e,t))return;l.uniform3uiv(this.addr,t),Hn(e,t)}}function rC(l,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(l.uniform4ui(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Gn(e,t))return;l.uniform4uiv(this.addr,t),Hn(e,t)}}function aC(l,t,e){const s=this.cache,o=e.allocateTextureUnit();s[0]!==o&&(l.uniform1i(this.addr,o),s[0]=o),e.setTexture2D(t||nb,o)}function oC(l,t,e){const s=this.cache,o=e.allocateTextureUnit();s[0]!==o&&(l.uniform1i(this.addr,o),s[0]=o),e.setTexture3D(t||rb,o)}function lC(l,t,e){const s=this.cache,o=e.allocateTextureUnit();s[0]!==o&&(l.uniform1i(this.addr,o),s[0]=o),e.setTextureCube(t||ab,o)}function hC(l,t,e){const s=this.cache,o=e.allocateTextureUnit();s[0]!==o&&(l.uniform1i(this.addr,o),s[0]=o),e.setTexture2DArray(t||sb,o)}function cC(l){switch(l){case 5126:return qE;case 35664:return $E;case 35665:return jE;case 35666:return ZE;case 35674:return XE;case 35675:return YE;case 35676:return JE;case 5124:case 35670:return KE;case 35667:case 35671:return QE;case 35668:case 35672:return tC;case 35669:case 35673:return eC;case 5125:return iC;case 36294:return nC;case 36295:return sC;case 36296:return rC;case 35678:case 36198:case 36298:case 36306:case 35682:return aC;case 35679:case 36299:case 36307:return oC;case 35680:case 36300:case 36308:case 36293:return lC;case 36289:case 36303:case 36311:case 36292:return hC}}function uC(l,t){l.uniform1fv(this.addr,t)}function dC(l,t){const e=Jh(t,this.size,2);l.uniform2fv(this.addr,e)}function fC(l,t){const e=Jh(t,this.size,3);l.uniform3fv(this.addr,e)}function pC(l,t){const e=Jh(t,this.size,4);l.uniform4fv(this.addr,e)}function mC(l,t){const e=Jh(t,this.size,4);l.uniformMatrix2fv(this.addr,!1,e)}function gC(l,t){const e=Jh(t,this.size,9);l.uniformMatrix3fv(this.addr,!1,e)}function _C(l,t){const e=Jh(t,this.size,16);l.uniformMatrix4fv(this.addr,!1,e)}function yC(l,t){l.uniform1iv(this.addr,t)}function vC(l,t){l.uniform2iv(this.addr,t)}function xC(l,t){l.uniform3iv(this.addr,t)}function bC(l,t){l.uniform4iv(this.addr,t)}function wC(l,t){l.uniform1uiv(this.addr,t)}function MC(l,t){l.uniform2uiv(this.addr,t)}function SC(l,t){l.uniform3uiv(this.addr,t)}function AC(l,t){l.uniform4uiv(this.addr,t)}function TC(l,t,e){const s=this.cache,o=t.length,c=Yp(e,o);Gn(s,c)||(l.uniform1iv(this.addr,c),Hn(s,c));for(let d=0;d!==o;++d)e.setTexture2D(t[d]||nb,c[d])}function EC(l,t,e){const s=this.cache,o=t.length,c=Yp(e,o);Gn(s,c)||(l.uniform1iv(this.addr,c),Hn(s,c));for(let d=0;d!==o;++d)e.setTexture3D(t[d]||rb,c[d])}function CC(l,t,e){const s=this.cache,o=t.length,c=Yp(e,o);Gn(s,c)||(l.uniform1iv(this.addr,c),Hn(s,c));for(let d=0;d!==o;++d)e.setTextureCube(t[d]||ab,c[d])}function IC(l,t,e){const s=this.cache,o=t.length,c=Yp(e,o);Gn(s,c)||(l.uniform1iv(this.addr,c),Hn(s,c));for(let d=0;d!==o;++d)e.setTexture2DArray(t[d]||sb,c[d])}function PC(l){switch(l){case 5126:return uC;case 35664:return dC;case 35665:return fC;case 35666:return pC;case 35674:return mC;case 35675:return gC;case 35676:return _C;case 5124:case 35670:return yC;case 35667:case 35671:return vC;case 35668:case 35672:return xC;case 35669:case 35673:return bC;case 5125:return wC;case 36294:return MC;case 36295:return SC;case 36296:return AC;case 35678:case 36198:case 36298:case 36306:case 35682:return TC;case 35679:case 36299:case 36307:return EC;case 35680:case 36300:case 36308:case 36293:return CC;case 36289:case 36303:case 36311:case 36292:return IC}}class LC{constructor(t,e,s){this.id=t,this.addr=s,this.cache=[],this.setValue=cC(e.type)}}class RC{constructor(t,e,s){this.id=t,this.addr=s,this.cache=[],this.size=e.size,this.setValue=PC(e.type)}}class DC{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,s){const o=this.seq;for(let c=0,d=o.length;c!==d;++c){const a=o[c];a.setValue(t,e[a.id],s)}}}const Pg=/(\w+)(\])?(\[|\.)?/g;function Lv(l,t){l.seq.push(t),l.map[t.id]=t}function zC(l,t,e){const s=l.name,o=s.length;for(Pg.lastIndex=0;;){const c=Pg.exec(s),d=Pg.lastIndex;let a=c[1];const _=c[2]==="]",v=c[3];if(_&&(a=a|0),v===void 0||v==="["&&d+2===o){Lv(e,v===void 0?new LC(a,l,t):new RC(a,l,t));break}else{let M=e.map[a];M===void 0&&(M=new DC(a),Lv(e,M)),e=M}}}class Pp{constructor(t,e){this.seq=[],this.map={};const s=t.getProgramParameter(e,35718);for(let o=0;o<s;++o){const c=t.getActiveUniform(e,o),d=t.getUniformLocation(e,c.name);zC(c,d,this)}}setValue(t,e,s,o){const c=this.map[e];c!==void 0&&c.setValue(t,s,o)}setOptional(t,e,s){const o=e[s];o!==void 0&&this.setValue(t,s,o)}static upload(t,e,s,o){for(let c=0,d=e.length;c!==d;++c){const a=e[c],_=s[a.id];_.needsUpdate!==!1&&a.setValue(t,_.value,o)}}static seqWithValue(t,e){const s=[];for(let o=0,c=t.length;o!==c;++o){const d=t[o];d.id in e&&s.push(d)}return s}}function Rv(l,t,e){const s=l.createShader(t);return l.shaderSource(s,e),l.compileShader(s),s}let kC=0;function FC(l,t){const e=l.split(`
`),s=[],o=Math.max(t-6,0),c=Math.min(t+6,e.length);for(let d=o;d<c;d++){const a=d+1;s.push(`${a===t?">":" "} ${a}: ${e[d]}`)}return s.join(`
`)}function BC(l){switch(l){case yo:return["Linear","( value )"];case on:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",l),["Linear","( value )"]}}function Dv(l,t,e){const s=l.getShaderParameter(t,35713),o=l.getShaderInfoLog(t).trim();if(s&&o==="")return"";const c=/ERROR: 0:(\d+)/.exec(o);if(c){const d=parseInt(c[1]);return e.toUpperCase()+`

`+o+`

`+FC(l.getShaderSource(t),d)}else return o}function OC(l,t){const e=BC(t);return"vec4 "+l+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function NC(l,t){let e;switch(t){case b1:e="Linear";break;case w1:e="Reinhard";break;case M1:e="OptimizedCineon";break;case S1:e="ACESFilmic";break;case A1:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+l+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function UC(l){return[l.extensionDerivatives||l.envMapCubeUVHeight||l.bumpMap||l.normalMapTangentSpace||l.clearcoatNormalMap||l.flatShading||l.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(l.extensionFragDepth||l.logarithmicDepthBuffer)&&l.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",l.extensionDrawBuffers&&l.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(l.extensionShaderTextureLOD||l.envMap||l.transmission)&&l.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Mu).join(`
`)}function VC(l){const t=[];for(const e in l){const s=l[e];s!==!1&&t.push("#define "+e+" "+s)}return t.join(`
`)}function GC(l,t){const e={},s=l.getProgramParameter(t,35721);for(let o=0;o<s;o++){const c=l.getActiveAttrib(t,o),d=c.name;let a=1;c.type===35674&&(a=2),c.type===35675&&(a=3),c.type===35676&&(a=4),e[d]={type:c.type,location:l.getAttribLocation(t,d),locationSize:a}}return e}function Mu(l){return l!==""}function zv(l,t){const e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return l.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function kv(l,t){return l.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const HC=/^[ \t]*#include +<([\w\d./]+)>/gm;function A_(l){return l.replace(HC,WC)}function WC(l,t){const e=Li[t];if(e===void 0)throw new Error("Can not resolve #include <"+t+">");return A_(e)}const qC=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Fv(l){return l.replace(qC,$C)}function $C(l,t,e,s){let o="";for(let c=parseInt(t);c<parseInt(e);c++)o+=s.replace(/\[\s*i\s*\]/g,"[ "+c+" ]").replace(/UNROLLED_LOOP_INDEX/g,c);return o}function Bv(l){let t="precision "+l.precision+` float;
precision `+l.precision+" int;";return l.precision==="highp"?t+=`
#define HIGH_PRECISION`:l.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:l.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function jC(l){let t="SHADOWMAP_TYPE_BASIC";return l.shadowMapType===N_?t="SHADOWMAP_TYPE_PCF":l.shadowMapType===Qx?t="SHADOWMAP_TYPE_PCF_SOFT":l.shadowMapType===Ih&&(t="SHADOWMAP_TYPE_VSM"),t}function ZC(l){let t="ENVMAP_TYPE_CUBE";if(l.envMap)switch(l.envMapMode){case po:case mo:t="ENVMAP_TYPE_CUBE";break;case Xh:t="ENVMAP_TYPE_CUBE_UV";break}return t}function XC(l){let t="ENVMAP_MODE_REFLECTION";if(l.envMap)switch(l.envMapMode){case mo:t="ENVMAP_MODE_REFRACTION";break}return t}function YC(l){let t="ENVMAP_BLENDING_NONE";if(l.envMap)switch(l.combine){case rd:t="ENVMAP_BLENDING_MULTIPLY";break;case v1:t="ENVMAP_BLENDING_MIX";break;case x1:t="ENVMAP_BLENDING_ADD";break}return t}function JC(l){const t=l.envMapCubeUVHeight;if(t===null)return null;const e=Math.log2(t)-2,s=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:s,maxMip:e}}function KC(l,t,e,s){const o=l.getContext(),c=e.defines;let d=e.vertexShader,a=e.fragmentShader;const _=jC(e),v=ZC(e),S=XC(e),M=YC(e),A=JC(e),C=e.isWebGL2?"":UC(e),R=VC(c),F=o.createProgram();let z,L,W=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(z=[R].filter(Mu).join(`
`),z.length>0&&(z+=`
`),L=[C,R].filter(Mu).join(`
`),L.length>0&&(L+=`
`)):(z=[Bv(e),"#define SHADER_NAME "+e.shaderName,R,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+S:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.displacementMap?"#define USE_DISPLACEMENTMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.mapUv?"#define MAP_UV "+e.mapUv:"",e.alphaMapUv?"#define ALPHAMAP_UV "+e.alphaMapUv:"",e.lightMapUv?"#define LIGHTMAP_UV "+e.lightMapUv:"",e.aoMapUv?"#define AOMAP_UV "+e.aoMapUv:"",e.emissiveMapUv?"#define EMISSIVEMAP_UV "+e.emissiveMapUv:"",e.bumpMapUv?"#define BUMPMAP_UV "+e.bumpMapUv:"",e.normalMapUv?"#define NORMALMAP_UV "+e.normalMapUv:"",e.displacementMapUv?"#define DISPLACEMENTMAP_UV "+e.displacementMapUv:"",e.metalnessMapUv?"#define METALNESSMAP_UV "+e.metalnessMapUv:"",e.roughnessMapUv?"#define ROUGHNESSMAP_UV "+e.roughnessMapUv:"",e.clearcoatMapUv?"#define CLEARCOATMAP_UV "+e.clearcoatMapUv:"",e.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+e.clearcoatNormalMapUv:"",e.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+e.clearcoatRoughnessMapUv:"",e.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+e.iridescenceMapUv:"",e.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+e.iridescenceThicknessMapUv:"",e.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+e.sheenColorMapUv:"",e.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+e.sheenRoughnessMapUv:"",e.specularMapUv?"#define SPECULARMAP_UV "+e.specularMapUv:"",e.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+e.specularColorMapUv:"",e.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+e.specularIntensityMapUv:"",e.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+e.transmissionMapUv:"",e.thicknessMapUv?"#define THICKNESSMAP_UV "+e.thicknessMapUv:"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs2?"#define USE_UV2":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors&&e.isWebGL2?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+_:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Mu).join(`
`),L=[C,Bv(e),"#define SHADER_NAME "+e.shaderName,R,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+v:"",e.envMap?"#define "+S:"",e.envMap?"#define "+M:"",A?"#define CUBEUV_TEXEL_WIDTH "+A.texelWidth:"",A?"#define CUBEUV_TEXEL_HEIGHT "+A.texelHeight:"",A?"#define CUBEUV_MAX_MIP "+A.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs2?"#define USE_UV2":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+_:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.useLegacyLights?"#define LEGACY_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==Hr?"#define TONE_MAPPING":"",e.toneMapping!==Hr?Li.tonemapping_pars_fragment:"",e.toneMapping!==Hr?NC("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",Li.encodings_pars_fragment,OC("linearToOutputTexel",e.outputEncoding),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(Mu).join(`
`)),d=A_(d),d=zv(d,e),d=kv(d,e),a=A_(a),a=zv(a,e),a=kv(a,e),d=Fv(d),a=Fv(a),e.isWebGL2&&e.isRawShaderMaterial!==!0&&(W=`#version 300 es
`,z=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+z,L=["#define varying in",e.glslVersion===w_?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===w_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+L);const G=W+z+d,H=W+L+a,Q=Rv(o,35633,G),nt=Rv(o,35632,H);if(o.attachShader(F,Q),o.attachShader(F,nt),e.index0AttributeName!==void 0?o.bindAttribLocation(F,0,e.index0AttributeName):e.morphTargets===!0&&o.bindAttribLocation(F,0,"position"),o.linkProgram(F),l.debug.checkShaderErrors){const K=o.getProgramInfoLog(F).trim(),ot=o.getShaderInfoLog(Q).trim(),kt=o.getShaderInfoLog(nt).trim();let zt=!0,It=!0;if(o.getProgramParameter(F,35714)===!1)if(zt=!1,typeof l.debug.onShaderError=="function")l.debug.onShaderError(o,F,Q,nt);else{const Dt=Dv(o,Q,"vertex"),Wt=Dv(o,nt,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(F,35715)+`

Program Info Log: `+K+`
`+Dt+`
`+Wt)}else K!==""?console.warn("THREE.WebGLProgram: Program Info Log:",K):(ot===""||kt==="")&&(It=!1);It&&(this.diagnostics={runnable:zt,programLog:K,vertexShader:{log:ot,prefix:z},fragmentShader:{log:kt,prefix:L}})}o.deleteShader(Q),o.deleteShader(nt);let pt;this.getUniforms=function(){return pt===void 0&&(pt=new Pp(o,F)),pt};let ft;return this.getAttributes=function(){return ft===void 0&&(ft=GC(o,F)),ft},this.destroy=function(){s.releaseStatesOfProgram(this),o.deleteProgram(F),this.program=void 0},this.name=e.shaderName,this.id=kC++,this.cacheKey=t,this.usedTimes=1,this.program=F,this.vertexShader=Q,this.fragmentShader=nt,this}let QC=0;class t3{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,s=t.fragmentShader,o=this._getShaderStage(e),c=this._getShaderStage(s),d=this._getShaderCacheForMaterial(t);return d.has(o)===!1&&(d.add(o),o.usedTimes++),d.has(c)===!1&&(d.add(c),c.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const s of e)s.usedTimes--,s.usedTimes===0&&this.shaderCache.delete(s.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let s=e.get(t);return s===void 0&&(s=new Set,e.set(t,s)),s}_getShaderStage(t){const e=this.shaderCache;let s=e.get(t);return s===void 0&&(s=new e3(t),e.set(t,s)),s}}class e3{constructor(t){this.id=QC++,this.code=t,this.usedTimes=0}}function i3(l,t,e,s,o,c,d){const a=new jp,_=new t3,v=[],S=o.isWebGL2,M=o.logarithmicDepthBuffer,A=o.vertexTextures;let C=o.precision;const R={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function F(K){return K===1?"uv2":"uv"}function z(K,ot,kt,zt,It){const Dt=zt.fog,Wt=It.geometry,se=K.isMeshStandardMaterial?zt.environment:null,ce=(K.isMeshStandardMaterial?e:t).get(K.envMap||se),ie=ce&&ce.mapping===Xh?ce.image.height:null,be=R[K.type];K.precision!==null&&(C=o.getMaxPrecision(K.precision),C!==K.precision&&console.warn("THREE.WebGLProgram.getParameters:",K.precision,"not supported, using",C,"instead."));const de=Wt.morphAttributes.position||Wt.morphAttributes.normal||Wt.morphAttributes.color,$e=de!==void 0?de.length:0;let _e=0;Wt.morphAttributes.position!==void 0&&(_e=1),Wt.morphAttributes.normal!==void 0&&(_e=2),Wt.morphAttributes.color!==void 0&&(_e=3);let Yt,re,Re,Fe;if(be){const tt=Er[be];Yt=tt.vertexShader,re=tt.fragmentShader}else Yt=K.vertexShader,re=K.fragmentShader,_.update(K),Re=_.getVertexShaderID(K),Fe=_.getFragmentShaderID(K);const Gt=l.getRenderTarget(),ei=It.isInstancedMesh===!0,ci=!!K.map,xe=!!K.matcap,Qe=!!ce,le=!!K.aoMap,Kt=!!K.lightMap,he=!!K.bumpMap,Ee=!!K.normalMap,Ce=!!K.displacementMap,Pt=!!K.emissiveMap,ai=!!K.metalnessMap,ni=!!K.roughnessMap,Oe=K.clearcoat>0,gi=K.iridescence>0,mt=K.sheen>0,rt=K.transmission>0,$t=Oe&&!!K.clearcoatMap,pe=Oe&&!!K.clearcoatNormalMap,ye=Oe&&!!K.clearcoatRoughnessMap,ke=gi&&!!K.iridescenceMap,ui=gi&&!!K.iridescenceThicknessMap,Ut=mt&&!!K.sheenColorMap,Zt=mt&&!!K.sheenRoughnessMap,Ge=!!K.specularMap,si=!!K.specularColorMap,oi=!!K.specularIntensityMap,Bt=rt&&!!K.transmissionMap,ge=rt&&!!K.thicknessMap,Pe=!!K.gradientMap,yi=!!K.alphaMap,Fi=K.alphaTest>0,vt=!!K.extensions,Jt=!!Wt.attributes.uv2;return{isWebGL2:S,shaderID:be,shaderName:K.type,vertexShader:Yt,fragmentShader:re,defines:K.defines,customVertexShaderID:Re,customFragmentShaderID:Fe,isRawShaderMaterial:K.isRawShaderMaterial===!0,glslVersion:K.glslVersion,precision:C,instancing:ei,instancingColor:ei&&It.instanceColor!==null,supportsVertexTextures:A,outputEncoding:Gt===null?l.outputEncoding:Gt.isXRRenderTarget===!0?Gt.texture.encoding:yo,map:ci,matcap:xe,envMap:Qe,envMapMode:Qe&&ce.mapping,envMapCubeUVHeight:ie,aoMap:le,lightMap:Kt,bumpMap:he,normalMap:Ee,displacementMap:A&&Ce,emissiveMap:Pt,normalMapObjectSpace:Ee&&K.normalMapType===$1,normalMapTangentSpace:Ee&&K.normalMapType===wo,decodeVideoTexture:ci&&K.map.isVideoTexture===!0&&K.map.encoding===on,metalnessMap:ai,roughnessMap:ni,clearcoat:Oe,clearcoatMap:$t,clearcoatNormalMap:pe,clearcoatRoughnessMap:ye,iridescence:gi,iridescenceMap:ke,iridescenceThicknessMap:ui,sheen:mt,sheenColorMap:Ut,sheenRoughnessMap:Zt,specularMap:Ge,specularColorMap:si,specularIntensityMap:oi,transmission:rt,transmissionMap:Bt,thicknessMap:ge,gradientMap:Pe,opaque:K.transparent===!1&&K.blending===cl,alphaMap:yi,alphaTest:Fi,combine:K.combine,mapUv:ci&&F(K.map.channel),aoMapUv:le&&F(K.aoMap.channel),lightMapUv:Kt&&F(K.lightMap.channel),bumpMapUv:he&&F(K.bumpMap.channel),normalMapUv:Ee&&F(K.normalMap.channel),displacementMapUv:Ce&&F(K.displacementMap.channel),emissiveMapUv:Pt&&F(K.emissiveMap.channel),metalnessMapUv:ai&&F(K.metalnessMap.channel),roughnessMapUv:ni&&F(K.roughnessMap.channel),clearcoatMapUv:$t&&F(K.clearcoatMap.channel),clearcoatNormalMapUv:pe&&F(K.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ye&&F(K.clearcoatRoughnessMap.channel),iridescenceMapUv:ke&&F(K.iridescenceMap.channel),iridescenceThicknessMapUv:ui&&F(K.iridescenceThicknessMap.channel),sheenColorMapUv:Ut&&F(K.sheenColorMap.channel),sheenRoughnessMapUv:Zt&&F(K.sheenRoughnessMap.channel),specularMapUv:Ge&&F(K.specularMap.channel),specularColorMapUv:si&&F(K.specularColorMap.channel),specularIntensityMapUv:oi&&F(K.specularIntensityMap.channel),transmissionMapUv:Bt&&F(K.transmissionMap.channel),thicknessMapUv:ge&&F(K.thicknessMap.channel),alphaMapUv:yi&&F(K.alphaMap.channel),vertexTangents:Ee&&!!Wt.attributes.tangent,vertexColors:K.vertexColors,vertexAlphas:K.vertexColors===!0&&!!Wt.attributes.color&&Wt.attributes.color.itemSize===4,vertexUvs2:Jt,pointsUvs:It.isPoints===!0&&!!Wt.attributes.uv&&(ci||yi),fog:!!Dt,useFog:K.fog===!0,fogExp2:Dt&&Dt.isFogExp2,flatShading:K.flatShading===!0,sizeAttenuation:K.sizeAttenuation===!0,logarithmicDepthBuffer:M,skinning:It.isSkinnedMesh===!0,morphTargets:Wt.morphAttributes.position!==void 0,morphNormals:Wt.morphAttributes.normal!==void 0,morphColors:Wt.morphAttributes.color!==void 0,morphTargetsCount:$e,morphTextureStride:_e,numDirLights:ot.directional.length,numPointLights:ot.point.length,numSpotLights:ot.spot.length,numSpotLightMaps:ot.spotLightMap.length,numRectAreaLights:ot.rectArea.length,numHemiLights:ot.hemi.length,numDirLightShadows:ot.directionalShadowMap.length,numPointLightShadows:ot.pointShadowMap.length,numSpotLightShadows:ot.spotShadowMap.length,numSpotLightShadowsWithMaps:ot.numSpotLightShadowsWithMaps,numClippingPlanes:d.numPlanes,numClipIntersection:d.numIntersection,dithering:K.dithering,shadowMapEnabled:l.shadowMap.enabled&&kt.length>0,shadowMapType:l.shadowMap.type,toneMapping:K.toneMapped?l.toneMapping:Hr,useLegacyLights:l.useLegacyLights,premultipliedAlpha:K.premultipliedAlpha,doubleSided:K.side===Vr,flipSided:K.side===Ps,useDepthPacking:K.depthPacking>=0,depthPacking:K.depthPacking||0,index0AttributeName:K.index0AttributeName,extensionDerivatives:vt&&K.extensions.derivatives===!0,extensionFragDepth:vt&&K.extensions.fragDepth===!0,extensionDrawBuffers:vt&&K.extensions.drawBuffers===!0,extensionShaderTextureLOD:vt&&K.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:S||s.has("EXT_frag_depth"),rendererExtensionDrawBuffers:S||s.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:S||s.has("EXT_shader_texture_lod"),customProgramCacheKey:K.customProgramCacheKey()}}function L(K){const ot=[];if(K.shaderID?ot.push(K.shaderID):(ot.push(K.customVertexShaderID),ot.push(K.customFragmentShaderID)),K.defines!==void 0)for(const kt in K.defines)ot.push(kt),ot.push(K.defines[kt]);return K.isRawShaderMaterial===!1&&(W(ot,K),G(ot,K),ot.push(l.outputEncoding)),ot.push(K.customProgramCacheKey),ot.join()}function W(K,ot){K.push(ot.precision),K.push(ot.outputEncoding),K.push(ot.envMapMode),K.push(ot.envMapCubeUVHeight),K.push(ot.mapUv),K.push(ot.alphaMapUv),K.push(ot.lightMapUv),K.push(ot.aoMapUv),K.push(ot.bumpMapUv),K.push(ot.normalMapUv),K.push(ot.displacementMapUv),K.push(ot.emissiveMapUv),K.push(ot.metalnessMapUv),K.push(ot.roughnessMapUv),K.push(ot.clearcoatMapUv),K.push(ot.clearcoatNormalMapUv),K.push(ot.clearcoatRoughnessMapUv),K.push(ot.iridescenceMapUv),K.push(ot.iridescenceThicknessMapUv),K.push(ot.sheenColorMapUv),K.push(ot.sheenRoughnessMapUv),K.push(ot.specularMapUv),K.push(ot.specularColorMapUv),K.push(ot.specularIntensityMapUv),K.push(ot.transmissionMapUv),K.push(ot.thicknessMapUv),K.push(ot.combine),K.push(ot.fogExp2),K.push(ot.sizeAttenuation),K.push(ot.morphTargetsCount),K.push(ot.morphAttributeCount),K.push(ot.numDirLights),K.push(ot.numPointLights),K.push(ot.numSpotLights),K.push(ot.numSpotLightMaps),K.push(ot.numHemiLights),K.push(ot.numRectAreaLights),K.push(ot.numDirLightShadows),K.push(ot.numPointLightShadows),K.push(ot.numSpotLightShadows),K.push(ot.numSpotLightShadowsWithMaps),K.push(ot.shadowMapType),K.push(ot.toneMapping),K.push(ot.numClippingPlanes),K.push(ot.numClipIntersection),K.push(ot.depthPacking)}function G(K,ot){a.disableAll(),ot.isWebGL2&&a.enable(0),ot.supportsVertexTextures&&a.enable(1),ot.instancing&&a.enable(2),ot.instancingColor&&a.enable(3),ot.matcap&&a.enable(4),ot.envMap&&a.enable(5),ot.normalMapObjectSpace&&a.enable(6),ot.normalMapTangentSpace&&a.enable(7),ot.clearcoat&&a.enable(8),ot.iridescence&&a.enable(9),ot.alphaTest&&a.enable(10),ot.vertexColors&&a.enable(11),ot.vertexAlphas&&a.enable(12),ot.vertexUvs2&&a.enable(13),ot.vertexTangents&&a.enable(14),K.push(a.mask),a.disableAll(),ot.fog&&a.enable(0),ot.useFog&&a.enable(1),ot.flatShading&&a.enable(2),ot.logarithmicDepthBuffer&&a.enable(3),ot.skinning&&a.enable(4),ot.morphTargets&&a.enable(5),ot.morphNormals&&a.enable(6),ot.morphColors&&a.enable(7),ot.premultipliedAlpha&&a.enable(8),ot.shadowMapEnabled&&a.enable(9),ot.useLegacyLights&&a.enable(10),ot.doubleSided&&a.enable(11),ot.flipSided&&a.enable(12),ot.useDepthPacking&&a.enable(13),ot.dithering&&a.enable(14),ot.transmission&&a.enable(15),ot.sheen&&a.enable(16),ot.decodeVideoTexture&&a.enable(17),ot.opaque&&a.enable(18),ot.pointsUvs&&a.enable(19),K.push(a.mask)}function H(K){const ot=R[K.type];let kt;if(ot){const zt=Er[ot];kt=Q1.clone(zt.uniforms)}else kt=K.uniforms;return kt}function Q(K,ot){let kt;for(let zt=0,It=v.length;zt<It;zt++){const Dt=v[zt];if(Dt.cacheKey===ot){kt=Dt,++kt.usedTimes;break}}return kt===void 0&&(kt=new KC(l,ot,K,c),v.push(kt)),kt}function nt(K){if(--K.usedTimes===0){const ot=v.indexOf(K);v[ot]=v[v.length-1],v.pop(),K.destroy()}}function pt(K){_.remove(K)}function ft(){_.dispose()}return{getParameters:z,getProgramCacheKey:L,getUniforms:H,acquireProgram:Q,releaseProgram:nt,releaseShaderCache:pt,programs:v,dispose:ft}}function n3(){let l=new WeakMap;function t(c){let d=l.get(c);return d===void 0&&(d={},l.set(c,d)),d}function e(c){l.delete(c)}function s(c,d,a){l.get(c)[d]=a}function o(){l=new WeakMap}return{get:t,remove:e,update:s,dispose:o}}function s3(l,t){return l.groupOrder!==t.groupOrder?l.groupOrder-t.groupOrder:l.renderOrder!==t.renderOrder?l.renderOrder-t.renderOrder:l.material.id!==t.material.id?l.material.id-t.material.id:l.z!==t.z?l.z-t.z:l.id-t.id}function Ov(l,t){return l.groupOrder!==t.groupOrder?l.groupOrder-t.groupOrder:l.renderOrder!==t.renderOrder?l.renderOrder-t.renderOrder:l.z!==t.z?t.z-l.z:l.id-t.id}function Nv(){const l=[];let t=0;const e=[],s=[],o=[];function c(){t=0,e.length=0,s.length=0,o.length=0}function d(M,A,C,R,F,z){let L=l[t];return L===void 0?(L={id:M.id,object:M,geometry:A,material:C,groupOrder:R,renderOrder:M.renderOrder,z:F,group:z},l[t]=L):(L.id=M.id,L.object=M,L.geometry=A,L.material=C,L.groupOrder=R,L.renderOrder=M.renderOrder,L.z=F,L.group=z),t++,L}function a(M,A,C,R,F,z){const L=d(M,A,C,R,F,z);C.transmission>0?s.push(L):C.transparent===!0?o.push(L):e.push(L)}function _(M,A,C,R,F,z){const L=d(M,A,C,R,F,z);C.transmission>0?s.unshift(L):C.transparent===!0?o.unshift(L):e.unshift(L)}function v(M,A){e.length>1&&e.sort(M||s3),s.length>1&&s.sort(A||Ov),o.length>1&&o.sort(A||Ov)}function S(){for(let M=t,A=l.length;M<A;M++){const C=l[M];if(C.id===null)break;C.id=null,C.object=null,C.geometry=null,C.material=null,C.group=null}}return{opaque:e,transmissive:s,transparent:o,init:c,push:a,unshift:_,finish:S,sort:v}}function r3(){let l=new WeakMap;function t(s,o){const c=l.get(s);let d;return c===void 0?(d=new Nv,l.set(s,[d])):o>=c.length?(d=new Nv,c.push(d)):d=c[o],d}function e(){l=new WeakMap}return{get:t,dispose:e}}function a3(){const l={};return{get:function(t){if(l[t.id]!==void 0)return l[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new ut,color:new Je};break;case"SpotLight":e={position:new ut,direction:new ut,color:new Je,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new ut,color:new Je,distance:0,decay:0};break;case"HemisphereLight":e={direction:new ut,skyColor:new Je,groundColor:new Je};break;case"RectAreaLight":e={color:new Je,position:new ut,halfWidth:new ut,halfHeight:new ut};break}return l[t.id]=e,e}}}function o3(){const l={};return{get:function(t){if(l[t.id]!==void 0)return l[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new me};break;case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new me};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new me,shadowCameraNear:1,shadowCameraFar:1e3};break}return l[t.id]=e,e}}}let l3=0;function h3(l,t){return(t.castShadow?2:0)-(l.castShadow?2:0)+(t.map?1:0)-(l.map?1:0)}function c3(l,t){const e=new a3,s=o3(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let S=0;S<9;S++)o.probe.push(new ut);const c=new ut,d=new xi,a=new xi;function _(S,M){let A=0,C=0,R=0;for(let kt=0;kt<9;kt++)o.probe[kt].set(0,0,0);let F=0,z=0,L=0,W=0,G=0,H=0,Q=0,nt=0,pt=0,ft=0;S.sort(h3);const K=M===!0?Math.PI:1;for(let kt=0,zt=S.length;kt<zt;kt++){const It=S[kt],Dt=It.color,Wt=It.intensity,se=It.distance,ce=It.shadow&&It.shadow.map?It.shadow.map.texture:null;if(It.isAmbientLight)A+=Dt.r*Wt*K,C+=Dt.g*Wt*K,R+=Dt.b*Wt*K;else if(It.isLightProbe)for(let ie=0;ie<9;ie++)o.probe[ie].addScaledVector(It.sh.coefficients[ie],Wt);else if(It.isDirectionalLight){const ie=e.get(It);if(ie.color.copy(It.color).multiplyScalar(It.intensity*K),It.castShadow){const be=It.shadow,de=s.get(It);de.shadowBias=be.bias,de.shadowNormalBias=be.normalBias,de.shadowRadius=be.radius,de.shadowMapSize=be.mapSize,o.directionalShadow[F]=de,o.directionalShadowMap[F]=ce,o.directionalShadowMatrix[F]=It.shadow.matrix,H++}o.directional[F]=ie,F++}else if(It.isSpotLight){const ie=e.get(It);ie.position.setFromMatrixPosition(It.matrixWorld),ie.color.copy(Dt).multiplyScalar(Wt*K),ie.distance=se,ie.coneCos=Math.cos(It.angle),ie.penumbraCos=Math.cos(It.angle*(1-It.penumbra)),ie.decay=It.decay,o.spot[L]=ie;const be=It.shadow;if(It.map&&(o.spotLightMap[pt]=It.map,pt++,be.updateMatrices(It),It.castShadow&&ft++),o.spotLightMatrix[L]=be.matrix,It.castShadow){const de=s.get(It);de.shadowBias=be.bias,de.shadowNormalBias=be.normalBias,de.shadowRadius=be.radius,de.shadowMapSize=be.mapSize,o.spotShadow[L]=de,o.spotShadowMap[L]=ce,nt++}L++}else if(It.isRectAreaLight){const ie=e.get(It);ie.color.copy(Dt).multiplyScalar(Wt),ie.halfWidth.set(It.width*.5,0,0),ie.halfHeight.set(0,It.height*.5,0),o.rectArea[W]=ie,W++}else if(It.isPointLight){const ie=e.get(It);if(ie.color.copy(It.color).multiplyScalar(It.intensity*K),ie.distance=It.distance,ie.decay=It.decay,It.castShadow){const be=It.shadow,de=s.get(It);de.shadowBias=be.bias,de.shadowNormalBias=be.normalBias,de.shadowRadius=be.radius,de.shadowMapSize=be.mapSize,de.shadowCameraNear=be.camera.near,de.shadowCameraFar=be.camera.far,o.pointShadow[z]=de,o.pointShadowMap[z]=ce,o.pointShadowMatrix[z]=It.shadow.matrix,Q++}o.point[z]=ie,z++}else if(It.isHemisphereLight){const ie=e.get(It);ie.skyColor.copy(It.color).multiplyScalar(Wt*K),ie.groundColor.copy(It.groundColor).multiplyScalar(Wt*K),o.hemi[G]=ie,G++}}W>0&&(t.isWebGL2||l.has("OES_texture_float_linear")===!0?(o.rectAreaLTC1=Ue.LTC_FLOAT_1,o.rectAreaLTC2=Ue.LTC_FLOAT_2):l.has("OES_texture_half_float_linear")===!0?(o.rectAreaLTC1=Ue.LTC_HALF_1,o.rectAreaLTC2=Ue.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=A,o.ambient[1]=C,o.ambient[2]=R;const ot=o.hash;(ot.directionalLength!==F||ot.pointLength!==z||ot.spotLength!==L||ot.rectAreaLength!==W||ot.hemiLength!==G||ot.numDirectionalShadows!==H||ot.numPointShadows!==Q||ot.numSpotShadows!==nt||ot.numSpotMaps!==pt)&&(o.directional.length=F,o.spot.length=L,o.rectArea.length=W,o.point.length=z,o.hemi.length=G,o.directionalShadow.length=H,o.directionalShadowMap.length=H,o.pointShadow.length=Q,o.pointShadowMap.length=Q,o.spotShadow.length=nt,o.spotShadowMap.length=nt,o.directionalShadowMatrix.length=H,o.pointShadowMatrix.length=Q,o.spotLightMatrix.length=nt+pt-ft,o.spotLightMap.length=pt,o.numSpotLightShadowsWithMaps=ft,ot.directionalLength=F,ot.pointLength=z,ot.spotLength=L,ot.rectAreaLength=W,ot.hemiLength=G,ot.numDirectionalShadows=H,ot.numPointShadows=Q,ot.numSpotShadows=nt,ot.numSpotMaps=pt,o.version=l3++)}function v(S,M){let A=0,C=0,R=0,F=0,z=0;const L=M.matrixWorldInverse;for(let W=0,G=S.length;W<G;W++){const H=S[W];if(H.isDirectionalLight){const Q=o.directional[A];Q.direction.setFromMatrixPosition(H.matrixWorld),c.setFromMatrixPosition(H.target.matrixWorld),Q.direction.sub(c),Q.direction.transformDirection(L),A++}else if(H.isSpotLight){const Q=o.spot[R];Q.position.setFromMatrixPosition(H.matrixWorld),Q.position.applyMatrix4(L),Q.direction.setFromMatrixPosition(H.matrixWorld),c.setFromMatrixPosition(H.target.matrixWorld),Q.direction.sub(c),Q.direction.transformDirection(L),R++}else if(H.isRectAreaLight){const Q=o.rectArea[F];Q.position.setFromMatrixPosition(H.matrixWorld),Q.position.applyMatrix4(L),a.identity(),d.copy(H.matrixWorld),d.premultiply(L),a.extractRotation(d),Q.halfWidth.set(H.width*.5,0,0),Q.halfHeight.set(0,H.height*.5,0),Q.halfWidth.applyMatrix4(a),Q.halfHeight.applyMatrix4(a),F++}else if(H.isPointLight){const Q=o.point[C];Q.position.setFromMatrixPosition(H.matrixWorld),Q.position.applyMatrix4(L),C++}else if(H.isHemisphereLight){const Q=o.hemi[z];Q.direction.setFromMatrixPosition(H.matrixWorld),Q.direction.transformDirection(L),z++}}}return{setup:_,setupView:v,state:o}}function Uv(l,t){const e=new c3(l,t),s=[],o=[];function c(){s.length=0,o.length=0}function d(M){s.push(M)}function a(M){o.push(M)}function _(M){e.setup(s,M)}function v(M){e.setupView(s,M)}return{init:c,state:{lightsArray:s,shadowsArray:o,lights:e},setupLights:_,setupLightsView:v,pushLight:d,pushShadow:a}}function u3(l,t){let e=new WeakMap;function s(c,d=0){const a=e.get(c);let _;return a===void 0?(_=new Uv(l,t),e.set(c,[_])):d>=a.length?(_=new Uv(l,t),a.push(_)):_=a[d],_}function o(){e=new WeakMap}return{get:s,dispose:o}}class K_ extends _s{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=W1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Q_ extends _s{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const d3=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,f3=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function p3(l,t,e){let s=new Zp;const o=new me,c=new me,d=new Ji,a=new K_({depthPacking:q1}),_=new Q_,v={},S=e.maxTextureSize,M={[Ea]:Ps,[Ps]:Ea,[Vr]:Vr},A=new jr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new me},radius:{value:4}},vertexShader:d3,fragmentShader:f3}),C=A.clone();C.defines.HORIZONTAL_PASS=1;const R=new Ii;R.setAttribute("position",new Zi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const F=new Vn(R,A),z=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=N_,this.render=function(H,Q,nt){if(z.enabled===!1||z.autoUpdate===!1&&z.needsUpdate===!1||H.length===0)return;const pt=l.getRenderTarget(),ft=l.getActiveCubeFace(),K=l.getActiveMipmapLevel(),ot=l.state;ot.setBlending(Ta),ot.buffers.color.setClear(1,1,1,1),ot.buffers.depth.setTest(!0),ot.setScissorTest(!1);for(let kt=0,zt=H.length;kt<zt;kt++){const It=H[kt],Dt=It.shadow;if(Dt===void 0){console.warn("THREE.WebGLShadowMap:",It,"has no shadow.");continue}if(Dt.autoUpdate===!1&&Dt.needsUpdate===!1)continue;o.copy(Dt.mapSize);const Wt=Dt.getFrameExtents();if(o.multiply(Wt),c.copy(Dt.mapSize),(o.x>S||o.y>S)&&(o.x>S&&(c.x=Math.floor(S/Wt.x),o.x=c.x*Wt.x,Dt.mapSize.x=c.x),o.y>S&&(c.y=Math.floor(S/Wt.y),o.y=c.y*Wt.y,Dt.mapSize.y=c.y)),Dt.map===null){const ce=this.type!==Ih?{minFilter:Rn,magFilter:Rn}:{};Dt.map=new Ir(o.x,o.y,ce),Dt.map.texture.name=It.name+".shadowMap",Dt.camera.updateProjectionMatrix()}l.setRenderTarget(Dt.map),l.clear();const se=Dt.getViewportCount();for(let ce=0;ce<se;ce++){const ie=Dt.getViewport(ce);d.set(c.x*ie.x,c.y*ie.y,c.x*ie.z,c.y*ie.w),ot.viewport(d),Dt.updateMatrices(It,ce),s=Dt.getFrustum(),G(Q,nt,Dt.camera,It,this.type)}Dt.isPointLightShadow!==!0&&this.type===Ih&&L(Dt,nt),Dt.needsUpdate=!1}z.needsUpdate=!1,l.setRenderTarget(pt,ft,K)};function L(H,Q){const nt=t.update(F);A.defines.VSM_SAMPLES!==H.blurSamples&&(A.defines.VSM_SAMPLES=H.blurSamples,C.defines.VSM_SAMPLES=H.blurSamples,A.needsUpdate=!0,C.needsUpdate=!0),H.mapPass===null&&(H.mapPass=new Ir(o.x,o.y)),A.uniforms.shadow_pass.value=H.map.texture,A.uniforms.resolution.value=H.mapSize,A.uniforms.radius.value=H.radius,l.setRenderTarget(H.mapPass),l.clear(),l.renderBufferDirect(Q,null,nt,A,F,null),C.uniforms.shadow_pass.value=H.mapPass.texture,C.uniforms.resolution.value=H.mapSize,C.uniforms.radius.value=H.radius,l.setRenderTarget(H.map),l.clear(),l.renderBufferDirect(Q,null,nt,C,F,null)}function W(H,Q,nt,pt){let ft=null;const K=nt.isPointLight===!0?H.customDistanceMaterial:H.customDepthMaterial;if(K!==void 0)ft=K;else if(ft=nt.isPointLight===!0?_:a,l.localClippingEnabled&&Q.clipShadows===!0&&Array.isArray(Q.clippingPlanes)&&Q.clippingPlanes.length!==0||Q.displacementMap&&Q.displacementScale!==0||Q.alphaMap&&Q.alphaTest>0||Q.map&&Q.alphaTest>0){const ot=ft.uuid,kt=Q.uuid;let zt=v[ot];zt===void 0&&(zt={},v[ot]=zt);let It=zt[kt];It===void 0&&(It=ft.clone(),zt[kt]=It),ft=It}if(ft.visible=Q.visible,ft.wireframe=Q.wireframe,pt===Ih?ft.side=Q.shadowSide!==null?Q.shadowSide:Q.side:ft.side=Q.shadowSide!==null?Q.shadowSide:M[Q.side],ft.alphaMap=Q.alphaMap,ft.alphaTest=Q.alphaTest,ft.map=Q.map,ft.clipShadows=Q.clipShadows,ft.clippingPlanes=Q.clippingPlanes,ft.clipIntersection=Q.clipIntersection,ft.displacementMap=Q.displacementMap,ft.displacementScale=Q.displacementScale,ft.displacementBias=Q.displacementBias,ft.wireframeLinewidth=Q.wireframeLinewidth,ft.linewidth=Q.linewidth,nt.isPointLight===!0&&ft.isMeshDistanceMaterial===!0){const ot=l.properties.get(ft);ot.light=nt}return ft}function G(H,Q,nt,pt,ft){if(H.visible===!1)return;if(H.layers.test(Q.layers)&&(H.isMesh||H.isLine||H.isPoints)&&(H.castShadow||H.receiveShadow&&ft===Ih)&&(!H.frustumCulled||s.intersectsObject(H))){H.modelViewMatrix.multiplyMatrices(nt.matrixWorldInverse,H.matrixWorld);const kt=t.update(H),zt=H.material;if(Array.isArray(zt)){const It=kt.groups;for(let Dt=0,Wt=It.length;Dt<Wt;Dt++){const se=It[Dt],ce=zt[se.materialIndex];if(ce&&ce.visible){const ie=W(H,ce,pt,ft);l.renderBufferDirect(nt,null,kt,ie,H,se)}}}else if(zt.visible){const It=W(H,zt,pt,ft);l.renderBufferDirect(nt,null,kt,It,H,null)}}const ot=H.children;for(let kt=0,zt=ot.length;kt<zt;kt++)G(ot[kt],Q,nt,pt,ft)}}function m3(l,t,e){const s=e.isWebGL2;function o(){let vt=!1;const Jt=new Ji;let fe=null;const tt=new Ji(0,0,0,0);return{setMask:function(V){fe!==V&&!vt&&(l.colorMask(V,V,V,V),fe=V)},setLocked:function(V){vt=V},setClear:function(V,j,Z,at,Mt){Mt===!0&&(V*=at,j*=at,Z*=at),Jt.set(V,j,Z,at),tt.equals(Jt)===!1&&(l.clearColor(V,j,Z,at),tt.copy(Jt))},reset:function(){vt=!1,fe=null,tt.set(-1,0,0,0)}}}function c(){let vt=!1,Jt=null,fe=null,tt=null;return{setTest:function(V){V?Gt(2929):ei(2929)},setMask:function(V){Jt!==V&&!vt&&(l.depthMask(V),Jt=V)},setFunc:function(V){if(fe!==V){switch(V){case d1:l.depthFunc(512);break;case f1:l.depthFunc(519);break;case p1:l.depthFunc(513);break;case zp:l.depthFunc(515);break;case m1:l.depthFunc(514);break;case g1:l.depthFunc(518);break;case _1:l.depthFunc(516);break;case y1:l.depthFunc(517);break;default:l.depthFunc(515)}fe=V}},setLocked:function(V){vt=V},setClear:function(V){tt!==V&&(l.clearDepth(V),tt=V)},reset:function(){vt=!1,Jt=null,fe=null,tt=null}}}function d(){let vt=!1,Jt=null,fe=null,tt=null,V=null,j=null,Z=null,at=null,Mt=null;return{setTest:function(bt){vt||(bt?Gt(2960):ei(2960))},setMask:function(bt){Jt!==bt&&!vt&&(l.stencilMask(bt),Jt=bt)},setFunc:function(bt,Tt,yt){(fe!==bt||tt!==Tt||V!==yt)&&(l.stencilFunc(bt,Tt,yt),fe=bt,tt=Tt,V=yt)},setOp:function(bt,Tt,yt){(j!==bt||Z!==Tt||at!==yt)&&(l.stencilOp(bt,Tt,yt),j=bt,Z=Tt,at=yt)},setLocked:function(bt){vt=bt},setClear:function(bt){Mt!==bt&&(l.clearStencil(bt),Mt=bt)},reset:function(){vt=!1,Jt=null,fe=null,tt=null,V=null,j=null,Z=null,at=null,Mt=null}}}const a=new o,_=new c,v=new d,S=new WeakMap,M=new WeakMap;let A={},C={},R=new WeakMap,F=[],z=null,L=!1,W=null,G=null,H=null,Q=null,nt=null,pt=null,ft=null,K=!1,ot=null,kt=null,zt=null,It=null,Dt=null;const Wt=l.getParameter(35661);let se=!1,ce=0;const ie=l.getParameter(7938);ie.indexOf("WebGL")!==-1?(ce=parseFloat(/^WebGL (\d)/.exec(ie)[1]),se=ce>=1):ie.indexOf("OpenGL ES")!==-1&&(ce=parseFloat(/^OpenGL ES (\d)/.exec(ie)[1]),se=ce>=2);let be=null,de={};const $e=l.getParameter(3088),_e=l.getParameter(2978),Yt=new Ji().fromArray($e),re=new Ji().fromArray(_e);function Re(vt,Jt,fe){const tt=new Uint8Array(4),V=l.createTexture();l.bindTexture(vt,V),l.texParameteri(vt,10241,9728),l.texParameteri(vt,10240,9728);for(let j=0;j<fe;j++)l.texImage2D(Jt+j,0,6408,1,1,0,6408,5121,tt);return V}const Fe={};Fe[3553]=Re(3553,3553,1),Fe[34067]=Re(34067,34069,6),a.setClear(0,0,0,1),_.setClear(1),v.setClear(0),Gt(2929),_.setFunc(zp),Ce(!1),Pt(jg),Gt(2884),he(Ta);function Gt(vt){A[vt]!==!0&&(l.enable(vt),A[vt]=!0)}function ei(vt){A[vt]!==!1&&(l.disable(vt),A[vt]=!1)}function ci(vt,Jt){return C[vt]!==Jt?(l.bindFramebuffer(vt,Jt),C[vt]=Jt,s&&(vt===36009&&(C[36160]=Jt),vt===36160&&(C[36009]=Jt)),!0):!1}function xe(vt,Jt){let fe=F,tt=!1;if(vt)if(fe=R.get(Jt),fe===void 0&&(fe=[],R.set(Jt,fe)),vt.isWebGLMultipleRenderTargets){const V=vt.texture;if(fe.length!==V.length||fe[0]!==36064){for(let j=0,Z=V.length;j<Z;j++)fe[j]=36064+j;fe.length=V.length,tt=!0}}else fe[0]!==36064&&(fe[0]=36064,tt=!0);else fe[0]!==1029&&(fe[0]=1029,tt=!0);tt&&(e.isWebGL2?l.drawBuffers(fe):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(fe))}function Qe(vt){return z!==vt?(l.useProgram(vt),z=vt,!0):!1}const le={[nl]:32774,[e1]:32778,[i1]:32779};if(s)le[Jg]=32775,le[Kg]=32776;else{const vt=t.get("EXT_blend_minmax");vt!==null&&(le[Jg]=vt.MIN_EXT,le[Kg]=vt.MAX_EXT)}const Kt={[n1]:0,[s1]:1,[r1]:768,[U_]:770,[u1]:776,[h1]:774,[o1]:772,[a1]:769,[V_]:771,[c1]:775,[l1]:773};function he(vt,Jt,fe,tt,V,j,Z,at){if(vt===Ta){L===!0&&(ei(3042),L=!1);return}if(L===!1&&(Gt(3042),L=!0),vt!==t1){if(vt!==W||at!==K){if((G!==nl||nt!==nl)&&(l.blendEquation(32774),G=nl,nt=nl),at)switch(vt){case cl:l.blendFuncSeparate(1,771,1,771);break;case Zg:l.blendFunc(1,1);break;case Xg:l.blendFuncSeparate(0,769,0,1);break;case Yg:l.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",vt);break}else switch(vt){case cl:l.blendFuncSeparate(770,771,1,771);break;case Zg:l.blendFunc(770,1);break;case Xg:l.blendFuncSeparate(0,769,0,1);break;case Yg:l.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",vt);break}H=null,Q=null,pt=null,ft=null,W=vt,K=at}return}V=V||Jt,j=j||fe,Z=Z||tt,(Jt!==G||V!==nt)&&(l.blendEquationSeparate(le[Jt],le[V]),G=Jt,nt=V),(fe!==H||tt!==Q||j!==pt||Z!==ft)&&(l.blendFuncSeparate(Kt[fe],Kt[tt],Kt[j],Kt[Z]),H=fe,Q=tt,pt=j,ft=Z),W=vt,K=!1}function Ee(vt,Jt){vt.side===Vr?ei(2884):Gt(2884);let fe=vt.side===Ps;Jt&&(fe=!fe),Ce(fe),vt.blending===cl&&vt.transparent===!1?he(Ta):he(vt.blending,vt.blendEquation,vt.blendSrc,vt.blendDst,vt.blendEquationAlpha,vt.blendSrcAlpha,vt.blendDstAlpha,vt.premultipliedAlpha),_.setFunc(vt.depthFunc),_.setTest(vt.depthTest),_.setMask(vt.depthWrite),a.setMask(vt.colorWrite);const tt=vt.stencilWrite;v.setTest(tt),tt&&(v.setMask(vt.stencilWriteMask),v.setFunc(vt.stencilFunc,vt.stencilRef,vt.stencilFuncMask),v.setOp(vt.stencilFail,vt.stencilZFail,vt.stencilZPass)),ni(vt.polygonOffset,vt.polygonOffsetFactor,vt.polygonOffsetUnits),vt.alphaToCoverage===!0?Gt(32926):ei(32926)}function Ce(vt){ot!==vt&&(vt?l.frontFace(2304):l.frontFace(2305),ot=vt)}function Pt(vt){vt!==Jx?(Gt(2884),vt!==kt&&(vt===jg?l.cullFace(1029):vt===Kx?l.cullFace(1028):l.cullFace(1032))):ei(2884),kt=vt}function ai(vt){vt!==zt&&(se&&l.lineWidth(vt),zt=vt)}function ni(vt,Jt,fe){vt?(Gt(32823),(It!==Jt||Dt!==fe)&&(l.polygonOffset(Jt,fe),It=Jt,Dt=fe)):ei(32823)}function Oe(vt){vt?Gt(3089):ei(3089)}function gi(vt){vt===void 0&&(vt=33984+Wt-1),be!==vt&&(l.activeTexture(vt),be=vt)}function mt(vt,Jt,fe){fe===void 0&&(be===null?fe=33984+Wt-1:fe=be);let tt=de[fe];tt===void 0&&(tt={type:void 0,texture:void 0},de[fe]=tt),(tt.type!==vt||tt.texture!==Jt)&&(be!==fe&&(l.activeTexture(fe),be=fe),l.bindTexture(vt,Jt||Fe[vt]),tt.type=vt,tt.texture=Jt)}function rt(){const vt=de[be];vt!==void 0&&vt.type!==void 0&&(l.bindTexture(vt.type,null),vt.type=void 0,vt.texture=void 0)}function $t(){try{l.compressedTexImage2D.apply(l,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function pe(){try{l.compressedTexImage3D.apply(l,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function ye(){try{l.texSubImage2D.apply(l,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function ke(){try{l.texSubImage3D.apply(l,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function ui(){try{l.compressedTexSubImage2D.apply(l,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function Ut(){try{l.compressedTexSubImage3D.apply(l,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function Zt(){try{l.texStorage2D.apply(l,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function Ge(){try{l.texStorage3D.apply(l,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function si(){try{l.texImage2D.apply(l,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function oi(){try{l.texImage3D.apply(l,arguments)}catch(vt){console.error("THREE.WebGLState:",vt)}}function Bt(vt){Yt.equals(vt)===!1&&(l.scissor(vt.x,vt.y,vt.z,vt.w),Yt.copy(vt))}function ge(vt){re.equals(vt)===!1&&(l.viewport(vt.x,vt.y,vt.z,vt.w),re.copy(vt))}function Pe(vt,Jt){let fe=M.get(Jt);fe===void 0&&(fe=new WeakMap,M.set(Jt,fe));let tt=fe.get(vt);tt===void 0&&(tt=l.getUniformBlockIndex(Jt,vt.name),fe.set(vt,tt))}function yi(vt,Jt){const tt=M.get(Jt).get(vt);S.get(Jt)!==tt&&(l.uniformBlockBinding(Jt,tt,vt.__bindingPointIndex),S.set(Jt,tt))}function Fi(){l.disable(3042),l.disable(2884),l.disable(2929),l.disable(32823),l.disable(3089),l.disable(2960),l.disable(32926),l.blendEquation(32774),l.blendFunc(1,0),l.blendFuncSeparate(1,0,1,0),l.colorMask(!0,!0,!0,!0),l.clearColor(0,0,0,0),l.depthMask(!0),l.depthFunc(513),l.clearDepth(1),l.stencilMask(4294967295),l.stencilFunc(519,0,4294967295),l.stencilOp(7680,7680,7680),l.clearStencil(0),l.cullFace(1029),l.frontFace(2305),l.polygonOffset(0,0),l.activeTexture(33984),l.bindFramebuffer(36160,null),s===!0&&(l.bindFramebuffer(36009,null),l.bindFramebuffer(36008,null)),l.useProgram(null),l.lineWidth(1),l.scissor(0,0,l.canvas.width,l.canvas.height),l.viewport(0,0,l.canvas.width,l.canvas.height),A={},be=null,de={},C={},R=new WeakMap,F=[],z=null,L=!1,W=null,G=null,H=null,Q=null,nt=null,pt=null,ft=null,K=!1,ot=null,kt=null,zt=null,It=null,Dt=null,Yt.set(0,0,l.canvas.width,l.canvas.height),re.set(0,0,l.canvas.width,l.canvas.height),a.reset(),_.reset(),v.reset()}return{buffers:{color:a,depth:_,stencil:v},enable:Gt,disable:ei,bindFramebuffer:ci,drawBuffers:xe,useProgram:Qe,setBlending:he,setMaterial:Ee,setFlipSided:Ce,setCullFace:Pt,setLineWidth:ai,setPolygonOffset:ni,setScissorTest:Oe,activeTexture:gi,bindTexture:mt,unbindTexture:rt,compressedTexImage2D:$t,compressedTexImage3D:pe,texImage2D:si,texImage3D:oi,updateUBOMapping:Pe,uniformBlockBinding:yi,texStorage2D:Zt,texStorage3D:Ge,texSubImage2D:ye,texSubImage3D:ke,compressedTexSubImage2D:ui,compressedTexSubImage3D:Ut,scissor:Bt,viewport:ge,reset:Fi}}function g3(l,t,e,s,o,c,d){const a=o.isWebGL2,_=o.maxTextures,v=o.maxCubemapSize,S=o.maxTextureSize,M=o.maxSamples,A=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,C=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),R=new WeakMap;let F;const z=new WeakMap;let L=!1;try{L=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function W(mt,rt){return L?new OffscreenCanvas(mt,rt):qu("canvas")}function G(mt,rt,$t,pe){let ye=1;if((mt.width>pe||mt.height>pe)&&(ye=pe/Math.max(mt.width,mt.height)),ye<1||rt===!0)if(typeof HTMLImageElement<"u"&&mt instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&mt instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&mt instanceof ImageBitmap){const ke=rt?X1:Math.floor,ui=ke(ye*mt.width),Ut=ke(ye*mt.height);F===void 0&&(F=W(ui,Ut));const Zt=$t?W(ui,Ut):F;return Zt.width=ui,Zt.height=Ut,Zt.getContext("2d").drawImage(mt,0,0,ui,Ut),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+mt.width+"x"+mt.height+") to ("+ui+"x"+Ut+")."),Zt}else return"data"in mt&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+mt.width+"x"+mt.height+")."),mt;return mt}function H(mt){return M_(mt.width)&&M_(mt.height)}function Q(mt){return a?!1:mt.wrapS!==gs||mt.wrapT!==gs||mt.minFilter!==Rn&&mt.minFilter!==Dn}function nt(mt,rt){return mt.generateMipmaps&&rt&&mt.minFilter!==Rn&&mt.minFilter!==Dn}function pt(mt){l.generateMipmap(mt)}function ft(mt,rt,$t,pe,ye=!1){if(a===!1)return rt;if(mt!==null){if(l[mt]!==void 0)return l[mt];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+mt+"'")}let ke=rt;return rt===6403&&($t===5126&&(ke=33326),$t===5131&&(ke=33325),$t===5121&&(ke=33321)),rt===33319&&($t===5126&&(ke=33328),$t===5131&&(ke=33327),$t===5121&&(ke=33323)),rt===6408&&($t===5126&&(ke=34836),$t===5131&&(ke=34842),$t===5121&&(ke=pe===on&&ye===!1?35907:32856),$t===32819&&(ke=32854),$t===32820&&(ke=32855)),(ke===33325||ke===33326||ke===33327||ke===33328||ke===34842||ke===34836)&&t.get("EXT_color_buffer_float"),ke}function K(mt,rt,$t){return nt(mt,$t)===!0||mt.isFramebufferTexture&&mt.minFilter!==Rn&&mt.minFilter!==Dn?Math.log2(Math.max(rt.width,rt.height))+1:mt.mipmaps!==void 0&&mt.mipmaps.length>0?mt.mipmaps.length:mt.isCompressedTexture&&Array.isArray(mt.image)?rt.mipmaps.length:1}function ot(mt){return mt===Rn||mt===kp||mt===Eu?9728:9729}function kt(mt){const rt=mt.target;rt.removeEventListener("dispose",kt),It(rt),rt.isVideoTexture&&R.delete(rt)}function zt(mt){const rt=mt.target;rt.removeEventListener("dispose",zt),Wt(rt)}function It(mt){const rt=s.get(mt);if(rt.__webglInit===void 0)return;const $t=mt.source,pe=z.get($t);if(pe){const ye=pe[rt.__cacheKey];ye.usedTimes--,ye.usedTimes===0&&Dt(mt),Object.keys(pe).length===0&&z.delete($t)}s.remove(mt)}function Dt(mt){const rt=s.get(mt);l.deleteTexture(rt.__webglTexture);const $t=mt.source,pe=z.get($t);delete pe[rt.__cacheKey],d.memory.textures--}function Wt(mt){const rt=mt.texture,$t=s.get(mt),pe=s.get(rt);if(pe.__webglTexture!==void 0&&(l.deleteTexture(pe.__webglTexture),d.memory.textures--),mt.depthTexture&&mt.depthTexture.dispose(),mt.isWebGLCubeRenderTarget)for(let ye=0;ye<6;ye++)l.deleteFramebuffer($t.__webglFramebuffer[ye]),$t.__webglDepthbuffer&&l.deleteRenderbuffer($t.__webglDepthbuffer[ye]);else{if(l.deleteFramebuffer($t.__webglFramebuffer),$t.__webglDepthbuffer&&l.deleteRenderbuffer($t.__webglDepthbuffer),$t.__webglMultisampledFramebuffer&&l.deleteFramebuffer($t.__webglMultisampledFramebuffer),$t.__webglColorRenderbuffer)for(let ye=0;ye<$t.__webglColorRenderbuffer.length;ye++)$t.__webglColorRenderbuffer[ye]&&l.deleteRenderbuffer($t.__webglColorRenderbuffer[ye]);$t.__webglDepthRenderbuffer&&l.deleteRenderbuffer($t.__webglDepthRenderbuffer)}if(mt.isWebGLMultipleRenderTargets)for(let ye=0,ke=rt.length;ye<ke;ye++){const ui=s.get(rt[ye]);ui.__webglTexture&&(l.deleteTexture(ui.__webglTexture),d.memory.textures--),s.remove(rt[ye])}s.remove(rt),s.remove(mt)}let se=0;function ce(){se=0}function ie(){const mt=se;return mt>=_&&console.warn("THREE.WebGLTextures: Trying to use "+mt+" texture units while this GPU supports only "+_),se+=1,mt}function be(mt){const rt=[];return rt.push(mt.wrapS),rt.push(mt.wrapT),rt.push(mt.wrapR||0),rt.push(mt.magFilter),rt.push(mt.minFilter),rt.push(mt.anisotropy),rt.push(mt.internalFormat),rt.push(mt.format),rt.push(mt.type),rt.push(mt.generateMipmaps),rt.push(mt.premultiplyAlpha),rt.push(mt.flipY),rt.push(mt.unpackAlignment),rt.push(mt.encoding),rt.join()}function de(mt,rt){const $t=s.get(mt);if(mt.isVideoTexture&&Oe(mt),mt.isRenderTargetTexture===!1&&mt.version>0&&$t.__version!==mt.version){const pe=mt.image;if(pe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(pe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ei($t,mt,rt);return}}e.bindTexture(3553,$t.__webglTexture,33984+rt)}function $e(mt,rt){const $t=s.get(mt);if(mt.version>0&&$t.__version!==mt.version){ei($t,mt,rt);return}e.bindTexture(35866,$t.__webglTexture,33984+rt)}function _e(mt,rt){const $t=s.get(mt);if(mt.version>0&&$t.__version!==mt.version){ei($t,mt,rt);return}e.bindTexture(32879,$t.__webglTexture,33984+rt)}function Yt(mt,rt){const $t=s.get(mt);if(mt.version>0&&$t.__version!==mt.version){ci($t,mt,rt);return}e.bindTexture(34067,$t.__webglTexture,33984+rt)}const re={[Nu]:10497,[gs]:33071,[Uu]:33648},Re={[Rn]:9728,[kp]:9984,[Eu]:9986,[Dn]:9729,[G_]:9985,[go]:9987};function Fe(mt,rt,$t){if($t?(l.texParameteri(mt,10242,re[rt.wrapS]),l.texParameteri(mt,10243,re[rt.wrapT]),(mt===32879||mt===35866)&&l.texParameteri(mt,32882,re[rt.wrapR]),l.texParameteri(mt,10240,Re[rt.magFilter]),l.texParameteri(mt,10241,Re[rt.minFilter])):(l.texParameteri(mt,10242,33071),l.texParameteri(mt,10243,33071),(mt===32879||mt===35866)&&l.texParameteri(mt,32882,33071),(rt.wrapS!==gs||rt.wrapT!==gs)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),l.texParameteri(mt,10240,ot(rt.magFilter)),l.texParameteri(mt,10241,ot(rt.minFilter)),rt.minFilter!==Rn&&rt.minFilter!==Dn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){const pe=t.get("EXT_texture_filter_anisotropic");if(rt.magFilter===Rn||rt.minFilter!==Eu&&rt.minFilter!==go||rt.type===Aa&&t.has("OES_texture_float_linear")===!1||a===!1&&rt.type===Gh&&t.has("OES_texture_half_float_linear")===!1)return;(rt.anisotropy>1||s.get(rt).__currentAnisotropy)&&(l.texParameterf(mt,pe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(rt.anisotropy,o.getMaxAnisotropy())),s.get(rt).__currentAnisotropy=rt.anisotropy)}}function Gt(mt,rt){let $t=!1;mt.__webglInit===void 0&&(mt.__webglInit=!0,rt.addEventListener("dispose",kt));const pe=rt.source;let ye=z.get(pe);ye===void 0&&(ye={},z.set(pe,ye));const ke=be(rt);if(ke!==mt.__cacheKey){ye[ke]===void 0&&(ye[ke]={texture:l.createTexture(),usedTimes:0},d.memory.textures++,$t=!0),ye[ke].usedTimes++;const ui=ye[mt.__cacheKey];ui!==void 0&&(ye[mt.__cacheKey].usedTimes--,ui.usedTimes===0&&Dt(rt)),mt.__cacheKey=ke,mt.__webglTexture=ye[ke].texture}return $t}function ei(mt,rt,$t){let pe=3553;(rt.isDataArrayTexture||rt.isCompressedArrayTexture)&&(pe=35866),rt.isData3DTexture&&(pe=32879);const ye=Gt(mt,rt),ke=rt.source;e.bindTexture(pe,mt.__webglTexture,33984+$t);const ui=s.get(ke);if(ke.version!==ui.__version||ye===!0){e.activeTexture(33984+$t),l.pixelStorei(37440,rt.flipY),l.pixelStorei(37441,rt.premultiplyAlpha),l.pixelStorei(3317,rt.unpackAlignment),l.pixelStorei(37443,0);const Ut=Q(rt)&&H(rt.image)===!1;let Zt=G(rt.image,Ut,!1,S);Zt=gi(rt,Zt);const Ge=H(Zt)||a,si=c.convert(rt.format,rt.encoding);let oi=c.convert(rt.type),Bt=ft(rt.internalFormat,si,oi,rt.encoding,rt.isVideoTexture);Fe(pe,rt,Ge);let ge;const Pe=rt.mipmaps,yi=a&&rt.isVideoTexture!==!0,Fi=ui.__version===void 0||ye===!0,vt=K(rt,Zt,Ge);if(rt.isDepthTexture)Bt=6402,a?rt.type===Aa?Bt=36012:rt.type===ho?Bt=33190:rt.type===ul?Bt=35056:Bt=33189:rt.type===Aa&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),rt.format===co&&Bt===6402&&rt.type!==H_&&rt.type!==ho&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),rt.type=ho,oi=c.convert(rt.type)),rt.format===fl&&Bt===6402&&(Bt=34041,rt.type!==ul&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),rt.type=ul,oi=c.convert(rt.type))),Fi&&(yi?e.texStorage2D(3553,1,Bt,Zt.width,Zt.height):e.texImage2D(3553,0,Bt,Zt.width,Zt.height,0,si,oi,null));else if(rt.isDataTexture)if(Pe.length>0&&Ge){yi&&Fi&&e.texStorage2D(3553,vt,Bt,Pe[0].width,Pe[0].height);for(let Jt=0,fe=Pe.length;Jt<fe;Jt++)ge=Pe[Jt],yi?e.texSubImage2D(3553,Jt,0,0,ge.width,ge.height,si,oi,ge.data):e.texImage2D(3553,Jt,Bt,ge.width,ge.height,0,si,oi,ge.data);rt.generateMipmaps=!1}else yi?(Fi&&e.texStorage2D(3553,vt,Bt,Zt.width,Zt.height),e.texSubImage2D(3553,0,0,0,Zt.width,Zt.height,si,oi,Zt.data)):e.texImage2D(3553,0,Bt,Zt.width,Zt.height,0,si,oi,Zt.data);else if(rt.isCompressedTexture)if(rt.isCompressedArrayTexture){yi&&Fi&&e.texStorage3D(35866,vt,Bt,Pe[0].width,Pe[0].height,Zt.depth);for(let Jt=0,fe=Pe.length;Jt<fe;Jt++)ge=Pe[Jt],rt.format!==Qs?si!==null?yi?e.compressedTexSubImage3D(35866,Jt,0,0,0,ge.width,ge.height,Zt.depth,si,ge.data,0,0):e.compressedTexImage3D(35866,Jt,Bt,ge.width,ge.height,Zt.depth,0,ge.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):yi?e.texSubImage3D(35866,Jt,0,0,0,ge.width,ge.height,Zt.depth,si,oi,ge.data):e.texImage3D(35866,Jt,Bt,ge.width,ge.height,Zt.depth,0,si,oi,ge.data)}else{yi&&Fi&&e.texStorage2D(3553,vt,Bt,Pe[0].width,Pe[0].height);for(let Jt=0,fe=Pe.length;Jt<fe;Jt++)ge=Pe[Jt],rt.format!==Qs?si!==null?yi?e.compressedTexSubImage2D(3553,Jt,0,0,ge.width,ge.height,si,ge.data):e.compressedTexImage2D(3553,Jt,Bt,ge.width,ge.height,0,ge.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):yi?e.texSubImage2D(3553,Jt,0,0,ge.width,ge.height,si,oi,ge.data):e.texImage2D(3553,Jt,Bt,ge.width,ge.height,0,si,oi,ge.data)}else if(rt.isDataArrayTexture)yi?(Fi&&e.texStorage3D(35866,vt,Bt,Zt.width,Zt.height,Zt.depth),e.texSubImage3D(35866,0,0,0,0,Zt.width,Zt.height,Zt.depth,si,oi,Zt.data)):e.texImage3D(35866,0,Bt,Zt.width,Zt.height,Zt.depth,0,si,oi,Zt.data);else if(rt.isData3DTexture)yi?(Fi&&e.texStorage3D(32879,vt,Bt,Zt.width,Zt.height,Zt.depth),e.texSubImage3D(32879,0,0,0,0,Zt.width,Zt.height,Zt.depth,si,oi,Zt.data)):e.texImage3D(32879,0,Bt,Zt.width,Zt.height,Zt.depth,0,si,oi,Zt.data);else if(rt.isFramebufferTexture){if(Fi)if(yi)e.texStorage2D(3553,vt,Bt,Zt.width,Zt.height);else{let Jt=Zt.width,fe=Zt.height;for(let tt=0;tt<vt;tt++)e.texImage2D(3553,tt,Bt,Jt,fe,0,si,oi,null),Jt>>=1,fe>>=1}}else if(Pe.length>0&&Ge){yi&&Fi&&e.texStorage2D(3553,vt,Bt,Pe[0].width,Pe[0].height);for(let Jt=0,fe=Pe.length;Jt<fe;Jt++)ge=Pe[Jt],yi?e.texSubImage2D(3553,Jt,0,0,si,oi,ge):e.texImage2D(3553,Jt,Bt,si,oi,ge);rt.generateMipmaps=!1}else yi?(Fi&&e.texStorage2D(3553,vt,Bt,Zt.width,Zt.height),e.texSubImage2D(3553,0,0,0,si,oi,Zt)):e.texImage2D(3553,0,Bt,si,oi,Zt);nt(rt,Ge)&&pt(pe),ui.__version=ke.version,rt.onUpdate&&rt.onUpdate(rt)}mt.__version=rt.version}function ci(mt,rt,$t){if(rt.image.length!==6)return;const pe=Gt(mt,rt),ye=rt.source;e.bindTexture(34067,mt.__webglTexture,33984+$t);const ke=s.get(ye);if(ye.version!==ke.__version||pe===!0){e.activeTexture(33984+$t),l.pixelStorei(37440,rt.flipY),l.pixelStorei(37441,rt.premultiplyAlpha),l.pixelStorei(3317,rt.unpackAlignment),l.pixelStorei(37443,0);const ui=rt.isCompressedTexture||rt.image[0].isCompressedTexture,Ut=rt.image[0]&&rt.image[0].isDataTexture,Zt=[];for(let Jt=0;Jt<6;Jt++)!ui&&!Ut?Zt[Jt]=G(rt.image[Jt],!1,!0,v):Zt[Jt]=Ut?rt.image[Jt].image:rt.image[Jt],Zt[Jt]=gi(rt,Zt[Jt]);const Ge=Zt[0],si=H(Ge)||a,oi=c.convert(rt.format,rt.encoding),Bt=c.convert(rt.type),ge=ft(rt.internalFormat,oi,Bt,rt.encoding),Pe=a&&rt.isVideoTexture!==!0,yi=ke.__version===void 0||pe===!0;let Fi=K(rt,Ge,si);Fe(34067,rt,si);let vt;if(ui){Pe&&yi&&e.texStorage2D(34067,Fi,ge,Ge.width,Ge.height);for(let Jt=0;Jt<6;Jt++){vt=Zt[Jt].mipmaps;for(let fe=0;fe<vt.length;fe++){const tt=vt[fe];rt.format!==Qs?oi!==null?Pe?e.compressedTexSubImage2D(34069+Jt,fe,0,0,tt.width,tt.height,oi,tt.data):e.compressedTexImage2D(34069+Jt,fe,ge,tt.width,tt.height,0,tt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Pe?e.texSubImage2D(34069+Jt,fe,0,0,tt.width,tt.height,oi,Bt,tt.data):e.texImage2D(34069+Jt,fe,ge,tt.width,tt.height,0,oi,Bt,tt.data)}}}else{vt=rt.mipmaps,Pe&&yi&&(vt.length>0&&Fi++,e.texStorage2D(34067,Fi,ge,Zt[0].width,Zt[0].height));for(let Jt=0;Jt<6;Jt++)if(Ut){Pe?e.texSubImage2D(34069+Jt,0,0,0,Zt[Jt].width,Zt[Jt].height,oi,Bt,Zt[Jt].data):e.texImage2D(34069+Jt,0,ge,Zt[Jt].width,Zt[Jt].height,0,oi,Bt,Zt[Jt].data);for(let fe=0;fe<vt.length;fe++){const V=vt[fe].image[Jt].image;Pe?e.texSubImage2D(34069+Jt,fe+1,0,0,V.width,V.height,oi,Bt,V.data):e.texImage2D(34069+Jt,fe+1,ge,V.width,V.height,0,oi,Bt,V.data)}}else{Pe?e.texSubImage2D(34069+Jt,0,0,0,oi,Bt,Zt[Jt]):e.texImage2D(34069+Jt,0,ge,oi,Bt,Zt[Jt]);for(let fe=0;fe<vt.length;fe++){const tt=vt[fe];Pe?e.texSubImage2D(34069+Jt,fe+1,0,0,oi,Bt,tt.image[Jt]):e.texImage2D(34069+Jt,fe+1,ge,oi,Bt,tt.image[Jt])}}}nt(rt,si)&&pt(34067),ke.__version=ye.version,rt.onUpdate&&rt.onUpdate(rt)}mt.__version=rt.version}function xe(mt,rt,$t,pe,ye){const ke=c.convert($t.format,$t.encoding),ui=c.convert($t.type),Ut=ft($t.internalFormat,ke,ui,$t.encoding);s.get(rt).__hasExternalTextures||(ye===32879||ye===35866?e.texImage3D(ye,0,Ut,rt.width,rt.height,rt.depth,0,ke,ui,null):e.texImage2D(ye,0,Ut,rt.width,rt.height,0,ke,ui,null)),e.bindFramebuffer(36160,mt),ni(rt)?A.framebufferTexture2DMultisampleEXT(36160,pe,ye,s.get($t).__webglTexture,0,ai(rt)):(ye===3553||ye>=34069&&ye<=34074)&&l.framebufferTexture2D(36160,pe,ye,s.get($t).__webglTexture,0),e.bindFramebuffer(36160,null)}function Qe(mt,rt,$t){if(l.bindRenderbuffer(36161,mt),rt.depthBuffer&&!rt.stencilBuffer){let pe=33189;if($t||ni(rt)){const ye=rt.depthTexture;ye&&ye.isDepthTexture&&(ye.type===Aa?pe=36012:ye.type===ho&&(pe=33190));const ke=ai(rt);ni(rt)?A.renderbufferStorageMultisampleEXT(36161,ke,pe,rt.width,rt.height):l.renderbufferStorageMultisample(36161,ke,pe,rt.width,rt.height)}else l.renderbufferStorage(36161,pe,rt.width,rt.height);l.framebufferRenderbuffer(36160,36096,36161,mt)}else if(rt.depthBuffer&&rt.stencilBuffer){const pe=ai(rt);$t&&ni(rt)===!1?l.renderbufferStorageMultisample(36161,pe,35056,rt.width,rt.height):ni(rt)?A.renderbufferStorageMultisampleEXT(36161,pe,35056,rt.width,rt.height):l.renderbufferStorage(36161,34041,rt.width,rt.height),l.framebufferRenderbuffer(36160,33306,36161,mt)}else{const pe=rt.isWebGLMultipleRenderTargets===!0?rt.texture:[rt.texture];for(let ye=0;ye<pe.length;ye++){const ke=pe[ye],ui=c.convert(ke.format,ke.encoding),Ut=c.convert(ke.type),Zt=ft(ke.internalFormat,ui,Ut,ke.encoding),Ge=ai(rt);$t&&ni(rt)===!1?l.renderbufferStorageMultisample(36161,Ge,Zt,rt.width,rt.height):ni(rt)?A.renderbufferStorageMultisampleEXT(36161,Ge,Zt,rt.width,rt.height):l.renderbufferStorage(36161,Zt,rt.width,rt.height)}}l.bindRenderbuffer(36161,null)}function le(mt,rt){if(rt&&rt.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,mt),!(rt.depthTexture&&rt.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!s.get(rt.depthTexture).__webglTexture||rt.depthTexture.image.width!==rt.width||rt.depthTexture.image.height!==rt.height)&&(rt.depthTexture.image.width=rt.width,rt.depthTexture.image.height=rt.height,rt.depthTexture.needsUpdate=!0),de(rt.depthTexture,0);const pe=s.get(rt.depthTexture).__webglTexture,ye=ai(rt);if(rt.depthTexture.format===co)ni(rt)?A.framebufferTexture2DMultisampleEXT(36160,36096,3553,pe,0,ye):l.framebufferTexture2D(36160,36096,3553,pe,0);else if(rt.depthTexture.format===fl)ni(rt)?A.framebufferTexture2DMultisampleEXT(36160,33306,3553,pe,0,ye):l.framebufferTexture2D(36160,33306,3553,pe,0);else throw new Error("Unknown depthTexture format")}function Kt(mt){const rt=s.get(mt),$t=mt.isWebGLCubeRenderTarget===!0;if(mt.depthTexture&&!rt.__autoAllocateDepthBuffer){if($t)throw new Error("target.depthTexture not supported in Cube render targets");le(rt.__webglFramebuffer,mt)}else if($t){rt.__webglDepthbuffer=[];for(let pe=0;pe<6;pe++)e.bindFramebuffer(36160,rt.__webglFramebuffer[pe]),rt.__webglDepthbuffer[pe]=l.createRenderbuffer(),Qe(rt.__webglDepthbuffer[pe],mt,!1)}else e.bindFramebuffer(36160,rt.__webglFramebuffer),rt.__webglDepthbuffer=l.createRenderbuffer(),Qe(rt.__webglDepthbuffer,mt,!1);e.bindFramebuffer(36160,null)}function he(mt,rt,$t){const pe=s.get(mt);rt!==void 0&&xe(pe.__webglFramebuffer,mt,mt.texture,36064,3553),$t!==void 0&&Kt(mt)}function Ee(mt){const rt=mt.texture,$t=s.get(mt),pe=s.get(rt);mt.addEventListener("dispose",zt),mt.isWebGLMultipleRenderTargets!==!0&&(pe.__webglTexture===void 0&&(pe.__webglTexture=l.createTexture()),pe.__version=rt.version,d.memory.textures++);const ye=mt.isWebGLCubeRenderTarget===!0,ke=mt.isWebGLMultipleRenderTargets===!0,ui=H(mt)||a;if(ye){$t.__webglFramebuffer=[];for(let Ut=0;Ut<6;Ut++)$t.__webglFramebuffer[Ut]=l.createFramebuffer()}else{if($t.__webglFramebuffer=l.createFramebuffer(),ke)if(o.drawBuffers){const Ut=mt.texture;for(let Zt=0,Ge=Ut.length;Zt<Ge;Zt++){const si=s.get(Ut[Zt]);si.__webglTexture===void 0&&(si.__webglTexture=l.createTexture(),d.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&mt.samples>0&&ni(mt)===!1){const Ut=ke?rt:[rt];$t.__webglMultisampledFramebuffer=l.createFramebuffer(),$t.__webglColorRenderbuffer=[],e.bindFramebuffer(36160,$t.__webglMultisampledFramebuffer);for(let Zt=0;Zt<Ut.length;Zt++){const Ge=Ut[Zt];$t.__webglColorRenderbuffer[Zt]=l.createRenderbuffer(),l.bindRenderbuffer(36161,$t.__webglColorRenderbuffer[Zt]);const si=c.convert(Ge.format,Ge.encoding),oi=c.convert(Ge.type),Bt=ft(Ge.internalFormat,si,oi,Ge.encoding,mt.isXRRenderTarget===!0),ge=ai(mt);l.renderbufferStorageMultisample(36161,ge,Bt,mt.width,mt.height),l.framebufferRenderbuffer(36160,36064+Zt,36161,$t.__webglColorRenderbuffer[Zt])}l.bindRenderbuffer(36161,null),mt.depthBuffer&&($t.__webglDepthRenderbuffer=l.createRenderbuffer(),Qe($t.__webglDepthRenderbuffer,mt,!0)),e.bindFramebuffer(36160,null)}}if(ye){e.bindTexture(34067,pe.__webglTexture),Fe(34067,rt,ui);for(let Ut=0;Ut<6;Ut++)xe($t.__webglFramebuffer[Ut],mt,rt,36064,34069+Ut);nt(rt,ui)&&pt(34067),e.unbindTexture()}else if(ke){const Ut=mt.texture;for(let Zt=0,Ge=Ut.length;Zt<Ge;Zt++){const si=Ut[Zt],oi=s.get(si);e.bindTexture(3553,oi.__webglTexture),Fe(3553,si,ui),xe($t.__webglFramebuffer,mt,si,36064+Zt,3553),nt(si,ui)&&pt(3553)}e.unbindTexture()}else{let Ut=3553;(mt.isWebGL3DRenderTarget||mt.isWebGLArrayRenderTarget)&&(a?Ut=mt.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),e.bindTexture(Ut,pe.__webglTexture),Fe(Ut,rt,ui),xe($t.__webglFramebuffer,mt,rt,36064,Ut),nt(rt,ui)&&pt(Ut),e.unbindTexture()}mt.depthBuffer&&Kt(mt)}function Ce(mt){const rt=H(mt)||a,$t=mt.isWebGLMultipleRenderTargets===!0?mt.texture:[mt.texture];for(let pe=0,ye=$t.length;pe<ye;pe++){const ke=$t[pe];if(nt(ke,rt)){const ui=mt.isWebGLCubeRenderTarget?34067:3553,Ut=s.get(ke).__webglTexture;e.bindTexture(ui,Ut),pt(ui),e.unbindTexture()}}}function Pt(mt){if(a&&mt.samples>0&&ni(mt)===!1){const rt=mt.isWebGLMultipleRenderTargets?mt.texture:[mt.texture],$t=mt.width,pe=mt.height;let ye=16384;const ke=[],ui=mt.stencilBuffer?33306:36096,Ut=s.get(mt),Zt=mt.isWebGLMultipleRenderTargets===!0;if(Zt)for(let Ge=0;Ge<rt.length;Ge++)e.bindFramebuffer(36160,Ut.__webglMultisampledFramebuffer),l.framebufferRenderbuffer(36160,36064+Ge,36161,null),e.bindFramebuffer(36160,Ut.__webglFramebuffer),l.framebufferTexture2D(36009,36064+Ge,3553,null,0);e.bindFramebuffer(36008,Ut.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,Ut.__webglFramebuffer);for(let Ge=0;Ge<rt.length;Ge++){ke.push(36064+Ge),mt.depthBuffer&&ke.push(ui);const si=Ut.__ignoreDepthValues!==void 0?Ut.__ignoreDepthValues:!1;if(si===!1&&(mt.depthBuffer&&(ye|=256),mt.stencilBuffer&&(ye|=1024)),Zt&&l.framebufferRenderbuffer(36008,36064,36161,Ut.__webglColorRenderbuffer[Ge]),si===!0&&(l.invalidateFramebuffer(36008,[ui]),l.invalidateFramebuffer(36009,[ui])),Zt){const oi=s.get(rt[Ge]).__webglTexture;l.framebufferTexture2D(36009,36064,3553,oi,0)}l.blitFramebuffer(0,0,$t,pe,0,0,$t,pe,ye,9728),C&&l.invalidateFramebuffer(36008,ke)}if(e.bindFramebuffer(36008,null),e.bindFramebuffer(36009,null),Zt)for(let Ge=0;Ge<rt.length;Ge++){e.bindFramebuffer(36160,Ut.__webglMultisampledFramebuffer),l.framebufferRenderbuffer(36160,36064+Ge,36161,Ut.__webglColorRenderbuffer[Ge]);const si=s.get(rt[Ge]).__webglTexture;e.bindFramebuffer(36160,Ut.__webglFramebuffer),l.framebufferTexture2D(36009,36064+Ge,3553,si,0)}e.bindFramebuffer(36009,Ut.__webglMultisampledFramebuffer)}}function ai(mt){return Math.min(M,mt.samples)}function ni(mt){const rt=s.get(mt);return a&&mt.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&rt.__useRenderToTexture!==!1}function Oe(mt){const rt=d.render.frame;R.get(mt)!==rt&&(R.set(mt,rt),mt.update())}function gi(mt,rt){const $t=mt.encoding,pe=mt.format,ye=mt.type;return mt.isCompressedTexture===!0||mt.isVideoTexture===!0||mt.format===Fp||$t!==yo&&($t===on?a===!1?t.has("EXT_sRGB")===!0&&pe===Qs?(mt.format=Fp,mt.minFilter=Dn,mt.generateMipmaps=!1):rt=j_.sRGBToLinear(rt):(pe!==Qs||ye!==_o)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",$t)),rt}this.allocateTextureUnit=ie,this.resetTextureUnits=ce,this.setTexture2D=de,this.setTexture2DArray=$e,this.setTexture3D=_e,this.setTextureCube=Yt,this.rebindTextures=he,this.setupRenderTarget=Ee,this.updateRenderTargetMipmap=Ce,this.updateMultisampleRenderTarget=Pt,this.setupDepthRenderbuffer=Kt,this.setupFrameBufferTexture=xe,this.useMultisampledRTT=ni}function ob(l,t,e){const s=e.isWebGL2;function o(c,d=null){let a;if(c===_o)return 5121;if(c===I1)return 32819;if(c===P1)return 32820;if(c===T1)return 5120;if(c===E1)return 5122;if(c===H_)return 5123;if(c===C1)return 5124;if(c===ho)return 5125;if(c===Aa)return 5126;if(c===Gh)return s?5131:(a=t.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(c===L1)return 6406;if(c===Qs)return 6408;if(c===R1)return 6409;if(c===D1)return 6410;if(c===co)return 6402;if(c===fl)return 34041;if(c===Fp)return a=t.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(c===z1)return 6403;if(c===k1)return 36244;if(c===F1)return 33319;if(c===B1)return 33320;if(c===O1)return 36249;if(c===Mp||c===Sp||c===Ap||c===Tp)if(d===on)if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(c===Mp)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(c===Sp)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(c===Ap)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(c===Tp)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=t.get("WEBGL_compressed_texture_s3tc"),a!==null){if(c===Mp)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(c===Sp)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(c===Ap)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(c===Tp)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(c===Qg||c===t_||c===e_||c===i_)if(a=t.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(c===Qg)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(c===t_)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(c===e_)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(c===i_)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(c===N1)return a=t.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(c===n_||c===s_)if(a=t.get("WEBGL_compressed_texture_etc"),a!==null){if(c===n_)return d===on?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(c===s_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(c===r_||c===a_||c===o_||c===l_||c===h_||c===c_||c===u_||c===d_||c===f_||c===p_||c===m_||c===g_||c===__||c===y_)if(a=t.get("WEBGL_compressed_texture_astc"),a!==null){if(c===r_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(c===a_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(c===o_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(c===l_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(c===h_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(c===c_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(c===u_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(c===d_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(c===f_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(c===p_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(c===m_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(c===g_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(c===__)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(c===y_)return d===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(c===Ep)if(a=t.get("EXT_texture_compression_bptc"),a!==null){if(c===Ep)return d===on?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(c===U1||c===v_||c===x_||c===b_)if(a=t.get("EXT_texture_compression_rgtc"),a!==null){if(c===Ep)return a.COMPRESSED_RED_RGTC1_EXT;if(c===v_)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(c===x_)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(c===b_)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return c===ul?s?34042:(a=t.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):l[c]!==void 0?l[c]:null}return{convert:o}}class lb extends ns{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class ll extends Vi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _3={type:"move"};class Lg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ll,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ll,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ut,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ut),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ll,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ut,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ut),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const s of t.hand.values())this._getHandJoint(e,s)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,s){let o=null,c=null,d=null;const a=this._targetRay,_=this._grip,v=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(v&&t.hand){d=!0;for(const F of t.hand.values()){const z=e.getJointPose(F,s),L=this._getHandJoint(v,F);z!==null&&(L.matrix.fromArray(z.transform.matrix),L.matrix.decompose(L.position,L.rotation,L.scale),L.jointRadius=z.radius),L.visible=z!==null}const S=v.joints["index-finger-tip"],M=v.joints["thumb-tip"],A=S.position.distanceTo(M.position),C=.02,R=.005;v.inputState.pinching&&A>C+R?(v.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!v.inputState.pinching&&A<=C-R&&(v.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else _!==null&&t.gripSpace&&(c=e.getPose(t.gripSpace,s),c!==null&&(_.matrix.fromArray(c.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),c.linearVelocity?(_.hasLinearVelocity=!0,_.linearVelocity.copy(c.linearVelocity)):_.hasLinearVelocity=!1,c.angularVelocity?(_.hasAngularVelocity=!0,_.angularVelocity.copy(c.angularVelocity)):_.hasAngularVelocity=!1));a!==null&&(o=e.getPose(t.targetRaySpace,s),o===null&&c!==null&&(o=c),o!==null&&(a.matrix.fromArray(o.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),o.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(o.linearVelocity)):a.hasLinearVelocity=!1,o.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(o.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(_3)))}return a!==null&&(a.visible=o!==null),_!==null&&(_.visible=c!==null),v!==null&&(v.visible=d!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){const s=new ll;s.matrixAutoUpdate=!1,s.visible=!1,t.joints[e.jointName]=s,t.add(s)}return t.joints[e.jointName]}}class hb extends zn{constructor(t,e,s,o,c,d,a,_,v,S){if(S=S!==void 0?S:co,S!==co&&S!==fl)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&S===co&&(s=ho),s===void 0&&S===fl&&(s=ul),super(null,o,c,d,a,_,S,s,v),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:Rn,this.minFilter=_!==void 0?_:Rn,this.flipY=!1,this.generateMipmaps=!1}}class y3 extends Ca{constructor(t,e){super();const s=this;let o=null,c=1,d=null,a="local-floor",_=1,v=null,S=null,M=null,A=null,C=null,R=null;const F=e.getContextAttributes();let z=null,L=null;const W=[],G=[],H=new Set,Q=new Map,nt=new ns;nt.layers.enable(1),nt.viewport=new Ji;const pt=new ns;pt.layers.enable(2),pt.viewport=new Ji;const ft=[nt,pt],K=new lb;K.layers.enable(1),K.layers.enable(2);let ot=null,kt=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Yt){let re=W[Yt];return re===void 0&&(re=new Lg,W[Yt]=re),re.getTargetRaySpace()},this.getControllerGrip=function(Yt){let re=W[Yt];return re===void 0&&(re=new Lg,W[Yt]=re),re.getGripSpace()},this.getHand=function(Yt){let re=W[Yt];return re===void 0&&(re=new Lg,W[Yt]=re),re.getHandSpace()};function zt(Yt){const re=G.indexOf(Yt.inputSource);if(re===-1)return;const Re=W[re];Re!==void 0&&Re.dispatchEvent({type:Yt.type,data:Yt.inputSource})}function It(){o.removeEventListener("select",zt),o.removeEventListener("selectstart",zt),o.removeEventListener("selectend",zt),o.removeEventListener("squeeze",zt),o.removeEventListener("squeezestart",zt),o.removeEventListener("squeezeend",zt),o.removeEventListener("end",It),o.removeEventListener("inputsourceschange",Dt);for(let Yt=0;Yt<W.length;Yt++){const re=G[Yt];re!==null&&(G[Yt]=null,W[Yt].disconnect(re))}ot=null,kt=null,t.setRenderTarget(z),C=null,A=null,M=null,o=null,L=null,_e.stop(),s.isPresenting=!1,s.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Yt){c=Yt,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Yt){a=Yt,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return v||d},this.setReferenceSpace=function(Yt){v=Yt},this.getBaseLayer=function(){return A!==null?A:C},this.getBinding=function(){return M},this.getFrame=function(){return R},this.getSession=function(){return o},this.setSession=async function(Yt){if(o=Yt,o!==null){if(z=t.getRenderTarget(),o.addEventListener("select",zt),o.addEventListener("selectstart",zt),o.addEventListener("selectend",zt),o.addEventListener("squeeze",zt),o.addEventListener("squeezestart",zt),o.addEventListener("squeezeend",zt),o.addEventListener("end",It),o.addEventListener("inputsourceschange",Dt),F.xrCompatible!==!0&&await e.makeXRCompatible(),o.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const re={antialias:o.renderState.layers===void 0?F.antialias:!0,alpha:F.alpha,depth:F.depth,stencil:F.stencil,framebufferScaleFactor:c};C=new XRWebGLLayer(o,e,re),o.updateRenderState({baseLayer:C}),L=new Ir(C.framebufferWidth,C.framebufferHeight,{format:Qs,type:_o,encoding:t.outputEncoding,stencilBuffer:F.stencil})}else{let re=null,Re=null,Fe=null;F.depth&&(Fe=F.stencil?35056:33190,re=F.stencil?fl:co,Re=F.stencil?ul:ho);const Gt={colorFormat:32856,depthFormat:Fe,scaleFactor:c};M=new XRWebGLBinding(o,e),A=M.createProjectionLayer(Gt),o.updateRenderState({layers:[A]}),L=new Ir(A.textureWidth,A.textureHeight,{format:Qs,type:_o,depthTexture:new hb(A.textureWidth,A.textureHeight,Re,void 0,void 0,void 0,void 0,void 0,void 0,re),stencilBuffer:F.stencil,encoding:t.outputEncoding,samples:F.antialias?4:0});const ei=t.properties.get(L);ei.__ignoreDepthValues=A.ignoreDepthValues}L.isXRRenderTarget=!0,this.setFoveation(_),v=null,d=await o.requestReferenceSpace(a),_e.setContext(o),_e.start(),s.isPresenting=!0,s.dispatchEvent({type:"sessionstart"})}};function Dt(Yt){for(let re=0;re<Yt.removed.length;re++){const Re=Yt.removed[re],Fe=G.indexOf(Re);Fe>=0&&(G[Fe]=null,W[Fe].disconnect(Re))}for(let re=0;re<Yt.added.length;re++){const Re=Yt.added[re];let Fe=G.indexOf(Re);if(Fe===-1){for(let ei=0;ei<W.length;ei++)if(ei>=G.length){G.push(Re),Fe=ei;break}else if(G[ei]===null){G[ei]=Re,Fe=ei;break}if(Fe===-1)break}const Gt=W[Fe];Gt&&Gt.connect(Re)}}const Wt=new ut,se=new ut;function ce(Yt,re,Re){Wt.setFromMatrixPosition(re.matrixWorld),se.setFromMatrixPosition(Re.matrixWorld);const Fe=Wt.distanceTo(se),Gt=re.projectionMatrix.elements,ei=Re.projectionMatrix.elements,ci=Gt[14]/(Gt[10]-1),xe=Gt[14]/(Gt[10]+1),Qe=(Gt[9]+1)/Gt[5],le=(Gt[9]-1)/Gt[5],Kt=(Gt[8]-1)/Gt[0],he=(ei[8]+1)/ei[0],Ee=ci*Kt,Ce=ci*he,Pt=Fe/(-Kt+he),ai=Pt*-Kt;re.matrixWorld.decompose(Yt.position,Yt.quaternion,Yt.scale),Yt.translateX(ai),Yt.translateZ(Pt),Yt.matrixWorld.compose(Yt.position,Yt.quaternion,Yt.scale),Yt.matrixWorldInverse.copy(Yt.matrixWorld).invert();const ni=ci+Pt,Oe=xe+Pt,gi=Ee-ai,mt=Ce+(Fe-ai),rt=Qe*xe/Oe*ni,$t=le*xe/Oe*ni;Yt.projectionMatrix.makePerspective(gi,mt,rt,$t,ni,Oe),Yt.projectionMatrixInverse.copy(Yt.projectionMatrix).invert()}function ie(Yt,re){re===null?Yt.matrixWorld.copy(Yt.matrix):Yt.matrixWorld.multiplyMatrices(re.matrixWorld,Yt.matrix),Yt.matrixWorldInverse.copy(Yt.matrixWorld).invert()}this.updateCamera=function(Yt){if(o===null)return;K.near=pt.near=nt.near=Yt.near,K.far=pt.far=nt.far=Yt.far,(ot!==K.near||kt!==K.far)&&(o.updateRenderState({depthNear:K.near,depthFar:K.far}),ot=K.near,kt=K.far);const re=Yt.parent,Re=K.cameras;ie(K,re);for(let Fe=0;Fe<Re.length;Fe++)ie(Re[Fe],re);Re.length===2?ce(K,nt,pt):K.projectionMatrix.copy(nt.projectionMatrix),be(Yt,K,re)};function be(Yt,re,Re){Re===null?Yt.matrix.copy(re.matrixWorld):(Yt.matrix.copy(Re.matrixWorld),Yt.matrix.invert(),Yt.matrix.multiply(re.matrixWorld)),Yt.matrix.decompose(Yt.position,Yt.quaternion,Yt.scale),Yt.updateMatrixWorld(!0);const Fe=Yt.children;for(let Gt=0,ei=Fe.length;Gt<ei;Gt++)Fe[Gt].updateMatrixWorld(!0);Yt.projectionMatrix.copy(re.projectionMatrix),Yt.projectionMatrixInverse.copy(re.projectionMatrixInverse),Yt.isPerspectiveCamera&&(Yt.fov=Wh*2*Math.atan(1/Yt.projectionMatrix.elements[5]),Yt.zoom=1)}this.getCamera=function(){return K},this.getFoveation=function(){if(!(A===null&&C===null))return _},this.setFoveation=function(Yt){_=Yt,A!==null&&(A.fixedFoveation=Yt),C!==null&&C.fixedFoveation!==void 0&&(C.fixedFoveation=Yt)},this.getPlanes=function(){return H};let de=null;function $e(Yt,re){if(S=re.getViewerPose(v||d),R=re,S!==null){const Re=S.views;C!==null&&(t.setRenderTargetFramebuffer(L,C.framebuffer),t.setRenderTarget(L));let Fe=!1;Re.length!==K.cameras.length&&(K.cameras.length=0,Fe=!0);for(let Gt=0;Gt<Re.length;Gt++){const ei=Re[Gt];let ci=null;if(C!==null)ci=C.getViewport(ei);else{const Qe=M.getViewSubImage(A,ei);ci=Qe.viewport,Gt===0&&(t.setRenderTargetTextures(L,Qe.colorTexture,A.ignoreDepthValues?void 0:Qe.depthStencilTexture),t.setRenderTarget(L))}let xe=ft[Gt];xe===void 0&&(xe=new ns,xe.layers.enable(Gt),xe.viewport=new Ji,ft[Gt]=xe),xe.matrix.fromArray(ei.transform.matrix),xe.matrix.decompose(xe.position,xe.quaternion,xe.scale),xe.projectionMatrix.fromArray(ei.projectionMatrix),xe.projectionMatrixInverse.copy(xe.projectionMatrix).invert(),xe.viewport.set(ci.x,ci.y,ci.width,ci.height),Gt===0&&(K.matrix.copy(xe.matrix),K.matrix.decompose(K.position,K.quaternion,K.scale)),Fe===!0&&K.cameras.push(xe)}}for(let Re=0;Re<W.length;Re++){const Fe=G[Re],Gt=W[Re];Fe!==null&&Gt!==void 0&&Gt.update(Fe,re,v||d)}if(de&&de(Yt,re),re.detectedPlanes){s.dispatchEvent({type:"planesdetected",data:re.detectedPlanes});let Re=null;for(const Fe of H)re.detectedPlanes.has(Fe)||(Re===null&&(Re=[]),Re.push(Fe));if(Re!==null)for(const Fe of Re)H.delete(Fe),Q.delete(Fe),s.dispatchEvent({type:"planeremoved",data:Fe});for(const Fe of re.detectedPlanes)if(!H.has(Fe))H.add(Fe),Q.set(Fe,re.lastChangedTime),s.dispatchEvent({type:"planeadded",data:Fe});else{const Gt=Q.get(Fe);Fe.lastChangedTime>Gt&&(Q.set(Fe,Fe.lastChangedTime),s.dispatchEvent({type:"planechanged",data:Fe}))}}R=null}const _e=new ib;_e.setAnimationLoop($e),this.setAnimationLoop=function(Yt){de=Yt},this.dispose=function(){}}}function v3(l,t){function e(z,L){z.matrixAutoUpdate===!0&&z.updateMatrix(),L.value.copy(z.matrix)}function s(z,L){L.color.getRGB(z.fogColor.value,K1(l)),L.isFog?(z.fogNear.value=L.near,z.fogFar.value=L.far):L.isFogExp2&&(z.fogDensity.value=L.density)}function o(z,L,W,G,H){L.isMeshBasicMaterial||L.isMeshLambertMaterial?c(z,L):L.isMeshToonMaterial?(c(z,L),M(z,L)):L.isMeshPhongMaterial?(c(z,L),S(z,L)):L.isMeshStandardMaterial?(c(z,L),A(z,L),L.isMeshPhysicalMaterial&&C(z,L,H)):L.isMeshMatcapMaterial?(c(z,L),R(z,L)):L.isMeshDepthMaterial?c(z,L):L.isMeshDistanceMaterial?(c(z,L),F(z,L)):L.isMeshNormalMaterial?c(z,L):L.isLineBasicMaterial?(d(z,L),L.isLineDashedMaterial&&a(z,L)):L.isPointsMaterial?_(z,L,W,G):L.isSpriteMaterial?v(z,L):L.isShadowMaterial?(z.color.value.copy(L.color),z.opacity.value=L.opacity):L.isShaderMaterial&&(L.uniformsNeedUpdate=!1)}function c(z,L){z.opacity.value=L.opacity,L.color&&z.diffuse.value.copy(L.color),L.emissive&&z.emissive.value.copy(L.emissive).multiplyScalar(L.emissiveIntensity),L.map&&(z.map.value=L.map,e(L.map,z.mapTransform)),L.alphaMap&&(z.alphaMap.value=L.alphaMap,e(L.alphaMap,z.alphaMapTransform)),L.bumpMap&&(z.bumpMap.value=L.bumpMap,e(L.bumpMap,z.bumpMapTransform),z.bumpScale.value=L.bumpScale,L.side===Ps&&(z.bumpScale.value*=-1)),L.normalMap&&(z.normalMap.value=L.normalMap,e(L.normalMap,z.normalMapTransform),z.normalScale.value.copy(L.normalScale),L.side===Ps&&z.normalScale.value.negate()),L.displacementMap&&(z.displacementMap.value=L.displacementMap,e(L.displacementMap,z.displacementMapTransform),z.displacementScale.value=L.displacementScale,z.displacementBias.value=L.displacementBias),L.emissiveMap&&(z.emissiveMap.value=L.emissiveMap,e(L.emissiveMap,z.emissiveMapTransform)),L.specularMap&&(z.specularMap.value=L.specularMap,e(L.specularMap,z.specularMapTransform)),L.alphaTest>0&&(z.alphaTest.value=L.alphaTest);const W=t.get(L).envMap;if(W&&(z.envMap.value=W,z.flipEnvMap.value=W.isCubeTexture&&W.isRenderTargetTexture===!1?-1:1,z.reflectivity.value=L.reflectivity,z.ior.value=L.ior,z.refractionRatio.value=L.refractionRatio),L.lightMap){z.lightMap.value=L.lightMap;const G=l.useLegacyLights===!0?Math.PI:1;z.lightMapIntensity.value=L.lightMapIntensity*G,e(L.lightMap,z.lightMapTransform)}L.aoMap&&(z.aoMap.value=L.aoMap,z.aoMapIntensity.value=L.aoMapIntensity,e(L.aoMap,z.aoMapTransform))}function d(z,L){z.diffuse.value.copy(L.color),z.opacity.value=L.opacity,L.map&&(z.map.value=L.map,e(L.map,z.mapTransform))}function a(z,L){z.dashSize.value=L.dashSize,z.totalSize.value=L.dashSize+L.gapSize,z.scale.value=L.scale}function _(z,L,W,G){z.diffuse.value.copy(L.color),z.opacity.value=L.opacity,z.size.value=L.size*W,z.scale.value=G*.5,L.map&&(z.map.value=L.map,e(L.map,z.uvTransform)),L.alphaMap&&(z.alphaMap.value=L.alphaMap),L.alphaTest>0&&(z.alphaTest.value=L.alphaTest)}function v(z,L){z.diffuse.value.copy(L.color),z.opacity.value=L.opacity,z.rotation.value=L.rotation,L.map&&(z.map.value=L.map,e(L.map,z.mapTransform)),L.alphaMap&&(z.alphaMap.value=L.alphaMap),L.alphaTest>0&&(z.alphaTest.value=L.alphaTest)}function S(z,L){z.specular.value.copy(L.specular),z.shininess.value=Math.max(L.shininess,1e-4)}function M(z,L){L.gradientMap&&(z.gradientMap.value=L.gradientMap)}function A(z,L){z.metalness.value=L.metalness,L.metalnessMap&&(z.metalnessMap.value=L.metalnessMap,e(L.metalnessMap,z.metalnessMapTransform)),z.roughness.value=L.roughness,L.roughnessMap&&(z.roughnessMap.value=L.roughnessMap,e(L.roughnessMap,z.roughnessMapTransform)),t.get(L).envMap&&(z.envMapIntensity.value=L.envMapIntensity)}function C(z,L,W){z.ior.value=L.ior,L.sheen>0&&(z.sheenColor.value.copy(L.sheenColor).multiplyScalar(L.sheen),z.sheenRoughness.value=L.sheenRoughness,L.sheenColorMap&&(z.sheenColorMap.value=L.sheenColorMap,e(L.sheenColorMap,z.sheenColorMapTransform)),L.sheenRoughnessMap&&(z.sheenRoughnessMap.value=L.sheenRoughnessMap,e(L.sheenRoughnessMap,z.sheenRoughnessMapTransform))),L.clearcoat>0&&(z.clearcoat.value=L.clearcoat,z.clearcoatRoughness.value=L.clearcoatRoughness,L.clearcoatMap&&(z.clearcoatMap.value=L.clearcoatMap,e(L.clearcoatMap,z.clearcoatMapTransform)),L.clearcoatRoughnessMap&&(z.clearcoatRoughnessMap.value=L.clearcoatRoughnessMap,e(L.clearcoatRoughnessMap,z.clearcoatRoughnessMapTransform)),L.clearcoatNormalMap&&(z.clearcoatNormalMap.value=L.clearcoatNormalMap,e(L.clearcoatNormalMap,z.clearcoatNormalMapTransform),z.clearcoatNormalScale.value.copy(L.clearcoatNormalScale),L.side===Ps&&z.clearcoatNormalScale.value.negate())),L.iridescence>0&&(z.iridescence.value=L.iridescence,z.iridescenceIOR.value=L.iridescenceIOR,z.iridescenceThicknessMinimum.value=L.iridescenceThicknessRange[0],z.iridescenceThicknessMaximum.value=L.iridescenceThicknessRange[1],L.iridescenceMap&&(z.iridescenceMap.value=L.iridescenceMap,e(L.iridescenceMap,z.iridescenceMapTransform)),L.iridescenceThicknessMap&&(z.iridescenceThicknessMap.value=L.iridescenceThicknessMap,e(L.iridescenceThicknessMap,z.iridescenceThicknessMapTransform))),L.transmission>0&&(z.transmission.value=L.transmission,z.transmissionSamplerMap.value=W.texture,z.transmissionSamplerSize.value.set(W.width,W.height),L.transmissionMap&&(z.transmissionMap.value=L.transmissionMap,e(L.transmissionMap,z.transmissionMapTransform)),z.thickness.value=L.thickness,L.thicknessMap&&(z.thicknessMap.value=L.thicknessMap,e(L.thicknessMap,z.thicknessMapTransform)),z.attenuationDistance.value=L.attenuationDistance,z.attenuationColor.value.copy(L.attenuationColor)),z.specularIntensity.value=L.specularIntensity,z.specularColor.value.copy(L.specularColor),L.specularColorMap&&(z.specularColorMap.value=L.specularColorMap,e(L.specularColorMap,z.specularColorMapTransform)),L.specularIntensityMap&&(z.specularIntensityMap.value=L.specularIntensityMap,e(L.specularIntensityMap,z.specularIntensityMapTransform))}function R(z,L){L.matcap&&(z.matcap.value=L.matcap)}function F(z,L){const W=t.get(L).light;z.referencePosition.value.setFromMatrixPosition(W.matrixWorld),z.nearDistance.value=W.shadow.camera.near,z.farDistance.value=W.shadow.camera.far}return{refreshFogUniforms:s,refreshMaterialUniforms:o}}function x3(l,t,e,s){let o={},c={},d=[];const a=e.isWebGL2?l.getParameter(35375):0;function _(W,G){const H=G.program;s.uniformBlockBinding(W,H)}function v(W,G){let H=o[W.id];H===void 0&&(R(W),H=S(W),o[W.id]=H,W.addEventListener("dispose",z));const Q=G.program;s.updateUBOMapping(W,Q);const nt=t.render.frame;c[W.id]!==nt&&(A(W),c[W.id]=nt)}function S(W){const G=M();W.__bindingPointIndex=G;const H=l.createBuffer(),Q=W.__size,nt=W.usage;return l.bindBuffer(35345,H),l.bufferData(35345,Q,nt),l.bindBuffer(35345,null),l.bindBufferBase(35345,G,H),H}function M(){for(let W=0;W<a;W++)if(d.indexOf(W)===-1)return d.push(W),W;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function A(W){const G=o[W.id],H=W.uniforms,Q=W.__cache;l.bindBuffer(35345,G);for(let nt=0,pt=H.length;nt<pt;nt++){const ft=H[nt];if(C(ft,nt,Q)===!0){const K=ft.__offset,ot=Array.isArray(ft.value)?ft.value:[ft.value];let kt=0;for(let zt=0;zt<ot.length;zt++){const It=ot[zt],Dt=F(It);typeof It=="number"?(ft.__data[0]=It,l.bufferSubData(35345,K+kt,ft.__data)):It.isMatrix3?(ft.__data[0]=It.elements[0],ft.__data[1]=It.elements[1],ft.__data[2]=It.elements[2],ft.__data[3]=It.elements[0],ft.__data[4]=It.elements[3],ft.__data[5]=It.elements[4],ft.__data[6]=It.elements[5],ft.__data[7]=It.elements[0],ft.__data[8]=It.elements[6],ft.__data[9]=It.elements[7],ft.__data[10]=It.elements[8],ft.__data[11]=It.elements[0]):(It.toArray(ft.__data,kt),kt+=Dt.storage/Float32Array.BYTES_PER_ELEMENT)}l.bufferSubData(35345,K,ft.__data)}}l.bindBuffer(35345,null)}function C(W,G,H){const Q=W.value;if(H[G]===void 0){if(typeof Q=="number")H[G]=Q;else{const nt=Array.isArray(Q)?Q:[Q],pt=[];for(let ft=0;ft<nt.length;ft++)pt.push(nt[ft].clone());H[G]=pt}return!0}else if(typeof Q=="number"){if(H[G]!==Q)return H[G]=Q,!0}else{const nt=Array.isArray(H[G])?H[G]:[H[G]],pt=Array.isArray(Q)?Q:[Q];for(let ft=0;ft<nt.length;ft++){const K=nt[ft];if(K.equals(pt[ft])===!1)return K.copy(pt[ft]),!0}}return!1}function R(W){const G=W.uniforms;let H=0;const Q=16;let nt=0;for(let pt=0,ft=G.length;pt<ft;pt++){const K=G[pt],ot={boundary:0,storage:0},kt=Array.isArray(K.value)?K.value:[K.value];for(let zt=0,It=kt.length;zt<It;zt++){const Dt=kt[zt],Wt=F(Dt);ot.boundary+=Wt.boundary,ot.storage+=Wt.storage}if(K.__data=new Float32Array(ot.storage/Float32Array.BYTES_PER_ELEMENT),K.__offset=H,pt>0){nt=H%Q;const zt=Q-nt;nt!==0&&zt-ot.boundary<0&&(H+=Q-nt,K.__offset=H)}H+=ot.storage}return nt=H%Q,nt>0&&(H+=Q-nt),W.__size=H,W.__cache={},this}function F(W){const G={boundary:0,storage:0};return typeof W=="number"?(G.boundary=4,G.storage=4):W.isVector2?(G.boundary=8,G.storage=8):W.isVector3||W.isColor?(G.boundary=16,G.storage=12):W.isVector4?(G.boundary=16,G.storage=16):W.isMatrix3?(G.boundary=48,G.storage=48):W.isMatrix4?(G.boundary=64,G.storage=64):W.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",W),G}function z(W){const G=W.target;G.removeEventListener("dispose",z);const H=d.indexOf(G.__bindingPointIndex);d.splice(H,1),l.deleteBuffer(o[G.id]),delete o[G.id],delete c[G.id]}function L(){for(const W in o)l.deleteBuffer(o[W]);d=[],o={},c={}}return{bind:_,update:v,dispose:L}}function b3(){const l=qu("canvas");return l.style.display="block",l}class Jp{constructor(t={}){const{canvas:e=b3(),context:s=null,depth:o=!0,stencil:c=!0,alpha:d=!1,antialias:a=!1,premultipliedAlpha:_=!0,preserveDrawingBuffer:v=!1,powerPreference:S="default",failIfMajorPerformanceCaveat:M=!1}=t;this.isWebGLRenderer=!0;let A;s!==null?A=s.getContextAttributes().alpha:A=d;let C=null,R=null;const F=[],z=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=yo,this.useLegacyLights=!0,this.toneMapping=Hr,this.toneMappingExposure=1;const L=this;let W=!1,G=0,H=0,Q=null,nt=-1,pt=null;const ft=new Ji,K=new Ji;let ot=null,kt=e.width,zt=e.height,It=1,Dt=null,Wt=null;const se=new Ji(0,0,kt,zt),ce=new Ji(0,0,kt,zt);let ie=!1;const be=new Zp;let de=!1,$e=!1,_e=null;const Yt=new xi,re=new ut,Re={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Fe(){return Q===null?It:1}let Gt=s;function ei(et,At){for(let Ot=0;Ot<et.length;Ot++){const St=et[Ot],Ht=e.getContext(St,At);if(Ht!==null)return Ht}return null}try{const et={alpha:!0,depth:o,stencil:c,antialias:a,premultipliedAlpha:_,preserveDrawingBuffer:v,powerPreference:S,failIfMajorPerformanceCaveat:M};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Hp}`),e.addEventListener("webglcontextlost",ge,!1),e.addEventListener("webglcontextrestored",Pe,!1),e.addEventListener("webglcontextcreationerror",yi,!1),Gt===null){const At=["webgl2","webgl","experimental-webgl"];if(L.isWebGL1Renderer===!0&&At.shift(),Gt=ei(At,et),Gt===null)throw ei(At)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Gt.getShaderPrecisionFormat===void 0&&(Gt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(et){throw console.error("THREE.WebGLRenderer: "+et.message),et}let ci,xe,Qe,le,Kt,he,Ee,Ce,Pt,ai,ni,Oe,gi,mt,rt,$t,pe,ye,ke,ui,Ut,Zt,Ge,si;function oi(){ci=new BE(Gt),xe=new LE(Gt,ci,t),ci.init(xe),Zt=new ob(Gt,ci,xe),Qe=new m3(Gt,ci,xe),le=new UE,Kt=new n3,he=new g3(Gt,ci,Qe,Kt,xe,Zt,le),Ee=new DE(L),Ce=new FE(L),Pt=new K2(Gt,xe),Ge=new IE(Gt,ci,Pt,xe),ai=new OE(Gt,Pt,le,Ge),ni=new WE(Gt,ai,Pt,le),ke=new HE(Gt,xe,he),$t=new RE(Kt),Oe=new i3(L,Ee,Ce,ci,xe,Ge,$t),gi=new v3(L,Kt),mt=new r3,rt=new u3(ci,xe),ye=new CE(L,Ee,Ce,Qe,ni,A,_),pe=new p3(L,ni,xe),si=new x3(Gt,le,xe,Qe),ui=new PE(Gt,ci,le,xe),Ut=new NE(Gt,ci,le,xe),le.programs=Oe.programs,L.capabilities=xe,L.extensions=ci,L.properties=Kt,L.renderLists=mt,L.shadowMap=pe,L.state=Qe,L.info=le}oi();const Bt=new y3(L,Gt);this.xr=Bt,this.getContext=function(){return Gt},this.getContextAttributes=function(){return Gt.getContextAttributes()},this.forceContextLoss=function(){const et=ci.get("WEBGL_lose_context");et&&et.loseContext()},this.forceContextRestore=function(){const et=ci.get("WEBGL_lose_context");et&&et.restoreContext()},this.getPixelRatio=function(){return It},this.setPixelRatio=function(et){et!==void 0&&(It=et,this.setSize(kt,zt,!1))},this.getSize=function(et){return et.set(kt,zt)},this.setSize=function(et,At,Ot=!0){if(Bt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}kt=et,zt=At,e.width=Math.floor(et*It),e.height=Math.floor(At*It),Ot===!0&&(e.style.width=et+"px",e.style.height=At+"px"),this.setViewport(0,0,et,At)},this.getDrawingBufferSize=function(et){return et.set(kt*It,zt*It).floor()},this.setDrawingBufferSize=function(et,At,Ot){kt=et,zt=At,It=Ot,e.width=Math.floor(et*Ot),e.height=Math.floor(At*Ot),this.setViewport(0,0,et,At)},this.getCurrentViewport=function(et){return et.copy(ft)},this.getViewport=function(et){return et.copy(se)},this.setViewport=function(et,At,Ot,St){et.isVector4?se.set(et.x,et.y,et.z,et.w):se.set(et,At,Ot,St),Qe.viewport(ft.copy(se).multiplyScalar(It).floor())},this.getScissor=function(et){return et.copy(ce)},this.setScissor=function(et,At,Ot,St){et.isVector4?ce.set(et.x,et.y,et.z,et.w):ce.set(et,At,Ot,St),Qe.scissor(K.copy(ce).multiplyScalar(It).floor())},this.getScissorTest=function(){return ie},this.setScissorTest=function(et){Qe.setScissorTest(ie=et)},this.setOpaqueSort=function(et){Dt=et},this.setTransparentSort=function(et){Wt=et},this.getClearColor=function(et){return et.copy(ye.getClearColor())},this.setClearColor=function(){ye.setClearColor.apply(ye,arguments)},this.getClearAlpha=function(){return ye.getClearAlpha()},this.setClearAlpha=function(){ye.setClearAlpha.apply(ye,arguments)},this.clear=function(et=!0,At=!0,Ot=!0){let St=0;et&&(St|=16384),At&&(St|=256),Ot&&(St|=1024),Gt.clear(St)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ge,!1),e.removeEventListener("webglcontextrestored",Pe,!1),e.removeEventListener("webglcontextcreationerror",yi,!1),mt.dispose(),rt.dispose(),Kt.dispose(),Ee.dispose(),Ce.dispose(),ni.dispose(),Ge.dispose(),si.dispose(),Oe.dispose(),Bt.dispose(),Bt.removeEventListener("sessionstart",V),Bt.removeEventListener("sessionend",j),_e&&(_e.dispose(),_e=null),Z.stop()};function ge(et){et.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),W=!0}function Pe(){console.log("THREE.WebGLRenderer: Context Restored."),W=!1;const et=le.autoReset,At=pe.enabled,Ot=pe.autoUpdate,St=pe.needsUpdate,Ht=pe.type;oi(),le.autoReset=et,pe.enabled=At,pe.autoUpdate=Ot,pe.needsUpdate=St,pe.type=Ht}function yi(et){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",et.statusMessage)}function Fi(et){const At=et.target;At.removeEventListener("dispose",Fi),vt(At)}function vt(et){Jt(et),Kt.remove(et)}function Jt(et){const At=Kt.get(et).programs;At!==void 0&&(At.forEach(function(Ot){Oe.releaseProgram(Ot)}),et.isShaderMaterial&&Oe.releaseShaderCache(et))}this.renderBufferDirect=function(et,At,Ot,St,Ht,De){At===null&&(At=Re);const je=Ht.isMesh&&Ht.matrixWorld.determinant()<0,we=jt(et,At,Ot,St,Ht);Qe.setMaterial(St,je);let Ke=Ot.index,li=1;St.wireframe===!0&&(Ke=ai.getWireframeAttribute(Ot),li=2);const pi=Ot.drawRange,di=Ot.attributes.position;let Mi=pi.start*li,Gi=(pi.start+pi.count)*li;De!==null&&(Mi=Math.max(Mi,De.start*li),Gi=Math.min(Gi,(De.start+De.count)*li)),Ke!==null?(Mi=Math.max(Mi,0),Gi=Math.min(Gi,Ke.count)):di!=null&&(Mi=Math.max(Mi,0),Gi=Math.min(Gi,di.count));const ss=Gi-Mi;if(ss<0||ss===1/0)return;Ge.setup(Ht,St,we,Ot,Ke);let gr,mi=ui;if(Ke!==null&&(gr=Pt.get(Ke),mi=Ut,mi.setIndex(gr)),Ht.isMesh)St.wireframe===!0?(Qe.setLineWidth(St.wireframeLinewidth*Fe()),mi.setMode(1)):mi.setMode(4);else if(Ht.isLine){let Pi=St.linewidth;Pi===void 0&&(Pi=1),Qe.setLineWidth(Pi*Fe()),Ht.isLineSegments?mi.setMode(1):Ht.isLineLoop?mi.setMode(2):mi.setMode(3)}else Ht.isPoints?mi.setMode(0):Ht.isSprite&&mi.setMode(4);if(Ht.isInstancedMesh)mi.renderInstances(Mi,ss,Ht.count);else if(Ot.isInstancedBufferGeometry){const Pi=Ot._maxInstanceCount!==void 0?Ot._maxInstanceCount:1/0,Kr=Math.min(Ot.instanceCount,Pi);mi.renderInstances(Mi,ss,Kr)}else mi.render(Mi,ss)},this.compile=function(et,At){function Ot(St,Ht,De){St.transparent===!0&&St.side===Vr&&St.forceSinglePass===!1?(St.side=Ps,St.needsUpdate=!0,Rt(St,Ht,De),St.side=Ea,St.needsUpdate=!0,Rt(St,Ht,De),St.side=Vr):Rt(St,Ht,De)}R=rt.get(et),R.init(),z.push(R),et.traverseVisible(function(St){St.isLight&&St.layers.test(At.layers)&&(R.pushLight(St),St.castShadow&&R.pushShadow(St))}),R.setupLights(L.useLegacyLights),et.traverse(function(St){const Ht=St.material;if(Ht)if(Array.isArray(Ht))for(let De=0;De<Ht.length;De++){const je=Ht[De];Ot(je,et,St)}else Ot(Ht,et,St)}),z.pop(),R=null};let fe=null;function tt(et){fe&&fe(et)}function V(){Z.stop()}function j(){Z.start()}const Z=new ib;Z.setAnimationLoop(tt),typeof self<"u"&&Z.setContext(self),this.setAnimationLoop=function(et){fe=et,Bt.setAnimationLoop(et),et===null?Z.stop():Z.start()},Bt.addEventListener("sessionstart",V),Bt.addEventListener("sessionend",j),this.render=function(et,At){if(At!==void 0&&At.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(W===!0)return;et.matrixWorldAutoUpdate===!0&&et.updateMatrixWorld(),At.parent===null&&At.matrixWorldAutoUpdate===!0&&At.updateMatrixWorld(),Bt.enabled===!0&&Bt.isPresenting===!0&&(Bt.cameraAutoUpdate===!0&&Bt.updateCamera(At),At=Bt.getCamera()),et.isScene===!0&&et.onBeforeRender(L,et,At,Q),R=rt.get(et,z.length),R.init(),z.push(R),Yt.multiplyMatrices(At.projectionMatrix,At.matrixWorldInverse),be.setFromProjectionMatrix(Yt),$e=this.localClippingEnabled,de=$t.init(this.clippingPlanes,$e),C=mt.get(et,F.length),C.init(),F.push(C),at(et,At,0,L.sortObjects),C.finish(),L.sortObjects===!0&&C.sort(Dt,Wt),de===!0&&$t.beginShadows();const Ot=R.state.shadowsArray;if(pe.render(Ot,et,At),de===!0&&$t.endShadows(),this.info.autoReset===!0&&this.info.reset(),ye.render(C,et),R.setupLights(L.useLegacyLights),At.isArrayCamera){const St=At.cameras;for(let Ht=0,De=St.length;Ht<De;Ht++){const je=St[Ht];Mt(C,et,je,je.viewport)}}else Mt(C,et,At);Q!==null&&(he.updateMultisampleRenderTarget(Q),he.updateRenderTargetMipmap(Q)),et.isScene===!0&&et.onAfterRender(L,et,At),Ge.resetDefaultState(),nt=-1,pt=null,z.pop(),z.length>0?R=z[z.length-1]:R=null,F.pop(),F.length>0?C=F[F.length-1]:C=null};function at(et,At,Ot,St){if(et.visible===!1)return;if(et.layers.test(At.layers)){if(et.isGroup)Ot=et.renderOrder;else if(et.isLOD)et.autoUpdate===!0&&et.update(At);else if(et.isLight)R.pushLight(et),et.castShadow&&R.pushShadow(et);else if(et.isSprite){if(!et.frustumCulled||be.intersectsSprite(et)){St&&re.setFromMatrixPosition(et.matrixWorld).applyMatrix4(Yt);const je=ni.update(et),we=et.material;we.visible&&C.push(et,je,we,Ot,re.z,null)}}else if((et.isMesh||et.isLine||et.isPoints)&&(et.isSkinnedMesh&&et.skeleton.frame!==le.render.frame&&(et.skeleton.update(),et.skeleton.frame=le.render.frame),!et.frustumCulled||be.intersectsObject(et))){St&&re.setFromMatrixPosition(et.matrixWorld).applyMatrix4(Yt);const je=ni.update(et),we=et.material;if(Array.isArray(we)){const Ke=je.groups;for(let li=0,pi=Ke.length;li<pi;li++){const di=Ke[li],Mi=we[di.materialIndex];Mi&&Mi.visible&&C.push(et,je,Mi,Ot,re.z,di)}}else we.visible&&C.push(et,je,we,Ot,re.z,null)}}const De=et.children;for(let je=0,we=De.length;je<we;je++)at(De[je],At,Ot,St)}function Mt(et,At,Ot,St){const Ht=et.opaque,De=et.transmissive,je=et.transparent;R.setupLightsView(Ot),de===!0&&$t.setGlobalState(L.clippingPlanes,Ot),De.length>0&&bt(Ht,De,At,Ot),St&&Qe.viewport(ft.copy(St)),Ht.length>0&&Tt(Ht,At,Ot),De.length>0&&Tt(De,At,Ot),je.length>0&&Tt(je,At,Ot),Qe.buffers.depth.setTest(!0),Qe.buffers.depth.setMask(!0),Qe.buffers.color.setMask(!0),Qe.setPolygonOffset(!1)}function bt(et,At,Ot,St){if(_e===null){const we=xe.isWebGL2;_e=new Ir(1024,1024,{generateMipmaps:!0,type:ci.has("EXT_color_buffer_half_float")?Gh:_o,minFilter:go,samples:we&&a===!0?4:0})}const Ht=L.getRenderTarget();L.setRenderTarget(_e),L.clear();const De=L.toneMapping;L.toneMapping=Hr,Tt(et,Ot,St),he.updateMultisampleRenderTarget(_e),he.updateRenderTargetMipmap(_e);let je=!1;for(let we=0,Ke=At.length;we<Ke;we++){const li=At[we],pi=li.object,di=li.geometry,Mi=li.material,Gi=li.group;if(Mi.side===Vr&&pi.layers.test(St.layers)){const ss=Mi.side;Mi.side=Ps,Mi.needsUpdate=!0,yt(pi,Ot,St,di,Mi,Gi),Mi.side=ss,Mi.needsUpdate=!0,je=!0}}je===!0&&(he.updateMultisampleRenderTarget(_e),he.updateRenderTargetMipmap(_e)),L.setRenderTarget(Ht),L.toneMapping=De}function Tt(et,At,Ot){const St=At.isScene===!0?At.overrideMaterial:null;for(let Ht=0,De=et.length;Ht<De;Ht++){const je=et[Ht],we=je.object,Ke=je.geometry,li=St===null?je.material:St,pi=je.group;we.layers.test(Ot.layers)&&yt(we,At,Ot,Ke,li,pi)}}function yt(et,At,Ot,St,Ht,De){et.onBeforeRender(L,At,Ot,St,Ht,De),et.modelViewMatrix.multiplyMatrices(Ot.matrixWorldInverse,et.matrixWorld),et.normalMatrix.getNormalMatrix(et.modelViewMatrix),Ht.onBeforeRender(L,At,Ot,St,et,De),Ht.transparent===!0&&Ht.side===Vr&&Ht.forceSinglePass===!1?(Ht.side=Ps,Ht.needsUpdate=!0,L.renderBufferDirect(Ot,At,St,Ht,et,De),Ht.side=Ea,Ht.needsUpdate=!0,L.renderBufferDirect(Ot,At,St,Ht,et,De),Ht.side=Vr):L.renderBufferDirect(Ot,At,St,Ht,et,De),et.onAfterRender(L,At,Ot,St,Ht,De)}function Rt(et,At,Ot){At.isScene!==!0&&(At=Re);const St=Kt.get(et),Ht=R.state.lights,De=R.state.shadowsArray,je=Ht.state.version,we=Oe.getParameters(et,Ht.state,De,At,Ot),Ke=Oe.getProgramCacheKey(we);let li=St.programs;St.environment=et.isMeshStandardMaterial?At.environment:null,St.fog=At.fog,St.envMap=(et.isMeshStandardMaterial?Ce:Ee).get(et.envMap||St.environment),li===void 0&&(et.addEventListener("dispose",Fi),li=new Map,St.programs=li);let pi=li.get(Ke);if(pi!==void 0){if(St.currentProgram===pi&&St.lightsStateVersion===je)return ee(et,we),pi}else we.uniforms=Oe.getUniforms(et),et.onBuild(Ot,we,L),et.onBeforeCompile(we,L),pi=Oe.acquireProgram(we,Ke),li.set(Ke,pi),St.uniforms=we.uniforms;const di=St.uniforms;(!et.isShaderMaterial&&!et.isRawShaderMaterial||et.clipping===!0)&&(di.clippingPlanes=$t.uniform),ee(et,we),St.needsLights=We(et),St.lightsStateVersion=je,St.needsLights&&(di.ambientLightColor.value=Ht.state.ambient,di.lightProbe.value=Ht.state.probe,di.directionalLights.value=Ht.state.directional,di.directionalLightShadows.value=Ht.state.directionalShadow,di.spotLights.value=Ht.state.spot,di.spotLightShadows.value=Ht.state.spotShadow,di.rectAreaLights.value=Ht.state.rectArea,di.ltc_1.value=Ht.state.rectAreaLTC1,di.ltc_2.value=Ht.state.rectAreaLTC2,di.pointLights.value=Ht.state.point,di.pointLightShadows.value=Ht.state.pointShadow,di.hemisphereLights.value=Ht.state.hemi,di.directionalShadowMap.value=Ht.state.directionalShadowMap,di.directionalShadowMatrix.value=Ht.state.directionalShadowMatrix,di.spotShadowMap.value=Ht.state.spotShadowMap,di.spotLightMatrix.value=Ht.state.spotLightMatrix,di.spotLightMap.value=Ht.state.spotLightMap,di.pointShadowMap.value=Ht.state.pointShadowMap,di.pointShadowMatrix.value=Ht.state.pointShadowMatrix);const Mi=pi.getUniforms(),Gi=Pp.seqWithValue(Mi.seq,di);return St.currentProgram=pi,St.uniformsList=Gi,pi}function ee(et,At){const Ot=Kt.get(et);Ot.outputEncoding=At.outputEncoding,Ot.instancing=At.instancing,Ot.skinning=At.skinning,Ot.morphTargets=At.morphTargets,Ot.morphNormals=At.morphNormals,Ot.morphColors=At.morphColors,Ot.morphTargetsCount=At.morphTargetsCount,Ot.numClippingPlanes=At.numClippingPlanes,Ot.numIntersection=At.numClipIntersection,Ot.vertexAlphas=At.vertexAlphas,Ot.vertexTangents=At.vertexTangents,Ot.toneMapping=At.toneMapping}function jt(et,At,Ot,St,Ht){At.isScene!==!0&&(At=Re),he.resetTextureUnits();const De=At.fog,je=St.isMeshStandardMaterial?At.environment:null,we=Q===null?L.outputEncoding:Q.isXRRenderTarget===!0?Q.texture.encoding:yo,Ke=(St.isMeshStandardMaterial?Ce:Ee).get(St.envMap||je),li=St.vertexColors===!0&&!!Ot.attributes.color&&Ot.attributes.color.itemSize===4,pi=!!St.normalMap&&!!Ot.attributes.tangent,di=!!Ot.morphAttributes.position,Mi=!!Ot.morphAttributes.normal,Gi=!!Ot.morphAttributes.color,ss=St.toneMapped?L.toneMapping:Hr,gr=Ot.morphAttributes.position||Ot.morphAttributes.normal||Ot.morphAttributes.color,mi=gr!==void 0?gr.length:0,Pi=Kt.get(St),Kr=R.state.lights;if(de===!0&&($e===!0||et!==pt)){const Mn=et===pt&&St.id===nt;$t.setState(St,et,Mn)}let Oi=!1;St.version===Pi.__version?(Pi.needsLights&&Pi.lightsStateVersion!==Kr.state.version||Pi.outputEncoding!==we||Ht.isInstancedMesh&&Pi.instancing===!1||!Ht.isInstancedMesh&&Pi.instancing===!0||Ht.isSkinnedMesh&&Pi.skinning===!1||!Ht.isSkinnedMesh&&Pi.skinning===!0||Pi.envMap!==Ke||St.fog===!0&&Pi.fog!==De||Pi.numClippingPlanes!==void 0&&(Pi.numClippingPlanes!==$t.numPlanes||Pi.numIntersection!==$t.numIntersection)||Pi.vertexAlphas!==li||Pi.vertexTangents!==pi||Pi.morphTargets!==di||Pi.morphNormals!==Mi||Pi.morphColors!==Gi||Pi.toneMapping!==ss||xe.isWebGL2===!0&&Pi.morphTargetsCount!==mi)&&(Oi=!0):(Oi=!0,Pi.__version=St.version);let fn=Pi.currentProgram;Oi===!0&&(fn=Rt(St,At,Ht));let To=!1,cn=!1,Wn=!1;const Fn=fn.getUniforms(),qn=Pi.uniforms;if(Qe.useProgram(fn.program)&&(To=!0,cn=!0,Wn=!0),St.id!==nt&&(nt=St.id,cn=!0),To||pt!==et){if(Fn.setValue(Gt,"projectionMatrix",et.projectionMatrix),xe.logarithmicDepthBuffer&&Fn.setValue(Gt,"logDepthBufFC",2/(Math.log(et.far+1)/Math.LN2)),pt!==et&&(pt=et,cn=!0,Wn=!0),St.isShaderMaterial||St.isMeshPhongMaterial||St.isMeshToonMaterial||St.isMeshStandardMaterial||St.envMap){const Mn=Fn.map.cameraPosition;Mn!==void 0&&Mn.setValue(Gt,re.setFromMatrixPosition(et.matrixWorld))}(St.isMeshPhongMaterial||St.isMeshToonMaterial||St.isMeshLambertMaterial||St.isMeshBasicMaterial||St.isMeshStandardMaterial||St.isShaderMaterial)&&Fn.setValue(Gt,"isOrthographic",et.isOrthographicCamera===!0),(St.isMeshPhongMaterial||St.isMeshToonMaterial||St.isMeshLambertMaterial||St.isMeshBasicMaterial||St.isMeshStandardMaterial||St.isShaderMaterial||St.isShadowMaterial||Ht.isSkinnedMesh)&&Fn.setValue(Gt,"viewMatrix",et.matrixWorldInverse)}if(Ht.isSkinnedMesh){Fn.setOptional(Gt,Ht,"bindMatrix"),Fn.setOptional(Gt,Ht,"bindMatrixInverse");const Mn=Ht.skeleton;Mn&&(xe.floatVertexTextures?(Mn.boneTexture===null&&Mn.computeBoneTexture(),Fn.setValue(Gt,"boneTexture",Mn.boneTexture,he),Fn.setValue(Gt,"boneTextureSize",Mn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const sn=Ot.morphAttributes;if((sn.position!==void 0||sn.normal!==void 0||sn.color!==void 0&&xe.isWebGL2===!0)&&ke.update(Ht,Ot,fn),(cn||Pi.receiveShadow!==Ht.receiveShadow)&&(Pi.receiveShadow=Ht.receiveShadow,Fn.setValue(Gt,"receiveShadow",Ht.receiveShadow)),St.isMeshGouraudMaterial&&St.envMap!==null&&(qn.envMap.value=Ke,qn.flipEnvMap.value=Ke.isCubeTexture&&Ke.isRenderTargetTexture===!1?-1:1),cn&&(Fn.setValue(Gt,"toneMappingExposure",L.toneMappingExposure),Pi.needsLights&&Qt(qn,Wn),De&&St.fog===!0&&gi.refreshFogUniforms(qn,De),gi.refreshMaterialUniforms(qn,St,It,zt,_e),Pp.upload(Gt,Pi.uniformsList,qn,he)),St.isShaderMaterial&&St.uniformsNeedUpdate===!0&&(Pp.upload(Gt,Pi.uniformsList,qn,he),St.uniformsNeedUpdate=!1),St.isSpriteMaterial&&Fn.setValue(Gt,"center",Ht.center),Fn.setValue(Gt,"modelViewMatrix",Ht.modelViewMatrix),Fn.setValue(Gt,"normalMatrix",Ht.normalMatrix),Fn.setValue(Gt,"modelMatrix",Ht.matrixWorld),St.isShaderMaterial||St.isRawShaderMaterial){const Mn=St.uniformsGroups;for(let Vs=0,rn=Mn.length;Vs<rn;Vs++)if(xe.isWebGL2){const nr=Mn[Vs];si.update(nr,fn),si.bind(nr,fn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return fn}function Qt(et,At){et.ambientLightColor.needsUpdate=At,et.lightProbe.needsUpdate=At,et.directionalLights.needsUpdate=At,et.directionalLightShadows.needsUpdate=At,et.pointLights.needsUpdate=At,et.pointLightShadows.needsUpdate=At,et.spotLights.needsUpdate=At,et.spotLightShadows.needsUpdate=At,et.rectAreaLights.needsUpdate=At,et.hemisphereLights.needsUpdate=At}function We(et){return et.isMeshLambertMaterial||et.isMeshToonMaterial||et.isMeshPhongMaterial||et.isMeshStandardMaterial||et.isShadowMaterial||et.isShaderMaterial&&et.lights===!0}this.getActiveCubeFace=function(){return G},this.getActiveMipmapLevel=function(){return H},this.getRenderTarget=function(){return Q},this.setRenderTargetTextures=function(et,At,Ot){Kt.get(et.texture).__webglTexture=At,Kt.get(et.depthTexture).__webglTexture=Ot;const St=Kt.get(et);St.__hasExternalTextures=!0,St.__hasExternalTextures&&(St.__autoAllocateDepthBuffer=Ot===void 0,St.__autoAllocateDepthBuffer||ci.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),St.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(et,At){const Ot=Kt.get(et);Ot.__webglFramebuffer=At,Ot.__useDefaultFramebuffer=At===void 0},this.setRenderTarget=function(et,At=0,Ot=0){Q=et,G=At,H=Ot;let St=!0,Ht=null,De=!1,je=!1;if(et){const Ke=Kt.get(et);Ke.__useDefaultFramebuffer!==void 0?(Qe.bindFramebuffer(36160,null),St=!1):Ke.__webglFramebuffer===void 0?he.setupRenderTarget(et):Ke.__hasExternalTextures&&he.rebindTextures(et,Kt.get(et.texture).__webglTexture,Kt.get(et.depthTexture).__webglTexture);const li=et.texture;(li.isData3DTexture||li.isDataArrayTexture||li.isCompressedArrayTexture)&&(je=!0);const pi=Kt.get(et).__webglFramebuffer;et.isWebGLCubeRenderTarget?(Ht=pi[At],De=!0):xe.isWebGL2&&et.samples>0&&he.useMultisampledRTT(et)===!1?Ht=Kt.get(et).__webglMultisampledFramebuffer:Ht=pi,ft.copy(et.viewport),K.copy(et.scissor),ot=et.scissorTest}else ft.copy(se).multiplyScalar(It).floor(),K.copy(ce).multiplyScalar(It).floor(),ot=ie;if(Qe.bindFramebuffer(36160,Ht)&&xe.drawBuffers&&St&&Qe.drawBuffers(et,Ht),Qe.viewport(ft),Qe.scissor(K),Qe.setScissorTest(ot),De){const Ke=Kt.get(et.texture);Gt.framebufferTexture2D(36160,36064,34069+At,Ke.__webglTexture,Ot)}else if(je){const Ke=Kt.get(et.texture),li=At||0;Gt.framebufferTextureLayer(36160,36064,Ke.__webglTexture,Ot||0,li)}nt=-1},this.readRenderTargetPixels=function(et,At,Ot,St,Ht,De,je){if(!(et&&et.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let we=Kt.get(et).__webglFramebuffer;if(et.isWebGLCubeRenderTarget&&je!==void 0&&(we=we[je]),we){Qe.bindFramebuffer(36160,we);try{const Ke=et.texture,li=Ke.format,pi=Ke.type;if(li!==Qs&&Zt.convert(li)!==Gt.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const di=pi===Gh&&(ci.has("EXT_color_buffer_half_float")||xe.isWebGL2&&ci.has("EXT_color_buffer_float"));if(pi!==_o&&Zt.convert(pi)!==Gt.getParameter(35738)&&!(pi===Aa&&(xe.isWebGL2||ci.has("OES_texture_float")||ci.has("WEBGL_color_buffer_float")))&&!di){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}At>=0&&At<=et.width-St&&Ot>=0&&Ot<=et.height-Ht&&Gt.readPixels(At,Ot,St,Ht,Zt.convert(li),Zt.convert(pi),De)}finally{const Ke=Q!==null?Kt.get(Q).__webglFramebuffer:null;Qe.bindFramebuffer(36160,Ke)}}},this.copyFramebufferToTexture=function(et,At,Ot=0){const St=Math.pow(2,-Ot),Ht=Math.floor(At.image.width*St),De=Math.floor(At.image.height*St);he.setTexture2D(At,0),Gt.copyTexSubImage2D(3553,Ot,0,0,et.x,et.y,Ht,De),Qe.unbindTexture()},this.copyTextureToTexture=function(et,At,Ot,St=0){const Ht=At.image.width,De=At.image.height,je=Zt.convert(Ot.format),we=Zt.convert(Ot.type);he.setTexture2D(Ot,0),Gt.pixelStorei(37440,Ot.flipY),Gt.pixelStorei(37441,Ot.premultiplyAlpha),Gt.pixelStorei(3317,Ot.unpackAlignment),At.isDataTexture?Gt.texSubImage2D(3553,St,et.x,et.y,Ht,De,je,we,At.image.data):At.isCompressedTexture?Gt.compressedTexSubImage2D(3553,St,et.x,et.y,At.mipmaps[0].width,At.mipmaps[0].height,je,At.mipmaps[0].data):Gt.texSubImage2D(3553,St,et.x,et.y,je,we,At.image),St===0&&Ot.generateMipmaps&&Gt.generateMipmap(3553),Qe.unbindTexture()},this.copyTextureToTexture3D=function(et,At,Ot,St,Ht=0){if(L.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const De=et.max.x-et.min.x+1,je=et.max.y-et.min.y+1,we=et.max.z-et.min.z+1,Ke=Zt.convert(St.format),li=Zt.convert(St.type);let pi;if(St.isData3DTexture)he.setTexture3D(St,0),pi=32879;else if(St.isDataArrayTexture)he.setTexture2DArray(St,0),pi=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Gt.pixelStorei(37440,St.flipY),Gt.pixelStorei(37441,St.premultiplyAlpha),Gt.pixelStorei(3317,St.unpackAlignment);const di=Gt.getParameter(3314),Mi=Gt.getParameter(32878),Gi=Gt.getParameter(3316),ss=Gt.getParameter(3315),gr=Gt.getParameter(32877),mi=Ot.isCompressedTexture?Ot.mipmaps[0]:Ot.image;Gt.pixelStorei(3314,mi.width),Gt.pixelStorei(32878,mi.height),Gt.pixelStorei(3316,et.min.x),Gt.pixelStorei(3315,et.min.y),Gt.pixelStorei(32877,et.min.z),Ot.isDataTexture||Ot.isData3DTexture?Gt.texSubImage3D(pi,Ht,At.x,At.y,At.z,De,je,we,Ke,li,mi.data):Ot.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Gt.compressedTexSubImage3D(pi,Ht,At.x,At.y,At.z,De,je,we,Ke,mi.data)):Gt.texSubImage3D(pi,Ht,At.x,At.y,At.z,De,je,we,Ke,li,mi),Gt.pixelStorei(3314,di),Gt.pixelStorei(32878,Mi),Gt.pixelStorei(3316,Gi),Gt.pixelStorei(3315,ss),Gt.pixelStorei(32877,gr),Ht===0&&St.generateMipmaps&&Gt.generateMipmap(pi),Qe.unbindTexture()},this.initTexture=function(et){et.isCubeTexture?he.setTextureCube(et,0):et.isData3DTexture?he.setTexture3D(et,0):et.isDataArrayTexture||et.isCompressedArrayTexture?he.setTexture2DArray(et,0):he.setTexture2D(et,0),Qe.unbindTexture()},this.resetState=function(){G=0,H=0,Q=null,Qe.reset(),Ge.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(t){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!t}}class cb extends Jp{}cb.prototype.isWebGL1Renderer=!0;class Kp{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new Je(t),this.density=e}clone(){return new Kp(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Qp{constructor(t,e=1,s=1e3){this.isFog=!0,this.name="",this.color=new Je(t),this.near=e,this.far=s}clone(){return new Qp(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class t0 extends Vi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}}class tm{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Wu,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=er()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,s){t*=this.stride,s*=e.stride;for(let o=0,c=this.stride;o<c;o++)this.array[t+o]=e.array[s+o];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=er()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(e,this.stride);return s.setUsage(this.usage),s}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=er()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ts=new ut;class pl{constructor(t,e,s,o=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=s,this.normalized=o}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,s=this.data.count;e<s;e++)Ts.fromBufferAttribute(this,e),Ts.applyMatrix4(t),this.setXYZ(e,Ts.x,Ts.y,Ts.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)Ts.fromBufferAttribute(this,e),Ts.applyNormalMatrix(t),this.setXYZ(e,Ts.x,Ts.y,Ts.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)Ts.fromBufferAttribute(this,e),Ts.transformDirection(t),this.setXYZ(e,Ts.x,Ts.y,Ts.z);return this}setX(t,e){return this.normalized&&(e=Ri(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Ri(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Ri(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Ri(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=tr(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=tr(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=tr(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=tr(e,this.array)),e}setXY(t,e,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ri(e,this.array),s=Ri(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this}setXYZ(t,e,s,o){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ri(e,this.array),s=Ri(s,this.array),o=Ri(o,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=o,this}setXYZW(t,e,s,o,c){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ri(e,this.array),s=Ri(s,this.array),o=Ri(o,this.array),c=Ri(c,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=o,this.data.array[t+3]=c,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const o=s*this.data.stride+this.offset;for(let c=0;c<this.itemSize;c++)e.push(this.data.array[o+c])}return new Zi(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new pl(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const o=s*this.data.stride+this.offset;for(let c=0;c<this.itemSize;c++)e.push(this.data.array[o+c])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class e0 extends _s{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Je(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let wh;const mu=new ut,Mh=new ut,Sh=new ut,Ah=new me,gu=new me,ub=new xi,Qf=new ut,_u=new ut,tp=new ut,Vv=new me,Rg=new me,Gv=new me;class db extends Vi{constructor(t){if(super(),this.isSprite=!0,this.type="Sprite",wh===void 0){wh=new Ii;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),s=new tm(e,5);wh.setIndex([0,1,2,0,2,3]),wh.setAttribute("position",new pl(s,3,0,!1)),wh.setAttribute("uv",new pl(s,2,3,!1))}this.geometry=wh,this.material=t!==void 0?t:new e0,this.center=new me(.5,.5)}raycast(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Mh.setFromMatrixScale(this.matrixWorld),ub.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Sh.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Mh.multiplyScalar(-Sh.z);const s=this.material.rotation;let o,c;s!==0&&(c=Math.cos(s),o=Math.sin(s));const d=this.center;ep(Qf.set(-.5,-.5,0),Sh,d,Mh,o,c),ep(_u.set(.5,-.5,0),Sh,d,Mh,o,c),ep(tp.set(.5,.5,0),Sh,d,Mh,o,c),Vv.set(0,0),Rg.set(1,0),Gv.set(1,1);let a=t.ray.intersectTriangle(Qf,_u,tp,!1,mu);if(a===null&&(ep(_u.set(-.5,.5,0),Sh,d,Mh,o,c),Rg.set(0,1),a=t.ray.intersectTriangle(Qf,tp,_u,!1,mu),a===null))return;const _=t.ray.origin.distanceTo(mu);_<t.near||_>t.far||e.push({distance:_,point:mu.clone(),uv:Bs.getInterpolation(mu,Qf,_u,tp,Vv,Rg,Gv,new me),face:null,object:this})}copy(t,e){return super.copy(t,e),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function ep(l,t,e,s,o,c){Ah.subVectors(l,e).addScalar(.5).multiply(s),o!==void 0?(gu.x=c*Ah.x-o*Ah.y,gu.y=o*Ah.x+c*Ah.y):gu.copy(Ah),l.copy(t),l.x+=gu.x,l.y+=gu.y,l.applyMatrix4(ub)}const ip=new ut,Hv=new ut;class fb extends Vi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let s=0,o=e.length;s<o;s++){const c=e[s];this.addLevel(c.object.clone(),c.distance,c.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0,s=0){e=Math.abs(e);const o=this.levels;let c;for(c=0;c<o.length&&!(e<o[c].distance);c++);return o.splice(c,0,{distance:e,hysteresis:s,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let s,o;for(s=1,o=e.length;s<o;s++){let c=e[s].distance;if(e[s].object.visible&&(c-=c*e[s].hysteresis),t<c)break}return e[s-1].object}return null}raycast(t,e){if(this.levels.length>0){ip.setFromMatrixPosition(this.matrixWorld);const o=t.ray.origin.distanceTo(ip);this.getObjectForDistance(o).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){ip.setFromMatrixPosition(t.matrixWorld),Hv.setFromMatrixPosition(this.matrixWorld);const s=ip.distanceTo(Hv)/t.zoom;e[0].object.visible=!0;let o,c;for(o=1,c=e.length;o<c;o++){let d=e[o].distance;if(e[o].object.visible&&(d-=d*e[o].hysteresis),s>=d)e[o-1].object.visible=!1,e[o].object.visible=!0;else break}for(this._currentLevel=o-1;o<c;o++)e[o].object.visible=!1}}toJSON(t){const e=super.toJSON(t);this.autoUpdate===!1&&(e.object.autoUpdate=!1),e.object.levels=[];const s=this.levels;for(let o=0,c=s.length;o<c;o++){const d=s[o];e.object.levels.push({object:d.object.uuid,distance:d.distance,hysteresis:d.hysteresis})}return e}}const Wv=new ut,qv=new Ji,$v=new Ji,w3=new ut,jv=new xi,Th=new ut;class pb extends Vn{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new xi,this.bindMatrixInverse=new xi,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new Yr),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let s=0;s<e.count;s++)Th.fromBufferAttribute(e,s),this.applyBoneTransform(s,Th),this.boundingBox.expandByPoint(Th)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Jr),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let s=0;s<e.count;s++)Th.fromBufferAttribute(e,s),this.applyBoneTransform(s,Th),this.boundingSphere.expandByPoint(Th)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Ji,e=this.geometry.attributes.skinWeight;for(let s=0,o=e.count;s<o;s++){t.fromBufferAttribute(e,s);const c=1/t.manhattanLength();c!==1/0?t.multiplyScalar(c):t.set(1,0,0,0),e.setXYZW(s,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const s=this.skeleton,o=this.geometry;qv.fromBufferAttribute(o.attributes.skinIndex,t),$v.fromBufferAttribute(o.attributes.skinWeight,t),Wv.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let c=0;c<4;c++){const d=$v.getComponent(c);if(d!==0){const a=qv.getComponent(c);jv.multiplyMatrices(s.bones[a].matrixWorld,s.boneInverses[a]),e.addScaledVector(w3.copy(Wv).applyMatrix4(jv),d)}}return e.applyMatrix4(this.bindMatrixInverse)}boneTransform(t,e){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(t,e)}}class i0 extends Vi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Nh extends zn{constructor(t=null,e=1,s=1,o,c,d,a,_,v=Rn,S=Rn,M,A){super(null,d,a,_,v,S,o,c,M,A),this.isDataTexture=!0,this.image={data:t,width:e,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Zv=new xi,M3=new xi;class em{constructor(t=[],e=[]){this.uuid=er(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let s=0,o=this.bones.length;s<o;s++)this.boneInverses.push(new xi)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const s=new xi;this.bones[t]&&s.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(s)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const s=this.bones[t];s&&s.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const s=this.bones[t];s&&(s.parent&&s.parent.isBone?(s.matrix.copy(s.parent.matrixWorld).invert(),s.matrix.multiply(s.matrixWorld)):s.matrix.copy(s.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale))}}update(){const t=this.bones,e=this.boneInverses,s=this.boneMatrices,o=this.boneTexture;for(let c=0,d=t.length;c<d;c++){const a=t[c]?t[c].matrixWorld:M3;Zv.multiplyMatrices(a,e[c]),Zv.toArray(s,c*16)}o!==null&&(o.needsUpdate=!0)}clone(){return new em(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Z1(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const s=new Nh(e,t,t,Qs,Aa);return s.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=s,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,s=this.bones.length;e<s;e++){const o=this.bones[e];if(o.name===t)return o}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let s=0,o=t.bones.length;s<o;s++){const c=t.bones[s];let d=e[c];d===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",c),d=new i0),this.bones.push(d),this.boneInverses.push(new xi().fromArray(t.boneInverses[s]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,s=this.boneInverses;for(let o=0,c=e.length;o<c;o++){const d=e[o];t.bones.push(d.uuid);const a=s[o];t.boneInverses.push(a.toArray())}return t}}class $h extends Zi{constructor(t,e,s,o=1){super(t,e,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=o}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Eh=new xi,Xv=new xi,np=[],Yv=new Yr,S3=new xi,yu=new Vn,vu=new Jr;class mb extends Vn{constructor(t,e,s){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new $h(new Float32Array(s*16),16),this.instanceColor=null,this.count=s,this.boundingBox=null,this.boundingSphere=null;for(let o=0;o<s;o++)this.setMatrixAt(o,S3)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new Yr),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,Eh),Yv.copy(t.boundingBox).applyMatrix4(Eh),this.boundingBox.union(Yv)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Jr),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,Eh),vu.copy(t.boundingSphere).applyMatrix4(Eh),this.boundingSphere.union(vu)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}raycast(t,e){const s=this.matrixWorld,o=this.count;if(yu.geometry=this.geometry,yu.material=this.material,yu.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),vu.copy(this.boundingSphere),vu.applyMatrix4(s),t.ray.intersectsSphere(vu)!==!1))for(let c=0;c<o;c++){this.getMatrixAt(c,Eh),Xv.multiplyMatrices(s,Eh),yu.matrixWorld=Xv,yu.raycast(t,np);for(let d=0,a=np.length;d<a;d++){const _=np[d];_.instanceId=c,_.object=this,e.push(_)}np.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new $h(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class ys extends _s{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Je(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Jv=new ut,Kv=new ut,Qv=new xi,Dg=new ad,sp=new Jr;class vo extends Vi{constructor(t=new Ii,e=new ys){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,s=[0];for(let o=1,c=e.count;o<c;o++)Jv.fromBufferAttribute(e,o-1),Kv.fromBufferAttribute(e,o),s[o]=s[o-1],s[o]+=Jv.distanceTo(Kv);t.setAttribute("lineDistance",new ii(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const s=this.geometry,o=this.matrixWorld,c=t.params.Line.threshold,d=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),sp.copy(s.boundingSphere),sp.applyMatrix4(o),sp.radius+=c,t.ray.intersectsSphere(sp)===!1)return;Qv.copy(o).invert(),Dg.copy(t.ray).applyMatrix4(Qv);const a=c/((this.scale.x+this.scale.y+this.scale.z)/3),_=a*a,v=new ut,S=new ut,M=new ut,A=new ut,C=this.isLineSegments?2:1,R=s.index,z=s.attributes.position;if(R!==null){const L=Math.max(0,d.start),W=Math.min(R.count,d.start+d.count);for(let G=L,H=W-1;G<H;G+=C){const Q=R.getX(G),nt=R.getX(G+1);if(v.fromBufferAttribute(z,Q),S.fromBufferAttribute(z,nt),Dg.distanceSqToSegment(v,S,A,M)>_)continue;A.applyMatrix4(this.matrixWorld);const ft=t.ray.origin.distanceTo(A);ft<t.near||ft>t.far||e.push({distance:ft,point:M.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}else{const L=Math.max(0,d.start),W=Math.min(z.count,d.start+d.count);for(let G=L,H=W-1;G<H;G+=C){if(v.fromBufferAttribute(z,G),S.fromBufferAttribute(z,G+1),Dg.distanceSqToSegment(v,S,A,M)>_)continue;A.applyMatrix4(this.matrixWorld);const nt=t.ray.origin.distanceTo(A);nt<t.near||nt>t.far||e.push({distance:nt,point:M.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const o=e[s[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,d=o.length;c<d;c++){const a=o[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=c}}}}}const tx=new ut,ex=new ut;class Pr extends vo{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,s=[];for(let o=0,c=e.count;o<c;o+=2)tx.fromBufferAttribute(e,o),ex.fromBufferAttribute(e,o+1),s[o]=o===0?0:s[o-1],s[o+1]=s[o]+tx.distanceTo(ex);t.setAttribute("lineDistance",new ii(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class gb extends vo{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class n0 extends _s{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Je(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const ix=new xi,T_=new ad,rp=new Jr,ap=new ut;class _b extends Vi{constructor(t=new Ii,e=new n0){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const s=this.geometry,o=this.matrixWorld,c=t.params.Points.threshold,d=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),rp.copy(s.boundingSphere),rp.applyMatrix4(o),rp.radius+=c,t.ray.intersectsSphere(rp)===!1)return;ix.copy(o).invert(),T_.copy(t.ray).applyMatrix4(ix);const a=c/((this.scale.x+this.scale.y+this.scale.z)/3),_=a*a,v=s.index,M=s.attributes.position;if(v!==null){const A=Math.max(0,d.start),C=Math.min(v.count,d.start+d.count);for(let R=A,F=C;R<F;R++){const z=v.getX(R);ap.fromBufferAttribute(M,z),nx(ap,z,_,o,t,e,this)}}else{const A=Math.max(0,d.start),C=Math.min(M.count,d.start+d.count);for(let R=A,F=C;R<F;R++)ap.fromBufferAttribute(M,R),nx(ap,R,_,o,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const o=e[s[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,d=o.length;c<d;c++){const a=o[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=c}}}}}function nx(l,t,e,s,o,c,d){const a=T_.distanceSqToPoint(l);if(a<e){const _=new ut;T_.closestPointToPoint(l,_),_.applyMatrix4(s);const v=o.ray.origin.distanceTo(_);if(v<o.near||v>o.far)return;c.push({distance:v,distanceToRay:Math.sqrt(a),point:_,index:t,face:null,object:d})}}class A3 extends zn{constructor(t,e,s,o,c,d,a,_,v){super(t,e,s,o,c,d,a,_,v),this.isVideoTexture=!0,this.minFilter=d!==void 0?d:Dn,this.magFilter=c!==void 0?c:Dn,this.generateMipmaps=!1;const S=this;function M(){S.needsUpdate=!0,t.requestVideoFrameCallback(M)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(M)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class T3 extends zn{constructor(t,e,s){super({width:t,height:e}),this.isFramebufferTexture=!0,this.format=s,this.magFilter=Rn,this.minFilter=Rn,this.generateMipmaps=!1,this.needsUpdate=!0}}class s0 extends zn{constructor(t,e,s,o,c,d,a,_,v,S,M,A){super(null,d,a,_,v,S,o,c,M,A),this.isCompressedTexture=!0,this.image={width:e,height:s},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class E3 extends s0{constructor(t,e,s,o,c,d){super(t,e,s,c,d),this.isCompressedArrayTexture=!0,this.image.depth=o,this.wrapR=gs}}class C3 extends zn{constructor(t,e,s,o,c,d,a,_,v){super(t,e,s,o,c,d,a,_,v),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Lr{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const s=this.getUtoTmapping(t);return this.getPoint(s,e)}getPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return e}getSpacedPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPointAt(s/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let s,o=this.getPoint(0),c=0;e.push(0);for(let d=1;d<=t;d++)s=this.getPoint(d/t),c+=s.distanceTo(o),e.push(c),o=s;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const s=this.getLengths();let o=0;const c=s.length;let d;e?d=e:d=t*s[c-1];let a=0,_=c-1,v;for(;a<=_;)if(o=Math.floor(a+(_-a)/2),v=s[o]-d,v<0)a=o+1;else if(v>0)_=o-1;else{_=o;break}if(o=_,s[o]===d)return o/(c-1);const S=s[o],A=s[o+1]-S,C=(d-S)/A;return(o+C)/(c-1)}getTangent(t,e){let o=t-1e-4,c=t+1e-4;o<0&&(o=0),c>1&&(c=1);const d=this.getPoint(o),a=this.getPoint(c),_=e||(d.isVector2?new me:new ut);return _.copy(a).sub(d).normalize(),_}getTangentAt(t,e){const s=this.getUtoTmapping(t);return this.getTangent(s,e)}computeFrenetFrames(t,e){const s=new ut,o=[],c=[],d=[],a=new ut,_=new xi;for(let C=0;C<=t;C++){const R=C/t;o[C]=this.getTangentAt(R,new ut)}c[0]=new ut,d[0]=new ut;let v=Number.MAX_VALUE;const S=Math.abs(o[0].x),M=Math.abs(o[0].y),A=Math.abs(o[0].z);S<=v&&(v=S,s.set(1,0,0)),M<=v&&(v=M,s.set(0,1,0)),A<=v&&s.set(0,0,1),a.crossVectors(o[0],s).normalize(),c[0].crossVectors(o[0],a),d[0].crossVectors(o[0],c[0]);for(let C=1;C<=t;C++){if(c[C]=c[C-1].clone(),d[C]=d[C-1].clone(),a.crossVectors(o[C-1],o[C]),a.length()>Number.EPSILON){a.normalize();const R=Math.acos(wn(o[C-1].dot(o[C]),-1,1));c[C].applyMatrix4(_.makeRotationAxis(a,R))}d[C].crossVectors(o[C],c[C])}if(e===!0){let C=Math.acos(wn(c[0].dot(c[t]),-1,1));C/=t,o[0].dot(a.crossVectors(c[0],c[t]))>0&&(C=-C);for(let R=1;R<=t;R++)c[R].applyMatrix4(_.makeRotationAxis(o[R],C*R)),d[R].crossVectors(o[R],c[R])}return{tangents:o,normals:c,binormals:d}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class im extends Lr{constructor(t=0,e=0,s=1,o=1,c=0,d=Math.PI*2,a=!1,_=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=s,this.yRadius=o,this.aStartAngle=c,this.aEndAngle=d,this.aClockwise=a,this.aRotation=_}getPoint(t,e){const s=e||new me,o=Math.PI*2;let c=this.aEndAngle-this.aStartAngle;const d=Math.abs(c)<Number.EPSILON;for(;c<0;)c+=o;for(;c>o;)c-=o;c<Number.EPSILON&&(d?c=0:c=o),this.aClockwise===!0&&!d&&(c===o?c=-o:c=c-o);const a=this.aStartAngle+t*c;let _=this.aX+this.xRadius*Math.cos(a),v=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const S=Math.cos(this.aRotation),M=Math.sin(this.aRotation),A=_-this.aX,C=v-this.aY;_=A*S-C*M+this.aX,v=A*M+C*S+this.aY}return s.set(_,v)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class yb extends im{constructor(t,e,s,o,c,d){super(t,e,s,s,o,c,d),this.isArcCurve=!0,this.type="ArcCurve"}}function r0(){let l=0,t=0,e=0,s=0;function o(c,d,a,_){l=c,t=a,e=-3*c+3*d-2*a-_,s=2*c-2*d+a+_}return{initCatmullRom:function(c,d,a,_,v){o(d,a,v*(a-c),v*(_-d))},initNonuniformCatmullRom:function(c,d,a,_,v,S,M){let A=(d-c)/v-(a-c)/(v+S)+(a-d)/S,C=(a-d)/S-(_-d)/(S+M)+(_-a)/M;A*=S,C*=S,o(d,a,A,C)},calc:function(c){const d=c*c,a=d*c;return l+t*c+e*d+s*a}}}const op=new ut,zg=new r0,kg=new r0,Fg=new r0;class vb extends Lr{constructor(t=[],e=!1,s="centripetal",o=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=s,this.tension=o}getPoint(t,e=new ut){const s=e,o=this.points,c=o.length,d=(c-(this.closed?0:1))*t;let a=Math.floor(d),_=d-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/c)+1)*c:_===0&&a===c-1&&(a=c-2,_=1);let v,S;this.closed||a>0?v=o[(a-1)%c]:(op.subVectors(o[0],o[1]).add(o[0]),v=op);const M=o[a%c],A=o[(a+1)%c];if(this.closed||a+2<c?S=o[(a+2)%c]:(op.subVectors(o[c-1],o[c-2]).add(o[c-1]),S=op),this.curveType==="centripetal"||this.curveType==="chordal"){const C=this.curveType==="chordal"?.5:.25;let R=Math.pow(v.distanceToSquared(M),C),F=Math.pow(M.distanceToSquared(A),C),z=Math.pow(A.distanceToSquared(S),C);F<1e-4&&(F=1),R<1e-4&&(R=F),z<1e-4&&(z=F),zg.initNonuniformCatmullRom(v.x,M.x,A.x,S.x,R,F,z),kg.initNonuniformCatmullRom(v.y,M.y,A.y,S.y,R,F,z),Fg.initNonuniformCatmullRom(v.z,M.z,A.z,S.z,R,F,z)}else this.curveType==="catmullrom"&&(zg.initCatmullRom(v.x,M.x,A.x,S.x,this.tension),kg.initCatmullRom(v.y,M.y,A.y,S.y,this.tension),Fg.initCatmullRom(v.z,M.z,A.z,S.z,this.tension));return s.set(zg.calc(_),kg.calc(_),Fg.calc(_)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const o=t.points[e];this.points.push(o.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const o=this.points[e];t.points.push(o.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const o=t.points[e];this.points.push(new ut().fromArray(o))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function sx(l,t,e,s,o){const c=(s-t)*.5,d=(o-e)*.5,a=l*l,_=l*a;return(2*e-2*s+c+d)*_+(-3*e+3*s-2*c-d)*a+c*l+e}function I3(l,t){const e=1-l;return e*e*t}function P3(l,t){return 2*(1-l)*l*t}function L3(l,t){return l*l*t}function Iu(l,t,e,s){return I3(l,t)+P3(l,e)+L3(l,s)}function R3(l,t){const e=1-l;return e*e*e*t}function D3(l,t){const e=1-l;return 3*e*e*l*t}function z3(l,t){return 3*(1-l)*l*l*t}function k3(l,t){return l*l*l*t}function Pu(l,t,e,s,o){return R3(l,t)+D3(l,e)+z3(l,s)+k3(l,o)}class a0 extends Lr{constructor(t=new me,e=new me,s=new me,o=new me){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=s,this.v3=o}getPoint(t,e=new me){const s=e,o=this.v0,c=this.v1,d=this.v2,a=this.v3;return s.set(Pu(t,o.x,c.x,d.x,a.x),Pu(t,o.y,c.y,d.y,a.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class xb extends Lr{constructor(t=new ut,e=new ut,s=new ut,o=new ut){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=s,this.v3=o}getPoint(t,e=new ut){const s=e,o=this.v0,c=this.v1,d=this.v2,a=this.v3;return s.set(Pu(t,o.x,c.x,d.x,a.x),Pu(t,o.y,c.y,d.y,a.y),Pu(t,o.z,c.z,d.z,a.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class nm extends Lr{constructor(t=new me,e=new me){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new me){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new me){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class bb extends Lr{constructor(t=new ut,e=new ut){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new ut){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new ut){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class o0 extends Lr{constructor(t=new me,e=new me,s=new me){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new me){const s=e,o=this.v0,c=this.v1,d=this.v2;return s.set(Iu(t,o.x,c.x,d.x),Iu(t,o.y,c.y,d.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class l0 extends Lr{constructor(t=new ut,e=new ut,s=new ut){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new ut){const s=e,o=this.v0,c=this.v1,d=this.v2;return s.set(Iu(t,o.x,c.x,d.x),Iu(t,o.y,c.y,d.y),Iu(t,o.z,c.z,d.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class h0 extends Lr{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new me){const s=e,o=this.points,c=(o.length-1)*t,d=Math.floor(c),a=c-d,_=o[d===0?d:d-1],v=o[d],S=o[d>o.length-2?o.length-1:d+1],M=o[d>o.length-3?o.length-1:d+2];return s.set(sx(a,_.x,v.x,S.x,M.x),sx(a,_.y,v.y,S.y,M.y)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const o=t.points[e];this.points.push(o.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const o=this.points[e];t.points.push(o.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const o=t.points[e];this.points.push(new me().fromArray(o))}return this}}var c0=Object.freeze({__proto__:null,ArcCurve:yb,CatmullRomCurve3:vb,CubicBezierCurve:a0,CubicBezierCurve3:xb,EllipseCurve:im,LineCurve:nm,LineCurve3:bb,QuadraticBezierCurve:o0,QuadraticBezierCurve3:l0,SplineCurve:h0});class wb extends Lr{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new nm(e,t))}getPoint(t,e){const s=t*this.getLength(),o=this.getCurveLengths();let c=0;for(;c<o.length;){if(o[c]>=s){const d=o[c]-s,a=this.curves[c],_=a.getLength(),v=_===0?0:1-d/_;return a.getPointAt(v,e)}c++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let s=0,o=this.curves.length;s<o;s++)e+=this.curves[s].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let s;for(let o=0,c=this.curves;o<c.length;o++){const d=c[o],a=d.isEllipseCurve?t*2:d.isLineCurve||d.isLineCurve3?1:d.isSplineCurve?t*d.points.length:t,_=d.getPoints(a);for(let v=0;v<_.length;v++){const S=_[v];s&&s.equals(S)||(e.push(S),s=S)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const o=t.curves[e];this.curves.push(o.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,s=this.curves.length;e<s;e++){const o=this.curves[e];t.curves.push(o.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const o=t.curves[e];this.curves.push(new c0[o.type]().fromJSON(o))}return this}}class $u extends wb{constructor(t){super(),this.type="Path",this.currentPoint=new me,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,s=t.length;e<s;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const s=new nm(this.currentPoint.clone(),new me(t,e));return this.curves.push(s),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,s,o){const c=new o0(this.currentPoint.clone(),new me(t,e),new me(s,o));return this.curves.push(c),this.currentPoint.set(s,o),this}bezierCurveTo(t,e,s,o,c,d){const a=new a0(this.currentPoint.clone(),new me(t,e),new me(s,o),new me(c,d));return this.curves.push(a),this.currentPoint.set(c,d),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),s=new h0(e);return this.curves.push(s),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,s,o,c,d){const a=this.currentPoint.x,_=this.currentPoint.y;return this.absarc(t+a,e+_,s,o,c,d),this}absarc(t,e,s,o,c,d){return this.absellipse(t,e,s,s,o,c,d),this}ellipse(t,e,s,o,c,d,a,_){const v=this.currentPoint.x,S=this.currentPoint.y;return this.absellipse(t+v,e+S,s,o,c,d,a,_),this}absellipse(t,e,s,o,c,d,a,_){const v=new im(t,e,s,o,c,d,a,_);if(this.curves.length>0){const M=v.getPoint(0);M.equals(this.currentPoint)||this.lineTo(M.x,M.y)}this.curves.push(v);const S=v.getPoint(1);return this.currentPoint.copy(S),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Kh extends Ii{constructor(t=[new me(0,-.5),new me(.5,0),new me(0,.5)],e=12,s=0,o=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:s,phiLength:o},e=Math.floor(e),o=wn(o,0,Math.PI*2);const c=[],d=[],a=[],_=[],v=[],S=1/e,M=new ut,A=new me,C=new ut,R=new ut,F=new ut;let z=0,L=0;for(let W=0;W<=t.length-1;W++)switch(W){case 0:z=t[W+1].x-t[W].x,L=t[W+1].y-t[W].y,C.x=L*1,C.y=-z,C.z=L*0,F.copy(C),C.normalize(),_.push(C.x,C.y,C.z);break;case t.length-1:_.push(F.x,F.y,F.z);break;default:z=t[W+1].x-t[W].x,L=t[W+1].y-t[W].y,C.x=L*1,C.y=-z,C.z=L*0,R.copy(C),C.x+=F.x,C.y+=F.y,C.z+=F.z,C.normalize(),_.push(C.x,C.y,C.z),F.copy(R)}for(let W=0;W<=e;W++){const G=s+W*S*o,H=Math.sin(G),Q=Math.cos(G);for(let nt=0;nt<=t.length-1;nt++){M.x=t[nt].x*H,M.y=t[nt].y,M.z=t[nt].x*Q,d.push(M.x,M.y,M.z),A.x=W/e,A.y=nt/(t.length-1),a.push(A.x,A.y);const pt=_[3*nt+0]*H,ft=_[3*nt+1],K=_[3*nt+0]*Q;v.push(pt,ft,K)}}for(let W=0;W<e;W++)for(let G=0;G<t.length-1;G++){const H=G+W*t.length,Q=H,nt=H+t.length,pt=H+t.length+1,ft=H+1;c.push(Q,nt,ft),c.push(pt,ft,nt)}this.setIndex(c),this.setAttribute("position",new ii(d,3)),this.setAttribute("uv",new ii(a,2)),this.setAttribute("normal",new ii(v,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Kh(t.points,t.segments,t.phiStart,t.phiLength)}}class cd extends Kh{constructor(t=1,e=1,s=4,o=8){const c=new $u;c.absarc(0,-e/2,t,Math.PI*1.5,0),c.absarc(0,e/2,t,0,Math.PI*.5),super(c.getPoints(s),o),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:s,radialSegments:o}}static fromJSON(t){return new cd(t.radius,t.length,t.capSegments,t.radialSegments)}}class ud extends Ii{constructor(t=1,e=32,s=0,o=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:s,thetaLength:o},e=Math.max(3,e);const c=[],d=[],a=[],_=[],v=new ut,S=new me;d.push(0,0,0),a.push(0,0,1),_.push(.5,.5);for(let M=0,A=3;M<=e;M++,A+=3){const C=s+M/e*o;v.x=t*Math.cos(C),v.y=t*Math.sin(C),d.push(v.x,v.y,v.z),a.push(0,0,1),S.x=(d[A]/t+1)/2,S.y=(d[A+1]/t+1)/2,_.push(S.x,S.y)}for(let M=1;M<=e;M++)c.push(M,M+1,0);this.setIndex(c),this.setAttribute("position",new ii(d,3)),this.setAttribute("normal",new ii(a,3)),this.setAttribute("uv",new ii(_,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ud(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class vl extends Ii{constructor(t=1,e=1,s=1,o=32,c=1,d=!1,a=0,_=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:s,radialSegments:o,heightSegments:c,openEnded:d,thetaStart:a,thetaLength:_};const v=this;o=Math.floor(o),c=Math.floor(c);const S=[],M=[],A=[],C=[];let R=0;const F=[],z=s/2;let L=0;W(),d===!1&&(t>0&&G(!0),e>0&&G(!1)),this.setIndex(S),this.setAttribute("position",new ii(M,3)),this.setAttribute("normal",new ii(A,3)),this.setAttribute("uv",new ii(C,2));function W(){const H=new ut,Q=new ut;let nt=0;const pt=(e-t)/s;for(let ft=0;ft<=c;ft++){const K=[],ot=ft/c,kt=ot*(e-t)+t;for(let zt=0;zt<=o;zt++){const It=zt/o,Dt=It*_+a,Wt=Math.sin(Dt),se=Math.cos(Dt);Q.x=kt*Wt,Q.y=-ot*s+z,Q.z=kt*se,M.push(Q.x,Q.y,Q.z),H.set(Wt,pt,se).normalize(),A.push(H.x,H.y,H.z),C.push(It,1-ot),K.push(R++)}F.push(K)}for(let ft=0;ft<o;ft++)for(let K=0;K<c;K++){const ot=F[K][ft],kt=F[K+1][ft],zt=F[K+1][ft+1],It=F[K][ft+1];S.push(ot,kt,It),S.push(kt,zt,It),nt+=6}v.addGroup(L,nt,0),L+=nt}function G(H){const Q=R,nt=new me,pt=new ut;let ft=0;const K=H===!0?t:e,ot=H===!0?1:-1;for(let zt=1;zt<=o;zt++)M.push(0,z*ot,0),A.push(0,ot,0),C.push(.5,.5),R++;const kt=R;for(let zt=0;zt<=o;zt++){const Dt=zt/o*_+a,Wt=Math.cos(Dt),se=Math.sin(Dt);pt.x=K*se,pt.y=z*ot,pt.z=K*Wt,M.push(pt.x,pt.y,pt.z),A.push(0,ot,0),nt.x=Wt*.5+.5,nt.y=se*.5*ot+.5,C.push(nt.x,nt.y),R++}for(let zt=0;zt<o;zt++){const It=Q+zt,Dt=kt+zt;H===!0?S.push(Dt,Dt+1,It):S.push(Dt+1,Dt,It),ft+=3}v.addGroup(L,ft,H===!0?1:2),L+=ft}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new vl(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class dd extends vl{constructor(t=1,e=1,s=32,o=1,c=!1,d=0,a=Math.PI*2){super(0,t,e,s,o,c,d,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:s,heightSegments:o,openEnded:c,thetaStart:d,thetaLength:a}}static fromJSON(t){return new dd(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Ia extends Ii{constructor(t=[],e=[],s=1,o=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:s,detail:o};const c=[],d=[];a(o),v(s),S(),this.setAttribute("position",new ii(c,3)),this.setAttribute("normal",new ii(c.slice(),3)),this.setAttribute("uv",new ii(d,2)),o===0?this.computeVertexNormals():this.normalizeNormals();function a(W){const G=new ut,H=new ut,Q=new ut;for(let nt=0;nt<e.length;nt+=3)C(e[nt+0],G),C(e[nt+1],H),C(e[nt+2],Q),_(G,H,Q,W)}function _(W,G,H,Q){const nt=Q+1,pt=[];for(let ft=0;ft<=nt;ft++){pt[ft]=[];const K=W.clone().lerp(H,ft/nt),ot=G.clone().lerp(H,ft/nt),kt=nt-ft;for(let zt=0;zt<=kt;zt++)zt===0&&ft===nt?pt[ft][zt]=K:pt[ft][zt]=K.clone().lerp(ot,zt/kt)}for(let ft=0;ft<nt;ft++)for(let K=0;K<2*(nt-ft)-1;K++){const ot=Math.floor(K/2);K%2===0?(A(pt[ft][ot+1]),A(pt[ft+1][ot]),A(pt[ft][ot])):(A(pt[ft][ot+1]),A(pt[ft+1][ot+1]),A(pt[ft+1][ot]))}}function v(W){const G=new ut;for(let H=0;H<c.length;H+=3)G.x=c[H+0],G.y=c[H+1],G.z=c[H+2],G.normalize().multiplyScalar(W),c[H+0]=G.x,c[H+1]=G.y,c[H+2]=G.z}function S(){const W=new ut;for(let G=0;G<c.length;G+=3){W.x=c[G+0],W.y=c[G+1],W.z=c[G+2];const H=z(W)/2/Math.PI+.5,Q=L(W)/Math.PI+.5;d.push(H,1-Q)}R(),M()}function M(){for(let W=0;W<d.length;W+=6){const G=d[W+0],H=d[W+2],Q=d[W+4],nt=Math.max(G,H,Q),pt=Math.min(G,H,Q);nt>.9&&pt<.1&&(G<.2&&(d[W+0]+=1),H<.2&&(d[W+2]+=1),Q<.2&&(d[W+4]+=1))}}function A(W){c.push(W.x,W.y,W.z)}function C(W,G){const H=W*3;G.x=t[H+0],G.y=t[H+1],G.z=t[H+2]}function R(){const W=new ut,G=new ut,H=new ut,Q=new ut,nt=new me,pt=new me,ft=new me;for(let K=0,ot=0;K<c.length;K+=9,ot+=6){W.set(c[K+0],c[K+1],c[K+2]),G.set(c[K+3],c[K+4],c[K+5]),H.set(c[K+6],c[K+7],c[K+8]),nt.set(d[ot+0],d[ot+1]),pt.set(d[ot+2],d[ot+3]),ft.set(d[ot+4],d[ot+5]),Q.copy(W).add(G).add(H).divideScalar(3);const kt=z(Q);F(nt,ot+0,W,kt),F(pt,ot+2,G,kt),F(ft,ot+4,H,kt)}}function F(W,G,H,Q){Q<0&&W.x===1&&(d[G]=W.x-1),H.x===0&&H.z===0&&(d[G]=Q/2/Math.PI+.5)}function z(W){return Math.atan2(W.z,-W.x)}function L(W){return Math.atan2(-W.y,Math.sqrt(W.x*W.x+W.z*W.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ia(t.vertices,t.indices,t.radius,t.details)}}class fd extends Ia{constructor(t=1,e=0){const s=(1+Math.sqrt(5))/2,o=1/s,c=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-s,0,-o,s,0,o,-s,0,o,s,-o,-s,0,-o,s,0,o,-s,0,o,s,0,-s,0,-o,s,0,-o,-s,0,o,s,0,o],d=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(c,d,t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new fd(t.radius,t.detail)}}const lp=new ut,hp=new ut,Bg=new ut,cp=new Bs;class u0 extends Ii{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},t!==null){const o=Math.pow(10,4),c=Math.cos(dl*e),d=t.getIndex(),a=t.getAttribute("position"),_=d?d.count:a.count,v=[0,0,0],S=["a","b","c"],M=new Array(3),A={},C=[];for(let R=0;R<_;R+=3){d?(v[0]=d.getX(R),v[1]=d.getX(R+1),v[2]=d.getX(R+2)):(v[0]=R,v[1]=R+1,v[2]=R+2);const{a:F,b:z,c:L}=cp;if(F.fromBufferAttribute(a,v[0]),z.fromBufferAttribute(a,v[1]),L.fromBufferAttribute(a,v[2]),cp.getNormal(Bg),M[0]=`${Math.round(F.x*o)},${Math.round(F.y*o)},${Math.round(F.z*o)}`,M[1]=`${Math.round(z.x*o)},${Math.round(z.y*o)},${Math.round(z.z*o)}`,M[2]=`${Math.round(L.x*o)},${Math.round(L.y*o)},${Math.round(L.z*o)}`,!(M[0]===M[1]||M[1]===M[2]||M[2]===M[0]))for(let W=0;W<3;W++){const G=(W+1)%3,H=M[W],Q=M[G],nt=cp[S[W]],pt=cp[S[G]],ft=`${H}_${Q}`,K=`${Q}_${H}`;K in A&&A[K]?(Bg.dot(A[K].normal)<=c&&(C.push(nt.x,nt.y,nt.z),C.push(pt.x,pt.y,pt.z)),A[K]=null):ft in A||(A[ft]={index0:v[W],index1:v[G],normal:Bg.clone()})}}for(const R in A)if(A[R]){const{index0:F,index1:z}=A[R];lp.fromBufferAttribute(a,F),hp.fromBufferAttribute(a,z),C.push(lp.x,lp.y,lp.z),C.push(hp.x,hp.y,hp.z)}this.setAttribute("position",new ii(C,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class uo extends $u{constructor(t){super(t),this.uuid=er(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let s=0,o=this.holes.length;s<o;s++)e[s]=this.holes[s].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const o=t.holes[e];this.holes.push(o.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,s=this.holes.length;e<s;e++){const o=this.holes[e];t.holes.push(o.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const o=t.holes[e];this.holes.push(new $u().fromJSON(o))}return this}}const F3={triangulate:function(l,t,e=2){const s=t&&t.length,o=s?t[0]*e:l.length;let c=Mb(l,0,o,e,!0);const d=[];if(!c||c.next===c.prev)return d;let a,_,v,S,M,A,C;if(s&&(c=V3(l,t,c,e)),l.length>80*e){a=v=l[0],_=S=l[1];for(let R=e;R<o;R+=e)M=l[R],A=l[R+1],M<a&&(a=M),A<_&&(_=A),M>v&&(v=M),A>S&&(S=A);C=Math.max(v-a,S-_),C=C!==0?32767/C:0}return ju(c,d,e,a,_,C,0),d}};function Mb(l,t,e,s,o){let c,d;if(o===K3(l,t,e,s)>0)for(c=t;c<e;c+=s)d=rx(c,l[c],l[c+1],d);else for(c=e-s;c>=t;c-=s)d=rx(c,l[c],l[c+1],d);return d&&sm(d,d.next)&&(Xu(d),d=d.next),d}function ml(l,t){if(!l)return l;t||(t=l);let e=l,s;do if(s=!1,!e.steiner&&(sm(e,e.next)||yn(e.prev,e,e.next)===0)){if(Xu(e),e=t=e.prev,e===e.next)break;s=!0}else e=e.next;while(s||e!==t);return t}function ju(l,t,e,s,o,c,d){if(!l)return;!d&&c&&$3(l,s,o,c);let a=l,_,v;for(;l.prev!==l.next;){if(_=l.prev,v=l.next,c?O3(l,s,o,c):B3(l)){t.push(_.i/e|0),t.push(l.i/e|0),t.push(v.i/e|0),Xu(l),l=v.next,a=v.next;continue}if(l=v,l===a){d?d===1?(l=N3(ml(l),t,e),ju(l,t,e,s,o,c,2)):d===2&&U3(l,t,e,s,o,c):ju(ml(l),t,e,s,o,c,1);break}}}function B3(l){const t=l.prev,e=l,s=l.next;if(yn(t,e,s)>=0)return!1;const o=t.x,c=e.x,d=s.x,a=t.y,_=e.y,v=s.y,S=o<c?o<d?o:d:c<d?c:d,M=a<_?a<v?a:v:_<v?_:v,A=o>c?o>d?o:d:c>d?c:d,C=a>_?a>v?a:v:_>v?_:v;let R=s.next;for(;R!==t;){if(R.x>=S&&R.x<=A&&R.y>=M&&R.y<=C&&Rh(o,a,c,_,d,v,R.x,R.y)&&yn(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function O3(l,t,e,s){const o=l.prev,c=l,d=l.next;if(yn(o,c,d)>=0)return!1;const a=o.x,_=c.x,v=d.x,S=o.y,M=c.y,A=d.y,C=a<_?a<v?a:v:_<v?_:v,R=S<M?S<A?S:A:M<A?M:A,F=a>_?a>v?a:v:_>v?_:v,z=S>M?S>A?S:A:M>A?M:A,L=E_(C,R,t,e,s),W=E_(F,z,t,e,s);let G=l.prevZ,H=l.nextZ;for(;G&&G.z>=L&&H&&H.z<=W;){if(G.x>=C&&G.x<=F&&G.y>=R&&G.y<=z&&G!==o&&G!==d&&Rh(a,S,_,M,v,A,G.x,G.y)&&yn(G.prev,G,G.next)>=0||(G=G.prevZ,H.x>=C&&H.x<=F&&H.y>=R&&H.y<=z&&H!==o&&H!==d&&Rh(a,S,_,M,v,A,H.x,H.y)&&yn(H.prev,H,H.next)>=0))return!1;H=H.nextZ}for(;G&&G.z>=L;){if(G.x>=C&&G.x<=F&&G.y>=R&&G.y<=z&&G!==o&&G!==d&&Rh(a,S,_,M,v,A,G.x,G.y)&&yn(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;H&&H.z<=W;){if(H.x>=C&&H.x<=F&&H.y>=R&&H.y<=z&&H!==o&&H!==d&&Rh(a,S,_,M,v,A,H.x,H.y)&&yn(H.prev,H,H.next)>=0)return!1;H=H.nextZ}return!0}function N3(l,t,e){let s=l;do{const o=s.prev,c=s.next.next;!sm(o,c)&&Sb(o,s,s.next,c)&&Zu(o,c)&&Zu(c,o)&&(t.push(o.i/e|0),t.push(s.i/e|0),t.push(c.i/e|0),Xu(s),Xu(s.next),s=l=c),s=s.next}while(s!==l);return ml(s)}function U3(l,t,e,s,o,c){let d=l;do{let a=d.next.next;for(;a!==d.prev;){if(d.i!==a.i&&X3(d,a)){let _=Ab(d,a);d=ml(d,d.next),_=ml(_,_.next),ju(d,t,e,s,o,c,0),ju(_,t,e,s,o,c,0);return}a=a.next}d=d.next}while(d!==l)}function V3(l,t,e,s){const o=[];let c,d,a,_,v;for(c=0,d=t.length;c<d;c++)a=t[c]*s,_=c<d-1?t[c+1]*s:l.length,v=Mb(l,a,_,s,!1),v===v.next&&(v.steiner=!0),o.push(Z3(v));for(o.sort(G3),c=0;c<o.length;c++)e=H3(o[c],e);return e}function G3(l,t){return l.x-t.x}function H3(l,t){const e=W3(l,t);if(!e)return t;const s=Ab(e,l);return ml(s,s.next),ml(e,e.next)}function W3(l,t){let e=t,s=-1/0,o;const c=l.x,d=l.y;do{if(d<=e.y&&d>=e.next.y&&e.next.y!==e.y){const A=e.x+(d-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(A<=c&&A>s&&(s=A,o=e.x<e.next.x?e:e.next,A===c))return o}e=e.next}while(e!==t);if(!o)return null;const a=o,_=o.x,v=o.y;let S=1/0,M;e=o;do c>=e.x&&e.x>=_&&c!==e.x&&Rh(d<v?c:s,d,_,v,d<v?s:c,d,e.x,e.y)&&(M=Math.abs(d-e.y)/(c-e.x),Zu(e,l)&&(M<S||M===S&&(e.x>o.x||e.x===o.x&&q3(o,e)))&&(o=e,S=M)),e=e.next;while(e!==a);return o}function q3(l,t){return yn(l.prev,l,t.prev)<0&&yn(t.next,l,l.next)<0}function $3(l,t,e,s){let o=l;do o.z===0&&(o.z=E_(o.x,o.y,t,e,s)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==l);o.prevZ.nextZ=null,o.prevZ=null,j3(o)}function j3(l){let t,e,s,o,c,d,a,_,v=1;do{for(e=l,l=null,c=null,d=0;e;){for(d++,s=e,a=0,t=0;t<v&&(a++,s=s.nextZ,!!s);t++);for(_=v;a>0||_>0&&s;)a!==0&&(_===0||!s||e.z<=s.z)?(o=e,e=e.nextZ,a--):(o=s,s=s.nextZ,_--),c?c.nextZ=o:l=o,o.prevZ=c,c=o;e=s}c.nextZ=null,v*=2}while(d>1);return l}function E_(l,t,e,s,o){return l=(l-e)*o|0,t=(t-s)*o|0,l=(l|l<<8)&16711935,l=(l|l<<4)&252645135,l=(l|l<<2)&858993459,l=(l|l<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,l|t<<1}function Z3(l){let t=l,e=l;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==l);return e}function Rh(l,t,e,s,o,c,d,a){return(o-d)*(t-a)>=(l-d)*(c-a)&&(l-d)*(s-a)>=(e-d)*(t-a)&&(e-d)*(c-a)>=(o-d)*(s-a)}function X3(l,t){return l.next.i!==t.i&&l.prev.i!==t.i&&!Y3(l,t)&&(Zu(l,t)&&Zu(t,l)&&J3(l,t)&&(yn(l.prev,l,t.prev)||yn(l,t.prev,t))||sm(l,t)&&yn(l.prev,l,l.next)>0&&yn(t.prev,t,t.next)>0)}function yn(l,t,e){return(t.y-l.y)*(e.x-t.x)-(t.x-l.x)*(e.y-t.y)}function sm(l,t){return l.x===t.x&&l.y===t.y}function Sb(l,t,e,s){const o=dp(yn(l,t,e)),c=dp(yn(l,t,s)),d=dp(yn(e,s,l)),a=dp(yn(e,s,t));return!!(o!==c&&d!==a||o===0&&up(l,e,t)||c===0&&up(l,s,t)||d===0&&up(e,l,s)||a===0&&up(e,t,s))}function up(l,t,e){return t.x<=Math.max(l.x,e.x)&&t.x>=Math.min(l.x,e.x)&&t.y<=Math.max(l.y,e.y)&&t.y>=Math.min(l.y,e.y)}function dp(l){return l>0?1:l<0?-1:0}function Y3(l,t){let e=l;do{if(e.i!==l.i&&e.next.i!==l.i&&e.i!==t.i&&e.next.i!==t.i&&Sb(e,e.next,l,t))return!0;e=e.next}while(e!==l);return!1}function Zu(l,t){return yn(l.prev,l,l.next)<0?yn(l,t,l.next)>=0&&yn(l,l.prev,t)>=0:yn(l,t,l.prev)<0||yn(l,l.next,t)<0}function J3(l,t){let e=l,s=!1;const o=(l.x+t.x)/2,c=(l.y+t.y)/2;do e.y>c!=e.next.y>c&&e.next.y!==e.y&&o<(e.next.x-e.x)*(c-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next;while(e!==l);return s}function Ab(l,t){const e=new C_(l.i,l.x,l.y),s=new C_(t.i,t.x,t.y),o=l.next,c=t.prev;return l.next=t,t.prev=l,e.next=o,o.prev=e,s.next=e,e.prev=s,c.next=s,s.prev=c,s}function rx(l,t,e,s){const o=new C_(l,t,e);return s?(o.next=s.next,o.prev=s,s.next.prev=o,s.next=o):(o.prev=o,o.next=o),o}function Xu(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function C_(l,t,e){this.i=l,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function K3(l,t,e,s){let o=0;for(let c=t,d=e-s;c<e;c+=s)o+=(l[d]-l[c])*(l[c+1]+l[d+1]),d=c;return o}class Wr{static area(t){const e=t.length;let s=0;for(let o=e-1,c=0;c<e;o=c++)s+=t[o].x*t[c].y-t[c].x*t[o].y;return s*.5}static isClockWise(t){return Wr.area(t)<0}static triangulateShape(t,e){const s=[],o=[],c=[];ax(t),ox(s,t);let d=t.length;e.forEach(ax);for(let _=0;_<e.length;_++)o.push(d),d+=e[_].length,ox(s,e[_]);const a=F3.triangulate(s,o);for(let _=0;_<a.length;_+=3)c.push(a.slice(_,_+3));return c}}function ax(l){const t=l.length;t>2&&l[t-1].equals(l[0])&&l.pop()}function ox(l,t){for(let e=0;e<t.length;e++)l.push(t[e].x),l.push(t[e].y)}class Qh extends Ii{constructor(t=new uo([new me(.5,.5),new me(-.5,.5),new me(-.5,-.5),new me(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const s=this,o=[],c=[];for(let a=0,_=t.length;a<_;a++){const v=t[a];d(v)}this.setAttribute("position",new ii(o,3)),this.setAttribute("uv",new ii(c,2)),this.computeVertexNormals();function d(a){const _=[],v=e.curveSegments!==void 0?e.curveSegments:12,S=e.steps!==void 0?e.steps:1,M=e.depth!==void 0?e.depth:1;let A=e.bevelEnabled!==void 0?e.bevelEnabled:!0,C=e.bevelThickness!==void 0?e.bevelThickness:.2,R=e.bevelSize!==void 0?e.bevelSize:C-.1,F=e.bevelOffset!==void 0?e.bevelOffset:0,z=e.bevelSegments!==void 0?e.bevelSegments:3;const L=e.extrudePath,W=e.UVGenerator!==void 0?e.UVGenerator:Q3;let G,H=!1,Q,nt,pt,ft;L&&(G=L.getSpacedPoints(S),H=!0,A=!1,Q=L.computeFrenetFrames(S,!1),nt=new ut,pt=new ut,ft=new ut),A||(z=0,C=0,R=0,F=0);const K=a.extractPoints(v);let ot=K.shape;const kt=K.holes;if(!Wr.isClockWise(ot)){ot=ot.reverse();for(let le=0,Kt=kt.length;le<Kt;le++){const he=kt[le];Wr.isClockWise(he)&&(kt[le]=he.reverse())}}const It=Wr.triangulateShape(ot,kt),Dt=ot;for(let le=0,Kt=kt.length;le<Kt;le++){const he=kt[le];ot=ot.concat(he)}function Wt(le,Kt,he){return Kt||console.error("THREE.ExtrudeGeometry: vec does not exist"),le.clone().addScaledVector(Kt,he)}const se=ot.length,ce=It.length;function ie(le,Kt,he){let Ee,Ce,Pt;const ai=le.x-Kt.x,ni=le.y-Kt.y,Oe=he.x-le.x,gi=he.y-le.y,mt=ai*ai+ni*ni,rt=ai*gi-ni*Oe;if(Math.abs(rt)>Number.EPSILON){const $t=Math.sqrt(mt),pe=Math.sqrt(Oe*Oe+gi*gi),ye=Kt.x-ni/$t,ke=Kt.y+ai/$t,ui=he.x-gi/pe,Ut=he.y+Oe/pe,Zt=((ui-ye)*gi-(Ut-ke)*Oe)/(ai*gi-ni*Oe);Ee=ye+ai*Zt-le.x,Ce=ke+ni*Zt-le.y;const Ge=Ee*Ee+Ce*Ce;if(Ge<=2)return new me(Ee,Ce);Pt=Math.sqrt(Ge/2)}else{let $t=!1;ai>Number.EPSILON?Oe>Number.EPSILON&&($t=!0):ai<-Number.EPSILON?Oe<-Number.EPSILON&&($t=!0):Math.sign(ni)===Math.sign(gi)&&($t=!0),$t?(Ee=-ni,Ce=ai,Pt=Math.sqrt(mt)):(Ee=ai,Ce=ni,Pt=Math.sqrt(mt/2))}return new me(Ee/Pt,Ce/Pt)}const be=[];for(let le=0,Kt=Dt.length,he=Kt-1,Ee=le+1;le<Kt;le++,he++,Ee++)he===Kt&&(he=0),Ee===Kt&&(Ee=0),be[le]=ie(Dt[le],Dt[he],Dt[Ee]);const de=[];let $e,_e=be.concat();for(let le=0,Kt=kt.length;le<Kt;le++){const he=kt[le];$e=[];for(let Ee=0,Ce=he.length,Pt=Ce-1,ai=Ee+1;Ee<Ce;Ee++,Pt++,ai++)Pt===Ce&&(Pt=0),ai===Ce&&(ai=0),$e[Ee]=ie(he[Ee],he[Pt],he[ai]);de.push($e),_e=_e.concat($e)}for(let le=0;le<z;le++){const Kt=le/z,he=C*Math.cos(Kt*Math.PI/2),Ee=R*Math.sin(Kt*Math.PI/2)+F;for(let Ce=0,Pt=Dt.length;Ce<Pt;Ce++){const ai=Wt(Dt[Ce],be[Ce],Ee);Gt(ai.x,ai.y,-he)}for(let Ce=0,Pt=kt.length;Ce<Pt;Ce++){const ai=kt[Ce];$e=de[Ce];for(let ni=0,Oe=ai.length;ni<Oe;ni++){const gi=Wt(ai[ni],$e[ni],Ee);Gt(gi.x,gi.y,-he)}}}const Yt=R+F;for(let le=0;le<se;le++){const Kt=A?Wt(ot[le],_e[le],Yt):ot[le];H?(pt.copy(Q.normals[0]).multiplyScalar(Kt.x),nt.copy(Q.binormals[0]).multiplyScalar(Kt.y),ft.copy(G[0]).add(pt).add(nt),Gt(ft.x,ft.y,ft.z)):Gt(Kt.x,Kt.y,0)}for(let le=1;le<=S;le++)for(let Kt=0;Kt<se;Kt++){const he=A?Wt(ot[Kt],_e[Kt],Yt):ot[Kt];H?(pt.copy(Q.normals[le]).multiplyScalar(he.x),nt.copy(Q.binormals[le]).multiplyScalar(he.y),ft.copy(G[le]).add(pt).add(nt),Gt(ft.x,ft.y,ft.z)):Gt(he.x,he.y,M/S*le)}for(let le=z-1;le>=0;le--){const Kt=le/z,he=C*Math.cos(Kt*Math.PI/2),Ee=R*Math.sin(Kt*Math.PI/2)+F;for(let Ce=0,Pt=Dt.length;Ce<Pt;Ce++){const ai=Wt(Dt[Ce],be[Ce],Ee);Gt(ai.x,ai.y,M+he)}for(let Ce=0,Pt=kt.length;Ce<Pt;Ce++){const ai=kt[Ce];$e=de[Ce];for(let ni=0,Oe=ai.length;ni<Oe;ni++){const gi=Wt(ai[ni],$e[ni],Ee);H?Gt(gi.x,gi.y+G[S-1].y,G[S-1].x+he):Gt(gi.x,gi.y,M+he)}}}re(),Re();function re(){const le=o.length/3;if(A){let Kt=0,he=se*Kt;for(let Ee=0;Ee<ce;Ee++){const Ce=It[Ee];ei(Ce[2]+he,Ce[1]+he,Ce[0]+he)}Kt=S+z*2,he=se*Kt;for(let Ee=0;Ee<ce;Ee++){const Ce=It[Ee];ei(Ce[0]+he,Ce[1]+he,Ce[2]+he)}}else{for(let Kt=0;Kt<ce;Kt++){const he=It[Kt];ei(he[2],he[1],he[0])}for(let Kt=0;Kt<ce;Kt++){const he=It[Kt];ei(he[0]+se*S,he[1]+se*S,he[2]+se*S)}}s.addGroup(le,o.length/3-le,0)}function Re(){const le=o.length/3;let Kt=0;Fe(Dt,Kt),Kt+=Dt.length;for(let he=0,Ee=kt.length;he<Ee;he++){const Ce=kt[he];Fe(Ce,Kt),Kt+=Ce.length}s.addGroup(le,o.length/3-le,1)}function Fe(le,Kt){let he=le.length;for(;--he>=0;){const Ee=he;let Ce=he-1;Ce<0&&(Ce=le.length-1);for(let Pt=0,ai=S+z*2;Pt<ai;Pt++){const ni=se*Pt,Oe=se*(Pt+1),gi=Kt+Ee+ni,mt=Kt+Ce+ni,rt=Kt+Ce+Oe,$t=Kt+Ee+Oe;ci(gi,mt,rt,$t)}}}function Gt(le,Kt,he){_.push(le),_.push(Kt),_.push(he)}function ei(le,Kt,he){xe(le),xe(Kt),xe(he);const Ee=o.length/3,Ce=W.generateTopUV(s,o,Ee-3,Ee-2,Ee-1);Qe(Ce[0]),Qe(Ce[1]),Qe(Ce[2])}function ci(le,Kt,he,Ee){xe(le),xe(Kt),xe(Ee),xe(Kt),xe(he),xe(Ee);const Ce=o.length/3,Pt=W.generateSideWallUV(s,o,Ce-6,Ce-3,Ce-2,Ce-1);Qe(Pt[0]),Qe(Pt[1]),Qe(Pt[3]),Qe(Pt[1]),Qe(Pt[2]),Qe(Pt[3])}function xe(le){o.push(_[le*3+0]),o.push(_[le*3+1]),o.push(_[le*3+2])}function Qe(le){c.push(le.x),c.push(le.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,s=this.parameters.options;return tI(e,s,t)}static fromJSON(t,e){const s=[];for(let c=0,d=t.shapes.length;c<d;c++){const a=e[t.shapes[c]];s.push(a)}const o=t.options.extrudePath;return o!==void 0&&(t.options.extrudePath=new c0[o.type]().fromJSON(o)),new Qh(s,t.options)}}const Q3={generateTopUV:function(l,t,e,s,o){const c=t[e*3],d=t[e*3+1],a=t[s*3],_=t[s*3+1],v=t[o*3],S=t[o*3+1];return[new me(c,d),new me(a,_),new me(v,S)]},generateSideWallUV:function(l,t,e,s,o,c){const d=t[e*3],a=t[e*3+1],_=t[e*3+2],v=t[s*3],S=t[s*3+1],M=t[s*3+2],A=t[o*3],C=t[o*3+1],R=t[o*3+2],F=t[c*3],z=t[c*3+1],L=t[c*3+2];return Math.abs(a-S)<Math.abs(d-v)?[new me(d,1-_),new me(v,1-M),new me(A,1-R),new me(F,1-L)]:[new me(a,1-_),new me(S,1-M),new me(C,1-R),new me(z,1-L)]}};function tI(l,t,e){if(e.shapes=[],Array.isArray(l))for(let s=0,o=l.length;s<o;s++){const c=l[s];e.shapes.push(c.uuid)}else e.shapes.push(l.uuid);return e.options=Object.assign({},t),t.extrudePath!==void 0&&(e.options.extrudePath=t.extrudePath.toJSON()),e}class pd extends Ia{constructor(t=1,e=0){const s=(1+Math.sqrt(5))/2,o=[-1,s,0,1,s,0,-1,-s,0,1,-s,0,0,-1,s,0,1,s,0,-1,-s,0,1,-s,s,0,-1,s,0,1,-s,0,-1,-s,0,1],c=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(o,c,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new pd(t.radius,t.detail)}}class tc extends Ia{constructor(t=1,e=0){const s=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],o=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(s,o,t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new tc(t.radius,t.detail)}}class md extends Ii{constructor(t=.5,e=1,s=32,o=1,c=0,d=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:s,phiSegments:o,thetaStart:c,thetaLength:d},s=Math.max(3,s),o=Math.max(1,o);const a=[],_=[],v=[],S=[];let M=t;const A=(e-t)/o,C=new ut,R=new me;for(let F=0;F<=o;F++){for(let z=0;z<=s;z++){const L=c+z/s*d;C.x=M*Math.cos(L),C.y=M*Math.sin(L),_.push(C.x,C.y,C.z),v.push(0,0,1),R.x=(C.x/e+1)/2,R.y=(C.y/e+1)/2,S.push(R.x,R.y)}M+=A}for(let F=0;F<o;F++){const z=F*(s+1);for(let L=0;L<s;L++){const W=L+z,G=W,H=W+s+1,Q=W+s+2,nt=W+1;a.push(G,H,nt),a.push(H,Q,nt)}}this.setIndex(a),this.setAttribute("position",new ii(_,3)),this.setAttribute("normal",new ii(v,3)),this.setAttribute("uv",new ii(S,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new md(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class gd extends Ii{constructor(t=new uo([new me(0,.5),new me(-.5,-.5),new me(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const s=[],o=[],c=[],d=[];let a=0,_=0;if(Array.isArray(t)===!1)v(t);else for(let S=0;S<t.length;S++)v(t[S]),this.addGroup(a,_,S),a+=_,_=0;this.setIndex(s),this.setAttribute("position",new ii(o,3)),this.setAttribute("normal",new ii(c,3)),this.setAttribute("uv",new ii(d,2));function v(S){const M=o.length/3,A=S.extractPoints(e);let C=A.shape;const R=A.holes;Wr.isClockWise(C)===!1&&(C=C.reverse());for(let z=0,L=R.length;z<L;z++){const W=R[z];Wr.isClockWise(W)===!0&&(R[z]=W.reverse())}const F=Wr.triangulateShape(C,R);for(let z=0,L=R.length;z<L;z++){const W=R[z];C=C.concat(W)}for(let z=0,L=C.length;z<L;z++){const W=C[z];o.push(W.x,W.y,0),c.push(0,0,1),d.push(W.x,W.y)}for(let z=0,L=F.length;z<L;z++){const W=F[z],G=W[0]+M,H=W[1]+M,Q=W[2]+M;s.push(G,H,Q),_+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return eI(e,t)}static fromJSON(t,e){const s=[];for(let o=0,c=t.shapes.length;o<c;o++){const d=e[t.shapes[o]];s.push(d)}return new gd(s,t.curveSegments)}}function eI(l,t){if(t.shapes=[],Array.isArray(l))for(let e=0,s=l.length;e<s;e++){const o=l[e];t.shapes.push(o.uuid)}else t.shapes.push(l.uuid);return t}class ec extends Ii{constructor(t=1,e=32,s=16,o=0,c=Math.PI*2,d=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:s,phiStart:o,phiLength:c,thetaStart:d,thetaLength:a},e=Math.max(3,Math.floor(e)),s=Math.max(2,Math.floor(s));const _=Math.min(d+a,Math.PI);let v=0;const S=[],M=new ut,A=new ut,C=[],R=[],F=[],z=[];for(let L=0;L<=s;L++){const W=[],G=L/s;let H=0;L===0&&d===0?H=.5/e:L===s&&_===Math.PI&&(H=-.5/e);for(let Q=0;Q<=e;Q++){const nt=Q/e;M.x=-t*Math.cos(o+nt*c)*Math.sin(d+G*a),M.y=t*Math.cos(d+G*a),M.z=t*Math.sin(o+nt*c)*Math.sin(d+G*a),R.push(M.x,M.y,M.z),A.copy(M).normalize(),F.push(A.x,A.y,A.z),z.push(nt+H,1-G),W.push(v++)}S.push(W)}for(let L=0;L<s;L++)for(let W=0;W<e;W++){const G=S[L][W+1],H=S[L][W],Q=S[L+1][W],nt=S[L+1][W+1];(L!==0||d>0)&&C.push(G,H,nt),(L!==s-1||_<Math.PI)&&C.push(H,Q,nt)}this.setIndex(C),this.setAttribute("position",new ii(R,3)),this.setAttribute("normal",new ii(F,3)),this.setAttribute("uv",new ii(z,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ec(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class _d extends Ia{constructor(t=1,e=0){const s=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],o=[2,1,0,0,3,2,1,3,0,2,3,1];super(s,o,t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new _d(t.radius,t.detail)}}class yd extends Ii{constructor(t=1,e=.4,s=12,o=48,c=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:s,tubularSegments:o,arc:c},s=Math.floor(s),o=Math.floor(o);const d=[],a=[],_=[],v=[],S=new ut,M=new ut,A=new ut;for(let C=0;C<=s;C++)for(let R=0;R<=o;R++){const F=R/o*c,z=C/s*Math.PI*2;M.x=(t+e*Math.cos(z))*Math.cos(F),M.y=(t+e*Math.cos(z))*Math.sin(F),M.z=e*Math.sin(z),a.push(M.x,M.y,M.z),S.x=t*Math.cos(F),S.y=t*Math.sin(F),A.subVectors(M,S).normalize(),_.push(A.x,A.y,A.z),v.push(R/o),v.push(C/s)}for(let C=1;C<=s;C++)for(let R=1;R<=o;R++){const F=(o+1)*C+R-1,z=(o+1)*(C-1)+R-1,L=(o+1)*(C-1)+R,W=(o+1)*C+R;d.push(F,z,W),d.push(z,L,W)}this.setIndex(d),this.setAttribute("position",new ii(a,3)),this.setAttribute("normal",new ii(_,3)),this.setAttribute("uv",new ii(v,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new yd(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class vd extends Ii{constructor(t=1,e=.4,s=64,o=8,c=2,d=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:s,radialSegments:o,p:c,q:d},s=Math.floor(s),o=Math.floor(o);const a=[],_=[],v=[],S=[],M=new ut,A=new ut,C=new ut,R=new ut,F=new ut,z=new ut,L=new ut;for(let G=0;G<=s;++G){const H=G/s*c*Math.PI*2;W(H,c,d,t,C),W(H+.01,c,d,t,R),z.subVectors(R,C),L.addVectors(R,C),F.crossVectors(z,L),L.crossVectors(F,z),F.normalize(),L.normalize();for(let Q=0;Q<=o;++Q){const nt=Q/o*Math.PI*2,pt=-e*Math.cos(nt),ft=e*Math.sin(nt);M.x=C.x+(pt*L.x+ft*F.x),M.y=C.y+(pt*L.y+ft*F.y),M.z=C.z+(pt*L.z+ft*F.z),_.push(M.x,M.y,M.z),A.subVectors(M,C).normalize(),v.push(A.x,A.y,A.z),S.push(G/s),S.push(Q/o)}}for(let G=1;G<=s;G++)for(let H=1;H<=o;H++){const Q=(o+1)*(G-1)+(H-1),nt=(o+1)*G+(H-1),pt=(o+1)*G+H,ft=(o+1)*(G-1)+H;a.push(Q,nt,ft),a.push(nt,pt,ft)}this.setIndex(a),this.setAttribute("position",new ii(_,3)),this.setAttribute("normal",new ii(v,3)),this.setAttribute("uv",new ii(S,2));function W(G,H,Q,nt,pt){const ft=Math.cos(G),K=Math.sin(G),ot=Q/H*G,kt=Math.cos(ot);pt.x=nt*(2+kt)*.5*ft,pt.y=nt*(2+kt)*K*.5,pt.z=nt*Math.sin(ot)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new vd(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class xd extends Ii{constructor(t=new l0(new ut(-1,-1,0),new ut(-1,1,0),new ut(1,1,0)),e=64,s=1,o=8,c=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:s,radialSegments:o,closed:c};const d=t.computeFrenetFrames(e,c);this.tangents=d.tangents,this.normals=d.normals,this.binormals=d.binormals;const a=new ut,_=new ut,v=new me;let S=new ut;const M=[],A=[],C=[],R=[];F(),this.setIndex(R),this.setAttribute("position",new ii(M,3)),this.setAttribute("normal",new ii(A,3)),this.setAttribute("uv",new ii(C,2));function F(){for(let G=0;G<e;G++)z(G);z(c===!1?e:0),W(),L()}function z(G){S=t.getPointAt(G/e,S);const H=d.normals[G],Q=d.binormals[G];for(let nt=0;nt<=o;nt++){const pt=nt/o*Math.PI*2,ft=Math.sin(pt),K=-Math.cos(pt);_.x=K*H.x+ft*Q.x,_.y=K*H.y+ft*Q.y,_.z=K*H.z+ft*Q.z,_.normalize(),A.push(_.x,_.y,_.z),a.x=S.x+s*_.x,a.y=S.y+s*_.y,a.z=S.z+s*_.z,M.push(a.x,a.y,a.z)}}function L(){for(let G=1;G<=e;G++)for(let H=1;H<=o;H++){const Q=(o+1)*(G-1)+(H-1),nt=(o+1)*G+(H-1),pt=(o+1)*G+H,ft=(o+1)*(G-1)+H;R.push(Q,nt,ft),R.push(nt,pt,ft)}}function W(){for(let G=0;G<=e;G++)for(let H=0;H<=o;H++)v.x=G/e,v.y=H/o,C.push(v.x,v.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new xd(new c0[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Tb extends Ii{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const e=[],s=new Set,o=new ut,c=new ut;if(t.index!==null){const d=t.attributes.position,a=t.index;let _=t.groups;_.length===0&&(_=[{start:0,count:a.count,materialIndex:0}]);for(let v=0,S=_.length;v<S;++v){const M=_[v],A=M.start,C=M.count;for(let R=A,F=A+C;R<F;R+=3)for(let z=0;z<3;z++){const L=a.getX(R+z),W=a.getX(R+(z+1)%3);o.fromBufferAttribute(d,L),c.fromBufferAttribute(d,W),lx(o,c,s)===!0&&(e.push(o.x,o.y,o.z),e.push(c.x,c.y,c.z))}}}else{const d=t.attributes.position;for(let a=0,_=d.count/3;a<_;a++)for(let v=0;v<3;v++){const S=3*a+v,M=3*a+(v+1)%3;o.fromBufferAttribute(d,S),c.fromBufferAttribute(d,M),lx(o,c,s)===!0&&(e.push(o.x,o.y,o.z),e.push(c.x,c.y,c.z))}}this.setAttribute("position",new ii(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function lx(l,t,e){const s=`${l.x},${l.y},${l.z}-${t.x},${t.y},${t.z}`,o=`${t.x},${t.y},${t.z}-${l.x},${l.y},${l.z}`;return e.has(s)===!0||e.has(o)===!0?!1:(e.add(s),e.add(o),!0)}var hx=Object.freeze({__proto__:null,BoxGeometry:So,CapsuleGeometry:cd,CircleGeometry:ud,ConeGeometry:dd,CylinderGeometry:vl,DodecahedronGeometry:fd,EdgesGeometry:u0,ExtrudeGeometry:Qh,IcosahedronGeometry:pd,LatheGeometry:Kh,OctahedronGeometry:tc,PlaneGeometry:Yh,PolyhedronGeometry:Ia,RingGeometry:md,ShapeGeometry:gd,SphereGeometry:ec,TetrahedronGeometry:_d,TorusGeometry:yd,TorusKnotGeometry:vd,TubeGeometry:xd,WireframeGeometry:Tb});class Eb extends _s{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Je(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Cb extends jr{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class d0 extends _s{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Je(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wo,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Ib extends d0{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new me(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return wn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Je(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Je(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Je(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Pb extends _s{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Je(16777215),this.specular=new Je(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wo,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=rd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Lb extends _s{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Je(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wo,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Rb extends _s{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wo,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Db extends _s{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Je(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wo,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=rd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class zb extends _s{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Je(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wo,this.normalScale=new me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class kb extends ys{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function pr(l,t,e){return f0(l)?new l.constructor(l.subarray(t,e!==void 0?e:l.length)):l.slice(t,e)}function hl(l,t,e){return!l||!e&&l.constructor===t?l:typeof t.BYTES_PER_ELEMENT=="number"?new t(l):Array.prototype.slice.call(l)}function f0(l){return ArrayBuffer.isView(l)&&!(l instanceof DataView)}function Fb(l){function t(o,c){return l[o]-l[c]}const e=l.length,s=new Array(e);for(let o=0;o!==e;++o)s[o]=o;return s.sort(t),s}function I_(l,t,e){const s=l.length,o=new l.constructor(s);for(let c=0,d=0;d!==s;++c){const a=e[c]*t;for(let _=0;_!==t;++_)o[d++]=l[a+_]}return o}function p0(l,t,e,s){let o=1,c=l[0];for(;c!==void 0&&c[s]===void 0;)c=l[o++];if(c===void 0)return;let d=c[s];if(d!==void 0)if(Array.isArray(d))do d=c[s],d!==void 0&&(t.push(c.time),e.push.apply(e,d)),c=l[o++];while(c!==void 0);else if(d.toArray!==void 0)do d=c[s],d!==void 0&&(t.push(c.time),d.toArray(e,e.length)),c=l[o++];while(c!==void 0);else do d=c[s],d!==void 0&&(t.push(c.time),e.push(d)),c=l[o++];while(c!==void 0)}function iI(l,t,e,s,o=30){const c=l.clone();c.name=t;const d=[];for(let _=0;_<c.tracks.length;++_){const v=c.tracks[_],S=v.getValueSize(),M=[],A=[];for(let C=0;C<v.times.length;++C){const R=v.times[C]*o;if(!(R<e||R>=s)){M.push(v.times[C]);for(let F=0;F<S;++F)A.push(v.values[C*S+F])}}M.length!==0&&(v.times=hl(M,v.times.constructor),v.values=hl(A,v.values.constructor),d.push(v))}c.tracks=d;let a=1/0;for(let _=0;_<c.tracks.length;++_)a>c.tracks[_].times[0]&&(a=c.tracks[_].times[0]);for(let _=0;_<c.tracks.length;++_)c.tracks[_].shift(-1*a);return c.resetDuration(),c}function nI(l,t=0,e=l,s=30){s<=0&&(s=30);const o=e.tracks.length,c=t/s;for(let d=0;d<o;++d){const a=e.tracks[d],_=a.ValueTypeName;if(_==="bool"||_==="string")continue;const v=l.tracks.find(function(L){return L.name===a.name&&L.ValueTypeName===_});if(v===void 0)continue;let S=0;const M=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(S=M/3);let A=0;const C=v.getValueSize();v.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(A=C/3);const R=a.times.length-1;let F;if(c<=a.times[0]){const L=S,W=M-S;F=pr(a.values,L,W)}else if(c>=a.times[R]){const L=R*M+S,W=L+M-S;F=pr(a.values,L,W)}else{const L=a.createInterpolant(),W=S,G=M-S;L.evaluate(c),F=pr(L.resultBuffer,W,G)}_==="quaternion"&&new Os().fromArray(F).normalize().conjugate().toArray(F);const z=v.times.length;for(let L=0;L<z;++L){const W=L*C+A;if(_==="quaternion")Os.multiplyQuaternionsFlat(v.values,W,F,0,v.values,W);else{const G=C-A*2;for(let H=0;H<G;++H)v.values[W+H]-=F[H]}}}return l.blendMode=W_,l}const sI={arraySlice:pr,convertArray:hl,isTypedArray:f0,getKeyframeOrder:Fb,sortedArray:I_,flattenJSON:p0,subclip:iI,makeClipAdditive:nI};class bd{constructor(t,e,s,o){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=o!==void 0?o:new e.constructor(s),this.sampleValues=e,this.valueSize=s,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let s=this._cachedIndex,o=e[s],c=e[s-1];t:{e:{let d;i:{n:if(!(t<o)){for(let a=s+2;;){if(o===void 0){if(t<c)break n;return s=e.length,this._cachedIndex=s,this.copySampleValue_(s-1)}if(s===a)break;if(c=o,o=e[++s],t<o)break e}d=e.length;break i}if(!(t>=c)){const a=e[1];t<a&&(s=2,c=a);for(let _=s-2;;){if(c===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===_)break;if(o=c,c=e[--s-1],t>=c)break e}d=s,s=0;break i}break t}for(;s<d;){const a=s+d>>>1;t<e[a]?d=a:s=a+1}if(o=e[s],c=e[s-1],c===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(o===void 0)return s=e.length,this._cachedIndex=s,this.copySampleValue_(s-1)}this._cachedIndex=s,this.intervalChanged_(s,c,o)}return this.interpolate_(s,c,t,o)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,s=this.sampleValues,o=this.valueSize,c=t*o;for(let d=0;d!==o;++d)e[d]=s[c+d];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Bb extends bd{constructor(t,e,s,o){super(t,e,s,o),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:rl,endingEnd:rl}}intervalChanged_(t,e,s){const o=this.parameterPositions;let c=t-2,d=t+1,a=o[c],_=o[d];if(a===void 0)switch(this.getSettings_().endingStart){case al:c=t,a=2*e-s;break;case Hu:c=o.length-2,a=e+o[c]-o[c+1];break;default:c=t,a=s}if(_===void 0)switch(this.getSettings_().endingEnd){case al:d=t,_=2*s-e;break;case Hu:d=1,_=s+o[1]-o[0];break;default:d=t-1,_=e}const v=(s-e)*.5,S=this.valueSize;this._weightPrev=v/(e-a),this._weightNext=v/(_-s),this._offsetPrev=c*S,this._offsetNext=d*S}interpolate_(t,e,s,o){const c=this.resultBuffer,d=this.sampleValues,a=this.valueSize,_=t*a,v=_-a,S=this._offsetPrev,M=this._offsetNext,A=this._weightPrev,C=this._weightNext,R=(s-e)/(o-e),F=R*R,z=F*R,L=-A*z+2*A*F-A*R,W=(1+A)*z+(-1.5-2*A)*F+(-.5+A)*R+1,G=(-1-C)*z+(1.5+C)*F+.5*R,H=C*z-C*F;for(let Q=0;Q!==a;++Q)c[Q]=L*d[S+Q]+W*d[v+Q]+G*d[_+Q]+H*d[M+Q];return c}}class m0 extends bd{constructor(t,e,s,o){super(t,e,s,o)}interpolate_(t,e,s,o){const c=this.resultBuffer,d=this.sampleValues,a=this.valueSize,_=t*a,v=_-a,S=(s-e)/(o-e),M=1-S;for(let A=0;A!==a;++A)c[A]=d[v+A]*M+d[_+A]*S;return c}}class Ob extends bd{constructor(t,e,s,o){super(t,e,s,o)}interpolate_(t){return this.copySampleValue_(t-1)}}class Rr{constructor(t,e,s,o){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=hl(e,this.TimeBufferType),this.values=hl(s,this.ValueBufferType),this.setInterpolation(o||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let s;if(e.toJSON!==this.toJSON)s=e.toJSON(t);else{s={name:t.name,times:hl(t.times,Array),values:hl(t.values,Array)};const o=t.getInterpolation();o!==t.DefaultInterpolation&&(s.interpolation=o)}return s.type=t.ValueTypeName,s}InterpolantFactoryMethodDiscrete(t){return new Ob(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new m0(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Bb(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Vu:e=this.InterpolantFactoryMethodDiscrete;break;case Gu:e=this.InterpolantFactoryMethodLinear;break;case Cp:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const s="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(s);return console.warn("THREE.KeyframeTrack:",s),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Vu;case this.InterpolantFactoryMethodLinear:return Gu;case this.InterpolantFactoryMethodSmooth:return Cp}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let s=0,o=e.length;s!==o;++s)e[s]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let s=0,o=e.length;s!==o;++s)e[s]*=t}return this}trim(t,e){const s=this.times,o=s.length;let c=0,d=o-1;for(;c!==o&&s[c]<t;)++c;for(;d!==-1&&s[d]>e;)--d;if(++d,c!==0||d!==o){c>=d&&(d=Math.max(d,1),c=d-1);const a=this.getValueSize();this.times=pr(s,c,d),this.values=pr(this.values,c*a,d*a)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const s=this.times,o=this.values,c=s.length;c===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let d=null;for(let a=0;a!==c;a++){const _=s[a];if(typeof _=="number"&&isNaN(_)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,_),t=!1;break}if(d!==null&&d>_){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,_,d),t=!1;break}d=_}if(o!==void 0&&f0(o))for(let a=0,_=o.length;a!==_;++a){const v=o[a];if(isNaN(v)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,v),t=!1;break}}return t}optimize(){const t=pr(this.times),e=pr(this.values),s=this.getValueSize(),o=this.getInterpolation()===Cp,c=t.length-1;let d=1;for(let a=1;a<c;++a){let _=!1;const v=t[a],S=t[a+1];if(v!==S&&(a!==1||v!==t[0]))if(o)_=!0;else{const M=a*s,A=M-s,C=M+s;for(let R=0;R!==s;++R){const F=e[M+R];if(F!==e[A+R]||F!==e[C+R]){_=!0;break}}}if(_){if(a!==d){t[d]=t[a];const M=a*s,A=d*s;for(let C=0;C!==s;++C)e[A+C]=e[M+C]}++d}}if(c>0){t[d]=t[c];for(let a=c*s,_=d*s,v=0;v!==s;++v)e[_+v]=e[a+v];++d}return d!==t.length?(this.times=pr(t,0,d),this.values=pr(e,0,d*s)):(this.times=t,this.values=e),this}clone(){const t=pr(this.times,0),e=pr(this.values,0),s=this.constructor,o=new s(this.name,t,e);return o.createInterpolant=this.createInterpolant,o}}Rr.prototype.TimeBufferType=Float32Array;Rr.prototype.ValueBufferType=Float32Array;Rr.prototype.DefaultInterpolation=Gu;class xl extends Rr{}xl.prototype.ValueTypeName="bool";xl.prototype.ValueBufferType=Array;xl.prototype.DefaultInterpolation=Vu;xl.prototype.InterpolantFactoryMethodLinear=void 0;xl.prototype.InterpolantFactoryMethodSmooth=void 0;class g0 extends Rr{}g0.prototype.ValueTypeName="color";class Yu extends Rr{}Yu.prototype.ValueTypeName="number";class Nb extends bd{constructor(t,e,s,o){super(t,e,s,o)}interpolate_(t,e,s,o){const c=this.resultBuffer,d=this.sampleValues,a=this.valueSize,_=(s-e)/(o-e);let v=t*a;for(let S=v+a;v!==S;v+=4)Os.slerpFlat(c,0,d,v-a,d,v,_);return c}}class ic extends Rr{InterpolantFactoryMethodLinear(t){return new Nb(this.times,this.values,this.getValueSize(),t)}}ic.prototype.ValueTypeName="quaternion";ic.prototype.DefaultInterpolation=Gu;ic.prototype.InterpolantFactoryMethodSmooth=void 0;class bl extends Rr{}bl.prototype.ValueTypeName="string";bl.prototype.ValueBufferType=Array;bl.prototype.DefaultInterpolation=Vu;bl.prototype.InterpolantFactoryMethodLinear=void 0;bl.prototype.InterpolantFactoryMethodSmooth=void 0;class Ju extends Rr{}Ju.prototype.ValueTypeName="vector";class Ku{constructor(t,e=-1,s,o=qp){this.name=t,this.tracks=s,this.duration=e,this.blendMode=o,this.uuid=er(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],s=t.tracks,o=1/(t.fps||1);for(let d=0,a=s.length;d!==a;++d)e.push(aI(s[d]).scale(o));const c=new this(t.name,t.duration,e,t.blendMode);return c.uuid=t.uuid,c}static toJSON(t){const e=[],s=t.tracks,o={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let c=0,d=s.length;c!==d;++c)e.push(Rr.toJSON(s[c]));return o}static CreateFromMorphTargetSequence(t,e,s,o){const c=e.length,d=[];for(let a=0;a<c;a++){let _=[],v=[];_.push((a+c-1)%c,a,(a+1)%c),v.push(0,1,0);const S=Fb(_);_=I_(_,1,S),v=I_(v,1,S),!o&&_[0]===0&&(_.push(c),v.push(v[0])),d.push(new Yu(".morphTargetInfluences["+e[a].name+"]",_,v).scale(1/s))}return new this(t,-1,d)}static findByName(t,e){let s=t;if(!Array.isArray(t)){const o=t;s=o.geometry&&o.geometry.animations||o.animations}for(let o=0;o<s.length;o++)if(s[o].name===e)return s[o];return null}static CreateClipsFromMorphTargetSequences(t,e,s){const o={},c=/^([\w-]*?)([\d]+)$/;for(let a=0,_=t.length;a<_;a++){const v=t[a],S=v.name.match(c);if(S&&S.length>1){const M=S[1];let A=o[M];A||(o[M]=A=[]),A.push(v)}}const d=[];for(const a in o)d.push(this.CreateFromMorphTargetSequence(a,o[a],e,s));return d}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const s=function(M,A,C,R,F){if(C.length!==0){const z=[],L=[];p0(C,z,L,R),z.length!==0&&F.push(new M(A,z,L))}},o=[],c=t.name||"default",d=t.fps||30,a=t.blendMode;let _=t.length||-1;const v=t.hierarchy||[];for(let M=0;M<v.length;M++){const A=v[M].keys;if(!(!A||A.length===0))if(A[0].morphTargets){const C={};let R;for(R=0;R<A.length;R++)if(A[R].morphTargets)for(let F=0;F<A[R].morphTargets.length;F++)C[A[R].morphTargets[F]]=-1;for(const F in C){const z=[],L=[];for(let W=0;W!==A[R].morphTargets.length;++W){const G=A[R];z.push(G.time),L.push(G.morphTarget===F?1:0)}o.push(new Yu(".morphTargetInfluence["+F+"]",z,L))}_=C.length*d}else{const C=".bones["+e[M].name+"]";s(Ju,C+".position",A,"pos",o),s(ic,C+".quaternion",A,"rot",o),s(Ju,C+".scale",A,"scl",o)}}return o.length===0?null:new this(c,_,o,a)}resetDuration(){const t=this.tracks;let e=0;for(let s=0,o=t.length;s!==o;++s){const c=this.tracks[s];e=Math.max(e,c.times[c.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function rI(l){switch(l.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Yu;case"vector":case"vector2":case"vector3":case"vector4":return Ju;case"color":return g0;case"quaternion":return ic;case"bool":case"boolean":return xl;case"string":return bl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+l)}function aI(l){if(l.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=rI(l.type);if(l.times===void 0){const e=[],s=[];p0(l.keys,e,s,"value"),l.times=e,l.values=s}return t.parse!==void 0?t.parse(l):new t(l.name,l.times,l.values,l.interpolation)}const gl={enabled:!1,files:{},add:function(l,t){this.enabled!==!1&&(this.files[l]=t)},get:function(l){if(this.enabled!==!1)return this.files[l]},remove:function(l){delete this.files[l]},clear:function(){this.files={}}};class _0{constructor(t,e,s){const o=this;let c=!1,d=0,a=0,_;const v=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=s,this.itemStart=function(S){a++,c===!1&&o.onStart!==void 0&&o.onStart(S,d,a),c=!0},this.itemEnd=function(S){d++,o.onProgress!==void 0&&o.onProgress(S,d,a),d===a&&(c=!1,o.onLoad!==void 0&&o.onLoad())},this.itemError=function(S){o.onError!==void 0&&o.onError(S)},this.resolveURL=function(S){return _?_(S):S},this.setURLModifier=function(S){return _=S,this},this.addHandler=function(S,M){return v.push(S,M),this},this.removeHandler=function(S){const M=v.indexOf(S);return M!==-1&&v.splice(M,2),this},this.getHandler=function(S){for(let M=0,A=v.length;M<A;M+=2){const C=v[M],R=v[M+1];if(C.global&&(C.lastIndex=0),C.test(S))return R}return null}}}const Ub=new _0;class ir{constructor(t){this.manager=t!==void 0?t:Ub,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const s=this;return new Promise(function(o,c){s.load(t,o,e,c)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const wa={};class oI extends Error{constructor(t,e){super(t),this.response=e}}class Zr extends ir{constructor(t){super(t)}load(t,e,s,o){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const c=gl.get(t);if(c!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(c),this.manager.itemEnd(t)},0),c;if(wa[t]!==void 0){wa[t].push({onLoad:e,onProgress:s,onError:o});return}wa[t]=[],wa[t].push({onLoad:e,onProgress:s,onError:o});const d=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,_=this.responseType;fetch(d).then(v=>{if(v.status===200||v.status===0){if(v.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||v.body===void 0||v.body.getReader===void 0)return v;const S=wa[t],M=v.body.getReader(),A=v.headers.get("Content-Length")||v.headers.get("X-File-Size"),C=A?parseInt(A):0,R=C!==0;let F=0;const z=new ReadableStream({start(L){W();function W(){M.read().then(({done:G,value:H})=>{if(G)L.close();else{F+=H.byteLength;const Q=new ProgressEvent("progress",{lengthComputable:R,loaded:F,total:C});for(let nt=0,pt=S.length;nt<pt;nt++){const ft=S[nt];ft.onProgress&&ft.onProgress(Q)}L.enqueue(H),W()}})}}});return new Response(z)}else throw new oI(`fetch for "${v.url}" responded with ${v.status}: ${v.statusText}`,v)}).then(v=>{switch(_){case"arraybuffer":return v.arrayBuffer();case"blob":return v.blob();case"document":return v.text().then(S=>new DOMParser().parseFromString(S,a));case"json":return v.json();default:if(a===void 0)return v.text();{const M=/charset="?([^;"\s]*)"?/i.exec(a),A=M&&M[1]?M[1].toLowerCase():void 0,C=new TextDecoder(A);return v.arrayBuffer().then(R=>C.decode(R))}}}).then(v=>{gl.add(t,v);const S=wa[t];delete wa[t];for(let M=0,A=S.length;M<A;M++){const C=S[M];C.onLoad&&C.onLoad(v)}}).catch(v=>{const S=wa[t];if(S===void 0)throw this.manager.itemError(t),v;delete wa[t];for(let M=0,A=S.length;M<A;M++){const C=S[M];C.onError&&C.onError(v)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class lI extends ir{constructor(t){super(t)}load(t,e,s,o){const c=this,d=new Zr(this.manager);d.setPath(this.path),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(t,function(a){try{e(c.parse(JSON.parse(a)))}catch(_){o?o(_):console.error(_),c.manager.itemError(t)}},s,o)}parse(t){const e=[];for(let s=0;s<t.length;s++){const o=Ku.parse(t[s]);e.push(o)}return e}}class hI extends ir{constructor(t){super(t)}load(t,e,s,o){const c=this,d=[],a=new s0,_=new Zr(this.manager);_.setPath(this.path),_.setResponseType("arraybuffer"),_.setRequestHeader(this.requestHeader),_.setWithCredentials(c.withCredentials);let v=0;function S(M){_.load(t[M],function(A){const C=c.parse(A,!0);d[M]={width:C.width,height:C.height,format:C.format,mipmaps:C.mipmaps},v+=1,v===6&&(C.mipmapCount===1&&(a.minFilter=Dn),a.image=d,a.format=C.format,a.needsUpdate=!0,e&&e(a))},s,o)}if(Array.isArray(t))for(let M=0,A=t.length;M<A;++M)S(M);else _.load(t,function(M){const A=c.parse(M,!0);if(A.isCubemap){const C=A.mipmaps.length/A.mipmapCount;for(let R=0;R<C;R++){d[R]={mipmaps:[]};for(let F=0;F<A.mipmapCount;F++)d[R].mipmaps.push(A.mipmaps[R*A.mipmapCount+F]),d[R].format=A.format,d[R].width=A.width,d[R].height=A.height}a.image=d}else a.image.width=A.width,a.image.height=A.height,a.mipmaps=A.mipmaps;A.mipmapCount===1&&(a.minFilter=Dn),a.format=A.format,a.needsUpdate=!0,e&&e(a)},s,o);return a}}class Qu extends ir{constructor(t){super(t)}load(t,e,s,o){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const c=this,d=gl.get(t);if(d!==void 0)return c.manager.itemStart(t),setTimeout(function(){e&&e(d),c.manager.itemEnd(t)},0),d;const a=qu("img");function _(){S(),gl.add(t,this),e&&e(this),c.manager.itemEnd(t)}function v(M){S(),o&&o(M),c.manager.itemError(t),c.manager.itemEnd(t)}function S(){a.removeEventListener("load",_,!1),a.removeEventListener("error",v,!1)}return a.addEventListener("load",_,!1),a.addEventListener("error",v,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),c.manager.itemStart(t),a.src=t,a}}class cI extends ir{constructor(t){super(t)}load(t,e,s,o){const c=new hd,d=new Qu(this.manager);d.setCrossOrigin(this.crossOrigin),d.setPath(this.path);let a=0;function _(v){d.load(t[v],function(S){c.images[v]=S,a++,a===6&&(c.needsUpdate=!0,e&&e(c))},void 0,o)}for(let v=0;v<t.length;++v)_(v);return c}}class uI extends ir{constructor(t){super(t)}load(t,e,s,o){const c=this,d=new Nh,a=new Zr(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(c.withCredentials),a.load(t,function(_){const v=c.parse(_);v&&(v.image!==void 0?d.image=v.image:v.data!==void 0&&(d.image.width=v.width,d.image.height=v.height,d.image.data=v.data),d.wrapS=v.wrapS!==void 0?v.wrapS:gs,d.wrapT=v.wrapT!==void 0?v.wrapT:gs,d.magFilter=v.magFilter!==void 0?v.magFilter:Dn,d.minFilter=v.minFilter!==void 0?v.minFilter:Dn,d.anisotropy=v.anisotropy!==void 0?v.anisotropy:1,v.encoding!==void 0&&(d.encoding=v.encoding),v.flipY!==void 0&&(d.flipY=v.flipY),v.format!==void 0&&(d.format=v.format),v.type!==void 0&&(d.type=v.type),v.mipmaps!==void 0&&(d.mipmaps=v.mipmaps,d.minFilter=go),v.mipmapCount===1&&(d.minFilter=Dn),v.generateMipmaps!==void 0&&(d.generateMipmaps=v.generateMipmaps),d.needsUpdate=!0,e&&e(d,v))},s,o),d}}class dI extends ir{constructor(t){super(t)}load(t,e,s,o){const c=new zn,d=new Qu(this.manager);return d.setCrossOrigin(this.crossOrigin),d.setPath(this.path),d.load(t,function(a){c.image=a,c.needsUpdate=!0,e!==void 0&&e(c)},s,o),c}}class Ao extends Vi{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Je(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}}class Vb extends Ao{constructor(t,e,s){super(t,s),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Vi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Je(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const Og=new xi,cx=new ut,ux=new ut;class y0{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new me(512,512),this.map=null,this.mapPass=null,this.matrix=new xi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Zp,this._frameExtents=new me(1,1),this._viewportCount=1,this._viewports=[new Ji(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,s=this.matrix;cx.setFromMatrixPosition(t.matrixWorld),e.position.copy(cx),ux.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(ux),e.updateMatrixWorld(),Og.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Og),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(Og)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class fI extends y0{constructor(){super(new ns(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,s=Wh*2*t.angle*this.focus,o=this.mapSize.width/this.mapSize.height,c=t.distance||e.far;(s!==e.fov||o!==e.aspect||c!==e.far)&&(e.fov=s,e.aspect=o,e.far=c,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Gb extends Ao{constructor(t,e,s=0,o=Math.PI/3,c=0,d=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Vi.DEFAULT_UP),this.updateMatrix(),this.target=new Vi,this.distance=s,this.angle=o,this.penumbra=c,this.decay=d,this.map=null,this.shadow=new fI}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const dx=new xi,xu=new ut,Ng=new ut;class pI extends y0{constructor(){super(new ns(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new me(4,2),this._viewportCount=6,this._viewports=[new Ji(2,1,1,1),new Ji(0,1,1,1),new Ji(3,1,1,1),new Ji(1,1,1,1),new Ji(3,0,1,1),new Ji(1,0,1,1)],this._cubeDirections=[new ut(1,0,0),new ut(-1,0,0),new ut(0,0,1),new ut(0,0,-1),new ut(0,1,0),new ut(0,-1,0)],this._cubeUps=[new ut(0,1,0),new ut(0,1,0),new ut(0,1,0),new ut(0,1,0),new ut(0,0,1),new ut(0,0,-1)]}updateMatrices(t,e=0){const s=this.camera,o=this.matrix,c=t.distance||s.far;c!==s.far&&(s.far=c,s.updateProjectionMatrix()),xu.setFromMatrixPosition(t.matrixWorld),s.position.copy(xu),Ng.copy(s.position),Ng.add(this._cubeDirections[e]),s.up.copy(this._cubeUps[e]),s.lookAt(Ng),s.updateMatrixWorld(),o.makeTranslation(-xu.x,-xu.y,-xu.z),dx.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(dx)}}class Hb extends Ao{constructor(t,e,s=0,o=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=o,this.shadow=new pI}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class mI extends y0{constructor(){super(new Xp(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Wb extends Ao{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Vi.DEFAULT_UP),this.updateMatrix(),this.target=new Vi,this.shadow=new mI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class qb extends Ao{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class $b extends Ao{constructor(t,e,s=10,o=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=s,this.height=o}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class jb{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new ut)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const s=t.x,o=t.y,c=t.z,d=this.coefficients;return e.copy(d[0]).multiplyScalar(.282095),e.addScaledVector(d[1],.488603*o),e.addScaledVector(d[2],.488603*c),e.addScaledVector(d[3],.488603*s),e.addScaledVector(d[4],1.092548*(s*o)),e.addScaledVector(d[5],1.092548*(o*c)),e.addScaledVector(d[6],.315392*(3*c*c-1)),e.addScaledVector(d[7],1.092548*(s*c)),e.addScaledVector(d[8],.546274*(s*s-o*o)),e}getIrradianceAt(t,e){const s=t.x,o=t.y,c=t.z,d=this.coefficients;return e.copy(d[0]).multiplyScalar(.886227),e.addScaledVector(d[1],2*.511664*o),e.addScaledVector(d[2],2*.511664*c),e.addScaledVector(d[3],2*.511664*s),e.addScaledVector(d[4],2*.429043*s*o),e.addScaledVector(d[5],2*.429043*o*c),e.addScaledVector(d[6],.743125*c*c-.247708),e.addScaledVector(d[7],2*.429043*s*c),e.addScaledVector(d[8],.429043*(s*s-o*o)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let s=0;s<9;s++)this.coefficients[s].addScaledVector(t.coefficients[s],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let s=0;s<9;s++)this.coefficients[s].lerp(t.coefficients[s],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,e=0){const s=this.coefficients;for(let o=0;o<9;o++)s[o].fromArray(t,e+o*3);return this}toArray(t=[],e=0){const s=this.coefficients;for(let o=0;o<9;o++)s[o].toArray(t,e+o*3);return t}static getBasisAt(t,e){const s=t.x,o=t.y,c=t.z;e[0]=.282095,e[1]=.488603*o,e[2]=.488603*c,e[3]=.488603*s,e[4]=1.092548*s*o,e[5]=1.092548*o*c,e[6]=.315392*(3*c*c-1),e[7]=1.092548*s*c,e[8]=.546274*(s*s-o*o)}}class rm extends Ao{constructor(t=new jb,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class am extends ir{constructor(t){super(t),this.textures={}}load(t,e,s,o){const c=this,d=new Zr(c.manager);d.setPath(c.path),d.setRequestHeader(c.requestHeader),d.setWithCredentials(c.withCredentials),d.load(t,function(a){try{e(c.parse(JSON.parse(a)))}catch(_){o?o(_):console.error(_),c.manager.itemError(t)}},s,o)}parse(t){const e=this.textures;function s(c){return e[c]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",c),e[c]}const o=am.createMaterialFromType(t.type);if(t.uuid!==void 0&&(o.uuid=t.uuid),t.name!==void 0&&(o.name=t.name),t.color!==void 0&&o.color!==void 0&&o.color.setHex(t.color),t.roughness!==void 0&&(o.roughness=t.roughness),t.metalness!==void 0&&(o.metalness=t.metalness),t.sheen!==void 0&&(o.sheen=t.sheen),t.sheenColor!==void 0&&(o.sheenColor=new Je().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(o.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&o.emissive!==void 0&&o.emissive.setHex(t.emissive),t.specular!==void 0&&o.specular!==void 0&&o.specular.setHex(t.specular),t.specularIntensity!==void 0&&(o.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&o.specularColor!==void 0&&o.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(o.shininess=t.shininess),t.clearcoat!==void 0&&(o.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(o.clearcoatRoughness=t.clearcoatRoughness),t.iridescence!==void 0&&(o.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(o.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(o.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(o.transmission=t.transmission),t.thickness!==void 0&&(o.thickness=t.thickness),t.attenuationDistance!==void 0&&(o.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&o.attenuationColor!==void 0&&o.attenuationColor.setHex(t.attenuationColor),t.fog!==void 0&&(o.fog=t.fog),t.flatShading!==void 0&&(o.flatShading=t.flatShading),t.blending!==void 0&&(o.blending=t.blending),t.combine!==void 0&&(o.combine=t.combine),t.side!==void 0&&(o.side=t.side),t.shadowSide!==void 0&&(o.shadowSide=t.shadowSide),t.opacity!==void 0&&(o.opacity=t.opacity),t.transparent!==void 0&&(o.transparent=t.transparent),t.alphaTest!==void 0&&(o.alphaTest=t.alphaTest),t.depthTest!==void 0&&(o.depthTest=t.depthTest),t.depthWrite!==void 0&&(o.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(o.colorWrite=t.colorWrite),t.stencilWrite!==void 0&&(o.stencilWrite=t.stencilWrite),t.stencilWriteMask!==void 0&&(o.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(o.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(o.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(o.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(o.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(o.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(o.stencilZPass=t.stencilZPass),t.wireframe!==void 0&&(o.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(o.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(o.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(o.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(o.rotation=t.rotation),t.linewidth!==1&&(o.linewidth=t.linewidth),t.dashSize!==void 0&&(o.dashSize=t.dashSize),t.gapSize!==void 0&&(o.gapSize=t.gapSize),t.scale!==void 0&&(o.scale=t.scale),t.polygonOffset!==void 0&&(o.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(o.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(o.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(o.dithering=t.dithering),t.alphaToCoverage!==void 0&&(o.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(o.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(o.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(o.visible=t.visible),t.toneMapped!==void 0&&(o.toneMapped=t.toneMapped),t.userData!==void 0&&(o.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?o.vertexColors=t.vertexColors>0:o.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const c in t.uniforms){const d=t.uniforms[c];switch(o.uniforms[c]={},d.type){case"t":o.uniforms[c].value=s(d.value);break;case"c":o.uniforms[c].value=new Je().setHex(d.value);break;case"v2":o.uniforms[c].value=new me().fromArray(d.value);break;case"v3":o.uniforms[c].value=new ut().fromArray(d.value);break;case"v4":o.uniforms[c].value=new Ji().fromArray(d.value);break;case"m3":o.uniforms[c].value=new ki().fromArray(d.value);break;case"m4":o.uniforms[c].value=new xi().fromArray(d.value);break;default:o.uniforms[c].value=d.value}}if(t.defines!==void 0&&(o.defines=t.defines),t.vertexShader!==void 0&&(o.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(o.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(o.glslVersion=t.glslVersion),t.extensions!==void 0)for(const c in t.extensions)o.extensions[c]=t.extensions[c];if(t.size!==void 0&&(o.size=t.size),t.sizeAttenuation!==void 0&&(o.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(o.map=s(t.map)),t.matcap!==void 0&&(o.matcap=s(t.matcap)),t.alphaMap!==void 0&&(o.alphaMap=s(t.alphaMap)),t.bumpMap!==void 0&&(o.bumpMap=s(t.bumpMap)),t.bumpScale!==void 0&&(o.bumpScale=t.bumpScale),t.normalMap!==void 0&&(o.normalMap=s(t.normalMap)),t.normalMapType!==void 0&&(o.normalMapType=t.normalMapType),t.normalScale!==void 0){let c=t.normalScale;Array.isArray(c)===!1&&(c=[c,c]),o.normalScale=new me().fromArray(c)}return t.displacementMap!==void 0&&(o.displacementMap=s(t.displacementMap)),t.displacementScale!==void 0&&(o.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(o.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(o.roughnessMap=s(t.roughnessMap)),t.metalnessMap!==void 0&&(o.metalnessMap=s(t.metalnessMap)),t.emissiveMap!==void 0&&(o.emissiveMap=s(t.emissiveMap)),t.emissiveIntensity!==void 0&&(o.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(o.specularMap=s(t.specularMap)),t.specularIntensityMap!==void 0&&(o.specularIntensityMap=s(t.specularIntensityMap)),t.specularColorMap!==void 0&&(o.specularColorMap=s(t.specularColorMap)),t.envMap!==void 0&&(o.envMap=s(t.envMap)),t.envMapIntensity!==void 0&&(o.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(o.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(o.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(o.lightMap=s(t.lightMap)),t.lightMapIntensity!==void 0&&(o.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(o.aoMap=s(t.aoMap)),t.aoMapIntensity!==void 0&&(o.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(o.gradientMap=s(t.gradientMap)),t.clearcoatMap!==void 0&&(o.clearcoatMap=s(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(o.clearcoatRoughnessMap=s(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(o.clearcoatNormalMap=s(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(o.clearcoatNormalScale=new me().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(o.iridescenceMap=s(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(o.iridescenceThicknessMap=s(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(o.transmissionMap=s(t.transmissionMap)),t.thicknessMap!==void 0&&(o.thicknessMap=s(t.thicknessMap)),t.sheenColorMap!==void 0&&(o.sheenColorMap=s(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(o.sheenRoughnessMap=s(t.sheenRoughnessMap)),o}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){const e={ShadowMaterial:Eb,SpriteMaterial:e0,RawShaderMaterial:Cb,ShaderMaterial:jr,PointsMaterial:n0,MeshPhysicalMaterial:Ib,MeshStandardMaterial:d0,MeshPhongMaterial:Pb,MeshToonMaterial:Lb,MeshNormalMaterial:Rb,MeshLambertMaterial:Db,MeshDepthMaterial:K_,MeshDistanceMaterial:Q_,MeshBasicMaterial:Mo,MeshMatcapMaterial:zb,LineDashedMaterial:kb,LineBasicMaterial:ys,Material:_s};return new e[t]}}class P_{static decodeText(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let e="";for(let s=0,o=t.length;s<o;s++)e+=String.fromCharCode(t[s]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Zb extends Ii{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class Xb extends ir{constructor(t){super(t)}load(t,e,s,o){const c=this,d=new Zr(c.manager);d.setPath(c.path),d.setRequestHeader(c.requestHeader),d.setWithCredentials(c.withCredentials),d.load(t,function(a){try{e(c.parse(JSON.parse(a)))}catch(_){o?o(_):console.error(_),c.manager.itemError(t)}},s,o)}parse(t){const e={},s={};function o(C,R){if(e[R]!==void 0)return e[R];const z=C.interleavedBuffers[R],L=c(C,z.buffer),W=Ph(z.type,L),G=new tm(W,z.stride);return G.uuid=z.uuid,e[R]=G,G}function c(C,R){if(s[R]!==void 0)return s[R];const z=C.arrayBuffers[R],L=new Uint32Array(z).buffer;return s[R]=L,L}const d=t.isInstancedBufferGeometry?new Zb:new Ii,a=t.data.index;if(a!==void 0){const C=Ph(a.type,a.array);d.setIndex(new Zi(C,1))}const _=t.data.attributes;for(const C in _){const R=_[C];let F;if(R.isInterleavedBufferAttribute){const z=o(t.data,R.data);F=new pl(z,R.itemSize,R.offset,R.normalized)}else{const z=Ph(R.type,R.array),L=R.isInstancedBufferAttribute?$h:Zi;F=new L(z,R.itemSize,R.normalized)}R.name!==void 0&&(F.name=R.name),R.usage!==void 0&&F.setUsage(R.usage),R.updateRange!==void 0&&(F.updateRange.offset=R.updateRange.offset,F.updateRange.count=R.updateRange.count),d.setAttribute(C,F)}const v=t.data.morphAttributes;if(v)for(const C in v){const R=v[C],F=[];for(let z=0,L=R.length;z<L;z++){const W=R[z];let G;if(W.isInterleavedBufferAttribute){const H=o(t.data,W.data);G=new pl(H,W.itemSize,W.offset,W.normalized)}else{const H=Ph(W.type,W.array);G=new Zi(H,W.itemSize,W.normalized)}W.name!==void 0&&(G.name=W.name),F.push(G)}d.morphAttributes[C]=F}t.data.morphTargetsRelative&&(d.morphTargetsRelative=!0);const M=t.data.groups||t.data.drawcalls||t.data.offsets;if(M!==void 0)for(let C=0,R=M.length;C!==R;++C){const F=M[C];d.addGroup(F.start,F.count,F.materialIndex)}const A=t.data.boundingSphere;if(A!==void 0){const C=new ut;A.center!==void 0&&C.fromArray(A.center),d.boundingSphere=new Jr(C,A.radius)}return t.name&&(d.name=t.name),t.userData&&(d.userData=t.userData),d}}class gI extends ir{constructor(t){super(t)}load(t,e,s,o){const c=this,d=this.path===""?P_.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||d;const a=new Zr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(_){let v=null;try{v=JSON.parse(_)}catch(M){o!==void 0&&o(M),console.error("THREE:ObjectLoader: Can't parse "+t+".",M.message);return}const S=v.metadata;if(S===void 0||S.type===void 0||S.type.toLowerCase()==="geometry"){o!==void 0&&o(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}c.parse(v,e)},s,o)}async loadAsync(t,e){const s=this,o=this.path===""?P_.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;const c=new Zr(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials);const d=await c.loadAsync(t,e),a=JSON.parse(d),_=a.metadata;if(_===void 0||_.type===void 0||_.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await s.parseAsync(a)}parse(t,e){const s=this.parseAnimations(t.animations),o=this.parseShapes(t.shapes),c=this.parseGeometries(t.geometries,o),d=this.parseImages(t.images,function(){e!==void 0&&e(v)}),a=this.parseTextures(t.textures,d),_=this.parseMaterials(t.materials,a),v=this.parseObject(t.object,c,_,a,s),S=this.parseSkeletons(t.skeletons,v);if(this.bindSkeletons(v,S),e!==void 0){let M=!1;for(const A in d)if(d[A].data instanceof HTMLImageElement){M=!0;break}M===!1&&e(v)}return v}async parseAsync(t){const e=this.parseAnimations(t.animations),s=this.parseShapes(t.shapes),o=this.parseGeometries(t.geometries,s),c=await this.parseImagesAsync(t.images),d=this.parseTextures(t.textures,c),a=this.parseMaterials(t.materials,d),_=this.parseObject(t.object,o,a,d,e),v=this.parseSkeletons(t.skeletons,_);return this.bindSkeletons(_,v),_}parseShapes(t){const e={};if(t!==void 0)for(let s=0,o=t.length;s<o;s++){const c=new uo().fromJSON(t[s]);e[c.uuid]=c}return e}parseSkeletons(t,e){const s={},o={};if(e.traverse(function(c){c.isBone&&(o[c.uuid]=c)}),t!==void 0)for(let c=0,d=t.length;c<d;c++){const a=new em().fromJSON(t[c],o);s[a.uuid]=a}return s}parseGeometries(t,e){const s={};if(t!==void 0){const o=new Xb;for(let c=0,d=t.length;c<d;c++){let a;const _=t[c];switch(_.type){case"BufferGeometry":case"InstancedBufferGeometry":a=o.parse(_);break;default:_.type in hx?a=hx[_.type].fromJSON(_,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${_.type}"`)}a.uuid=_.uuid,_.name!==void 0&&(a.name=_.name),_.userData!==void 0&&(a.userData=_.userData),s[_.uuid]=a}}return s}parseMaterials(t,e){const s={},o={};if(t!==void 0){const c=new am;c.setTextures(e);for(let d=0,a=t.length;d<a;d++){const _=t[d];s[_.uuid]===void 0&&(s[_.uuid]=c.parse(_)),o[_.uuid]=s[_.uuid]}}return o}parseAnimations(t){const e={};if(t!==void 0)for(let s=0;s<t.length;s++){const o=t[s],c=Ku.parse(o);e[c.uuid]=c}return e}parseImages(t,e){const s=this,o={};let c;function d(_){return s.manager.itemStart(_),c.load(_,function(){s.manager.itemEnd(_)},void 0,function(){s.manager.itemError(_),s.manager.itemEnd(_)})}function a(_){if(typeof _=="string"){const v=_,S=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(v)?v:s.resourcePath+v;return d(S)}else return _.data?{data:Ph(_.type,_.data),width:_.width,height:_.height}:null}if(t!==void 0&&t.length>0){const _=new _0(e);c=new Qu(_),c.setCrossOrigin(this.crossOrigin);for(let v=0,S=t.length;v<S;v++){const M=t[v],A=M.url;if(Array.isArray(A)){const C=[];for(let R=0,F=A.length;R<F;R++){const z=A[R],L=a(z);L!==null&&(L instanceof HTMLImageElement?C.push(L):C.push(new Nh(L.data,L.width,L.height)))}o[M.uuid]=new ol(C)}else{const C=a(M.url);o[M.uuid]=new ol(C)}}}return o}async parseImagesAsync(t){const e=this,s={};let o;async function c(d){if(typeof d=="string"){const a=d,_=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:e.resourcePath+a;return await o.loadAsync(_)}else return d.data?{data:Ph(d.type,d.data),width:d.width,height:d.height}:null}if(t!==void 0&&t.length>0){o=new Qu(this.manager),o.setCrossOrigin(this.crossOrigin);for(let d=0,a=t.length;d<a;d++){const _=t[d],v=_.url;if(Array.isArray(v)){const S=[];for(let M=0,A=v.length;M<A;M++){const C=v[M],R=await c(C);R!==null&&(R instanceof HTMLImageElement?S.push(R):S.push(new Nh(R.data,R.width,R.height)))}s[_.uuid]=new ol(S)}else{const S=await c(_.url);s[_.uuid]=new ol(S)}}}return s}parseTextures(t,e){function s(c,d){return typeof c=="number"?c:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",c),d[c])}const o={};if(t!==void 0)for(let c=0,d=t.length;c<d;c++){const a=t[c];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),e[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const _=e[a.image],v=_.data;let S;Array.isArray(v)?(S=new hd,v.length===6&&(S.needsUpdate=!0)):(v&&v.data?S=new Nh:S=new zn,v&&(S.needsUpdate=!0)),S.source=_,S.uuid=a.uuid,a.name!==void 0&&(S.name=a.name),a.mapping!==void 0&&(S.mapping=s(a.mapping,_I)),a.channel!==void 0&&(S.channel=a.channel),a.offset!==void 0&&S.offset.fromArray(a.offset),a.repeat!==void 0&&S.repeat.fromArray(a.repeat),a.center!==void 0&&S.center.fromArray(a.center),a.rotation!==void 0&&(S.rotation=a.rotation),a.wrap!==void 0&&(S.wrapS=s(a.wrap[0],fx),S.wrapT=s(a.wrap[1],fx)),a.format!==void 0&&(S.format=a.format),a.internalFormat!==void 0&&(S.internalFormat=a.internalFormat),a.type!==void 0&&(S.type=a.type),a.encoding!==void 0&&(S.encoding=a.encoding),a.minFilter!==void 0&&(S.minFilter=s(a.minFilter,px)),a.magFilter!==void 0&&(S.magFilter=s(a.magFilter,px)),a.anisotropy!==void 0&&(S.anisotropy=a.anisotropy),a.flipY!==void 0&&(S.flipY=a.flipY),a.generateMipmaps!==void 0&&(S.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(S.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(S.unpackAlignment=a.unpackAlignment),a.userData!==void 0&&(S.userData=a.userData),o[a.uuid]=S}return o}parseObject(t,e,s,o,c){let d;function a(A){return e[A]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",A),e[A]}function _(A){if(A!==void 0){if(Array.isArray(A)){const C=[];for(let R=0,F=A.length;R<F;R++){const z=A[R];s[z]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",z),C.push(s[z])}return C}return s[A]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",A),s[A]}}function v(A){return o[A]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",A),o[A]}let S,M;switch(t.type){case"Scene":d=new t0,t.background!==void 0&&(Number.isInteger(t.background)?d.background=new Je(t.background):d.background=v(t.background)),t.environment!==void 0&&(d.environment=v(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?d.fog=new Qp(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(d.fog=new Kp(t.fog.color,t.fog.density))),t.backgroundBlurriness!==void 0&&(d.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(d.backgroundIntensity=t.backgroundIntensity);break;case"PerspectiveCamera":d=new ns(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(d.focus=t.focus),t.zoom!==void 0&&(d.zoom=t.zoom),t.filmGauge!==void 0&&(d.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(d.filmOffset=t.filmOffset),t.view!==void 0&&(d.view=Object.assign({},t.view));break;case"OrthographicCamera":d=new Xp(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(d.zoom=t.zoom),t.view!==void 0&&(d.view=Object.assign({},t.view));break;case"AmbientLight":d=new qb(t.color,t.intensity);break;case"DirectionalLight":d=new Wb(t.color,t.intensity);break;case"PointLight":d=new Hb(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":d=new $b(t.color,t.intensity,t.width,t.height);break;case"SpotLight":d=new Gb(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":d=new Vb(t.color,t.groundColor,t.intensity);break;case"LightProbe":d=new rm().fromJSON(t);break;case"SkinnedMesh":S=a(t.geometry),M=_(t.material),d=new pb(S,M),t.bindMode!==void 0&&(d.bindMode=t.bindMode),t.bindMatrix!==void 0&&d.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(d.skeleton=t.skeleton);break;case"Mesh":S=a(t.geometry),M=_(t.material),d=new Vn(S,M);break;case"InstancedMesh":S=a(t.geometry),M=_(t.material);const A=t.count,C=t.instanceMatrix,R=t.instanceColor;d=new mb(S,M,A),d.instanceMatrix=new $h(new Float32Array(C.array),16),R!==void 0&&(d.instanceColor=new $h(new Float32Array(R.array),R.itemSize));break;case"LOD":d=new fb;break;case"Line":d=new vo(a(t.geometry),_(t.material));break;case"LineLoop":d=new gb(a(t.geometry),_(t.material));break;case"LineSegments":d=new Pr(a(t.geometry),_(t.material));break;case"PointCloud":case"Points":d=new _b(a(t.geometry),_(t.material));break;case"Sprite":d=new db(_(t.material));break;case"Group":d=new ll;break;case"Bone":d=new i0;break;default:d=new Vi}if(d.uuid=t.uuid,t.name!==void 0&&(d.name=t.name),t.matrix!==void 0?(d.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(d.matrixAutoUpdate=t.matrixAutoUpdate),d.matrixAutoUpdate&&d.matrix.decompose(d.position,d.quaternion,d.scale)):(t.position!==void 0&&d.position.fromArray(t.position),t.rotation!==void 0&&d.rotation.fromArray(t.rotation),t.quaternion!==void 0&&d.quaternion.fromArray(t.quaternion),t.scale!==void 0&&d.scale.fromArray(t.scale)),t.up!==void 0&&d.up.fromArray(t.up),t.castShadow!==void 0&&(d.castShadow=t.castShadow),t.receiveShadow!==void 0&&(d.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.bias!==void 0&&(d.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(d.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(d.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&d.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(d.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(d.visible=t.visible),t.frustumCulled!==void 0&&(d.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(d.renderOrder=t.renderOrder),t.userData!==void 0&&(d.userData=t.userData),t.layers!==void 0&&(d.layers.mask=t.layers),t.children!==void 0){const A=t.children;for(let C=0;C<A.length;C++)d.add(this.parseObject(A[C],e,s,o,c))}if(t.animations!==void 0){const A=t.animations;for(let C=0;C<A.length;C++){const R=A[C];d.animations.push(c[R])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(d.autoUpdate=t.autoUpdate);const A=t.levels;for(let C=0;C<A.length;C++){const R=A[C],F=d.getObjectByProperty("uuid",R.object);F!==void 0&&d.addLevel(F,R.distance,R.hysteresis)}}return d}bindSkeletons(t,e){Object.keys(e).length!==0&&t.traverse(function(s){if(s.isSkinnedMesh===!0&&s.skeleton!==void 0){const o=e[s.skeleton];o===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",s.skeleton):s.bind(o,s.bindMatrix)}})}}const _I={UVMapping:Wp,CubeReflectionMapping:po,CubeRefractionMapping:mo,EquirectangularReflectionMapping:Bu,EquirectangularRefractionMapping:Ou,CubeUVReflectionMapping:Xh},fx={RepeatWrapping:Nu,ClampToEdgeWrapping:gs,MirroredRepeatWrapping:Uu},px={NearestFilter:Rn,NearestMipmapNearestFilter:kp,NearestMipmapLinearFilter:Eu,LinearFilter:Dn,LinearMipmapNearestFilter:G_,LinearMipmapLinearFilter:go};class yI extends ir{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,s,o){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const c=this,d=gl.get(t);if(d!==void 0)return c.manager.itemStart(t),setTimeout(function(){e&&e(d),c.manager.itemEnd(t)},0),d;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then(function(_){return _.blob()}).then(function(_){return createImageBitmap(_,Object.assign(c.options,{colorSpaceConversion:"none"}))}).then(function(_){gl.add(t,_),e&&e(_),c.manager.itemEnd(t)}).catch(function(_){o&&o(_),c.manager.itemError(t),c.manager.itemEnd(t)}),c.manager.itemStart(t)}}let fp;class v0{static getContext(){return fp===void 0&&(fp=new(window.AudioContext||window.webkitAudioContext)),fp}static setContext(t){fp=t}}class vI extends ir{constructor(t){super(t)}load(t,e,s,o){const c=this,d=new Zr(this.manager);d.setResponseType("arraybuffer"),d.setPath(this.path),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(t,function(a){try{const _=a.slice(0);v0.getContext().decodeAudioData(_,function(S){e(S)})}catch(_){o?o(_):console.error(_),c.manager.itemError(t)}},s,o)}}class xI extends rm{constructor(t,e,s=1){super(void 0,s),this.isHemisphereLightProbe=!0;const o=new Je().set(t),c=new Je().set(e),d=new ut(o.r,o.g,o.b),a=new ut(c.r,c.g,c.b),_=Math.sqrt(Math.PI),v=_*Math.sqrt(.75);this.sh.coefficients[0].copy(d).add(a).multiplyScalar(_),this.sh.coefficients[1].copy(d).sub(a).multiplyScalar(v)}}class bI extends rm{constructor(t,e=1){super(void 0,e),this.isAmbientLightProbe=!0;const s=new Je().set(t);this.sh.coefficients[0].set(s.r,s.g,s.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const mx=new xi,gx=new xi,Jo=new xi;class wI{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ns,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ns,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,Jo.copy(t.projectionMatrix);const o=e.eyeSep/2,c=o*e.near/e.focus,d=e.near*Math.tan(dl*e.fov*.5)/e.zoom;let a,_;gx.elements[12]=-o,mx.elements[12]=o,a=-d*e.aspect+c,_=d*e.aspect+c,Jo.elements[0]=2*e.near/(_-a),Jo.elements[8]=(_+a)/(_-a),this.cameraL.projectionMatrix.copy(Jo),a=-d*e.aspect-c,_=d*e.aspect-c,Jo.elements[0]=2*e.near/(_-a),Jo.elements[8]=(_+a)/(_-a),this.cameraR.projectionMatrix.copy(Jo)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(gx),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(mx)}}class Yb{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=_x(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=_x();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function _x(){return(typeof performance>"u"?Date:performance).now()}const Ko=new ut,yx=new Os,MI=new ut,Qo=new ut;class SI extends Vi{constructor(){super(),this.type="AudioListener",this.context=v0.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Yb}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,s=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ko,yx,MI),Qo.set(0,0,-1).applyQuaternion(yx),e.positionX){const o=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Ko.x,o),e.positionY.linearRampToValueAtTime(Ko.y,o),e.positionZ.linearRampToValueAtTime(Ko.z,o),e.forwardX.linearRampToValueAtTime(Qo.x,o),e.forwardY.linearRampToValueAtTime(Qo.y,o),e.forwardZ.linearRampToValueAtTime(Qo.z,o),e.upX.linearRampToValueAtTime(s.x,o),e.upY.linearRampToValueAtTime(s.y,o),e.upZ.linearRampToValueAtTime(s.z,o)}else e.setPosition(Ko.x,Ko.y,Ko.z),e.setOrientation(Qo.x,Qo.y,Qo.z,s.x,s.y,s.z)}}class Jb extends Vi{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const tl=new ut,vx=new Os,AI=new ut,el=new ut;class TI extends Jb{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,s){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=s,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(tl,vx,AI),el.set(0,0,1).applyQuaternion(vx);const e=this.panner;if(e.positionX){const s=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(tl.x,s),e.positionY.linearRampToValueAtTime(tl.y,s),e.positionZ.linearRampToValueAtTime(tl.z,s),e.orientationX.linearRampToValueAtTime(el.x,s),e.orientationY.linearRampToValueAtTime(el.y,s),e.orientationZ.linearRampToValueAtTime(el.z,s)}else e.setPosition(tl.x,tl.y,tl.z),e.setOrientation(el.x,el.y,el.z)}}class EI{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let s=0;s<e.length;s++)t+=e[s];return t/e.length}}class Kb{constructor(t,e,s){this.binding=t,this.valueSize=s;let o,c,d;switch(e){case"quaternion":o=this._slerp,c=this._slerpAdditive,d=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(s*6),this._workIndex=5;break;case"string":case"bool":o=this._select,c=this._select,d=this._setAdditiveIdentityOther,this.buffer=new Array(s*5);break;default:o=this._lerp,c=this._lerpAdditive,d=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(s*5)}this._mixBufferRegion=o,this._mixBufferRegionAdditive=c,this._setIdentity=d,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const s=this.buffer,o=this.valueSize,c=t*o+o;let d=this.cumulativeWeight;if(d===0){for(let a=0;a!==o;++a)s[c+a]=s[a];d=e}else{d+=e;const a=e/d;this._mixBufferRegion(s,c,0,a,o)}this.cumulativeWeight=d}accumulateAdditive(t){const e=this.buffer,s=this.valueSize,o=s*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,o,0,t,s),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,s=this.buffer,o=t*e+e,c=this.cumulativeWeight,d=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,c<1){const _=e*this._origIndex;this._mixBufferRegion(s,o,_,1-c,e)}d>0&&this._mixBufferRegionAdditive(s,o,this._addIndex*e,1,e);for(let _=e,v=e+e;_!==v;++_)if(s[_]!==s[_+e]){a.setValue(s,o);break}}saveOriginalState(){const t=this.binding,e=this.buffer,s=this.valueSize,o=s*this._origIndex;t.getValue(e,o);for(let c=s,d=o;c!==d;++c)e[c]=e[o+c%s];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let s=t;s<e;s++)this.buffer[s]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let s=0;s<this.valueSize;s++)this.buffer[e+s]=this.buffer[t+s]}_select(t,e,s,o,c){if(o>=.5)for(let d=0;d!==c;++d)t[e+d]=t[s+d]}_slerp(t,e,s,o){Os.slerpFlat(t,e,t,e,t,s,o)}_slerpAdditive(t,e,s,o,c){const d=this._workIndex*c;Os.multiplyQuaternionsFlat(t,d,t,e,t,s),Os.slerpFlat(t,e,t,e,t,d,o)}_lerp(t,e,s,o,c){const d=1-o;for(let a=0;a!==c;++a){const _=e+a;t[_]=t[_]*d+t[s+a]*o}}_lerpAdditive(t,e,s,o,c){for(let d=0;d!==c;++d){const a=e+d;t[a]=t[a]+t[s+d]*o}}}const x0="\\[\\]\\.:\\/",CI=new RegExp("["+x0+"]","g"),b0="[^"+x0+"]",II="[^"+x0.replace("\\.","")+"]",PI=/((?:WC+[\/:])*)/.source.replace("WC",b0),LI=/(WCOD+)?/.source.replace("WCOD",II),RI=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",b0),DI=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",b0),zI=new RegExp("^"+PI+LI+RI+DI+"$"),kI=["material","materials","bones","map"];class FI{constructor(t,e,s){const o=s||Ui.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,o)}getValue(t,e){this.bind();const s=this._targetGroup.nCachedObjects_,o=this._bindings[s];o!==void 0&&o.getValue(t,e)}setValue(t,e){const s=this._bindings;for(let o=this._targetGroup.nCachedObjects_,c=s.length;o!==c;++o)s[o].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,s=t.length;e!==s;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,s=t.length;e!==s;++e)t[e].unbind()}}class Ui{constructor(t,e,s){this.path=e,this.parsedPath=s||Ui.parseTrackName(e),this.node=Ui.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,s){return t&&t.isAnimationObjectGroup?new Ui.Composite(t,e,s):new Ui(t,e,s)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(CI,"")}static parseTrackName(t){const e=zI.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const s={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},o=s.nodeName&&s.nodeName.lastIndexOf(".");if(o!==void 0&&o!==-1){const c=s.nodeName.substring(o+1);kI.indexOf(c)!==-1&&(s.nodeName=s.nodeName.substring(0,o),s.objectName=c)}if(s.propertyName===null||s.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return s}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const s=t.skeleton.getBoneByName(e);if(s!==void 0)return s}if(t.children){const s=function(c){for(let d=0;d<c.length;d++){const a=c[d];if(a.name===e||a.uuid===e)return a;const _=s(a.children);if(_)return _}return null},o=s(t.children);if(o)return o}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const s=this.resolvedProperty;for(let o=0,c=s.length;o!==c;++o)t[e++]=s[o]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const s=this.resolvedProperty;for(let o=0,c=s.length;o!==c;++o)s[o]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const s=this.resolvedProperty;for(let o=0,c=s.length;o!==c;++o)s[o]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const s=this.resolvedProperty;for(let o=0,c=s.length;o!==c;++o)s[o]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,s=e.objectName,o=e.propertyName;let c=e.propertyIndex;if(t||(t=Ui.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(s){let v=e.objectIndex;switch(s){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let S=0;S<t.length;S++)if(t[S].name===v){v=S;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[s]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[s]}if(v!==void 0){if(t[v]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[v]}}const d=t[o];if(d===void 0){const v=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+v+"."+o+" but it wasn't found.",t);return}let a=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let _=this.BindingType.Direct;if(c!==void 0){if(o==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[c]!==void 0&&(c=t.morphTargetDictionary[c])}_=this.BindingType.ArrayElement,this.resolvedProperty=d,this.propertyIndex=c}else d.fromArray!==void 0&&d.toArray!==void 0?(_=this.BindingType.HasFromToArray,this.resolvedProperty=d):Array.isArray(d)?(_=this.BindingType.EntireArray,this.resolvedProperty=d):this.propertyName=o;this.getValue=this.GetterByBindingType[_],this.setValue=this.SetterByBindingTypeAndVersioning[_][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ui.Composite=FI;Ui.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ui.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ui.prototype.GetterByBindingType=[Ui.prototype._getValue_direct,Ui.prototype._getValue_array,Ui.prototype._getValue_arrayElement,Ui.prototype._getValue_toArray];Ui.prototype.SetterByBindingTypeAndVersioning=[[Ui.prototype._setValue_direct,Ui.prototype._setValue_direct_setNeedsUpdate,Ui.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ui.prototype._setValue_array,Ui.prototype._setValue_array_setNeedsUpdate,Ui.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ui.prototype._setValue_arrayElement,Ui.prototype._setValue_arrayElement_setNeedsUpdate,Ui.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ui.prototype._setValue_fromArray,Ui.prototype._setValue_fromArray_setNeedsUpdate,Ui.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class BI{constructor(){this.isAnimationObjectGroup=!0,this.uuid=er(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let s=0,o=arguments.length;s!==o;++s)t[arguments[s].uuid]=s;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,s=this._paths,o=this._parsedPaths,c=this._bindings,d=c.length;let a,_=t.length,v=this.nCachedObjects_;for(let S=0,M=arguments.length;S!==M;++S){const A=arguments[S],C=A.uuid;let R=e[C];if(R===void 0){R=_++,e[C]=R,t.push(A);for(let F=0,z=d;F!==z;++F)c[F].push(new Ui(A,s[F],o[F]))}else if(R<v){a=t[R];const F=--v,z=t[F];e[z.uuid]=R,t[R]=z,e[C]=F,t[F]=A;for(let L=0,W=d;L!==W;++L){const G=c[L],H=G[F];let Q=G[R];G[R]=H,Q===void 0&&(Q=new Ui(A,s[L],o[L])),G[F]=Q}}else t[R]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=v}remove(){const t=this._objects,e=this._indicesByUUID,s=this._bindings,o=s.length;let c=this.nCachedObjects_;for(let d=0,a=arguments.length;d!==a;++d){const _=arguments[d],v=_.uuid,S=e[v];if(S!==void 0&&S>=c){const M=c++,A=t[M];e[A.uuid]=S,t[S]=A,e[v]=M,t[M]=_;for(let C=0,R=o;C!==R;++C){const F=s[C],z=F[M],L=F[S];F[S]=z,F[M]=L}}}this.nCachedObjects_=c}uncache(){const t=this._objects,e=this._indicesByUUID,s=this._bindings,o=s.length;let c=this.nCachedObjects_,d=t.length;for(let a=0,_=arguments.length;a!==_;++a){const v=arguments[a],S=v.uuid,M=e[S];if(M!==void 0)if(delete e[S],M<c){const A=--c,C=t[A],R=--d,F=t[R];e[C.uuid]=M,t[M]=C,e[F.uuid]=A,t[A]=F,t.pop();for(let z=0,L=o;z!==L;++z){const W=s[z],G=W[A],H=W[R];W[M]=G,W[A]=H,W.pop()}}else{const A=--d,C=t[A];A>0&&(e[C.uuid]=M),t[M]=C,t.pop();for(let R=0,F=o;R!==F;++R){const z=s[R];z[M]=z[A],z.pop()}}}this.nCachedObjects_=c}subscribe_(t,e){const s=this._bindingsIndicesByPath;let o=s[t];const c=this._bindings;if(o!==void 0)return c[o];const d=this._paths,a=this._parsedPaths,_=this._objects,v=_.length,S=this.nCachedObjects_,M=new Array(v);o=c.length,s[t]=o,d.push(t),a.push(e),c.push(M);for(let A=S,C=_.length;A!==C;++A){const R=_[A];M[A]=new Ui(R,t,e)}return M}unsubscribe_(t){const e=this._bindingsIndicesByPath,s=e[t];if(s!==void 0){const o=this._paths,c=this._parsedPaths,d=this._bindings,a=d.length-1,_=d[a],v=t[a];e[v]=s,d[s]=_,d.pop(),c[s]=c[a],c.pop(),o[s]=o[a],o.pop()}}}class Qb{constructor(t,e,s=null,o=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=s,this.blendMode=o;const c=e.tracks,d=c.length,a=new Array(d),_={endingStart:rl,endingEnd:rl};for(let v=0;v!==d;++v){const S=c[v].createInterpolant(null);a[v]=S,S.settings=_}this._interpolantSettings=_,this._interpolants=a,this._propertyBindings=new Array(d),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=G1,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,s){if(t.fadeOut(e),this.fadeIn(e),s){const o=this._clip.duration,c=t._clip.duration,d=c/o,a=o/c;t.warp(1,d,e),this.warp(a,1,e)}return this}crossFadeTo(t,e,s){return t.crossFadeFrom(this,e,s)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,s){const o=this._mixer,c=o.time,d=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=o._lendControlInterpolant(),this._timeScaleInterpolant=a);const _=a.parameterPositions,v=a.sampleValues;return _[0]=c,_[1]=c+s,v[0]=t/d,v[1]=e/d,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,s,o){if(!this.enabled){this._updateWeight(t);return}const c=this._startTime;if(c!==null){const _=(t-c)*s;_<0||s===0?e=0:(this._startTime=null,e=s*_)}e*=this._updateTimeScale(t);const d=this._updateTime(e),a=this._updateWeight(t);if(a>0){const _=this._interpolants,v=this._propertyBindings;switch(this.blendMode){case W_:for(let S=0,M=_.length;S!==M;++S)_[S].evaluate(d),v[S].accumulateAdditive(a);break;case qp:default:for(let S=0,M=_.length;S!==M;++S)_[S].evaluate(d),v[S].accumulate(o,a)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const s=this._weightInterpolant;if(s!==null){const o=s.evaluate(t)[0];e*=o,t>s.parameterPositions[1]&&(this.stopFading(),o===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const s=this._timeScaleInterpolant;if(s!==null){const o=s.evaluate(t)[0];e*=o,t>s.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,s=this.loop;let o=this.time+t,c=this._loopCount;const d=s===H1;if(t===0)return c===-1?o:d&&(c&1)===1?e-o:o;if(s===V1){c===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(o>=e)o=e;else if(o<0)o=0;else{this.time=o;break t}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(c===-1&&(t>=0?(c=0,this._setEndings(!0,this.repetitions===0,d)):this._setEndings(this.repetitions===0,!0,d)),o>=e||o<0){const a=Math.floor(o/e);o-=e*a,c+=Math.abs(a);const _=this.repetitions-c;if(_<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,o=t>0?e:0,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(_===1){const v=t<0;this._setEndings(v,!v,d)}else this._setEndings(!1,!1,d);this._loopCount=c,this.time=o,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=o;if(d&&(c&1)===1)return e-o}return o}_setEndings(t,e,s){const o=this._interpolantSettings;s?(o.endingStart=al,o.endingEnd=al):(t?o.endingStart=this.zeroSlopeAtStart?al:rl:o.endingStart=Hu,e?o.endingEnd=this.zeroSlopeAtEnd?al:rl:o.endingEnd=Hu)}_scheduleFading(t,e,s){const o=this._mixer,c=o.time;let d=this._weightInterpolant;d===null&&(d=o._lendControlInterpolant(),this._weightInterpolant=d);const a=d.parameterPositions,_=d.sampleValues;return a[0]=c,_[0]=e,a[1]=c+t,_[1]=s,this}}const OI=new Float32Array(1);class NI extends Ca{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const s=t._localRoot||this._root,o=t._clip.tracks,c=o.length,d=t._propertyBindings,a=t._interpolants,_=s.uuid,v=this._bindingsByRootAndName;let S=v[_];S===void 0&&(S={},v[_]=S);for(let M=0;M!==c;++M){const A=o[M],C=A.name;let R=S[C];if(R!==void 0)++R.referenceCount,d[M]=R;else{if(R=d[M],R!==void 0){R._cacheIndex===null&&(++R.referenceCount,this._addInactiveBinding(R,_,C));continue}const F=e&&e._propertyBindings[M].binding.parsedPath;R=new Kb(Ui.create(s,C,F),A.ValueTypeName,A.getValueSize()),++R.referenceCount,this._addInactiveBinding(R,_,C),d[M]=R}a[M].resultBuffer=R.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const s=(t._localRoot||this._root).uuid,o=t._clip.uuid,c=this._actionsByClip[o];this._bindAction(t,c&&c.knownActions[0]),this._addInactiveAction(t,o,s)}const e=t._propertyBindings;for(let s=0,o=e.length;s!==o;++s){const c=e[s];c.useCount++===0&&(this._lendBinding(c),c.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let s=0,o=e.length;s!==o;++s){const c=e[s];--c.useCount===0&&(c.restoreOriginalState(),this._takeBackBinding(c))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,s){const o=this._actions,c=this._actionsByClip;let d=c[e];if(d===void 0)d={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,c[e]=d;else{const a=d.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=o.length,o.push(t),d.actionByRoot[s]=t}_removeInactiveAction(t){const e=this._actions,s=e[e.length-1],o=t._cacheIndex;s._cacheIndex=o,e[o]=s,e.pop(),t._cacheIndex=null;const c=t._clip.uuid,d=this._actionsByClip,a=d[c],_=a.knownActions,v=_[_.length-1],S=t._byClipCacheIndex;v._byClipCacheIndex=S,_[S]=v,_.pop(),t._byClipCacheIndex=null;const M=a.actionByRoot,A=(t._localRoot||this._root).uuid;delete M[A],_.length===0&&delete d[c],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let s=0,o=e.length;s!==o;++s){const c=e[s];--c.referenceCount===0&&this._removeInactiveBinding(c)}}_lendAction(t){const e=this._actions,s=t._cacheIndex,o=this._nActiveActions++,c=e[o];t._cacheIndex=o,e[o]=t,c._cacheIndex=s,e[s]=c}_takeBackAction(t){const e=this._actions,s=t._cacheIndex,o=--this._nActiveActions,c=e[o];t._cacheIndex=o,e[o]=t,c._cacheIndex=s,e[s]=c}_addInactiveBinding(t,e,s){const o=this._bindingsByRootAndName,c=this._bindings;let d=o[e];d===void 0&&(d={},o[e]=d),d[s]=t,t._cacheIndex=c.length,c.push(t)}_removeInactiveBinding(t){const e=this._bindings,s=t.binding,o=s.rootNode.uuid,c=s.path,d=this._bindingsByRootAndName,a=d[o],_=e[e.length-1],v=t._cacheIndex;_._cacheIndex=v,e[v]=_,e.pop(),delete a[c],Object.keys(a).length===0&&delete d[o]}_lendBinding(t){const e=this._bindings,s=t._cacheIndex,o=this._nActiveBindings++,c=e[o];t._cacheIndex=o,e[o]=t,c._cacheIndex=s,e[s]=c}_takeBackBinding(t){const e=this._bindings,s=t._cacheIndex,o=--this._nActiveBindings,c=e[o];t._cacheIndex=o,e[o]=t,c._cacheIndex=s,e[s]=c}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let s=t[e];return s===void 0&&(s=new m0(new Float32Array(2),new Float32Array(2),1,OI),s.__cacheIndex=e,t[e]=s),s}_takeBackControlInterpolant(t){const e=this._controlInterpolants,s=t.__cacheIndex,o=--this._nActiveControlInterpolants,c=e[o];t.__cacheIndex=o,e[o]=t,c.__cacheIndex=s,e[s]=c}clipAction(t,e,s){const o=e||this._root,c=o.uuid;let d=typeof t=="string"?Ku.findByName(o,t):t;const a=d!==null?d.uuid:t,_=this._actionsByClip[a];let v=null;if(s===void 0&&(d!==null?s=d.blendMode:s=qp),_!==void 0){const M=_.actionByRoot[c];if(M!==void 0&&M.blendMode===s)return M;v=_.knownActions[0],d===null&&(d=v._clip)}if(d===null)return null;const S=new Qb(this,d,e,s);return this._bindAction(S,v),this._addInactiveAction(S,a,c),S}existingAction(t,e){const s=e||this._root,o=s.uuid,c=typeof t=="string"?Ku.findByName(s,t):t,d=c?c.uuid:t,a=this._actionsByClip[d];return a!==void 0&&a.actionByRoot[o]||null}stopAllAction(){const t=this._actions,e=this._nActiveActions;for(let s=e-1;s>=0;--s)t[s].stop();return this}update(t){t*=this.timeScale;const e=this._actions,s=this._nActiveActions,o=this.time+=t,c=Math.sign(t),d=this._accuIndex^=1;for(let v=0;v!==s;++v)e[v]._update(o,t,c,d);const a=this._bindings,_=this._nActiveBindings;for(let v=0;v!==_;++v)a[v].apply(d);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,s=t.uuid,o=this._actionsByClip,c=o[s];if(c!==void 0){const d=c.knownActions;for(let a=0,_=d.length;a!==_;++a){const v=d[a];this._deactivateAction(v);const S=v._cacheIndex,M=e[e.length-1];v._cacheIndex=null,v._byClipCacheIndex=null,M._cacheIndex=S,e[S]=M,e.pop(),this._removeInactiveBindingsForAction(v)}delete o[s]}}uncacheRoot(t){const e=t.uuid,s=this._actionsByClip;for(const d in s){const a=s[d].actionByRoot,_=a[e];_!==void 0&&(this._deactivateAction(_),this._removeInactiveAction(_))}const o=this._bindingsByRootAndName,c=o[e];if(c!==void 0)for(const d in c){const a=c[d];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(t,e){const s=this.existingAction(t,e);s!==null&&(this._deactivateAction(s),this._removeInactiveAction(s))}}class w0{constructor(t){this.value=t}clone(){return new w0(this.value.clone===void 0?this.value:this.value.clone())}}let UI=0;class VI extends Ca{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:UI++}),this.name="",this.usage=Wu,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return e!==-1&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let s=0,o=e.length;s<o;s++)this.uniforms.push(e[s].clone());return this}clone(){return new this.constructor().copy(this)}}class GI extends tm{constructor(t,e,s=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class HI{constructor(t,e,s,o,c){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=s,this.elementSize=o,this.count=c,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}class WI{constructor(t,e,s=0,o=1/0){this.ray=new ad(t,e),this.near=s,this.far=o,this.camera=null,this.layers=new jp,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,s=[]){return L_(t,this,s,e),s.sort(xx),s}intersectObjects(t,e=!0,s=[]){for(let o=0,c=t.length;o<c;o++)L_(t[o],this,s,e);return s.sort(xx),s}}function xx(l,t){return l.distance-t.distance}function L_(l,t,e,s){if(l.layers.test(t.layers)&&l.raycast(t,e),s===!0){const o=l.children;for(let c=0,d=o.length;c<d;c++)L_(o[c],t,e,!0)}}class qI{constructor(t=1,e=0,s=0){return this.radius=t,this.phi=e,this.theta=s,this}set(t,e,s){return this.radius=t,this.phi=e,this.theta=s,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,s){return this.radius=Math.sqrt(t*t+e*e+s*s),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,s),this.phi=Math.acos(wn(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class $I{constructor(t=1,e=0,s=0){return this.radius=t,this.theta=e,this.y=s,this}set(t,e,s){return this.radius=t,this.theta=e,this.y=s,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,s){return this.radius=Math.sqrt(t*t+s*s),this.theta=Math.atan2(t,s),this.y=e,this}clone(){return new this.constructor().copy(this)}}const bx=new me;class jI{constructor(t=new me(1/0,1/0),e=new me(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=bx.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,bx).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const wx=new ut,pp=new ut;class ZI{constructor(t=new ut,e=new ut){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){wx.subVectors(t,this.start),pp.subVectors(this.end,this.start);const s=pp.dot(pp);let c=pp.dot(wx)/s;return e&&(c=wn(c,0,1)),c}closestPointToPoint(t,e,s){const o=this.closestPointToPointParameter(t,e);return this.delta(s).multiplyScalar(o).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Mx=new ut;class XI extends Vi{constructor(t,e){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const s=new Ii,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let d=0,a=1,_=32;d<_;d++,a++){const v=d/_*Math.PI*2,S=a/_*Math.PI*2;o.push(Math.cos(v),Math.sin(v),1,Math.cos(S),Math.sin(S),1)}s.setAttribute("position",new ii(o,3));const c=new ys({fog:!1,toneMapped:!1});this.cone=new Pr(s,c),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Mx.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Mx),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const oo=new ut,mp=new xi,Ug=new xi;class YI extends Pr{constructor(t){const e=tw(t),s=new Ii,o=[],c=[],d=new Je(0,0,1),a=new Je(0,1,0);for(let v=0;v<e.length;v++){const S=e[v];S.parent&&S.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),c.push(d.r,d.g,d.b),c.push(a.r,a.g,a.b))}s.setAttribute("position",new ii(o,3)),s.setAttribute("color",new ii(c,3));const _=new ys({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(s,_),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,s=this.geometry,o=s.getAttribute("position");Ug.copy(this.root.matrixWorld).invert();for(let c=0,d=0;c<e.length;c++){const a=e[c];a.parent&&a.parent.isBone&&(mp.multiplyMatrices(Ug,a.matrixWorld),oo.setFromMatrixPosition(mp),o.setXYZ(d,oo.x,oo.y,oo.z),mp.multiplyMatrices(Ug,a.parent.matrixWorld),oo.setFromMatrixPosition(mp),o.setXYZ(d+1,oo.x,oo.y,oo.z),d+=2)}s.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function tw(l){const t=[];l.isBone===!0&&t.push(l);for(let e=0;e<l.children.length;e++)t.push.apply(t,tw(l.children[e]));return t}class JI extends Vn{constructor(t,e,s){const o=new ec(e,4,2),c=new Mo({wireframe:!0,fog:!1,toneMapped:!1});super(o,c),this.light=t,this.color=s,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const KI=new ut,Sx=new Je,Ax=new Je;class QI extends Vi{constructor(t,e,s){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=s,this.type="HemisphereLightHelper";const o=new tc(e);o.rotateY(Math.PI*.5),this.material=new Mo({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const c=o.getAttribute("position"),d=new Float32Array(c.count*3);o.setAttribute("color",new Zi(d,3)),this.add(new Vn(o,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Sx.copy(this.light.color),Ax.copy(this.light.groundColor);for(let s=0,o=e.count;s<o;s++){const c=s<o/2?Sx:Ax;e.setXYZ(s,c.r,c.g,c.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(KI.setFromMatrixPosition(this.light.matrixWorld).negate())}}class tP extends Pr{constructor(t=10,e=10,s=4473924,o=8947848){s=new Je(s),o=new Je(o);const c=e/2,d=t/e,a=t/2,_=[],v=[];for(let A=0,C=0,R=-a;A<=e;A++,R+=d){_.push(-a,0,R,a,0,R),_.push(R,0,-a,R,0,a);const F=A===c?s:o;F.toArray(v,C),C+=3,F.toArray(v,C),C+=3,F.toArray(v,C),C+=3,F.toArray(v,C),C+=3}const S=new Ii;S.setAttribute("position",new ii(_,3)),S.setAttribute("color",new ii(v,3));const M=new ys({vertexColors:!0,toneMapped:!1});super(S,M),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class eP extends Pr{constructor(t=10,e=16,s=8,o=64,c=4473924,d=8947848){c=new Je(c),d=new Je(d);const a=[],_=[];if(e>1)for(let M=0;M<e;M++){const A=M/e*(Math.PI*2),C=Math.sin(A)*t,R=Math.cos(A)*t;a.push(0,0,0),a.push(C,0,R);const F=M&1?c:d;_.push(F.r,F.g,F.b),_.push(F.r,F.g,F.b)}for(let M=0;M<s;M++){const A=M&1?c:d,C=t-t/s*M;for(let R=0;R<o;R++){let F=R/o*(Math.PI*2),z=Math.sin(F)*C,L=Math.cos(F)*C;a.push(z,0,L),_.push(A.r,A.g,A.b),F=(R+1)/o*(Math.PI*2),z=Math.sin(F)*C,L=Math.cos(F)*C,a.push(z,0,L),_.push(A.r,A.g,A.b)}}const v=new Ii;v.setAttribute("position",new ii(a,3)),v.setAttribute("color",new ii(_,3));const S=new ys({vertexColors:!0,toneMapped:!1});super(v,S),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Tx=new ut,gp=new ut,Ex=new ut;class iP extends Vi{constructor(t,e,s){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=s,this.type="DirectionalLightHelper",e===void 0&&(e=1);let o=new Ii;o.setAttribute("position",new ii([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const c=new ys({fog:!1,toneMapped:!1});this.lightPlane=new vo(o,c),this.add(this.lightPlane),o=new Ii,o.setAttribute("position",new ii([0,0,0,0,0,1],3)),this.targetLine=new vo(o,c),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Tx.setFromMatrixPosition(this.light.matrixWorld),gp.setFromMatrixPosition(this.light.target.matrixWorld),Ex.subVectors(gp,Tx),this.lightPlane.lookAt(gp),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(gp),this.targetLine.scale.z=Ex.length()}}const _p=new ut,bn=new ld;class nP extends Pr{constructor(t){const e=new Ii,s=new ys({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],c=[],d={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(R,F){_(R),_(F)}function _(R){o.push(0,0,0),c.push(0,0,0),d[R]===void 0&&(d[R]=[]),d[R].push(o.length/3-1)}e.setAttribute("position",new ii(o,3)),e.setAttribute("color",new ii(c,3)),super(e,s),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=d,this.update();const v=new Je(16755200),S=new Je(16711680),M=new Je(43775),A=new Je(16777215),C=new Je(3355443);this.setColors(v,S,M,A,C)}setColors(t,e,s,o,c){const a=this.geometry.getAttribute("color");a.setXYZ(0,t.r,t.g,t.b),a.setXYZ(1,t.r,t.g,t.b),a.setXYZ(2,t.r,t.g,t.b),a.setXYZ(3,t.r,t.g,t.b),a.setXYZ(4,t.r,t.g,t.b),a.setXYZ(5,t.r,t.g,t.b),a.setXYZ(6,t.r,t.g,t.b),a.setXYZ(7,t.r,t.g,t.b),a.setXYZ(8,t.r,t.g,t.b),a.setXYZ(9,t.r,t.g,t.b),a.setXYZ(10,t.r,t.g,t.b),a.setXYZ(11,t.r,t.g,t.b),a.setXYZ(12,t.r,t.g,t.b),a.setXYZ(13,t.r,t.g,t.b),a.setXYZ(14,t.r,t.g,t.b),a.setXYZ(15,t.r,t.g,t.b),a.setXYZ(16,t.r,t.g,t.b),a.setXYZ(17,t.r,t.g,t.b),a.setXYZ(18,t.r,t.g,t.b),a.setXYZ(19,t.r,t.g,t.b),a.setXYZ(20,t.r,t.g,t.b),a.setXYZ(21,t.r,t.g,t.b),a.setXYZ(22,t.r,t.g,t.b),a.setXYZ(23,t.r,t.g,t.b),a.setXYZ(24,e.r,e.g,e.b),a.setXYZ(25,e.r,e.g,e.b),a.setXYZ(26,e.r,e.g,e.b),a.setXYZ(27,e.r,e.g,e.b),a.setXYZ(28,e.r,e.g,e.b),a.setXYZ(29,e.r,e.g,e.b),a.setXYZ(30,e.r,e.g,e.b),a.setXYZ(31,e.r,e.g,e.b),a.setXYZ(32,s.r,s.g,s.b),a.setXYZ(33,s.r,s.g,s.b),a.setXYZ(34,s.r,s.g,s.b),a.setXYZ(35,s.r,s.g,s.b),a.setXYZ(36,s.r,s.g,s.b),a.setXYZ(37,s.r,s.g,s.b),a.setXYZ(38,o.r,o.g,o.b),a.setXYZ(39,o.r,o.g,o.b),a.setXYZ(40,c.r,c.g,c.b),a.setXYZ(41,c.r,c.g,c.b),a.setXYZ(42,c.r,c.g,c.b),a.setXYZ(43,c.r,c.g,c.b),a.setXYZ(44,c.r,c.g,c.b),a.setXYZ(45,c.r,c.g,c.b),a.setXYZ(46,c.r,c.g,c.b),a.setXYZ(47,c.r,c.g,c.b),a.setXYZ(48,c.r,c.g,c.b),a.setXYZ(49,c.r,c.g,c.b),a.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap,s=1,o=1;bn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Pn("c",e,t,bn,0,0,-1),Pn("t",e,t,bn,0,0,1),Pn("n1",e,t,bn,-s,-o,-1),Pn("n2",e,t,bn,s,-o,-1),Pn("n3",e,t,bn,-s,o,-1),Pn("n4",e,t,bn,s,o,-1),Pn("f1",e,t,bn,-s,-o,1),Pn("f2",e,t,bn,s,-o,1),Pn("f3",e,t,bn,-s,o,1),Pn("f4",e,t,bn,s,o,1),Pn("u1",e,t,bn,s*.7,o*1.1,-1),Pn("u2",e,t,bn,-s*.7,o*1.1,-1),Pn("u3",e,t,bn,0,o*2,-1),Pn("cf1",e,t,bn,-s,0,1),Pn("cf2",e,t,bn,s,0,1),Pn("cf3",e,t,bn,0,-o,1),Pn("cf4",e,t,bn,0,o,1),Pn("cn1",e,t,bn,-s,0,-1),Pn("cn2",e,t,bn,s,0,-1),Pn("cn3",e,t,bn,0,-o,-1),Pn("cn4",e,t,bn,0,o,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Pn(l,t,e,s,o,c,d){_p.set(o,c,d).unproject(s);const a=t[l];if(a!==void 0){const _=e.getAttribute("position");for(let v=0,S=a.length;v<S;v++)_.setXYZ(a[v],_p.x,_p.y,_p.z)}}const yp=new Yr;class sP extends Pr{constructor(t,e=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(8*3),c=new Ii;c.setIndex(new Zi(s,1)),c.setAttribute("position",new Zi(o,3)),super(c,new ys({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(t!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&yp.setFromObject(this.object),yp.isEmpty())return;const e=yp.min,s=yp.max,o=this.geometry.attributes.position,c=o.array;c[0]=s.x,c[1]=s.y,c[2]=s.z,c[3]=e.x,c[4]=s.y,c[5]=s.z,c[6]=e.x,c[7]=e.y,c[8]=s.z,c[9]=s.x,c[10]=e.y,c[11]=s.z,c[12]=s.x,c[13]=s.y,c[14]=e.z,c[15]=e.x,c[16]=s.y,c[17]=e.z,c[18]=e.x,c[19]=e.y,c[20]=e.z,c[21]=s.x,c[22]=e.y,c[23]=e.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class rP extends Pr{constructor(t,e=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],c=new Ii;c.setIndex(new Zi(s,1)),c.setAttribute("position",new ii(o,3)),super(c,new ys({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class aP extends vo{constructor(t,e=1,s=16776960){const o=s,c=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],d=new Ii;d.setAttribute("position",new ii(c,3)),d.computeBoundingSphere(),super(d,new ys({color:o,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],_=new Ii;_.setAttribute("position",new ii(a,3)),_.computeBoundingSphere(),this.add(new Vn(_,new Mo({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Cx=new ut;let vp,Vg;class oP extends Vi{constructor(t=new ut(0,0,1),e=new ut(0,0,0),s=1,o=16776960,c=s*.2,d=c*.2){super(),this.type="ArrowHelper",vp===void 0&&(vp=new Ii,vp.setAttribute("position",new ii([0,0,0,0,1,0],3)),Vg=new vl(0,.5,1,5,1),Vg.translate(0,-.5,0)),this.position.copy(e),this.line=new vo(vp,new ys({color:o,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Vn(Vg,new Mo({color:o,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(s,c,d)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Cx.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Cx,e)}}setLength(t,e=t*.2,s=e*.2){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(s,e,s),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class lP extends Pr{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],s=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],o=new Ii;o.setAttribute("position",new ii(e,3)),o.setAttribute("color",new ii(s,3));const c=new ys({vertexColors:!0,toneMapped:!1});super(o,c),this.type="AxesHelper"}setColors(t,e,s){const o=new Je,c=this.geometry.attributes.color.array;return o.set(t),o.toArray(c,0),o.toArray(c,3),o.set(e),o.toArray(c,6),o.toArray(c,9),o.set(s),o.toArray(c,12),o.toArray(c,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class hP{constructor(){this.type="ShapePath",this.color=new Je,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new $u,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,s,o){return this.currentPath.quadraticCurveTo(t,e,s,o),this}bezierCurveTo(t,e,s,o,c,d){return this.currentPath.bezierCurveTo(t,e,s,o,c,d),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(L){const W=[];for(let G=0,H=L.length;G<H;G++){const Q=L[G],nt=new uo;nt.curves=Q.curves,W.push(nt)}return W}function s(L,W){const G=W.length;let H=!1;for(let Q=G-1,nt=0;nt<G;Q=nt++){let pt=W[Q],ft=W[nt],K=ft.x-pt.x,ot=ft.y-pt.y;if(Math.abs(ot)>Number.EPSILON){if(ot<0&&(pt=W[nt],K=-K,ft=W[Q],ot=-ot),L.y<pt.y||L.y>ft.y)continue;if(L.y===pt.y){if(L.x===pt.x)return!0}else{const kt=ot*(L.x-pt.x)-K*(L.y-pt.y);if(kt===0)return!0;if(kt<0)continue;H=!H}}else{if(L.y!==pt.y)continue;if(ft.x<=L.x&&L.x<=pt.x||pt.x<=L.x&&L.x<=ft.x)return!0}}return H}const o=Wr.isClockWise,c=this.subPaths;if(c.length===0)return[];let d,a,_;const v=[];if(c.length===1)return a=c[0],_=new uo,_.curves=a.curves,v.push(_),v;let S=!o(c[0].getPoints());S=t?!S:S;const M=[],A=[];let C=[],R=0,F;A[R]=void 0,C[R]=[];for(let L=0,W=c.length;L<W;L++)a=c[L],F=a.getPoints(),d=o(F),d=t?!d:d,d?(!S&&A[R]&&R++,A[R]={s:new uo,p:F},A[R].s.curves=a.curves,S&&R++,C[R]=[]):C[R].push({h:a,p:F[0]});if(!A[0])return e(c);if(A.length>1){let L=!1,W=0;for(let G=0,H=A.length;G<H;G++)M[G]=[];for(let G=0,H=A.length;G<H;G++){const Q=C[G];for(let nt=0;nt<Q.length;nt++){const pt=Q[nt];let ft=!0;for(let K=0;K<A.length;K++)s(pt.p,A[K].p)&&(G!==K&&W++,ft?(ft=!1,M[K].push(pt)):L=!0);ft&&M[G].push(pt)}}W>0&&L===!1&&(C=M)}let z;for(let L=0,W=A.length;L<W;L++){_=A[L].s,v.push(_),z=C[L];for(let G=0,H=z.length;G<H;G++)_.holes.push(z[G].h)}return v}}class cP extends So{constructor(t,e,s,o,c,d){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(t,e,s,o,c,d)}}class uP extends cd{constructor(t,e,s,o){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(t,e,s,o)}}class dP extends ud{constructor(t,e,s,o){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(t,e,s,o)}}class fP extends dd{constructor(t,e,s,o,c,d,a){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(t,e,s,o,c,d,a)}}class pP extends vl{constructor(t,e,s,o,c,d,a,_){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(t,e,s,o,c,d,a,_)}}class mP extends fd{constructor(t,e){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(t,e)}}class gP extends Qh{constructor(t,e){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(t,e)}}class _P extends pd{constructor(t,e){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(t,e)}}class yP extends Kh{constructor(t,e,s,o){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(t,e,s,o)}}class vP extends tc{constructor(t,e){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(t,e)}}class xP extends Yh{constructor(t,e,s,o){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(t,e,s,o)}}class bP extends Ia{constructor(t,e,s,o){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(t,e,s,o)}}class wP extends md{constructor(t,e,s,o,c,d){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(t,e,s,o,c,d)}}class MP extends gd{constructor(t,e){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(t,e)}}class SP extends ec{constructor(t,e,s,o,c,d,a){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(t,e,s,o,c,d,a)}}class AP extends _d{constructor(t,e){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(t,e)}}class TP extends yd{constructor(t,e,s,o,c){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(t,e,s,o,c)}}class EP extends vd{constructor(t,e,s,o,c,d){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(t,e,s,o,c,d)}}class CP extends xd{constructor(t,e,s,o,c){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(t,e,s,o,c)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Hp}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Hp);const IP=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:S1,AddEquation:nl,AddOperation:x1,AdditiveAnimationBlendMode:W_,AdditiveBlending:Zg,AlphaFormat:L1,AlwaysDepth:f1,AlwaysStencilFunc:j1,AmbientLight:qb,AmbientLightProbe:bI,AnimationAction:Qb,AnimationClip:Ku,AnimationLoader:lI,AnimationMixer:NI,AnimationObjectGroup:BI,AnimationUtils:sI,ArcCurve:yb,ArrayCamera:lb,ArrowHelper:oP,Audio:Jb,AudioAnalyser:EI,AudioContext:v0,AudioListener:SI,AudioLoader:vI,AxesHelper:lP,BackSide:Ps,BasicDepthPacking:W1,BasicShadowMap:SS,Bone:i0,BooleanKeyframeTrack:xl,Box2:jI,Box3:Yr,Box3Helper:rP,BoxBufferGeometry:cP,BoxGeometry:So,BoxHelper:sP,BufferAttribute:Zi,BufferGeometry:Ii,BufferGeometryLoader:Xb,ByteType:T1,Cache:gl,Camera:ld,CameraHelper:nP,CanvasTexture:C3,CapsuleBufferGeometry:uP,CapsuleGeometry:cd,CatmullRomCurve3:vb,CineonToneMapping:M1,CircleBufferGeometry:dP,CircleGeometry:ud,ClampToEdgeWrapping:gs,Clock:Yb,Color:Je,ColorKeyframeTrack:g0,ColorManagement:zs,CompressedArrayTexture:E3,CompressedTexture:s0,CompressedTextureLoader:hI,ConeBufferGeometry:fP,ConeGeometry:dd,CubeCamera:tb,CubeReflectionMapping:po,CubeRefractionMapping:mo,CubeTexture:hd,CubeTextureLoader:cI,CubeUVReflectionMapping:Xh,CubicBezierCurve:a0,CubicBezierCurve3:xb,CubicInterpolant:Bb,CullFaceBack:jg,CullFaceFront:Kx,CullFaceFrontBack:MS,CullFaceNone:Jx,Curve:Lr,CurvePath:wb,CustomBlending:t1,CustomToneMapping:A1,CylinderBufferGeometry:pP,CylinderGeometry:vl,Cylindrical:$I,Data3DTexture:Z_,DataArrayTexture:$p,DataTexture:Nh,DataTextureLoader:uI,DataUtils:B2,DecrementStencilOp:BS,DecrementWrapStencilOp:NS,DefaultLoadingManager:Ub,DepthFormat:co,DepthStencilFormat:fl,DepthTexture:hb,DirectionalLight:Wb,DirectionalLightHelper:iP,DiscreteInterpolant:Ob,DisplayP3ColorSpace:q_,DodecahedronBufferGeometry:mP,DodecahedronGeometry:fd,DoubleSide:Vr,DstAlphaFactor:o1,DstColorFactor:h1,DynamicCopyUsage:t2,DynamicDrawUsage:ZS,DynamicReadUsage:JS,EdgesGeometry:u0,EllipseCurve:im,EqualDepth:m1,EqualStencilFunc:HS,EquirectangularReflectionMapping:Bu,EquirectangularRefractionMapping:Ou,Euler:od,EventDispatcher:Ca,ExtrudeBufferGeometry:gP,ExtrudeGeometry:Qh,FileLoader:Zr,Float16BufferAttribute:H2,Float32BufferAttribute:ii,Float64BufferAttribute:W2,FloatType:Aa,Fog:Qp,FogExp2:Kp,FramebufferTexture:T3,FrontSide:Ea,Frustum:Zp,GLBufferAttribute:HI,GLSL1:i2,GLSL3:w_,GreaterDepth:_1,GreaterEqualDepth:g1,GreaterEqualStencilFunc:jS,GreaterStencilFunc:qS,GridHelper:tP,Group:ll,HalfFloatType:Gh,HemisphereLight:Vb,HemisphereLightHelper:QI,HemisphereLightProbe:xI,IcosahedronBufferGeometry:_P,IcosahedronGeometry:pd,ImageBitmapLoader:yI,ImageLoader:Qu,ImageUtils:j_,IncrementStencilOp:FS,IncrementWrapStencilOp:OS,InstancedBufferAttribute:$h,InstancedBufferGeometry:Zb,InstancedInterleavedBuffer:GI,InstancedMesh:mb,Int16BufferAttribute:V2,Int32BufferAttribute:G2,Int8BufferAttribute:O2,IntType:C1,InterleavedBuffer:tm,InterleavedBufferAttribute:pl,Interpolant:bd,InterpolateDiscrete:Vu,InterpolateLinear:Gu,InterpolateSmooth:Cp,InvertStencilOp:US,KeepStencilOp:Ip,KeyframeTrack:Rr,LOD:fb,LatheBufferGeometry:yP,LatheGeometry:Kh,Layers:jp,LessDepth:p1,LessEqualDepth:zp,LessEqualStencilFunc:WS,LessStencilFunc:GS,Light:Ao,LightProbe:rm,Line:vo,Line3:ZI,LineBasicMaterial:ys,LineCurve:nm,LineCurve3:bb,LineDashedMaterial:kb,LineLoop:gb,LineSegments:Pr,LinearEncoding:yo,LinearFilter:Dn,LinearInterpolant:m0,LinearMipMapLinearFilter:IS,LinearMipMapNearestFilter:CS,LinearMipmapLinearFilter:go,LinearMipmapNearestFilter:G_,LinearSRGBColorSpace:Hh,LinearToneMapping:b1,Loader:ir,LoaderUtils:P_,LoadingManager:_0,LoopOnce:V1,LoopPingPong:H1,LoopRepeat:G1,LuminanceAlphaFormat:D1,LuminanceFormat:R1,MOUSE:bS,Material:_s,MaterialLoader:am,MathUtils:g2,Matrix3:ki,Matrix4:xi,MaxEquation:Kg,Mesh:Vn,MeshBasicMaterial:Mo,MeshDepthMaterial:K_,MeshDistanceMaterial:Q_,MeshLambertMaterial:Db,MeshMatcapMaterial:zb,MeshNormalMaterial:Rb,MeshPhongMaterial:Pb,MeshPhysicalMaterial:Ib,MeshStandardMaterial:d0,MeshToonMaterial:Lb,MinEquation:Jg,MirroredRepeatWrapping:Uu,MixOperation:v1,MultiplyBlending:Yg,MultiplyOperation:rd,NearestFilter:Rn,NearestMipMapLinearFilter:ES,NearestMipMapNearestFilter:TS,NearestMipmapLinearFilter:Eu,NearestMipmapNearestFilter:kp,NeverDepth:d1,NeverStencilFunc:VS,NoBlending:Ta,NoColorSpace:DS,NoToneMapping:Hr,NormalAnimationBlendMode:qp,NormalBlending:cl,NotEqualDepth:y1,NotEqualStencilFunc:$S,NumberKeyframeTrack:Yu,Object3D:Vi,ObjectLoader:gI,ObjectSpaceNormalMap:$1,OctahedronBufferGeometry:vP,OctahedronGeometry:tc,OneFactor:s1,OneMinusDstAlphaFactor:l1,OneMinusDstColorFactor:c1,OneMinusSrcAlphaFactor:V_,OneMinusSrcColorFactor:a1,OrthographicCamera:Xp,PCFShadowMap:N_,PCFSoftShadowMap:Qx,PMREMGenerator:S_,Path:$u,PerspectiveCamera:ns,Plane:lo,PlaneBufferGeometry:xP,PlaneGeometry:Yh,PlaneHelper:aP,PointLight:Hb,PointLightHelper:JI,Points:_b,PointsMaterial:n0,PolarGridHelper:eP,PolyhedronBufferGeometry:bP,PolyhedronGeometry:Ia,PositionalAudio:TI,PropertyBinding:Ui,PropertyMixer:Kb,QuadraticBezierCurve:o0,QuadraticBezierCurve3:l0,Quaternion:Os,QuaternionKeyframeTrack:ic,QuaternionLinearInterpolant:Nb,RED_GREEN_RGTC2_Format:x_,RED_RGTC1_Format:U1,REVISION:Hp,RGBADepthPacking:q1,RGBAFormat:Qs,RGBAIntegerFormat:O1,RGBA_ASTC_10x10_Format:g_,RGBA_ASTC_10x5_Format:f_,RGBA_ASTC_10x6_Format:p_,RGBA_ASTC_10x8_Format:m_,RGBA_ASTC_12x10_Format:__,RGBA_ASTC_12x12_Format:y_,RGBA_ASTC_4x4_Format:r_,RGBA_ASTC_5x4_Format:a_,RGBA_ASTC_5x5_Format:o_,RGBA_ASTC_6x5_Format:l_,RGBA_ASTC_6x6_Format:h_,RGBA_ASTC_8x5_Format:c_,RGBA_ASTC_8x6_Format:u_,RGBA_ASTC_8x8_Format:d_,RGBA_BPTC_Format:Ep,RGBA_ETC2_EAC_Format:s_,RGBA_PVRTC_2BPPV1_Format:i_,RGBA_PVRTC_4BPPV1_Format:e_,RGBA_S3TC_DXT1_Format:Sp,RGBA_S3TC_DXT3_Format:Ap,RGBA_S3TC_DXT5_Format:Tp,RGB_ETC1_Format:N1,RGB_ETC2_Format:n_,RGB_PVRTC_2BPPV1_Format:t_,RGB_PVRTC_4BPPV1_Format:Qg,RGB_S3TC_DXT1_Format:Mp,RGFormat:F1,RGIntegerFormat:B1,RawShaderMaterial:Cb,Ray:ad,Raycaster:WI,RectAreaLight:$b,RedFormat:z1,RedIntegerFormat:k1,ReinhardToneMapping:w1,RepeatWrapping:Nu,ReplaceStencilOp:kS,ReverseSubtractEquation:i1,RingBufferGeometry:wP,RingGeometry:md,SIGNED_RED_GREEN_RGTC2_Format:b_,SIGNED_RED_RGTC1_Format:v_,SRGBColorSpace:Tr,Scene:t0,ShaderChunk:Li,ShaderLib:Er,ShaderMaterial:jr,ShadowMaterial:Eb,Shape:uo,ShapeBufferGeometry:MP,ShapeGeometry:gd,ShapePath:hP,ShapeUtils:Wr,ShortType:E1,Skeleton:em,SkeletonHelper:YI,SkinnedMesh:pb,Source:ol,Sphere:Jr,SphereBufferGeometry:SP,SphereGeometry:ec,Spherical:qI,SphericalHarmonics3:jb,SplineCurve:h0,SpotLight:Gb,SpotLightHelper:XI,Sprite:db,SpriteMaterial:e0,SrcAlphaFactor:U_,SrcAlphaSaturateFactor:u1,SrcColorFactor:r1,StaticCopyUsage:QS,StaticDrawUsage:Wu,StaticReadUsage:YS,StereoCamera:wI,StreamCopyUsage:e2,StreamDrawUsage:XS,StreamReadUsage:KS,StringKeyframeTrack:bl,SubtractEquation:e1,SubtractiveBlending:Xg,TOUCH:wS,TangentSpaceNormalMap:wo,TetrahedronBufferGeometry:AP,TetrahedronGeometry:_d,Texture:zn,TextureLoader:dI,TorusBufferGeometry:TP,TorusGeometry:yd,TorusKnotBufferGeometry:EP,TorusKnotGeometry:vd,Triangle:Bs,TriangleFanDrawMode:RS,TriangleStripDrawMode:LS,TrianglesDrawMode:PS,TubeBufferGeometry:CP,TubeGeometry:xd,TwoPassDoubleSide:AS,UVMapping:Wp,Uint16BufferAttribute:X_,Uint32BufferAttribute:Y_,Uint8BufferAttribute:N2,Uint8ClampedBufferAttribute:U2,Uniform:w0,UniformsGroup:VI,UniformsLib:Ue,UniformsUtils:Q1,UnsignedByteType:_o,UnsignedInt248Type:ul,UnsignedIntType:ho,UnsignedShort4444Type:I1,UnsignedShort5551Type:P1,UnsignedShortType:H_,VSMShadowMap:Ih,Vector2:me,Vector3:ut,Vector4:Ji,VectorKeyframeTrack:Ju,VideoTexture:A3,WebGL1Renderer:cb,WebGL3DRenderTarget:T2,WebGLArrayRenderTarget:A2,WebGLCubeRenderTarget:eb,WebGLMultipleRenderTargets:E2,WebGLRenderTarget:Ir,WebGLRenderer:Jp,WebGLUtils:ob,WireframeGeometry:Tb,WrapAroundEnding:Hu,ZeroCurvatureEnding:rl,ZeroFactor:n1,ZeroSlopeEnding:al,ZeroStencilOp:zS,_SRGBAFormat:Fp,sRGBEncoding:on},Symbol.toStringTag,{value:"Module"}));/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.17.0
 * @author George Michael Brower
 * @license MIT
 */class qr{constructor(t,e,s,o,c="div"){this.parent=t,this.object=e,this.property=s,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(o),this.$name=document.createElement("div"),this.$name.classList.add("name"),qr.nextNameID=qr.nextNameID||0,this.$name.id="lil-gui-name-"+ ++qr.nextNameID,this.$widget=document.createElement(c),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(s)}name(t){return this._name=t,this.$name.innerHTML=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled||(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t)),this}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(t){const e=this.parent.add(this.object,this.property,t);return e.name(this._name),this.destroy(),e}min(t){return this}max(t){return this}step(t){return this}decimals(t){return this}listen(t=!0){return this._listening=t,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const t=this.save();t!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=t}getValue(){return this.object[this.property]}setValue(t){return this.object[this.property]=t,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class PP extends qr{constructor(t,e,s){super(t,e,s,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function R_(l){let t,e;return(t=l.match(/(#|0x)?([a-f0-9]{6})/i))?e=t[2]:(t=l.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?e=parseInt(t[1]).toString(16).padStart(2,0)+parseInt(t[2]).toString(16).padStart(2,0)+parseInt(t[3]).toString(16).padStart(2,0):(t=l.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(e=t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),!!e&&"#"+e}const LP={isPrimitive:!0,match:l=>typeof l=="string",fromHexString:R_,toHexString:R_},td={isPrimitive:!0,match:l=>typeof l=="number",fromHexString:l=>parseInt(l.substring(1),16),toHexString:l=>"#"+l.toString(16).padStart(6,0)},RP={isPrimitive:!1,match:Array.isArray,fromHexString(l,t,e=1){const s=td.fromHexString(l);t[0]=(s>>16&255)/255*e,t[1]=(s>>8&255)/255*e,t[2]=(255&s)/255*e},toHexString:([l,t,e],s=1)=>td.toHexString(l*(s=255/s)<<16^t*s<<8^e*s<<0)},DP={isPrimitive:!1,match:l=>Object(l)===l,fromHexString(l,t,e=1){const s=td.fromHexString(l);t.r=(s>>16&255)/255*e,t.g=(s>>8&255)/255*e,t.b=(255&s)/255*e},toHexString:({r:l,g:t,b:e},s=1)=>td.toHexString(l*(s=255/s)<<16^t*s<<8^e*s<<0)},zP=[LP,td,RP,DP];class kP extends qr{constructor(t,e,s,o){var c;super(t,e,s,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(c=this.initialValue,zP.find(d=>d.match(c))),this._rgbScale=o,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const d=R_(this.$text.value);d&&this._setValueFromHexString(d)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const e=this._format.fromHexString(t);this.setValue(e)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class Gg extends qr{constructor(t,e,s){super(t,e,s,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",o=>{o.preventDefault(),this.getValue().call(this.object)}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class FP extends qr{constructor(t,e,s,o,c,d){super(t,e,s,"number"),this._initInput(),this.min(o),this.max(c);const a=d!==void 0;this.step(a?d:this._getImplicitStep(),a),this.updateDisplay()}decimals(t){return this._decimals=t,this.updateDisplay(),this}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,e=!0){return this._step=t,this._stepExplicit=e,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let e=(t-this._min)/(this._max-this._min);e=Math.max(0,Math.min(e,1)),this.$fill.style.width=100*e+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?t:t.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=S=>{const M=parseFloat(this.$input.value);isNaN(M)||(this._snapClampSetValue(M+S),this.$input.value=this.getValue())};let e,s,o,c,d,a=!1;const _=S=>{if(a){const M=S.clientX-e,A=S.clientY-s;Math.abs(A)>5?(S.preventDefault(),this.$input.blur(),a=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(M)>5&&v()}if(!a){const M=S.clientY-o;d-=M*this._step*this._arrowKeyMultiplier(S),c+d>this._max?d=this._max-c:c+d<this._min&&(d=this._min-c),this._snapClampSetValue(c+d)}o=S.clientY},v=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",v)};this.$input.addEventListener("input",()=>{let S=parseFloat(this.$input.value);isNaN(S)||(this._stepExplicit&&(S=this._snap(S)),this.setValue(this._clamp(S)))}),this.$input.addEventListener("keydown",S=>{S.code==="Enter"&&this.$input.blur(),S.code==="ArrowUp"&&(S.preventDefault(),t(this._step*this._arrowKeyMultiplier(S))),S.code==="ArrowDown"&&(S.preventDefault(),t(this._step*this._arrowKeyMultiplier(S)*-1))}),this.$input.addEventListener("wheel",S=>{this._inputFocused&&(S.preventDefault(),t(this._step*this._normalizeMouseWheel(S)))},{passive:!1}),this.$input.addEventListener("mousedown",S=>{e=S.clientX,s=o=S.clientY,a=!0,c=this.getValue(),d=0,window.addEventListener("mousemove",_),window.addEventListener("mouseup",v)}),this.$input.addEventListener("focus",()=>{this._inputFocused=!0}),this.$input.addEventListener("blur",()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()})}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=A=>{const C=this.$slider.getBoundingClientRect();let R=(F=A,z=C.left,L=C.right,W=this._min,G=this._max,(F-z)/(L-z)*(G-W)+W);var F,z,L,W,G;this._snapClampSetValue(R)},e=A=>{t(A.clientX)},s=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",s)};let o,c,d=!1;const a=A=>{A.preventDefault(),this._setDraggingStyle(!0),t(A.touches[0].clientX),d=!1},_=A=>{if(d){const C=A.touches[0].clientX-o,R=A.touches[0].clientY-c;Math.abs(C)>Math.abs(R)?a(A):(window.removeEventListener("touchmove",_),window.removeEventListener("touchend",v))}else A.preventDefault(),t(A.touches[0].clientX)},v=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",_),window.removeEventListener("touchend",v)},S=this._callOnFinishChange.bind(this);let M;this.$slider.addEventListener("mousedown",A=>{this._setDraggingStyle(!0),t(A.clientX),window.addEventListener("mousemove",e),window.addEventListener("mouseup",s)}),this.$slider.addEventListener("touchstart",A=>{A.touches.length>1||(this._hasScrollBar?(o=A.touches[0].clientX,c=A.touches[0].clientY,d=!0):a(A),window.addEventListener("touchmove",_,{passive:!1}),window.addEventListener("touchend",v))},{passive:!1}),this.$slider.addEventListener("wheel",A=>{if(Math.abs(A.deltaX)<Math.abs(A.deltaY)&&this._hasScrollBar)return;A.preventDefault();const C=this._normalizeMouseWheel(A)*this._step;this._snapClampSetValue(this.getValue()+C),this.$input.value=this.getValue(),clearTimeout(M),M=setTimeout(S,400)},{passive:!1})}_setDraggingStyle(t,e="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle("lil-gui-"+e,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:e,deltaY:s}=t;return Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(e=0,s=-t.wheelDelta/120,s*=this._stepExplicit?1:10),e+-s}_arrowKeyMultiplier(t){let e=this._stepExplicit?1:10;return t.shiftKey?e*=10:t.altKey&&(e/=10),e}_snap(t){const e=Math.round(t/this._step)*this._step;return parseFloat(e.toPrecision(15))}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class BP extends qr{constructor(t,e,s,o){super(t,e,s,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(o)?o:Object.values(o),this._names=Array.isArray(o)?o:Object.keys(o),this._names.forEach(c=>{const d=document.createElement("option");d.innerHTML=c,this.$select.appendChild(d)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const t=this.getValue(),e=this._values.indexOf(t);return this.$select.selectedIndex=e,this.$display.innerHTML=e===-1?t:this._names[e],this}}class OP extends qr{constructor(t,e,s){super(t,e,s,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",o=>{o.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let Ix=!1;class M0{constructor({parent:t,autoPlace:e=t===void 0,container:s,width:o,title:c="Controls",injectStyles:d=!0,touchStyles:a=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",_=>{_.code!=="Enter"&&_.code!=="Space"||(_.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(c),a&&this.domElement.classList.add("allow-touch-styles"),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),!Ix&&d&&(function(_){const v=document.createElement("style");v.innerHTML=_;const S=document.querySelector("head link[rel=stylesheet], head style");S?document.head.insertBefore(v,S):document.head.appendChild(v)}('.lil-gui{--background-color:#1f1f1f;--text-color:#ebebeb;--title-background-color:#111;--title-text-color:#ebebeb;--widget-color:#424242;--hover-color:#4f4f4f;--focus-color:#595959;--number-color:#2cc9ff;--string-color:#a2db3c;--font-size:11px;--input-font-size:11px;--font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;--font-family-mono:Menlo,Monaco,Consolas,"Droid Sans Mono",monospace;--padding:4px;--spacing:4px;--widget-height:20px;--name-width:45%;--slider-knob-width:2px;--slider-input-width:27%;--color-input-width:27%;--slider-input-min-width:45px;--color-input-min-width:45px;--folder-indent:7px;--widget-padding:0 0 0 3px;--widget-border-radius:2px;--checkbox-size:calc(var(--widget-height)*0.75);--scrollbar-width:5px;background-color:var(--background-color);color:var(--text-color);font-family:var(--font-family);font-size:var(--font-size);font-style:normal;font-weight:400;line-height:1;text-align:left;touch-action:manipulation;user-select:none;-webkit-user-select:none}.lil-gui,.lil-gui *{box-sizing:border-box;margin:0;padding:0}.lil-gui.root{display:flex;flex-direction:column;width:var(--width,245px)}.lil-gui.root>.title{background:var(--title-background-color);color:var(--title-text-color)}.lil-gui.root>.children{overflow-x:hidden;overflow-y:auto}.lil-gui.root>.children::-webkit-scrollbar{background:var(--background-color);height:var(--scrollbar-width);width:var(--scrollbar-width)}.lil-gui.root>.children::-webkit-scrollbar-thumb{background:var(--focus-color);border-radius:var(--scrollbar-width)}.lil-gui.force-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}.lil-gui.autoPlace{max-height:100%;position:fixed;right:15px;top:0;z-index:1001}.lil-gui .controller{align-items:center;display:flex;margin:var(--spacing) 0;padding:0 var(--padding)}.lil-gui .controller.disabled{opacity:.5}.lil-gui .controller.disabled,.lil-gui .controller.disabled *{pointer-events:none!important}.lil-gui .controller>.name{flex-shrink:0;line-height:var(--widget-height);min-width:var(--name-width);padding-right:var(--spacing);white-space:pre}.lil-gui .controller .widget{align-items:center;display:flex;min-height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.string input{color:var(--string-color)}.lil-gui .controller.boolean .widget{cursor:pointer}.lil-gui .controller.color .display{border-radius:var(--widget-border-radius);height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.color input[type=color]{cursor:pointer;height:100%;opacity:0;width:100%}.lil-gui .controller.color input[type=text]{flex-shrink:0;font-family:var(--font-family-mono);margin-left:var(--spacing);min-width:var(--color-input-min-width);width:var(--color-input-width)}.lil-gui .controller.option select{max-width:100%;opacity:0;position:absolute;width:100%}.lil-gui .controller.option .display{background:var(--widget-color);border-radius:var(--widget-border-radius);height:var(--widget-height);line-height:var(--widget-height);max-width:100%;overflow:hidden;padding-left:.55em;padding-right:1.75em;pointer-events:none;position:relative;word-break:break-all}.lil-gui .controller.option .display.active{background:var(--focus-color)}.lil-gui .controller.option .display:after{bottom:0;content:"";font-family:lil-gui;padding-right:.375em;position:absolute;right:0;top:0}.lil-gui .controller.option .widget,.lil-gui .controller.option select{cursor:pointer}.lil-gui .controller.number input{color:var(--number-color)}.lil-gui .controller.number.hasSlider input{flex-shrink:0;margin-left:var(--spacing);min-width:var(--slider-input-min-width);width:var(--slider-input-width)}.lil-gui .controller.number .slider{background-color:var(--widget-color);border-radius:var(--widget-border-radius);cursor:ew-resize;height:var(--widget-height);overflow:hidden;padding-right:var(--slider-knob-width);touch-action:pan-y;width:100%}.lil-gui .controller.number .slider.active{background-color:var(--focus-color)}.lil-gui .controller.number .slider.active .fill{opacity:.95}.lil-gui .controller.number .fill{border-right:var(--slider-knob-width) solid var(--number-color);box-sizing:content-box;height:100%}.lil-gui-dragging .lil-gui{--hover-color:var(--widget-color)}.lil-gui-dragging *{cursor:ew-resize!important}.lil-gui-dragging.lil-gui-vertical *{cursor:ns-resize!important}.lil-gui .title{--title-height:calc(var(--widget-height) + var(--spacing)*1.25);-webkit-tap-highlight-color:transparent;text-decoration-skip:objects;cursor:pointer;font-weight:600;height:var(--title-height);line-height:calc(var(--title-height) - 4px);outline:none;padding:0 var(--padding)}.lil-gui .title:before{content:"";display:inline-block;font-family:lil-gui;padding-right:2px}.lil-gui .title:active{background:var(--title-background-color);opacity:.75}.lil-gui.root>.title:focus{text-decoration:none!important}.lil-gui.closed>.title:before{content:""}.lil-gui.closed>.children{opacity:0;transform:translateY(-7px)}.lil-gui.closed:not(.transition)>.children{display:none}.lil-gui.transition>.children{overflow:hidden;pointer-events:none;transition-duration:.3s;transition-property:height,opacity,transform;transition-timing-function:cubic-bezier(.2,.6,.35,1)}.lil-gui .children:empty:before{content:"Empty";display:block;font-style:italic;height:var(--widget-height);line-height:var(--widget-height);margin:var(--spacing) 0;opacity:.5;padding:0 var(--padding)}.lil-gui.root>.children>.lil-gui>.title{border-width:0;border-bottom:1px solid var(--widget-color);border-left:0 solid var(--widget-color);border-right:0 solid var(--widget-color);border-top:1px solid var(--widget-color);transition:border-color .3s}.lil-gui.root>.children>.lil-gui.closed>.title{border-bottom-color:transparent}.lil-gui+.controller{border-top:1px solid var(--widget-color);margin-top:0;padding-top:var(--spacing)}.lil-gui .lil-gui .lil-gui>.title{border:none}.lil-gui .lil-gui .lil-gui>.children{border:none;border-left:2px solid var(--widget-color);margin-left:var(--folder-indent)}.lil-gui .lil-gui .controller{border:none}.lil-gui input{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:0;border-radius:var(--widget-border-radius);color:var(--text-color);font-family:var(--font-family);font-size:var(--input-font-size);height:var(--widget-height);outline:none;width:100%}.lil-gui input:disabled{opacity:1}.lil-gui input[type=number],.lil-gui input[type=text]{padding:var(--widget-padding)}.lil-gui input[type=number]:focus,.lil-gui input[type=text]:focus{background:var(--focus-color)}.lil-gui input::-webkit-inner-spin-button,.lil-gui input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.lil-gui input[type=number]{-moz-appearance:textfield}.lil-gui input[type=checkbox]{appearance:none;-webkit-appearance:none;border-radius:var(--widget-border-radius);cursor:pointer;height:var(--checkbox-size);text-align:center;width:var(--checkbox-size)}.lil-gui input[type=checkbox]:checked:before{content:"";font-family:lil-gui;font-size:var(--checkbox-size);line-height:var(--checkbox-size)}.lil-gui button{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:1px solid var(--widget-color);border-radius:var(--widget-border-radius);color:var(--text-color);cursor:pointer;font-family:var(--font-family);font-size:var(--font-size);height:var(--widget-height);line-height:calc(var(--widget-height) - 4px);outline:none;text-align:center;text-transform:none;width:100%}.lil-gui button:active{background:var(--focus-color)}@font-face{font-family:lil-gui;src:url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff")}@media (pointer:coarse){.lil-gui.allow-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}}@media (hover:hover){.lil-gui .controller.color .display:hover:before{border:1px solid #fff9;border-radius:var(--widget-border-radius);bottom:0;content:" ";display:block;left:0;position:absolute;right:0;top:0}.lil-gui .controller.option .display.focus{background:var(--focus-color)}.lil-gui .controller.option .widget:hover .display{background:var(--hover-color)}.lil-gui .controller.number .slider:hover{background-color:var(--hover-color)}body:not(.lil-gui-dragging) .lil-gui .title:hover{background:var(--title-background-color);opacity:.85}.lil-gui .title:focus{text-decoration:underline var(--focus-color)}.lil-gui input:hover{background:var(--hover-color)}.lil-gui input:active{background:var(--focus-color)}.lil-gui input[type=checkbox]:focus{box-shadow:inset 0 0 0 1px var(--focus-color)}.lil-gui button:hover{background:var(--hover-color);border-color:var(--hover-color)}.lil-gui button:focus{border-color:var(--focus-color)}}'),Ix=!0),s?s.appendChild(this.domElement):e&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),o&&this.domElement.style.setProperty("--width",o+"px"),this.domElement.addEventListener("keydown",_=>_.stopPropagation()),this.domElement.addEventListener("keyup",_=>_.stopPropagation())}add(t,e,s,o,c){if(Object(s)===s)return new BP(this,t,e,s);const d=t[e];switch(typeof d){case"number":return new FP(this,t,e,s,o,c);case"boolean":return new PP(this,t,e);case"string":return new OP(this,t,e);case"function":return new Gg(this,t,e)}console.error(`gui.add failed
	property:`,e,`
	object:`,t,`
	value:`,d)}addColor(t,e,s=1){return new kP(this,t,e,s)}addFolder(t){return new M0({parent:this,title:t})}load(t,e=!0){return t.controllers&&this.controllers.forEach(s=>{s instanceof Gg||s._name in t.controllers&&s.load(t.controllers[s._name])}),e&&t.folders&&this.folders.forEach(s=>{s._title in t.folders&&s.load(t.folders[s._title])}),this}save(t=!0){const e={controllers:{},folders:{}};return this.controllers.forEach(s=>{if(!(s instanceof Gg)){if(s._name in e.controllers)throw new Error(`Cannot save GUI with duplicate property "${s._name}"`);e.controllers[s._name]=s.save()}}),t&&this.folders.forEach(s=>{if(s._title in e.folders)throw new Error(`Cannot save GUI with duplicate folder "${s._title}"`);e.folders[s._title]=s.save()}),e}open(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const s=c=>{c.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",s))};this.$children.addEventListener("transitionend",s);const o=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame(()=>{this.$children.style.height=o+"px"})}),this}title(t){return this._title=t,this.$title.innerHTML=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach(e=>e.reset()),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),this._onChange!==void 0&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(t=>t.destroy())}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach(e=>{t=t.concat(e.controllersRecursive())}),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach(e=>{t=t.concat(e.foldersRecursive())}),t}}function NP(l,t=!1){const e=l[0].index!==null,s=new Set(Object.keys(l[0].attributes)),o=new Set(Object.keys(l[0].morphAttributes)),c={},d={},a=l[0].morphTargetsRelative,_=new Ii;let v=0;for(let S=0;S<l.length;++S){const M=l[S];let A=0;if(e!==(M.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+S+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const C in M.attributes){if(!s.has(C))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+S+'. All geometries must have compatible attributes; make sure "'+C+'" attribute exists among all geometries, or in none of them.'),null;c[C]===void 0&&(c[C]=[]),c[C].push(M.attributes[C]),A++}if(A!==s.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+S+". Make sure all geometries have the same number of attributes."),null;if(a!==M.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+S+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const C in M.morphAttributes){if(!o.has(C))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+S+".  .morphAttributes must be consistent throughout all geometries."),null;d[C]===void 0&&(d[C]=[]),d[C].push(M.morphAttributes[C])}if(t){let C;if(e)C=M.index.count;else if(M.attributes.position!==void 0)C=M.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+S+". The geometry must have either an index or a position attribute"),null;_.addGroup(v,C,S),v+=C}}if(e){let S=0;const M=[];for(let A=0;A<l.length;++A){const C=l[A].index;for(let R=0;R<C.count;++R)M.push(C.getX(R)+S);S+=l[A].attributes.position.count}_.setIndex(M)}for(const S in c){const M=Px(c[S]);if(!M)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+S+" attribute."),null;_.setAttribute(S,M)}for(const S in d){const M=d[S][0].length;if(M===0)break;_.morphAttributes=_.morphAttributes||{},_.morphAttributes[S]=[];for(let A=0;A<M;++A){const C=[];for(let F=0;F<d[S].length;++F)C.push(d[S][F][A]);const R=Px(C);if(!R)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+S+" morphAttribute."),null;_.morphAttributes[S].push(R)}}return _}function Px(l){let t,e,s,o=0;for(let a=0;a<l.length;++a){const _=l[a];if(_.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=_.array.constructor),t!==_.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(e===void 0&&(e=_.itemSize),e!==_.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(s===void 0&&(s=_.normalized),s!==_.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;o+=_.array.length}const c=new t(o);let d=0;for(let a=0;a<l.length;++a)c.set(l[a].array,d),d+=l[a].array.length;return new Zi(c,e,s)}var ew=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function UP(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function VP(l){if(l.__esModule)return l;var t=l.default;if(typeof t=="function"){var e=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(l).forEach(function(s){var o=Object.getOwnPropertyDescriptor(l,s);Object.defineProperty(e,s,o.get?o:{enumerable:!0,get:function(){return l[s]}})}),e}function GP(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var D_={exports:{}};const HP=VP(IP);(function(l,t){(function(){var e=this,s=typeof GP<"u",o=e.THREE||s&&HP;if(!o)throw new Error("MeshLine requires three.js");class c extends o.BufferGeometry{constructor(){super(),this.isMeshLine=!0,this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new o.Matrix4,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(S){this.setGeometry(S,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(S){this.setPoints(S,this.widthCallback)}}})}}c.prototype.setMatrixWorld=function(v){this.matrixWorld=v},c.prototype.setGeometry=function(v,S){this._geometry=v,this.setPoints(v.getAttribute("position").array,S)},c.prototype.setPoints=function(v,S){if(!(v instanceof Float32Array)&&!(v instanceof Array)){console.error("ERROR: The BufferArray of points is not instancied correctly.");return}if(this._points=v,this.widthCallback=S,this.positions=[],this.counters=[],v.length&&v[0]instanceof o.Vector3)for(var M=0;M<v.length;M++){var A=v[M],C=M/v.length;this.positions.push(A.x,A.y,A.z),this.positions.push(A.x,A.y,A.z),this.counters.push(C),this.counters.push(C)}else for(var M=0;M<v.length;M+=3){var C=M/v.length;this.positions.push(v[M],v[M+1],v[M+2]),this.positions.push(v[M],v[M+1],v[M+2]),this.counters.push(C),this.counters.push(C)}this.process()};function d(v,S){var M=new o.Matrix4,A=new o.Ray,C=new o.Sphere,R=new o.Vector3,F=this.geometry;if(F.boundingSphere||F.computeBoundingSphere(),C.copy(F.boundingSphere),C.applyMatrix4(this.matrixWorld),v.ray.intersectSphere(C,R)!==!1){M.copy(this.matrixWorld).invert(),A.copy(v.ray).applyMatrix4(M);var z=new o.Vector3,L=new o.Vector3,W=new o.Vector3,G=this instanceof o.LineSegments?2:1,H=F.index,Q=F.attributes;if(H!==null)for(var nt=H.array,pt=Q.position.array,ft=Q.width.array,K=0,ot=nt.length-1;K<ot;K+=G){var kt=nt[K],zt=nt[K+1];z.fromArray(pt,kt*3),L.fromArray(pt,zt*3);var It=ft[Math.floor(K/3)]!==void 0?ft[Math.floor(K/3)]:1,Dt=v.params.Line.threshold+this.material.lineWidth*It/2,Wt=Dt*Dt,se=A.distanceSqToSegment(z,L,R,W);if(!(se>Wt)){R.applyMatrix4(this.matrixWorld);var ce=v.ray.origin.distanceTo(R);ce<v.near||ce>v.far||(S.push({distance:ce,point:W.clone().applyMatrix4(this.matrixWorld),index:K,face:null,faceIndex:null,object:this}),K=ot)}}}}c.prototype.raycast=d,c.prototype.compareV3=function(v,S){var M=v*6,A=S*6;return this.positions[M]===this.positions[A]&&this.positions[M+1]===this.positions[A+1]&&this.positions[M+2]===this.positions[A+2]},c.prototype.copyV3=function(v){var S=v*6;return[this.positions[S],this.positions[S+1],this.positions[S+2]]},c.prototype.process=function(){var v=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];var S,M;this.compareV3(0,v-1)?M=this.copyV3(v-2):M=this.copyV3(0),this.previous.push(M[0],M[1],M[2]),this.previous.push(M[0],M[1],M[2]);for(var A=0;A<v;A++){if(this.side.push(1),this.side.push(-1),this.widthCallback?S=this.widthCallback(A/(v-1)):S=1,this.width.push(S),this.width.push(S),this.uvs.push(A/(v-1),0),this.uvs.push(A/(v-1),1),A<v-1){M=this.copyV3(A),this.previous.push(M[0],M[1],M[2]),this.previous.push(M[0],M[1],M[2]);var C=A*2;this.indices_array.push(C,C+1,C+2),this.indices_array.push(C+2,C+1,C+3)}A>0&&(M=this.copyV3(A),this.next.push(M[0],M[1],M[2]),this.next.push(M[0],M[1],M[2]))}this.compareV3(v-1,0)?M=this.copyV3(1):M=this.copyV3(v-1),this.next.push(M[0],M[1],M[2]),this.next.push(M[0],M[1],M[2]),!this._attributes||this._attributes.position.count!==this.positions.length?this._attributes={position:new o.BufferAttribute(new Float32Array(this.positions),3),previous:new o.BufferAttribute(new Float32Array(this.previous),3),next:new o.BufferAttribute(new Float32Array(this.next),3),side:new o.BufferAttribute(new Float32Array(this.side),1),width:new o.BufferAttribute(new Float32Array(this.width),1),uv:new o.BufferAttribute(new Float32Array(this.uvs),2),index:new o.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new o.BufferAttribute(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()};function a(v,S,M,A,C){var R;if(v=v.subarray||v.slice?v:v.buffer,M=M.subarray||M.slice?M:M.buffer,v=S?v.subarray?v.subarray(S,C&&S+C):v.slice(S,C&&S+C):v,M.set)M.set(v,A);else for(R=0;R<v.length;R++)M[R+A]=v[R];return M}c.prototype.advance=function(v){var S=this._attributes.position.array,M=this._attributes.previous.array,A=this._attributes.next.array,C=S.length;a(S,0,M,0,C),a(S,6,S,0,C-6),S[C-6]=v.x,S[C-5]=v.y,S[C-4]=v.z,S[C-3]=v.x,S[C-2]=v.y,S[C-1]=v.z,a(S,6,A,0,C-6),A[C-6]=v.x,A[C-5]=v.y,A[C-4]=v.z,A[C-3]=v.x,A[C-2]=v.y,A[C-1]=v.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},o.ShaderChunk.meshline_vert=["",o.ShaderChunk.logdepthbuf_pars_vertex,o.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","	 vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",o.ShaderChunk.logdepthbuf_vertex,o.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",o.ShaderChunk.fog_vertex,"}"].join(`
`),o.ShaderChunk.meshline_frag=["",o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",o.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",o.ShaderChunk.fog_fragment,"}"].join(`
`);class _ extends o.ShaderMaterial{constructor(S){super({uniforms:Object.assign({},o.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new o.Color(16777215)},opacity:{value:1},resolution:{value:new o.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new o.Vector2(1,1)}}),vertexShader:o.ShaderChunk.meshline_vert,fragmentShader:o.ShaderChunk.meshline_frag}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(M){this.uniforms.lineWidth.value=M}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(M){this.uniforms.map.value=M}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(M){this.uniforms.useMap.value=M}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(M){this.uniforms.alphaMap.value=M}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(M){this.uniforms.useAlphaMap.value=M}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(M){this.uniforms.color.value=M}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(M){this.uniforms.opacity.value=M}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(M){this.uniforms.resolution.value.copy(M)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(M){this.uniforms.sizeAttenuation.value=M}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(M){this.uniforms.dashArray.value=M,this.useDash=M!==0?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(M){this.uniforms.dashOffset.value=M}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(M){this.uniforms.dashRatio.value=M}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(M){this.uniforms.useDash.value=M}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(M){this.uniforms.visibility.value=M}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(M){this.uniforms.alphaTest.value=M}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(M){this.uniforms.repeat.value.copy(M)}}}),this.setValues(S)}}_.prototype.copy=function(v){return o.ShaderMaterial.prototype.copy.call(this,v),this.lineWidth=v.lineWidth,this.map=v.map,this.useMap=v.useMap,this.alphaMap=v.alphaMap,this.useAlphaMap=v.useAlphaMap,this.color.copy(v.color),this.opacity=v.opacity,this.resolution.copy(v.resolution),this.sizeAttenuation=v.sizeAttenuation,this.dashArray.copy(v.dashArray),this.dashOffset.copy(v.dashOffset),this.dashRatio.copy(v.dashRatio),this.useDash=v.useDash,this.visibility=v.visibility,this.alphaTest=v.alphaTest,this.repeat.copy(v.repeat),this},l.exports&&(t=l.exports={MeshLine:c,MeshLineMaterial:_,MeshLineRaycast:d}),t.MeshLine=c,t.MeshLineMaterial=_,t.MeshLineRaycast=d}).call(ew)})(D_,D_.exports);var Lx=D_.exports,iw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.2/LICENSE.txt
 */(function(l,t){(function(e,s){l.exports=s()})(ew,function(){var e={},s={};function o(d,a,_){if(s[d]=_,d==="index"){var v="var sharedModule = {}; ("+s.shared+")(sharedModule); ("+s.worker+")(sharedModule);",S={};return s.shared(S),s.index(e,S),typeof window<"u"&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([v],{type:"text/javascript"}))),e}}o("shared",["exports"],function(d){function a(r,i,h,f){return new(h||(h=Promise))(function(g,b){function w(k){try{P(f.next(k))}catch(O){b(O)}}function T(k){try{P(f.throw(k))}catch(O){b(O)}}function P(k){var O;k.done?g(k.value):(O=k.value,O instanceof h?O:new h(function(N){N(O)})).then(w,T)}P((f=f.apply(r,i||[])).next())})}function _(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var v=S;function S(r,i){this.x=r,this.y=i}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,i){return this.clone()._rotateAround(r,i)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var i=r.x-this.x,h=r.y-this.y;return i*i+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,i){return Math.atan2(this.x*i-this.y*r,this.x*r+this.y*i)},_matMult:function(r){var i=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=i,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var i=Math.cos(r),h=Math.sin(r),f=h*this.x+i*this.y;return this.x=i*this.x-h*this.y,this.y=f,this},_rotateAround:function(r,i){var h=Math.cos(r),f=Math.sin(r),g=i.y+f*(this.x-i.x)+h*(this.y-i.y);return this.x=i.x+h*(this.x-i.x)-f*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(r){return r instanceof S?r:Array.isArray(r)?new S(r[0],r[1]):r};var M=_(v),A=C;function C(r,i,h,f){this.cx=3*r,this.bx=3*(h-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=i,this.p2x=h,this.p2y=f}C.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,i){if(i===void 0&&(i=1e-6),r<0)return 0;if(r>1)return 1;for(var h=r,f=0;f<8;f++){var g=this.sampleCurveX(h)-r;if(Math.abs(g)<i)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=g/b}var w=0,T=1;for(h=r,f=0;f<20&&(g=this.sampleCurveX(h),!(Math.abs(g-r)<i));f++)r>g?w=h:T=h,h=.5*(T-w)+w;return h},solve:function(r,i){return this.sampleCurveY(this.solveCurveX(r,i))}};var R=_(A);let F,z;function L(){return F==null&&(F=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),F}function W(){if(z==null&&(z=!1,L())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let f=0;f<5*5;f++){const g=4*f;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(f%5,Math.floor(f/5),1,1)}const h=i.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&h[f]!==f){z=!0;break}}}return z||!1}function G(r,i,h,f){const g=new R(r,i,h,f);return function(b){return g.solve(b)}}const H=G(.25,.1,.25,1);function Q(r,i,h){return Math.min(h,Math.max(i,r))}function nt(r,i,h){const f=h-i,g=((r-i)%f+f)%f+i;return g===i?h:g}function pt(r,...i){for(const h of i)for(const f in h)r[f]=h[f];return r}let ft=1;function K(r,i,h){const f={};for(const g in r)f[g]=i.call(h||this,r[g],g,r);return f}function ot(r,i,h){const f={};for(const g in r)i.call(h||this,r[g],g,r)&&(f[g]=r[g]);return f}function kt(r){return Array.isArray(r)?r.map(kt):typeof r=="object"&&r?K(r,kt):r}const zt={};function It(r){zt[r]||(typeof console<"u"&&console.warn(r),zt[r]=!0)}function Dt(r,i,h){return(h.y-r.y)*(i.x-r.x)>(i.y-r.y)*(h.x-r.x)}function Wt(r){let i=0;for(let h,f,g=0,b=r.length,w=b-1;g<b;w=g++)h=r[g],f=r[w],i+=(f.x-h.x)*(h.y+f.y);return i}function se(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let ce=null;function ie(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function de(r,i,h,f,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(r,{timestamp:0});try{const w=b==null?void 0:b.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const T=w.startsWith("BGR"),P=new Uint8ClampedArray(f*g*4);if(yield b.copyTo(P,function(k,O,N,$,X){const J=4*Math.max(-O,0),st=(Math.max(0,N)-N)*$*4+J,ct=4*$,_t=Math.max(0,O),Lt=Math.max(0,N);return{rect:{x:_t,y:Lt,width:Math.min(k.width,O+$)-_t,height:Math.min(k.height,N+X)-Lt},layout:[{offset:st,stride:ct}]}}(r,i,h,f,g)),T)for(let k=0;k<P.length;k+=4){const O=P[k];P[k]=P[k+2],P[k+2]=O}return P}finally{b.close()}})}let $e,_e;const Yt="AbortError";function re(){return new Error(Yt)}const Re={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Fe(r){return Re.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const Gt="global-dispatcher";class ei extends Error{constructor(i,h,f,g){super(`AJAXError: ${h} (${i}): ${f}`),this.status=i,this.statusText=h,this.url=f,this.body=g}}const ci=()=>se(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,xe=function(r,i){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const f=Fe(r.url);if(f)return f(r,i);if(se(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:r,targetMapId:Gt},i)}if(!(/^file:/.test(h=r.url)||/^file:/.test(ci())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return a(this,void 0,void 0,function*(){const b=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:ci(),signal:g.signal});f.type==="json"&&b.headers.set("Accept","application/json");const w=yield fetch(b);if(!w.ok){const k=yield w.blob();throw new ei(w.status,w.statusText,f.url,k)}let T;T=f.type==="arrayBuffer"||f.type==="image"?w.arrayBuffer():f.type==="json"?w.json():w.text();const P=yield T;if(g.signal.aborted)throw re();return{data:P,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}})}(r,i);if(se(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:r,mustQueue:!0,targetMapId:Gt},i)}var h;return function(f,g){return new Promise((b,w)=>{const T=new XMLHttpRequest;T.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(T.responseType="arraybuffer");for(const P in f.headers)T.setRequestHeader(P,f.headers[P]);f.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=f.credentials==="include",T.onerror=()=>{w(new Error(T.statusText))},T.onload=()=>{if(!g.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let P=T.response;if(f.type==="json")try{P=JSON.parse(T.response)}catch(k){return void w(k)}b({data:P,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const P=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});w(new ei(T.status,T.statusText,f.url,P))}},g.signal.addEventListener("abort",()=>{T.abort(),w(re())}),T.send(f.body)})}(r,i)};function Qe(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const i=new URL(r),h=window.location;return i.protocol===h.protocol&&i.host===h.host}function le(r,i,h){h[r]&&h[r].indexOf(i)!==-1||(h[r]=h[r]||[],h[r].push(i))}function Kt(r,i,h){if(h&&h[r]){const f=h[r].indexOf(i);f!==-1&&h[r].splice(f,1)}}class he{constructor(i,h={}){pt(this,h),this.type=i}}class Ee extends he{constructor(i,h={}){super("error",pt({error:i},h))}}class Ce{on(i,h){return this._listeners=this._listeners||{},le(i,h,this._listeners),this}off(i,h){return Kt(i,h,this._listeners),Kt(i,h,this._oneTimeListeners),this}once(i,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},le(i,h,this._oneTimeListeners),this):new Promise(f=>this.once(i,f))}fire(i,h){typeof i=="string"&&(i=new he(i,h||{}));const f=i.type;if(this.listens(f)){i.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of g)T.call(this,i);const b=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of b)Kt(f,T,this._oneTimeListeners),T.call(this,i);const w=this._eventedParent;w&&(pt(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(i))}else i instanceof Ee&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,h){return this._eventedParent=i,this._eventedParentData=h,this}}var Pt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ai=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ni(r,i){const h={};for(const f in r)f!=="ref"&&(h[f]=r[f]);return ai.forEach(f=>{f in i&&(h[f]=i[f])}),h}function Oe(r,i){if(Array.isArray(r)){if(!Array.isArray(i)||r.length!==i.length)return!1;for(let h=0;h<r.length;h++)if(!Oe(r[h],i[h]))return!1;return!0}if(typeof r=="object"&&r!==null&&i!==null){if(typeof i!="object"||Object.keys(r).length!==Object.keys(i).length)return!1;for(const h in r)if(!Oe(r[h],i[h]))return!1;return!0}return r===i}function gi(r,i){r.push(i)}function mt(r,i,h){gi(h,{command:"addSource",args:[r,i[r]]})}function rt(r,i,h){gi(i,{command:"removeSource",args:[r]}),h[r]=!0}function $t(r,i,h,f){rt(r,h,f),mt(r,i,h)}function pe(r,i,h){let f;for(f in r[h])if(Object.prototype.hasOwnProperty.call(r[h],f)&&f!=="data"&&!Oe(r[h][f],i[h][f]))return!1;for(f in i[h])if(Object.prototype.hasOwnProperty.call(i[h],f)&&f!=="data"&&!Oe(r[h][f],i[h][f]))return!1;return!0}function ye(r,i,h,f,g,b){r=r||{},i=i||{};for(const w in r)Object.prototype.hasOwnProperty.call(r,w)&&(Oe(r[w],i[w])||h.push({command:b,args:[f,w,i[w],g]}));for(const w in i)Object.prototype.hasOwnProperty.call(i,w)&&!Object.prototype.hasOwnProperty.call(r,w)&&(Oe(r[w],i[w])||h.push({command:b,args:[f,w,i[w],g]}))}function ke(r){return r.id}function ui(r,i){return r[i.id]=i,r}class Ut{constructor(i,h,f,g){this.message=(i?`${i}: `:"")+f,g&&(this.identifier=g),h!=null&&h.__line__&&(this.line=h.__line__)}}function Zt(r,...i){for(const h of i)for(const f in h)r[f]=h[f];return r}class Ge extends Error{constructor(i,h){super(h),this.message=h,this.key=i}}class si{constructor(i,h=[]){this.parent=i,this.bindings={};for(const[f,g]of h)this.bindings[f]=g}concat(i){return new si(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const oi={kind:"null"},Bt={kind:"number"},ge={kind:"string"},Pe={kind:"boolean"},yi={kind:"color"},Fi={kind:"object"},vt={kind:"value"},Jt={kind:"collator"},fe={kind:"formatted"},tt={kind:"padding"},V={kind:"resolvedImage"},j={kind:"variableAnchorOffsetCollection"};function Z(r,i){return{kind:"array",itemType:r,N:i}}function at(r){if(r.kind==="array"){const i=at(r.itemType);return typeof r.N=="number"?`array<${i}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${i}>`}return r.kind}const Mt=[oi,Bt,ge,Pe,yi,fe,Fi,Z(vt),tt,V,j];function bt(r,i){if(i.kind==="error")return null;if(r.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!bt(r.itemType,i.itemType))&&(typeof r.N!="number"||r.N===i.N))return null}else{if(r.kind===i.kind)return null;if(r.kind==="value"){for(const h of Mt)if(!bt(h,i))return null}}return`Expected ${at(r)} but found ${at(i)} instead.`}function Tt(r,i){return i.some(h=>h.kind===r.kind)}function yt(r,i){return i.some(h=>h==="null"?r===null:h==="array"?Array.isArray(r):h==="object"?r&&!Array.isArray(r)&&typeof r=="object":h===typeof r)}function Rt(r,i){return r.kind==="array"&&i.kind==="array"?r.itemType.kind===i.itemType.kind&&typeof r.N=="number":r.kind===i.kind}const ee=.96422,jt=.82521,Qt=4/29,We=6/29,et=3*We*We,At=We*We*We,Ot=Math.PI/180,St=180/Math.PI;function Ht(r){return(r%=360)<0&&(r+=360),r}function De([r,i,h,f]){let g,b;const w=we((.2225045*(r=je(r))+.7168786*(i=je(i))+.0606169*(h=je(h)))/1);r===i&&i===h?g=b=w:(g=we((.4360747*r+.3850649*i+.1430804*h)/ee),b=we((.0139322*r+.0971045*i+.7141733*h)/jt));const T=116*w-16;return[T<0?0:T,500*(g-w),200*(w-b),f]}function je(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function we(r){return r>At?Math.pow(r,1/3):r/et+Qt}function Ke([r,i,h,f]){let g=(r+16)/116,b=isNaN(i)?g:g+i/500,w=isNaN(h)?g:g-h/200;return g=1*pi(g),b=ee*pi(b),w=jt*pi(w),[li(3.1338561*b-1.6168667*g-.4906146*w),li(-.9787684*b+1.9161415*g+.033454*w),li(.0719453*b-.2289914*g+1.4052427*w),f]}function li(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function pi(r){return r>We?r*r*r:et*(r-Qt)}function di(r){return parseInt(r.padEnd(2,r),16)/255}function Mi(r,i){return Gi(i?r/100:r,0,1)}function Gi(r,i,h){return Math.min(Math.max(i,r),h)}function ss(r){return!r.some(Number.isNaN)}const gr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class mi{constructor(i,h,f,g=1,b=!0){this.r=i,this.g=h,this.b=f,this.a=g,b||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,h,f,g]))}static parse(i){if(i instanceof mi)return i;if(typeof i!="string")return;const h=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=gr[f];if(g){const[w,T,P]=g;return[w/255,T/255,P/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const w=f.length<6?1:2;let T=1;return[di(f.slice(T,T+=w)),di(f.slice(T,T+=w)),di(f.slice(T,T+=w)),di(f.slice(T,T+w)||"ff")]}if(f.startsWith("rgb")){const w=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[T,P,k,O,N,$,X,J,st,ct,_t,Lt]=w,xt=[O||" ",X||" ",ct].join("");if(xt==="  "||xt==="  /"||xt===",,"||xt===",,,"){const Et=[k,$,st].join(""),Xt=Et==="%%%"?100:Et===""?255:0;if(Xt){const te=[Gi(+P/Xt,0,1),Gi(+N/Xt,0,1),Gi(+J/Xt,0,1),_t?Mi(+_t,Lt):1];if(ss(te))return te}}return}}const b=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[w,T,P,k,O,N,$,X,J]=b,st=[P||" ",O||" ",$].join("");if(st==="  "||st==="  /"||st===",,"||st===",,,"){const ct=[+T,Gi(+k,0,100),Gi(+N,0,100),X?Mi(+X,J):1];if(ss(ct))return function([_t,Lt,xt,Et]){function Xt(te){const Le=(te+_t/30)%12,qe=Lt*Math.min(xt,1-xt);return xt-qe*Math.max(-1,Math.min(Le-3,9-Le,1))}return _t=Ht(_t),Lt/=100,xt/=100,[Xt(0),Xt(8),Xt(4),Et]}(ct)}}}(i);return h?new mi(...h,!1):void 0}get rgb(){const{r:i,g:h,b:f,a:g}=this,b=g||1/0;return this.overwriteGetter("rgb",[i/b,h/b,f/b,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[h,f,g,b]=De(i),w=Math.sqrt(f*f+g*g);return[Math.round(1e4*w)?Ht(Math.atan2(g,f)*St):NaN,w,h,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",De(this.rgb))}overwriteGetter(i,h){return Object.defineProperty(this,i,{value:h}),h}toString(){const[i,h,f,g]=this.rgb;return`rgba(${[i,h,f].map(b=>Math.round(255*b)).join(",")},${g})`}}mi.black=new mi(0,0,0,1),mi.white=new mi(1,1,1,1),mi.transparent=new mi(0,0,0,0),mi.red=new mi(1,0,0,1);class Pi{constructor(i,h,f){this.sensitivity=i?h?"variant":"case":h?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,h){return this.collator.compare(i,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Kr{constructor(i,h,f,g,b){this.text=i,this.image=h,this.scale=f,this.fontStack=g,this.textColor=b}}class Oi{constructor(i){this.sections=i}static fromString(i){return new Oi([new Kr(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Oi?i:Oi.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class fn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof fn)return i;if(typeof i=="number")return new fn([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const h of i)if(typeof h!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new fn(i)}}toString(){return JSON.stringify(this.values)}}const To=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class cn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof cn)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let h=0;h<i.length;h+=2){const f=i[h],g=i[h+1];if(typeof f!="string"||!To.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new cn(i)}}toString(){return JSON.stringify(this.values)}}class Wn{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Wn({name:i,available:!1}):null}}function Fn(r,i,h,f){return typeof r=="number"&&r>=0&&r<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof h=="number"&&h>=0&&h<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[r,i,h,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[r,i,h,f]:[r,i,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qn(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof mi||r instanceof Pi||r instanceof Oi||r instanceof fn||r instanceof cn||r instanceof Wn)return!0;if(Array.isArray(r)){for(const i of r)if(!qn(i))return!1;return!0}if(typeof r=="object"){for(const i in r)if(!qn(r[i]))return!1;return!0}return!1}function sn(r){if(r===null)return oi;if(typeof r=="string")return ge;if(typeof r=="boolean")return Pe;if(typeof r=="number")return Bt;if(r instanceof mi)return yi;if(r instanceof Pi)return Jt;if(r instanceof Oi)return fe;if(r instanceof fn)return tt;if(r instanceof cn)return j;if(r instanceof Wn)return V;if(Array.isArray(r)){const i=r.length;let h;for(const f of r){const g=sn(f);if(h){if(h===g)continue;h=vt;break}h=g}return Z(h||vt,i)}return Fi}function Mn(r){const i=typeof r;return r===null?"":i==="string"||i==="number"||i==="boolean"?String(r):r instanceof mi||r instanceof Oi||r instanceof fn||r instanceof cn||r instanceof Wn?r.toString():JSON.stringify(r)}class Vs{constructor(i,h){this.type=i,this.value=h}static parse(i,h){if(i.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!qn(i[1]))return h.error("invalid value");const f=i[1];let g=sn(f);const b=h.expectedType;return g.kind!=="array"||g.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(g=b),new Vs(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class rn{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const nr={string:ge,number:Bt,boolean:Pe,object:Fi};class Gs{constructor(i,h){this.type=i,this.args=h}static parse(i,h){if(i.length<2)return h.error("Expected at least one argument.");let f,g=1;const b=i[0];if(b==="array"){let T,P;if(i.length>2){const k=i[1];if(typeof k!="string"||!(k in nr)||k==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);T=nr[k],g++}else T=vt;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return h.error('The length argument to "array" must be a positive integer literal',2);P=i[2],g++}f=Z(T,P)}else{if(!nr[b])throw new Error(`Types doesn't contain name = ${b}`);f=nr[b]}const w=[];for(;g<i.length;g++){const T=h.parse(i[g],g,vt);if(!T)return null;w.push(T)}return new Gs(f,w)}evaluate(i){for(let h=0;h<this.args.length;h++){const f=this.args[h].evaluate(i);if(!bt(this.type,sn(f)))return f;if(h===this.args.length-1)throw new rn(`Expected value to be of type ${at(this.type)}, but found ${at(sn(f))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const wl={"to-boolean":Pe,"to-color":yi,"to-number":Bt,"to-string":ge};class sr{constructor(i,h){this.type=i,this.args=h}static parse(i,h){if(i.length<2)return h.error("Expected at least one argument.");const f=i[0];if(!wl[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&i.length!==2)return h.error("Expected one argument.");const g=wl[f],b=[];for(let w=1;w<i.length;w++){const T=h.parse(i[w],w,vt);if(!T)return null;b.push(T)}return new sr(g,b)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let h,f;for(const g of this.args){if(h=g.evaluate(i),f=null,h instanceof mi)return h;if(typeof h=="string"){const b=i.parseColor(h);if(b)return b}else if(Array.isArray(h)&&(f=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:Fn(h[0],h[1],h[2],h[3]),!f))return new mi(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new rn(f||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const f of this.args){h=f.evaluate(i);const g=fn.parse(h);if(g)return g}throw new rn(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const f of this.args){h=f.evaluate(i);const g=cn.parse(h);if(g)return g}throw new rn(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const f of this.args){if(h=f.evaluate(i),h===null)return 0;const g=Number(h);if(!isNaN(g))return g}throw new rn(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Oi.fromString(Mn(this.args[0].evaluate(i)));case"resolvedImage":return Wn.fromString(Mn(this.args[0].evaluate(i)));default:return Mn(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const sc=["Unknown","Point","LineString","Polygon"];class La{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?sc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let h=this._parseColorCache[i];return h||(h=this._parseColorCache[i]=mi.parse(i)),h}}class Ni{constructor(i,h,f=[],g,b=new si,w=[]){this.registry=i,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=b,this.errors=w,this.expectedType=g,this._isConstant=h}parse(i,h,f,g,b={}){return h?this.concat(h,f,g)._parse(i,b):this._parse(i,b)}_parse(i,h){function f(g,b,w){return w==="assert"?new Gs(b,[g]):w==="coerce"?new sr(b,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[g];if(b){let w=b.parse(i,this);if(!w)return null;if(this.expectedType){const T=this.expectedType,P=w.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||P.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(T.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(T,P))return null}else w=f(w,T,h.typeAnnotation||"coerce");else w=f(w,T,h.typeAnnotation||"coerce");else w=f(w,T,h.typeAnnotation||"coerce");else w=f(w,T,h.typeAnnotation||"assert")}if(!(w instanceof Vs)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const T=new La;try{w=new Vs(w.type,w.evaluate(T))}catch(P){return this.error(P.message),null}}return w}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,h,f){const g=typeof i=="number"?this.path.concat(i):this.path,b=f?this.scope.concat(f):this.scope;return new Ni(this.registry,this._isConstant,g,h||null,b,this.errors)}error(i,...h){const f=`${this.key}${h.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ge(f,i))}checkSubtype(i,h){const f=bt(i,h);return f&&this.error(f),f}}class Ml{constructor(i,h,f){this.type=Jt,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=h}static parse(i,h){if(i.length!==2)return h.error("Expected one argument.");const f=i[1];if(typeof f!="object"||Array.isArray(f))return h.error("Collator options argument must be an object.");const g=h.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Pe);if(!g)return null;const b=h.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Pe);if(!b)return null;let w=null;return f.locale&&(w=h.parse(f.locale,1,ge),!w)?null:new Ml(g,b,w)}evaluate(i){return new Pi(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}const rr=8192;function rc(r,i){r[0]=Math.min(r[0],i[0]),r[1]=Math.min(r[1],i[1]),r[2]=Math.max(r[2],i[0]),r[3]=Math.max(r[3],i[1])}function Eo(r,i){return!(r[0]<=i[0]||r[2]>=i[2]||r[1]<=i[1]||r[3]>=i[3])}function Ed(r,i){const h=(180+r[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(h*g*rr),Math.round(f*g*rr)]}function hm(r,i,h){const f=r[0]-i[0],g=r[1]-i[1],b=r[0]-h[0],w=r[1]-h[1];return f*w-b*g==0&&f*b<=0&&g*w<=0}function Sl(r,i){let h=!1;for(let w=0,T=i.length;w<T;w++){const P=i[w];for(let k=0,O=P.length;k<O-1;k++){if(hm(r,P[k],P[k+1]))return!1;(g=P[k])[1]>(f=r)[1]!=(b=P[k+1])[1]>f[1]&&f[0]<(b[0]-g[0])*(f[1]-g[1])/(b[1]-g[1])+g[0]&&(h=!h)}}var f,g,b;return h}function Cd(r,i){for(let h=0;h<i.length;h++)if(Sl(r,i[h]))return!0;return!1}function Id(r,i,h,f){const g=f[0]-h[0],b=f[1]-h[1],w=(r[0]-h[0])*b-g*(r[1]-h[1]),T=(i[0]-h[0])*b-g*(i[1]-h[1]);return w>0&&T<0||w<0&&T>0}function cm(r,i,h){for(const k of h)for(let O=0;O<k.length-1;++O)if((T=[(w=k[O+1])[0]-(b=k[O])[0],w[1]-b[1]])[0]*(P=[(g=i)[0]-(f=r)[0],g[1]-f[1]])[1]-T[1]*P[0]!=0&&Id(f,g,b,w)&&Id(b,w,f,g))return!0;var f,g,b,w,T,P;return!1}function Pd(r,i){for(let h=0;h<r.length;++h)if(!Sl(r[h],i))return!1;for(let h=0;h<r.length-1;++h)if(cm(r[h],r[h+1],i))return!1;return!0}function um(r,i){for(let h=0;h<i.length;h++)if(Pd(r,i[h]))return!0;return!1}function Al(r,i,h){const f=[];for(let g=0;g<r.length;g++){const b=[];for(let w=0;w<r[g].length;w++){const T=Ed(r[g][w],h);rc(i,T),b.push(T)}f.push(b)}return f}function ac(r,i,h){const f=[];for(let g=0;g<r.length;g++){const b=Al(r[g],i,h);f.push(b)}return f}function Ld(r,i,h,f){if(r[0]<h[0]||r[0]>h[2]){const g=.5*f;let b=r[0]-h[0]>g?-f:h[0]-r[0]>g?f:0;b===0&&(b=r[0]-h[2]>g?-f:h[2]-r[0]>g?f:0),r[0]+=b}rc(i,r)}function Rd(r,i,h,f){const g=Math.pow(2,f.z)*rr,b=[f.x*rr,f.y*rr],w=[];for(const T of r)for(const P of T){const k=[P.x+b[0],P.y+b[1]];Ld(k,i,h,g),w.push(k)}return w}function Tl(r,i,h,f){const g=Math.pow(2,f.z)*rr,b=[f.x*rr,f.y*rr],w=[];for(const P of r){const k=[];for(const O of P){const N=[O.x+b[0],O.y+b[1]];rc(i,N),k.push(N)}w.push(k)}if(i[2]-i[0]<=g/2){(T=i)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const P of w)for(const k of P)Ld(k,i,h,g)}var T;return w}class Qr{constructor(i,h){this.type=Pe,this.geojson=i,this.geometries=h}static parse(i,h){if(i.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(qn(i[1])){const f=i[1];if(f.type==="FeatureCollection"){const g=[];for(const b of f.features){const{type:w,coordinates:T}=b.geometry;w==="Polygon"&&g.push(T),w==="MultiPolygon"&&g.push(...T)}if(g.length)return new Qr(f,{type:"MultiPolygon",coordinates:g})}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Qr(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Qr(f,f)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(h,f){const g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=h.canonicalID();if(f.type==="Polygon"){const T=Al(f.coordinates,b,w),P=Rd(h.geometry(),g,b,w);if(!Eo(g,b))return!1;for(const k of P)if(!Sl(k,T))return!1}if(f.type==="MultiPolygon"){const T=ac(f.coordinates,b,w),P=Rd(h.geometry(),g,b,w);if(!Eo(g,b))return!1;for(const k of P)if(!Cd(k,T))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(h,f){const g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=h.canonicalID();if(f.type==="Polygon"){const T=Al(f.coordinates,b,w),P=Tl(h.geometry(),g,b,w);if(!Eo(g,b))return!1;for(const k of P)if(!Pd(k,T))return!1}if(f.type==="MultiPolygon"){const T=ac(f.coordinates,b,w),P=Tl(h.geometry(),g,b,w);if(!Eo(g,b))return!1;for(const k of P)if(!um(k,T))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class El{constructor(i,h){this.type=h.type,this.name=i,this.boundExpression=h}static parse(i,h){if(i.length!==2||typeof i[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const f=i[1];return h.scope.has(f)?new El(f,h.scope.get(f)):h.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Ls{constructor(i,h,f,g){this.name=i,this.type=h,this._evaluate=f,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,h){const f=i[0],g=Ls.definitions[f];if(!g)return h.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(g)?g[0]:g.type,w=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=w.filter(([k])=>!Array.isArray(k)||k.length===i.length-1);let P=null;for(const[k,O]of T){P=new Ni(h.registry,Co,h.path,null,h.scope);const N=[];let $=!1;for(let X=1;X<i.length;X++){const J=i[X],st=Array.isArray(k)?k[X-1]:k.type,ct=P.parse(J,1+N.length,st);if(!ct){$=!0;break}N.push(ct)}if(!$)if(Array.isArray(k)&&k.length!==N.length)P.error(`Expected ${k.length} arguments, but found ${N.length} instead.`);else{for(let X=0;X<N.length;X++){const J=Array.isArray(k)?k[X]:k.type,st=N[X];P.concat(X+1).checkSubtype(J,st.type)}if(P.errors.length===0)return new Ls(f,b,O,N)}}if(T.length===1)h.errors.push(...P.errors);else{const k=(T.length?T:w).map(([N])=>{return $=N,Array.isArray($)?`(${$.map(at).join(", ")})`:`(${at($.type)}...)`;var $}).join(" | "),O=[];for(let N=1;N<i.length;N++){const $=h.parse(i[N],1+O.length);if(!$)return null;O.push(at($.type))}h.error(`Expected arguments of type ${k}, but found (${O.join(", ")}) instead.`)}return null}static register(i,h){Ls.definitions=h;for(const f in h)i[f]=Ls}}function Co(r){if(r instanceof El)return Co(r.boundExpression);if(r instanceof Ls&&r.name==="error"||r instanceof Ml||r instanceof Qr)return!1;const i=r instanceof sr||r instanceof Gs;let h=!0;return r.eachChild(f=>{h=i?h&&Co(f):h&&f instanceof Vs}),!!h&&Io(r)&&Cl(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Io(r){if(r instanceof Ls&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Qr)return!1;let i=!0;return r.eachChild(h=>{i&&!Io(h)&&(i=!1)}),i}function Po(r){if(r instanceof Ls&&r.name==="feature-state")return!1;let i=!0;return r.eachChild(h=>{i&&!Po(h)&&(i=!1)}),i}function Cl(r,i){if(r instanceof Ls&&i.indexOf(r.name)>=0)return!1;let h=!0;return r.eachChild(f=>{h&&!Cl(f,i)&&(h=!1)}),h}function Lo(r,i){const h=r.length-1;let f,g,b=0,w=h,T=0;for(;b<=w;)if(T=Math.floor((b+w)/2),f=r[T],g=r[T+1],f<=i){if(T===h||i<g)return T;b=T+1}else{if(!(f>i))throw new rn("Input is not a number.");w=T-1}return 0}class Ra{constructor(i,h,f){this.type=i,this.input=h,this.labels=[],this.outputs=[];for(const[g,b]of f)this.labels.push(g),this.outputs.push(b)}static parse(i,h){if(i.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return h.error("Expected an even number of arguments.");const f=h.parse(i[1],1,Bt);if(!f)return null;const g=[];let b=null;h.expectedType&&h.expectedType.kind!=="value"&&(b=h.expectedType);for(let w=1;w<i.length;w+=2){const T=w===1?-1/0:i[w],P=i[w+1],k=w,O=w+1;if(typeof T!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(g.length&&g[g.length-1][0]>=T)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const N=h.parse(P,O,b);if(!N)return null;b=b||N.type,g.push([T,N])}return new Ra(b,f,g)}evaluate(i){const h=this.labels,f=this.outputs;if(h.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=h[0])return f[0].evaluate(i);const b=h.length;return g>=h[b-1]?f[b-1].evaluate(i):f[Lo(h,g)].evaluate(i)}eachChild(i){i(this.input);for(const h of this.outputs)i(h)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function dm(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var fm=Dd;function Dd(r,i,h,f){this.cx=3*r,this.bx=3*(h-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=i,this.p2x=h,this.p2y=f}Dd.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,i){if(i===void 0&&(i=1e-6),r<0)return 0;if(r>1)return 1;for(var h=r,f=0;f<8;f++){var g=this.sampleCurveX(h)-r;if(Math.abs(g)<i)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=g/b}var w=0,T=1;for(h=r,f=0;f<20&&(g=this.sampleCurveX(h),!(Math.abs(g-r)<i));f++)r>g?w=h:T=h,h=.5*(T-w)+w;return h},solve:function(r,i){return this.sampleCurveY(this.solveCurveX(r,i))}};var pm=dm(fm);function ta(r,i,h){return r+h*(i-r)}function Il(r,i,h){return r.map((f,g)=>ta(f,i[g],h))}const vs={number:ta,color:function(r,i,h,f="rgb"){switch(f){case"rgb":{const[g,b,w,T]=Il(r.rgb,i.rgb,h);return new mi(g,b,w,T,!1)}case"hcl":{const[g,b,w,T]=r.hcl,[P,k,O,N]=i.hcl;let $,X;if(isNaN(g)||isNaN(P))isNaN(g)?isNaN(P)?$=NaN:($=P,w!==1&&w!==0||(X=k)):($=g,O!==1&&O!==0||(X=b));else{let Lt=P-g;P>g&&Lt>180?Lt-=360:P<g&&g-P>180&&(Lt+=360),$=g+h*Lt}const[J,st,ct,_t]=function([Lt,xt,Et,Xt]){return Lt=isNaN(Lt)?0:Lt*Ot,Ke([Et,Math.cos(Lt)*xt,Math.sin(Lt)*xt,Xt])}([$,X??ta(b,k,h),ta(w,O,h),ta(T,N,h)]);return new mi(J,st,ct,_t,!1)}case"lab":{const[g,b,w,T]=Ke(Il(r.lab,i.lab,h));return new mi(g,b,w,T,!1)}}},array:Il,padding:function(r,i,h){return new fn(Il(r.values,i.values,h))},variableAnchorOffsetCollection:function(r,i,h){const f=r.values,g=i.values;if(f.length!==g.length)throw new rn(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${i.toString()}`);const b=[];for(let w=0;w<f.length;w+=2){if(f[w]!==g[w])throw new rn(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${g[w]}`);b.push(f[w]);const[T,P]=f[w+1],[k,O]=g[w+1];b.push([ta(T,k,h),ta(P,O,h)])}return new cn(b)}};class Jn{constructor(i,h,f,g,b){this.type=i,this.operator=h,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[w,T]of b)this.labels.push(w),this.outputs.push(T)}static interpolationFactor(i,h,f,g){let b=0;if(i.name==="exponential")b=Da(h,i.base,f,g);else if(i.name==="linear")b=Da(h,1,f,g);else if(i.name==="cubic-bezier"){const w=i.controlPoints;b=new pm(w[0],w[1],w[2],w[3]).solve(Da(h,1,f,g))}return b}static parse(i,h){let[f,g,b,...w]=i;if(!Array.isArray(g)||g.length===0)return h.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const k=g[1];if(typeof k!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:k}}else{if(g[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const k=g.slice(1);if(k.length!==4||k.some(O=>typeof O!="number"||O<0||O>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:k}}}if(i.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(b=h.parse(b,2,Bt),!b)return null;const T=[];let P=null;f==="interpolate-hcl"||f==="interpolate-lab"?P=yi:h.expectedType&&h.expectedType.kind!=="value"&&(P=h.expectedType);for(let k=0;k<w.length;k+=2){const O=w[k],N=w[k+1],$=k+3,X=k+4;if(typeof O!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(T.length&&T[T.length-1][0]>=O)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const J=h.parse(N,X,P);if(!J)return null;P=P||J.type,T.push([O,J])}return Rt(P,Bt)||Rt(P,yi)||Rt(P,tt)||Rt(P,j)||Rt(P,Z(Bt))?new Jn(P,f,g,b,T):h.error(`Type ${at(P)} is not interpolatable.`)}evaluate(i){const h=this.labels,f=this.outputs;if(h.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=h[0])return f[0].evaluate(i);const b=h.length;if(g>=h[b-1])return f[b-1].evaluate(i);const w=Lo(h,g),T=Jn.interpolationFactor(this.interpolation,g,h[w],h[w+1]),P=f[w].evaluate(i),k=f[w+1].evaluate(i);switch(this.operator){case"interpolate":return vs[this.type.kind](P,k,T);case"interpolate-hcl":return vs.color(P,k,T,"hcl");case"interpolate-lab":return vs.color(P,k,T,"lab")}}eachChild(i){i(this.input);for(const h of this.outputs)i(h)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Da(r,i,h,f){const g=f-h,b=r-h;return g===0?0:i===1?b/g:(Math.pow(i,b)-1)/(Math.pow(i,g)-1)}class zi{constructor(i,h){this.type=i,this.args=h}static parse(i,h){if(i.length<2)return h.error("Expectected at least one argument.");let f=null;const g=h.expectedType;g&&g.kind!=="value"&&(f=g);const b=[];for(const T of i.slice(1)){const P=h.parse(T,1+b.length,f,void 0,{typeAnnotation:"omit"});if(!P)return null;f=f||P.type,b.push(P)}if(!f)throw new Error("No output type");const w=g&&b.some(T=>bt(g,T.type));return new zi(w?vt:f,b)}evaluate(i){let h,f=null,g=0;for(const b of this.args)if(g++,f=b.evaluate(i),f&&f instanceof Wn&&!f.available&&(h||(h=f.name),f=null,g===this.args.length&&(f=h)),f!==null)break;return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}class Pl{constructor(i,h){this.type=h.type,this.bindings=[].concat(i),this.result=h}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const h of this.bindings)i(h[1]);i(this.result)}static parse(i,h){if(i.length<4)return h.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let b=1;b<i.length-1;b+=2){const w=i[b];if(typeof w!="string")return h.error(`Expected string, but found ${typeof w} instead.`,b);if(/[^a-zA-Z0-9_]/.test(w))return h.error("Variable names must contain only alphanumeric characters or '_'.",b);const T=h.parse(i[b+1],b+1);if(!T)return null;f.push([w,T])}const g=h.parse(i[i.length-1],i.length-1,h.expectedType,f);return g?new Pl(f,g):null}outputDefined(){return this.result.outputDefined()}}class oc{constructor(i,h,f){this.type=i,this.index=h,this.input=f}static parse(i,h){if(i.length!==3)return h.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=h.parse(i[1],1,Bt),g=h.parse(i[2],2,Z(h.expectedType||vt));return f&&g?new oc(g.type.itemType,f,g):null}evaluate(i){const h=this.index.evaluate(i),f=this.input.evaluate(i);if(h<0)throw new rn(`Array index out of bounds: ${h} < 0.`);if(h>=f.length)throw new rn(`Array index out of bounds: ${h} > ${f.length-1}.`);if(h!==Math.floor(h))throw new rn(`Array index must be an integer, but found ${h} instead.`);return f[h]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class lc{constructor(i,h){this.type=Pe,this.needle=i,this.haystack=h}static parse(i,h){if(i.length!==3)return h.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=h.parse(i[1],1,vt),g=h.parse(i[2],2,vt);return f&&g?Tt(f.type,[Pe,ge,Bt,oi,vt])?new lc(f,g):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${at(f.type)} instead`):null}evaluate(i){const h=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!f)return!1;if(!yt(h,["boolean","string","number","null"]))throw new rn(`Expected first argument to be of type boolean, string, number or null, but found ${at(sn(h))} instead.`);if(!yt(f,["string","array"]))throw new rn(`Expected second argument to be of type array or string, but found ${at(sn(f))} instead.`);return f.indexOf(h)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Ll{constructor(i,h,f){this.type=Bt,this.needle=i,this.haystack=h,this.fromIndex=f}static parse(i,h){if(i.length<=2||i.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=h.parse(i[1],1,vt),g=h.parse(i[2],2,vt);if(!f||!g)return null;if(!Tt(f.type,[Pe,ge,Bt,oi,vt]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${at(f.type)} instead`);if(i.length===4){const b=h.parse(i[3],3,Bt);return b?new Ll(f,g,b):null}return new Ll(f,g)}evaluate(i){const h=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!yt(h,["boolean","string","number","null"]))throw new rn(`Expected first argument to be of type boolean, string, number or null, but found ${at(sn(h))} instead.`);if(!yt(f,["string","array"]))throw new rn(`Expected second argument to be of type array or string, but found ${at(sn(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(i);return f.indexOf(h,g)}return f.indexOf(h)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class hc{constructor(i,h,f,g,b,w){this.inputType=i,this.type=h,this.input=f,this.cases=g,this.outputs=b,this.otherwise=w}static parse(i,h){if(i.length<5)return h.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return h.error("Expected an even number of arguments.");let f,g;h.expectedType&&h.expectedType.kind!=="value"&&(g=h.expectedType);const b={},w=[];for(let k=2;k<i.length-1;k+=2){let O=i[k];const N=i[k+1];Array.isArray(O)||(O=[O]);const $=h.concat(k);if(O.length===0)return $.error("Expected at least one branch label.");for(const J of O){if(typeof J!="number"&&typeof J!="string")return $.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return $.error("Numeric branch labels must be integer values.");if(f){if($.checkSubtype(f,sn(J)))return null}else f=sn(J);if(b[String(J)]!==void 0)return $.error("Branch labels must be unique.");b[String(J)]=w.length}const X=h.parse(N,k,g);if(!X)return null;g=g||X.type,w.push(X)}const T=h.parse(i[1],1,vt);if(!T)return null;const P=h.parse(i[i.length-1],i.length-1,g);return P?T.type.kind!=="value"&&h.concat(1).checkSubtype(f,T.type)?null:new hc(f,g,T,b,w,P):null}evaluate(i){const h=this.input.evaluate(i);return(sn(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class cc{constructor(i,h,f){this.type=i,this.branches=h,this.otherwise=f}static parse(i,h){if(i.length<4)return h.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return h.error("Expected an odd number of arguments.");let f;h.expectedType&&h.expectedType.kind!=="value"&&(f=h.expectedType);const g=[];for(let w=1;w<i.length-1;w+=2){const T=h.parse(i[w],w,Pe);if(!T)return null;const P=h.parse(i[w+1],w+1,f);if(!P)return null;g.push([T,P]),f=f||P.type}const b=h.parse(i[i.length-1],i.length-1,f);if(!b)return null;if(!f)throw new Error("Can't infer output type");return new cc(f,g,b)}evaluate(i){for(const[h,f]of this.branches)if(h.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[h,f]of this.branches)i(h),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class Rl{constructor(i,h,f,g){this.type=i,this.input=h,this.beginIndex=f,this.endIndex=g}static parse(i,h){if(i.length<=2||i.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=h.parse(i[1],1,vt),g=h.parse(i[2],2,Bt);if(!f||!g)return null;if(!Tt(f.type,[Z(vt),ge,vt]))return h.error(`Expected first argument to be of type array or string, but found ${at(f.type)} instead`);if(i.length===4){const b=h.parse(i[3],3,Bt);return b?new Rl(f.type,f,g,b):null}return new Rl(f.type,f,g)}evaluate(i){const h=this.input.evaluate(i),f=this.beginIndex.evaluate(i);if(!yt(h,["string","array"]))throw new rn(`Expected first argument to be of type array or string, but found ${at(sn(h))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(i);return h.slice(f,g)}return h.slice(f)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function zd(r,i){return r==="=="||r==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function kd(r,i,h,f){return f.compare(i,h)===0}function za(r,i,h){const f=r!=="=="&&r!=="!=";return class nw{constructor(b,w,T){this.type=Pe,this.lhs=b,this.rhs=w,this.collator=T,this.hasUntypedArgument=b.type.kind==="value"||w.type.kind==="value"}static parse(b,w){if(b.length!==3&&b.length!==4)return w.error("Expected two or three arguments.");const T=b[0];let P=w.parse(b[1],1,vt);if(!P)return null;if(!zd(T,P.type))return w.concat(1).error(`"${T}" comparisons are not supported for type '${at(P.type)}'.`);let k=w.parse(b[2],2,vt);if(!k)return null;if(!zd(T,k.type))return w.concat(2).error(`"${T}" comparisons are not supported for type '${at(k.type)}'.`);if(P.type.kind!==k.type.kind&&P.type.kind!=="value"&&k.type.kind!=="value")return w.error(`Cannot compare types '${at(P.type)}' and '${at(k.type)}'.`);f&&(P.type.kind==="value"&&k.type.kind!=="value"?P=new Gs(k.type,[P]):P.type.kind!=="value"&&k.type.kind==="value"&&(k=new Gs(P.type,[k])));let O=null;if(b.length===4){if(P.type.kind!=="string"&&k.type.kind!=="string"&&P.type.kind!=="value"&&k.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(O=w.parse(b[3],3,Jt),!O)return null}return new nw(P,k,O)}evaluate(b){const w=this.lhs.evaluate(b),T=this.rhs.evaluate(b);if(f&&this.hasUntypedArgument){const P=sn(w),k=sn(T);if(P.kind!==k.kind||P.kind!=="string"&&P.kind!=="number")throw new rn(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${P.kind}, ${k.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const P=sn(w),k=sn(T);if(P.kind!=="string"||k.kind!=="string")return i(b,w,T)}return this.collator?h(b,w,T,this.collator.evaluate(b)):i(b,w,T)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const mm=za("==",function(r,i,h){return i===h},kd),gm=za("!=",function(r,i,h){return i!==h},function(r,i,h,f){return!kd(0,i,h,f)}),_m=za("<",function(r,i,h){return i<h},function(r,i,h,f){return f.compare(i,h)<0}),ym=za(">",function(r,i,h){return i>h},function(r,i,h,f){return f.compare(i,h)>0}),vm=za("<=",function(r,i,h){return i<=h},function(r,i,h,f){return f.compare(i,h)<=0}),xm=za(">=",function(r,i,h){return i>=h},function(r,i,h,f){return f.compare(i,h)>=0});class uc{constructor(i,h,f,g,b){this.type=ge,this.number=i,this.locale=h,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=b}static parse(i,h){if(i.length!==3)return h.error("Expected two arguments.");const f=h.parse(i[1],1,Bt);if(!f)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return h.error("NumberFormat options argument must be an object.");let b=null;if(g.locale&&(b=h.parse(g.locale,1,ge),!b))return null;let w=null;if(g.currency&&(w=h.parse(g.currency,1,ge),!w))return null;let T=null;if(g["min-fraction-digits"]&&(T=h.parse(g["min-fraction-digits"],1,Bt),!T))return null;let P=null;return g["max-fraction-digits"]&&(P=h.parse(g["max-fraction-digits"],1,Bt),!P)?null:new uc(f,b,w,T,P)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Dl{constructor(i){this.type=fe,this.sections=i}static parse(i,h){if(i.length<2)return h.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&typeof f=="object")return h.error("First argument must be an image or text section.");const g=[];let b=!1;for(let w=1;w<=i.length-1;++w){const T=i[w];if(b&&typeof T=="object"&&!Array.isArray(T)){b=!1;let P=null;if(T["font-scale"]&&(P=h.parse(T["font-scale"],1,Bt),!P))return null;let k=null;if(T["text-font"]&&(k=h.parse(T["text-font"],1,Z(ge)),!k))return null;let O=null;if(T["text-color"]&&(O=h.parse(T["text-color"],1,yi),!O))return null;const N=g[g.length-1];N.scale=P,N.font=k,N.textColor=O}else{const P=h.parse(i[w],1,vt);if(!P)return null;const k=P.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,g.push({content:P,scale:null,font:null,textColor:null})}}return new Dl(g)}evaluate(i){return new Oi(this.sections.map(h=>{const f=h.content.evaluate(i);return sn(f)===V?new Kr("",f,null,null,null):new Kr(Mn(f),null,h.scale?h.scale.evaluate(i):null,h.font?h.font.evaluate(i).join(","):null,h.textColor?h.textColor.evaluate(i):null)}))}eachChild(i){for(const h of this.sections)i(h.content),h.scale&&i(h.scale),h.font&&i(h.font),h.textColor&&i(h.textColor)}outputDefined(){return!1}}class dc{constructor(i){this.type=V,this.input=i}static parse(i,h){if(i.length!==2)return h.error("Expected two arguments.");const f=h.parse(i[1],1,ge);return f?new dc(f):h.error("No image name provided.")}evaluate(i){const h=this.input.evaluate(i),f=Wn.fromString(h);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(h)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}}class fc{constructor(i){this.type=Bt,this.input=i}static parse(i,h){if(i.length!==2)return h.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=h.parse(i[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${at(f.type)} instead.`):new fc(f):null}evaluate(i){const h=this.input.evaluate(i);if(typeof h=="string"||Array.isArray(h))return h.length;throw new rn(`Expected value to be of type string or array, but found ${at(sn(h))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const ka={"==":mm,"!=":gm,">":ym,"<":_m,">=":xm,"<=":vm,array:Gs,at:oc,boolean:Gs,case:cc,coalesce:zi,collator:Ml,format:Dl,image:dc,in:lc,"index-of":Ll,interpolate:Jn,"interpolate-hcl":Jn,"interpolate-lab":Jn,length:fc,let:Pl,literal:Vs,match:hc,number:Gs,"number-format":uc,object:Gs,slice:Rl,step:Ra,string:Gs,"to-boolean":sr,"to-color":sr,"to-number":sr,"to-string":sr,var:El,within:Qr};function Fd(r,[i,h,f,g]){i=i.evaluate(r),h=h.evaluate(r),f=f.evaluate(r);const b=g?g.evaluate(r):1,w=Fn(i,h,f,b);if(w)throw new rn(w);return new mi(i/255,h/255,f/255,b,!1)}function Bd(r,i){return r in i}function pc(r,i){const h=i[r];return h===void 0?null:h}function ea(r){return{type:r}}function Od(r){return{result:"success",value:r}}function Fa(r){return{result:"error",value:r}}function Ba(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Nd(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function mc(r){return!!r.expression&&r.expression.interpolated}function Bi(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Oa(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function bm(r){return r}function Ud(r,i){const h=i.type==="color",f=r.stops&&typeof r.stops[0][0]=="object",g=f||!(f||r.property!==void 0),b=r.type||(mc(i)?"exponential":"interval");if(h||i.type==="padding"){const O=h?mi.parse:fn.parse;(r=Zt({},r)).stops&&(r.stops=r.stops.map(N=>[N[0],O(N[1])])),r.default=O(r.default?r.default:i.default)}if(r.colorSpace&&(w=r.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var w;let T,P,k;if(b==="exponential")T=Vd;else if(b==="interval")T=pn;else if(b==="categorical"){T=wm,P=Object.create(null);for(const O of r.stops)P[O[0]]=O[1];k=typeof r.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);T=Di}if(f){const O={},N=[];for(let J=0;J<r.stops.length;J++){const st=r.stops[J],ct=st[0].zoom;O[ct]===void 0&&(O[ct]={zoom:ct,type:r.type,property:r.property,default:r.default,stops:[]},N.push(ct)),O[ct].stops.push([st[0].value,st[1]])}const $=[];for(const J of N)$.push([O[J].zoom,Ud(O[J],i)]);const X={name:"linear"};return{kind:"composite",interpolationType:X,interpolationFactor:Jn.interpolationFactor.bind(void 0,X),zoomStops:$.map(J=>J[0]),evaluate:({zoom:J},st)=>Vd({stops:$,base:r.base},i,J).evaluate(J,st)}}if(g){const O=b==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:Jn.interpolationFactor.bind(void 0,O),zoomStops:r.stops.map(N=>N[0]),evaluate:({zoom:N})=>T(r,i,N,P,k)}}return{kind:"source",evaluate(O,N){const $=N&&N.properties?N.properties[r.property]:void 0;return $===void 0?Ro(r.default,i.default):T(r,i,$,P,k)}}}function Ro(r,i,h){return r!==void 0?r:i!==void 0?i:h!==void 0?h:void 0}function wm(r,i,h,f,g){return Ro(typeof h===g?f[h]:void 0,r.default,i.default)}function pn(r,i,h){if(Bi(h)!=="number")return Ro(r.default,i.default);const f=r.stops.length;if(f===1||h<=r.stops[0][0])return r.stops[0][1];if(h>=r.stops[f-1][0])return r.stops[f-1][1];const g=Lo(r.stops.map(b=>b[0]),h);return r.stops[g][1]}function Vd(r,i,h){const f=r.base!==void 0?r.base:1;if(Bi(h)!=="number")return Ro(r.default,i.default);const g=r.stops.length;if(g===1||h<=r.stops[0][0])return r.stops[0][1];if(h>=r.stops[g-1][0])return r.stops[g-1][1];const b=Lo(r.stops.map(O=>O[0]),h),w=function(O,N,$,X){const J=X-$,st=O-$;return J===0?0:N===1?st/J:(Math.pow(N,st)-1)/(Math.pow(N,J)-1)}(h,f,r.stops[b][0],r.stops[b+1][0]),T=r.stops[b][1],P=r.stops[b+1][1],k=vs[i.type]||bm;return typeof T.evaluate=="function"?{evaluate(...O){const N=T.evaluate.apply(void 0,O),$=P.evaluate.apply(void 0,O);if(N!==void 0&&$!==void 0)return k(N,$,w,r.colorSpace)}}:k(T,P,w,r.colorSpace)}function Di(r,i,h){switch(i.type){case"color":h=mi.parse(h);break;case"formatted":h=Oi.fromString(h.toString());break;case"resolvedImage":h=Wn.fromString(h.toString());break;case"padding":h=fn.parse(h);break;default:Bi(h)===i.type||i.type==="enum"&&i.values[h]||(h=void 0)}return Ro(h,r.default,i.default)}Ls.register(ka,{error:[{kind:"error"},[ge],(r,[i])=>{throw new rn(i.evaluate(r))}],typeof:[ge,[vt],(r,[i])=>at(sn(i.evaluate(r)))],"to-rgba":[Z(Bt,4),[yi],(r,[i])=>{const[h,f,g,b]=i.evaluate(r).rgb;return[255*h,255*f,255*g,b]}],rgb:[yi,[Bt,Bt,Bt],Fd],rgba:[yi,[Bt,Bt,Bt,Bt],Fd],has:{type:Pe,overloads:[[[ge],(r,[i])=>Bd(i.evaluate(r),r.properties())],[[ge,Fi],(r,[i,h])=>Bd(i.evaluate(r),h.evaluate(r))]]},get:{type:vt,overloads:[[[ge],(r,[i])=>pc(i.evaluate(r),r.properties())],[[ge,Fi],(r,[i,h])=>pc(i.evaluate(r),h.evaluate(r))]]},"feature-state":[vt,[ge],(r,[i])=>pc(i.evaluate(r),r.featureState||{})],properties:[Fi,[],r=>r.properties()],"geometry-type":[ge,[],r=>r.geometryType()],id:[vt,[],r=>r.id()],zoom:[Bt,[],r=>r.globals.zoom],"heatmap-density":[Bt,[],r=>r.globals.heatmapDensity||0],"line-progress":[Bt,[],r=>r.globals.lineProgress||0],accumulated:[vt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Bt,ea(Bt),(r,i)=>{let h=0;for(const f of i)h+=f.evaluate(r);return h}],"*":[Bt,ea(Bt),(r,i)=>{let h=1;for(const f of i)h*=f.evaluate(r);return h}],"-":{type:Bt,overloads:[[[Bt,Bt],(r,[i,h])=>i.evaluate(r)-h.evaluate(r)],[[Bt],(r,[i])=>-i.evaluate(r)]]},"/":[Bt,[Bt,Bt],(r,[i,h])=>i.evaluate(r)/h.evaluate(r)],"%":[Bt,[Bt,Bt],(r,[i,h])=>i.evaluate(r)%h.evaluate(r)],ln2:[Bt,[],()=>Math.LN2],pi:[Bt,[],()=>Math.PI],e:[Bt,[],()=>Math.E],"^":[Bt,[Bt,Bt],(r,[i,h])=>Math.pow(i.evaluate(r),h.evaluate(r))],sqrt:[Bt,[Bt],(r,[i])=>Math.sqrt(i.evaluate(r))],log10:[Bt,[Bt],(r,[i])=>Math.log(i.evaluate(r))/Math.LN10],ln:[Bt,[Bt],(r,[i])=>Math.log(i.evaluate(r))],log2:[Bt,[Bt],(r,[i])=>Math.log(i.evaluate(r))/Math.LN2],sin:[Bt,[Bt],(r,[i])=>Math.sin(i.evaluate(r))],cos:[Bt,[Bt],(r,[i])=>Math.cos(i.evaluate(r))],tan:[Bt,[Bt],(r,[i])=>Math.tan(i.evaluate(r))],asin:[Bt,[Bt],(r,[i])=>Math.asin(i.evaluate(r))],acos:[Bt,[Bt],(r,[i])=>Math.acos(i.evaluate(r))],atan:[Bt,[Bt],(r,[i])=>Math.atan(i.evaluate(r))],min:[Bt,ea(Bt),(r,i)=>Math.min(...i.map(h=>h.evaluate(r)))],max:[Bt,ea(Bt),(r,i)=>Math.max(...i.map(h=>h.evaluate(r)))],abs:[Bt,[Bt],(r,[i])=>Math.abs(i.evaluate(r))],round:[Bt,[Bt],(r,[i])=>{const h=i.evaluate(r);return h<0?-Math.round(-h):Math.round(h)}],floor:[Bt,[Bt],(r,[i])=>Math.floor(i.evaluate(r))],ceil:[Bt,[Bt],(r,[i])=>Math.ceil(i.evaluate(r))],"filter-==":[Pe,[ge,vt],(r,[i,h])=>r.properties()[i.value]===h.value],"filter-id-==":[Pe,[vt],(r,[i])=>r.id()===i.value],"filter-type-==":[Pe,[ge],(r,[i])=>r.geometryType()===i.value],"filter-<":[Pe,[ge,vt],(r,[i,h])=>{const f=r.properties()[i.value],g=h.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Pe,[vt],(r,[i])=>{const h=r.id(),f=i.value;return typeof h==typeof f&&h<f}],"filter->":[Pe,[ge,vt],(r,[i,h])=>{const f=r.properties()[i.value],g=h.value;return typeof f==typeof g&&f>g}],"filter-id->":[Pe,[vt],(r,[i])=>{const h=r.id(),f=i.value;return typeof h==typeof f&&h>f}],"filter-<=":[Pe,[ge,vt],(r,[i,h])=>{const f=r.properties()[i.value],g=h.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Pe,[vt],(r,[i])=>{const h=r.id(),f=i.value;return typeof h==typeof f&&h<=f}],"filter->=":[Pe,[ge,vt],(r,[i,h])=>{const f=r.properties()[i.value],g=h.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Pe,[vt],(r,[i])=>{const h=r.id(),f=i.value;return typeof h==typeof f&&h>=f}],"filter-has":[Pe,[vt],(r,[i])=>i.value in r.properties()],"filter-has-id":[Pe,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Pe,[Z(ge)],(r,[i])=>i.value.indexOf(r.geometryType())>=0],"filter-id-in":[Pe,[Z(vt)],(r,[i])=>i.value.indexOf(r.id())>=0],"filter-in-small":[Pe,[ge,Z(vt)],(r,[i,h])=>h.value.indexOf(r.properties()[i.value])>=0],"filter-in-large":[Pe,[ge,Z(vt)],(r,[i,h])=>function(f,g,b,w){for(;b<=w;){const T=b+w>>1;if(g[T]===f)return!0;g[T]>f?w=T-1:b=T+1}return!1}(r.properties()[i.value],h.value,0,h.value.length-1)],all:{type:Pe,overloads:[[[Pe,Pe],(r,[i,h])=>i.evaluate(r)&&h.evaluate(r)],[ea(Pe),(r,i)=>{for(const h of i)if(!h.evaluate(r))return!1;return!0}]]},any:{type:Pe,overloads:[[[Pe,Pe],(r,[i,h])=>i.evaluate(r)||h.evaluate(r)],[ea(Pe),(r,i)=>{for(const h of i)if(h.evaluate(r))return!0;return!1}]]},"!":[Pe,[Pe],(r,[i])=>!i.evaluate(r)],"is-supported-script":[Pe,[ge],(r,[i])=>{const h=r.globals&&r.globals.isSupportedScript;return!h||h(i.evaluate(r))}],upcase:[ge,[ge],(r,[i])=>i.evaluate(r).toUpperCase()],downcase:[ge,[ge],(r,[i])=>i.evaluate(r).toLowerCase()],concat:[ge,ea(vt),(r,i)=>i.map(h=>Mn(h.evaluate(r))).join("")],"resolved-locale":[ge,[Jt],(r,[i])=>i.evaluate(r).resolvedLocale()]});class Do{constructor(i,h){var f;this.expression=i,this._warningHistory={},this._evaluator=new La,this._defaultValue=h?(f=h).type==="color"&&Oa(f.default)?new mi(0,0,0,0):f.type==="color"?mi.parse(f.default)||null:f.type==="padding"?fn.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?cn.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(i,h,f,g,b,w){return this._evaluator.globals=i,this._evaluator.feature=h,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(i,h,f,g,b,w){this._evaluator.globals=i,this._evaluator.feature=h||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new rn(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Xi(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in ka}function Wi(r,i){const h=new Ni(ka,Co,[],i?function(g){const b={color:yi,string:ge,number:Bt,enum:ge,boolean:Pe,formatted:fe,padding:tt,resolvedImage:V,variableAnchorOffsetCollection:j};return g.type==="array"?Z(b[g.value]||vt,g.length):b[g.type]}(i):void 0),f=h.parse(r,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Od(new Do(f,i)):Fa(h.errors)}class Na{constructor(i,h){this.kind=i,this._styleExpression=h,this.isStateDependent=i!=="constant"&&!Po(h.expression)}evaluateWithoutErrorHandling(i,h,f,g,b,w){return this._styleExpression.evaluateWithoutErrorHandling(i,h,f,g,b,w)}evaluate(i,h,f,g,b,w){return this._styleExpression.evaluate(i,h,f,g,b,w)}}class zl{constructor(i,h,f,g){this.kind=i,this.zoomStops=f,this._styleExpression=h,this.isStateDependent=i!=="camera"&&!Po(h.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,h,f,g,b,w){return this._styleExpression.evaluateWithoutErrorHandling(i,h,f,g,b,w)}evaluate(i,h,f,g,b,w){return this._styleExpression.evaluate(i,h,f,g,b,w)}interpolationFactor(i,h,f){return this.interpolationType?Jn.interpolationFactor(this.interpolationType,i,h,f):0}}function Gd(r,i){const h=Wi(r,i);if(h.result==="error")return h;const f=h.value.expression,g=Io(f);if(!g&&!Ba(i))return Fa([new Ge("","data expressions not supported")]);const b=Cl(f,["zoom"]);if(!b&&!Nd(i))return Fa([new Ge("","zoom expressions not supported")]);const w=Fl(f);return w||b?w instanceof Ge?Fa([w]):w instanceof Jn&&!mc(i)?Fa([new Ge("",'"interpolate" expressions cannot be used with this property')]):Od(w?new zl(g?"camera":"composite",h.value,w.labels,w instanceof Jn?w.interpolation:void 0):new Na(g?"constant":"source",h.value)):Fa([new Ge("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class kl{constructor(i,h){this._parameters=i,this._specification=h,Zt(this,Ud(this._parameters,this._specification))}static deserialize(i){return new kl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Fl(r){let i=null;if(r instanceof Pl)i=Fl(r.result);else if(r instanceof zi){for(const h of r.args)if(i=Fl(h),i)break}else(r instanceof Ra||r instanceof Jn)&&r.input instanceof Ls&&r.input.name==="zoom"&&(i=r);return i instanceof Ge||r.eachChild(h=>{const f=Fl(h);f instanceof Ge?i=f:!i&&f?i=new Ge("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new Ge("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function gc(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const i of r.slice(1))if(!gc(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Hd={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Bl(r){if(r==null)return{filter:()=>!0,needGeometry:!1};gc(r)||(r=Ua(r));const i=Wi(r,Hd);if(i.result==="error")throw new Error(i.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,f,g)=>i.value.evaluate(h,f,{},g),needGeometry:_c(r)}}function Wd(r,i){return r<i?-1:r>i?1:0}function _c(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let i=1;i<r.length;i++)if(_c(r[i]))return!0;return!1}function Ua(r){if(!r)return!0;const i=r[0];return r.length<=1?i!=="any":i==="=="?yc(r[1],r[2],"=="):i==="!="?Ol(yc(r[1],r[2],"==")):i==="<"||i===">"||i==="<="||i===">="?yc(r[1],r[2],i):i==="any"?(h=r.slice(1),["any"].concat(h.map(Ua))):i==="all"?["all"].concat(r.slice(1).map(Ua)):i==="none"?["all"].concat(r.slice(1).map(Ua).map(Ol)):i==="in"?qd(r[1],r.slice(2)):i==="!in"?Ol(qd(r[1],r.slice(2))):i==="has"?$d(r[1]):i==="!has"?Ol($d(r[1])):i!=="within"||r;var h}function yc(r,i,h){switch(r){case"$type":return[`filter-type-${h}`,i];case"$id":return[`filter-id-${h}`,i];default:return[`filter-${h}`,r,i]}}function qd(r,i){if(i.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(h=>typeof h!=typeof i[0])?["filter-in-large",r,["literal",i.sort(Wd)]]:["filter-in-small",r,["literal",i]]}}function $d(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Ol(r){return["!",r]}function vc(r){const i=typeof r;if(i==="number"||i==="boolean"||i==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let g="[";for(const b of r)g+=`${vc(b)},`;return`${g}]`}const h=Object.keys(r).sort();let f="{";for(let g=0;g<h.length;g++)f+=`${JSON.stringify(h[g])}:${vc(r[h[g]])},`;return`${f}}`}function Mm(r){let i="";for(const h of ai)i+=`/${vc(r[h])}`;return i}function jd(r){const i=r.value;return i?[new Ut(r.key,i,"constants have been deprecated as of v8")]:[]}function un(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Dr(r){if(Array.isArray(r))return r.map(Dr);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const i={};for(const h in r)i[h]=Dr(r[h]);return i}return un(r)}function xs(r){const i=r.key,h=r.value,f=r.valueSpec||{},g=r.objectElementValidators||{},b=r.style,w=r.styleSpec,T=r.validateSpec;let P=[];const k=Bi(h);if(k!=="object")return[new Ut(i,h,`object expected, ${k} found`)];for(const O in h){const N=O.split(".")[0],$=f[N]||f["*"];let X;if(g[N])X=g[N];else if(f[N])X=T;else if(g["*"])X=g["*"];else{if(!f["*"]){P.push(new Ut(i,h[O],`unknown property "${O}"`));continue}X=T}P=P.concat(X({key:(i&&`${i}.`)+O,value:h[O],valueSpec:$,style:b,styleSpec:w,object:h,objectKey:O,validateSpec:T},h))}for(const O in f)g[O]||f[O].required&&f[O].default===void 0&&h[O]===void 0&&P.push(new Ut(i,h,`missing required property "${O}"`));return P}function Va(r){const i=r.value,h=r.valueSpec,f=r.style,g=r.styleSpec,b=r.key,w=r.arrayElementValidator||r.validateSpec;if(Bi(i)!=="array")return[new Ut(b,i,`array expected, ${Bi(i)} found`)];if(h.length&&i.length!==h.length)return[new Ut(b,i,`array length ${h.length} expected, length ${i.length} found`)];if(h["min-length"]&&i.length<h["min-length"])return[new Ut(b,i,`array length at least ${h["min-length"]} expected, length ${i.length} found`)];let T={type:h.value,values:h.values};g.$version<7&&(T.function=h.function),Bi(h.value)==="object"&&(T=h.value);let P=[];for(let k=0;k<i.length;k++)P=P.concat(w({array:i,arrayIndex:k,value:i[k],valueSpec:T,validateSpec:r.validateSpec,style:f,styleSpec:g,key:`${b}[${k}]`}));return P}function xc(r){const i=r.key,h=r.value,f=r.valueSpec;let g=Bi(h);return g==="number"&&h!=h&&(g="NaN"),g!=="number"?[new Ut(i,h,`number expected, ${g} found`)]:"minimum"in f&&h<f.minimum?[new Ut(i,h,`${h} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&h>f.maximum?[new Ut(i,h,`${h} is greater than the maximum value ${f.maximum}`)]:[]}function bc(r){const i=r.valueSpec,h=un(r.value.type);let f,g,b,w={};const T=h!=="categorical"&&r.value.property===void 0,P=!T,k=Bi(r.value.stops)==="array"&&Bi(r.value.stops[0])==="array"&&Bi(r.value.stops[0][0])==="object",O=xs({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(X){if(h==="identity")return[new Ut(X.key,X.value,'identity function may not have a "stops" property')];let J=[];const st=X.value;return J=J.concat(Va({key:X.key,value:st,valueSpec:X.valueSpec,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:N})),Bi(st)==="array"&&st.length===0&&J.push(new Ut(X.key,st,"array must have at least one stop")),J},default:function(X){return X.validateSpec({key:X.key,value:X.value,valueSpec:i,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec})}}});return h==="identity"&&T&&O.push(new Ut(r.key,r.value,'missing required property "property"')),h==="identity"||r.value.stops||O.push(new Ut(r.key,r.value,'missing required property "stops"')),h==="exponential"&&r.valueSpec.expression&&!mc(r.valueSpec)&&O.push(new Ut(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(P&&!Ba(r.valueSpec)?O.push(new Ut(r.key,r.value,"property functions not supported")):T&&!Nd(r.valueSpec)&&O.push(new Ut(r.key,r.value,"zoom functions not supported"))),h!=="categorical"&&!k||r.value.property!==void 0||O.push(new Ut(r.key,r.value,'"property" property is required')),O;function N(X){let J=[];const st=X.value,ct=X.key;if(Bi(st)!=="array")return[new Ut(ct,st,`array expected, ${Bi(st)} found`)];if(st.length!==2)return[new Ut(ct,st,`array length 2 expected, length ${st.length} found`)];if(k){if(Bi(st[0])!=="object")return[new Ut(ct,st,`object expected, ${Bi(st[0])} found`)];if(st[0].zoom===void 0)return[new Ut(ct,st,"object stop key must have zoom")];if(st[0].value===void 0)return[new Ut(ct,st,"object stop key must have value")];if(b&&b>un(st[0].zoom))return[new Ut(ct,st[0].zoom,"stop zoom values must appear in ascending order")];un(st[0].zoom)!==b&&(b=un(st[0].zoom),g=void 0,w={}),J=J.concat(xs({key:`${ct}[0]`,value:st[0],valueSpec:{zoom:{}},validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:xc,value:$}}))}else J=J.concat($({key:`${ct}[0]`,value:st[0],valueSpec:{},validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec},st));return Xi(Dr(st[1]))?J.concat([new Ut(`${ct}[1]`,st[1],"expressions are not allowed in function stops.")]):J.concat(X.validateSpec({key:`${ct}[1]`,value:st[1],valueSpec:i,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec}))}function $(X,J){const st=Bi(X.value),ct=un(X.value),_t=X.value!==null?X.value:J;if(f){if(st!==f)return[new Ut(X.key,_t,`${st} stop domain type must match previous stop domain type ${f}`)]}else f=st;if(st!=="number"&&st!=="string"&&st!=="boolean")return[new Ut(X.key,_t,"stop domain value must be a number, string, or boolean")];if(st!=="number"&&h!=="categorical"){let Lt=`number expected, ${st} found`;return Ba(i)&&h===void 0&&(Lt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ut(X.key,_t,Lt)]}return h!=="categorical"||st!=="number"||isFinite(ct)&&Math.floor(ct)===ct?h!=="categorical"&&st==="number"&&g!==void 0&&ct<g?[new Ut(X.key,_t,"stop domain values must appear in ascending order")]:(g=ct,h==="categorical"&&ct in w?[new Ut(X.key,_t,"stop domain values must be unique")]:(w[ct]=!0,[])):[new Ut(X.key,_t,`integer expected, found ${ct}`)]}}function Ga(r){const i=(r.expressionContext==="property"?Gd:Wi)(Dr(r.value),r.valueSpec);if(i.result==="error")return i.value.map(f=>new Ut(`${r.key}${f.key}`,r.value,f.message));const h=i.value.expression||i.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!h.outputDefined())return[new Ut(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Po(h))return[new Ut(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Po(h))return[new Ut(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Cl(h,["zoom","feature-state"]))return[new Ut(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Io(h))return[new Ut(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ia(r){const i=r.key,h=r.value,f=r.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(un(h))===-1&&g.push(new Ut(i,h,`expected one of [${f.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(f.values).indexOf(un(h))===-1&&g.push(new Ut(i,h,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(h)} found`)),g}function Ha(r){return gc(Dr(r.value))?Ga(Zt({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):zo(r)}function zo(r){const i=r.value,h=r.key;if(Bi(i)!=="array")return[new Ut(h,i,`array expected, ${Bi(i)} found`)];const f=r.styleSpec;let g,b=[];if(i.length<1)return[new Ut(h,i,"filter array must have at least 1 element")];switch(b=b.concat(ia({key:`${h}[0]`,value:i[0],valueSpec:f.filter_operator,style:r.style,styleSpec:r.styleSpec})),un(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&un(i[1])==="$type"&&b.push(new Ut(h,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&b.push(new Ut(h,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Bi(i[1]),g!=="string"&&b.push(new Ut(`${h}[1]`,i[1],`string expected, ${g} found`)));for(let w=2;w<i.length;w++)g=Bi(i[w]),un(i[1])==="$type"?b=b.concat(ia({key:`${h}[${w}]`,value:i[w],valueSpec:f.geometry_type,style:r.style,styleSpec:r.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&b.push(new Ut(`${h}[${w}]`,i[w],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let w=1;w<i.length;w++)b=b.concat(zo({key:`${h}[${w}]`,value:i[w],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":g=Bi(i[1]),i.length!==2?b.push(new Ut(h,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&b.push(new Ut(`${h}[1]`,i[1],`string expected, ${g} found`));break;case"within":g=Bi(i[1]),i.length!==2?b.push(new Ut(h,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="object"&&b.push(new Ut(`${h}[1]`,i[1],`object expected, ${g} found`))}return b}function wc(r,i){const h=r.key,f=r.validateSpec,g=r.style,b=r.styleSpec,w=r.value,T=r.objectKey,P=b[`${i}_${r.layerType}`];if(!P)return[];const k=T.match(/^(.*)-transition$/);if(i==="paint"&&k&&P[k[1]]&&P[k[1]].transition)return f({key:h,value:w,valueSpec:b.transition,style:g,styleSpec:b});const O=r.valueSpec||P[T];if(!O)return[new Ut(h,w,`unknown property "${T}"`)];let N;if(Bi(w)==="string"&&Ba(O)&&!O.tokens&&(N=/^{([^}]+)}$/.exec(w)))return[new Ut(h,w,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];const $=[];return r.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&$.push(new Ut(h,w,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&Oa(Dr(w))&&un(w.type)==="identity"&&$.push(new Ut(h,w,'"text-font" does not support identity functions'))),$.concat(f({key:r.key,value:w,valueSpec:O,style:g,styleSpec:b,expressionContext:"property",propertyType:i,propertyKey:T}))}function Nl(r){return wc(r,"paint")}function Mc(r){return wc(r,"layout")}function Sc(r){let i=[];const h=r.value,f=r.key,g=r.style,b=r.styleSpec;h.type||h.ref||i.push(new Ut(f,h,'either "type" or "ref" is required'));let w=un(h.type);const T=un(h.ref);if(h.id){const P=un(h.id);for(let k=0;k<r.arrayIndex;k++){const O=g.layers[k];un(O.id)===P&&i.push(new Ut(f,h.id,`duplicate layer id "${h.id}", previously used at line ${O.id.__line__}`))}}if("ref"in h){let P;["type","source","source-layer","filter","layout"].forEach(k=>{k in h&&i.push(new Ut(f,h[k],`"${k}" is prohibited for ref layers`))}),g.layers.forEach(k=>{un(k.id)===T&&(P=k)}),P?P.ref?i.push(new Ut(f,h.ref,"ref cannot reference another ref layer")):w=un(P.type):i.push(new Ut(f,h.ref,`ref layer "${T}" not found`))}else if(w!=="background")if(h.source){const P=g.sources&&g.sources[h.source],k=P&&un(P.type);P?k==="vector"&&w==="raster"?i.push(new Ut(f,h.source,`layer "${h.id}" requires a raster source`)):k!=="raster-dem"&&w==="hillshade"?i.push(new Ut(f,h.source,`layer "${h.id}" requires a raster-dem source`)):k==="raster"&&w!=="raster"?i.push(new Ut(f,h.source,`layer "${h.id}" requires a vector source`)):k!=="vector"||h["source-layer"]?k==="raster-dem"&&w!=="hillshade"?i.push(new Ut(f,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!h.paint||!h.paint["line-gradient"]||k==="geojson"&&P.lineMetrics||i.push(new Ut(f,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Ut(f,h,`layer "${h.id}" must specify a "source-layer"`)):i.push(new Ut(f,h.source,`source "${h.source}" not found`))}else i.push(new Ut(f,h,'missing required property "source"'));return i=i.concat(xs({key:f,value:h,valueSpec:b.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${f}.type`,value:h.type,valueSpec:b.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:h,objectKey:"type"}),filter:Ha,layout:P=>xs({layer:h,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":k=>Mc(Zt({layerType:w},k))}}),paint:P=>xs({layer:h,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":k=>Nl(Zt({layerType:w},k))}})}})),i}function ar(r){const i=r.value,h=r.key,f=Bi(i);return f!=="string"?[new Ut(h,i,`string expected, ${f} found`)]:[]}const Zd={promoteId:function({key:r,value:i}){if(Bi(i)==="string")return ar({key:r,value:i});{const h=[];for(const f in i)h.push(...ar({key:`${r}.${f}`,value:i[f]}));return h}}};function Xd(r){const i=r.value,h=r.key,f=r.styleSpec,g=r.style,b=r.validateSpec;if(!i.type)return[new Ut(h,i,'"type" is required')];const w=un(i.type);let T;switch(w){case"vector":case"raster":return T=xs({key:h,value:i,valueSpec:f[`source_${w.replace("-","_")}`],style:r.style,styleSpec:f,objectElementValidators:Zd,validateSpec:b}),T;case"raster-dem":return T=function(P){var k;const O=(k=P.sourceName)!==null&&k!==void 0?k:"",N=P.value,$=P.styleSpec,X=$.source_raster_dem,J=P.style;let st=[];const ct=Bi(N);if(N===void 0)return st;if(ct!=="object")return st.push(new Ut("source_raster_dem",N,`object expected, ${ct} found`)),st;const _t=un(N.encoding)==="custom",Lt=["redFactor","greenFactor","blueFactor","baseShift"],xt=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Et in N)!_t&&Lt.includes(Et)?st.push(new Ut(Et,N[Et],`In "${O}": "${Et}" is only valid when "encoding" is set to "custom". ${xt} encoding found`)):X[Et]?st=st.concat(P.validateSpec({key:Et,value:N[Et],valueSpec:X[Et],validateSpec:P.validateSpec,style:J,styleSpec:$})):st.push(new Ut(Et,N[Et],`unknown property "${Et}"`));return st}({sourceName:h,value:i,style:r.style,styleSpec:f,validateSpec:b}),T;case"geojson":if(T=xs({key:h,value:i,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:b,objectElementValidators:Zd}),i.cluster)for(const P in i.clusterProperties){const[k,O]=i.clusterProperties[P],N=typeof k=="string"?[k,["accumulated"],["get",P]]:k;T.push(...Ga({key:`${h}.${P}.map`,value:O,validateSpec:b,expressionContext:"cluster-map"})),T.push(...Ga({key:`${h}.${P}.reduce`,value:N,validateSpec:b,expressionContext:"cluster-reduce"}))}return T;case"video":return xs({key:h,value:i,valueSpec:f.source_video,style:g,validateSpec:b,styleSpec:f});case"image":return xs({key:h,value:i,valueSpec:f.source_image,style:g,validateSpec:b,styleSpec:f});case"canvas":return[new Ut(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ia({key:`${h}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:b,styleSpec:f})}}function Yd(r){const i=r.value,h=r.styleSpec,f=h.light,g=r.style;let b=[];const w=Bi(i);if(i===void 0)return b;if(w!=="object")return b=b.concat([new Ut("light",i,`object expected, ${w} found`)]),b;for(const T in i){const P=T.match(/^(.*)-transition$/);b=b.concat(P&&f[P[1]]&&f[P[1]].transition?r.validateSpec({key:T,value:i[T],valueSpec:h.transition,validateSpec:r.validateSpec,style:g,styleSpec:h}):f[T]?r.validateSpec({key:T,value:i[T],valueSpec:f[T],validateSpec:r.validateSpec,style:g,styleSpec:h}):[new Ut(T,i[T],`unknown property "${T}"`)])}return b}function Jd(r){const i=r.value,h=r.styleSpec,f=h.sky,g=r.style,b=Bi(i);if(i===void 0)return[];if(b!=="object")return[new Ut("sky",i,`object expected, ${b} found`)];let w=[];for(const T in i)w=w.concat(f[T]?Bn({key:T,value:i[T],valueSpec:f[T],style:g,styleSpec:h}):[new Ut(T,i[T],`unknown property "${T}"`)]);return w}function Kd(r){const i=r.value,h=r.styleSpec,f=h.terrain,g=r.style;let b=[];const w=Bi(i);if(i===void 0)return b;if(w!=="object")return b=b.concat([new Ut("terrain",i,`object expected, ${w} found`)]),b;for(const T in i)b=b.concat(f[T]?r.validateSpec({key:T,value:i[T],valueSpec:f[T],validateSpec:r.validateSpec,style:g,styleSpec:h}):[new Ut(T,i[T],`unknown property "${T}"`)]);return b}function ko(r){let i=[];const h=r.value,f=r.key;if(Array.isArray(h)){const g=[],b=[];for(const w in h)h[w].id&&g.includes(h[w].id)&&i.push(new Ut(f,h,`all the sprites' ids must be unique, but ${h[w].id} is duplicated`)),g.push(h[w].id),h[w].url&&b.includes(h[w].url)&&i.push(new Ut(f,h,`all the sprites' URLs must be unique, but ${h[w].url} is duplicated`)),b.push(h[w].url),i=i.concat(xs({key:`${f}[${w}]`,value:h[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return i}return ar({key:f,value:h})}const Fo={"*":()=>[],array:Va,boolean:function(r){const i=r.value,h=r.key,f=Bi(i);return f!=="boolean"?[new Ut(h,i,`boolean expected, ${f} found`)]:[]},number:xc,color:function(r){const i=r.key,h=r.value,f=Bi(h);return f!=="string"?[new Ut(i,h,`color expected, ${f} found`)]:mi.parse(String(h))?[]:[new Ut(i,h,`color expected, "${h}" found`)]},constants:jd,enum:ia,filter:Ha,function:bc,layer:Sc,object:xs,source:Xd,light:Yd,sky:Jd,terrain:Kd,string:ar,formatted:function(r){return ar(r).length===0?[]:Ga(r)},resolvedImage:function(r){return ar(r).length===0?[]:Ga(r)},padding:function(r){const i=r.key,h=r.value;if(Bi(h)==="array"){if(h.length<1||h.length>4)return[new Ut(i,h,`padding requires 1 to 4 values; ${h.length} values found`)];const f={type:"number"};let g=[];for(let b=0;b<h.length;b++)g=g.concat(r.validateSpec({key:`${i}[${b}]`,value:h[b],validateSpec:r.validateSpec,valueSpec:f}));return g}return xc({key:i,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const i=r.key,h=r.value,f=Bi(h),g=r.styleSpec;if(f!=="array"||h.length<1||h.length%2!=0)return[new Ut(i,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let w=0;w<h.length;w+=2)b=b.concat(ia({key:`${i}[${w}]`,value:h[w],valueSpec:g.layout_symbol["text-anchor"]})),b=b.concat(Va({key:`${i}[${w+1}]`,value:h[w+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:g}));return b},sprite:ko};function Bn(r){const i=r.value,h=r.valueSpec,f=r.styleSpec;return r.validateSpec=Bn,h.expression&&Oa(un(i))?bc(r):h.expression&&Xi(Dr(i))?Ga(r):h.type&&Fo[h.type]?Fo[h.type](r):xs(Zt({},r,{valueSpec:h.type?f[h.type]:h}))}function Wa(r){const i=r.value,h=r.key,f=ar(r);return f.length||(i.indexOf("{fontstack}")===-1&&f.push(new Ut(h,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&f.push(new Ut(h,i,'"glyphs" url must include a "{range}" token'))),f}function Rs(r,i=Pt){let h=[];return h=h.concat(Bn({key:"",value:r,valueSpec:i.$root,styleSpec:i,style:r,validateSpec:Bn,objectElementValidators:{glyphs:Wa,"*":()=>[]}})),r.constants&&(h=h.concat(jd({key:"constants",value:r.constants,style:r,styleSpec:i,validateSpec:Bn}))),Qd(h)}function or(r){return function(i){return r({...i,validateSpec:Bn})}}function Qd(r){return[].concat(r).sort((i,h)=>i.line-h.line)}function rs(r){return function(...i){return Qd(r.apply(this,i))}}Rs.source=rs(or(Xd)),Rs.sprite=rs(or(ko)),Rs.glyphs=rs(or(Wa)),Rs.light=rs(or(Yd)),Rs.sky=rs(or(Jd)),Rs.terrain=rs(or(Kd)),Rs.layer=rs(or(Sc)),Rs.filter=rs(or(Ha)),Rs.paintProperty=rs(or(Nl)),Rs.layoutProperty=rs(or(Mc));const qa=Rs,Ac=qa.light,Sm=qa.paintProperty,Tc=qa.layoutProperty;function tf(r,i){let h=!1;if(i&&i.length)for(const f of i)r.fire(new Ee(new Error(f.message))),h=!0;return h}class _r{constructor(i,h,f){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const w=new Int32Array(this.arrayBuffer);i=w[0],this.d=(h=w[1])+2*(f=w[2]);for(let P=0;P<this.d*this.d;P++){const k=w[3+P],O=w[3+P+1];g.push(k===O?null:w.subarray(k,O))}const T=w[3+g.length+1];this.keys=w.subarray(w[3+g.length],T),this.bboxes=w.subarray(T),this.insert=this._insertReadonly}else{this.d=h+2*f;for(let w=0;w<this.d*this.d;w++)g.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=i,this.padding=f,this.scale=h/i,this.uid=0;const b=f/h*i;this.min=-b,this.max=i+b}insert(i,h,f,g,b){this._forEachCell(h,f,g,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,h,f,g,b,w){this.cells[b].push(w)}query(i,h,f,g,b){const w=this.min,T=this.max;if(i<=w&&h<=w&&T<=f&&T<=g&&!b)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(i,h,f,g,this._queryCell,P,{},b),P}}_queryCell(i,h,f,g,b,w,T,P){const k=this.cells[b];if(k!==null){const O=this.keys,N=this.bboxes;for(let $=0;$<k.length;$++){const X=k[$];if(T[X]===void 0){const J=4*X;(P?P(N[J+0],N[J+1],N[J+2],N[J+3]):i<=N[J+2]&&h<=N[J+3]&&f>=N[J+0]&&g>=N[J+1])?(T[X]=!0,w.push(O[X])):T[X]=!1}}}}_forEachCell(i,h,f,g,b,w,T,P){const k=this._convertToCellCoord(i),O=this._convertToCellCoord(h),N=this._convertToCellCoord(f),$=this._convertToCellCoord(g);for(let X=k;X<=N;X++)for(let J=O;J<=$;J++){const st=this.d*J+X;if((!P||P(this._convertFromCellCoord(X),this._convertFromCellCoord(J),this._convertFromCellCoord(X+1),this._convertFromCellCoord(J+1)))&&b.call(this,i,h,f,g,st,w,T,P))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,h=3+this.cells.length+1+1;let f=0;for(let w=0;w<this.cells.length;w++)f+=this.cells[w].length;const g=new Int32Array(h+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let b=h;for(let w=0;w<i.length;w++){const T=i[w];g[3+w]=b,g.set(T,b),b+=T.length}return g[3+i.length]=b,g.set(this.keys,b),b+=this.keys.length,g[3+i.length+1]=b,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer}static serialize(i,h){const f=i.toArrayBuffer();return h&&h.push(f),{buffer:f}}static deserialize(i){return new _r(i.buffer)}}const zr={};function Ne(r,i,h={}){if(zr[r])throw new Error(`${r} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:r,writeable:!1}),zr[r]={klass:i,omit:h.omit||[],shallow:h.shallow||[]}}Ne("Object",Object),Ne("TransferableGridIndex",_r),Ne("Color",mi),Ne("Error",Error),Ne("AJAXError",ei),Ne("ResolvedImage",Wn),Ne("StylePropertyFunction",kl),Ne("StyleExpression",Do,{omit:["_evaluator"]}),Ne("ZoomDependentExpression",zl),Ne("ZoomConstantExpression",Na),Ne("CompoundExpression",Ls,{omit:["_evaluate"]});for(const r in ka)ka[r]._classRegistryKey||Ne(`Expression_${r}`,ka[r]);function Ec(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function na(r,i){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error)return r;if(Ec(r)||ie(r))return i&&i.push(r),r;if(ArrayBuffer.isView(r)){const h=r;return i&&i.push(h.buffer),h}if(r instanceof ImageData)return i&&i.push(r.data.buffer),r;if(Array.isArray(r)){const h=[];for(const f of r)h.push(na(f,i));return h}if(typeof r=="object"){const h=r.constructor,f=h._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!zr[f])throw new Error(`${f} is not registered.`);const g=h.serialize?h.serialize(r,i):{};if(h.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in r){if(!r.hasOwnProperty(b)||zr[f].omit.indexOf(b)>=0)continue;const w=r[b];g[b]=zr[f].shallow.indexOf(b)>=0?w:na(w,i)}r instanceof Error&&(g.message=r.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof r)}function $a(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Ec(r)||ie(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map($a);if(typeof r=="object"){const i=r.$name||"Object";if(!zr[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:h}=zr[i];if(!h)throw new Error(`can't deserialize unregistered class ${i}`);if(h.deserialize)return h.deserialize(r);const f=Object.create(h.prototype);for(const g of Object.keys(r)){if(g==="$name")continue;const b=r[g];f[g]=zr[i].shallow.indexOf(g)>=0?b:$a(b)}return f}throw new Error("can't deserialize object of type "+typeof r)}class Cc{constructor(){this.first=!0}update(i,h){const f=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=h),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=f,!0))}}const ze={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Bo(r){for(const i of r)if(Vl(i.charCodeAt(0)))return!0;return!1}function Ul(r){for(const i of r)if(!ef(i.charCodeAt(0)))return!1;return!0}function ef(r){return!(ze.Arabic(r)||ze["Arabic Supplement"](r)||ze["Arabic Extended-A"](r)||ze["Arabic Presentation Forms-A"](r)||ze["Arabic Presentation Forms-B"](r))}function Vl(r){return!(r!==746&&r!==747&&(r<4352||!(ze["Bopomofo Extended"](r)||ze.Bopomofo(r)||ze["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||ze["CJK Compatibility Ideographs"](r)||ze["CJK Compatibility"](r)||ze["CJK Radicals Supplement"](r)||ze["CJK Strokes"](r)||!(!ze["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||ze["CJK Unified Ideographs Extension A"](r)||ze["CJK Unified Ideographs"](r)||ze["Enclosed CJK Letters and Months"](r)||ze["Hangul Compatibility Jamo"](r)||ze["Hangul Jamo Extended-A"](r)||ze["Hangul Jamo Extended-B"](r)||ze["Hangul Jamo"](r)||ze["Hangul Syllables"](r)||ze.Hiragana(r)||ze["Ideographic Description Characters"](r)||ze.Kanbun(r)||ze["Kangxi Radicals"](r)||ze["Katakana Phonetic Extensions"](r)||ze.Katakana(r)&&r!==12540||!(!ze["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!ze["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||ze["Unified Canadian Aboriginal Syllabics"](r)||ze["Unified Canadian Aboriginal Syllabics Extended"](r)||ze["Vertical Forms"](r)||ze["Yijing Hexagram Symbols"](r)||ze["Yi Syllables"](r)||ze["Yi Radicals"](r))))}function Ic(r){return!(Vl(r)||function(i){return!!(ze["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||ze["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||ze["Letterlike Symbols"](i)||ze["Number Forms"](i)||ze["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||ze["Control Pictures"](i)&&i!==9251||ze["Optical Character Recognition"](i)||ze["Enclosed Alphanumerics"](i)||ze["Geometric Shapes"](i)||ze["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||ze["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||ze["CJK Symbols and Punctuation"](i)||ze.Katakana(i)||ze["Private Use Area"](i)||ze["CJK Compatibility Forms"](i)||ze["Small Form Variants"](i)||ze["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(r))}function Pc(r){return r>=1424&&r<=2303||ze["Arabic Presentation Forms-A"](r)||ze["Arabic Presentation Forms-B"](r)}function Lc(r,i){return!(!i&&Pc(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||ze.Khmer(r))}function nf(r){for(const i of r)if(Pc(i.charCodeAt(0)))return!0;return!1}const sa=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ki{constructor(i,h){this.zoom=i,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Cc,this.transition={})}isSupportedScript(i){return function(h,f){for(const g of h)if(!Lc(g.charCodeAt(0),f))return!1;return!0}(i,sa.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,h=i-Math.floor(i),f=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*h}}}class Gl{constructor(i,h){this.property=i,this.value=h,this.expression=function(f,g){if(Oa(f))return new kl(f,g);if(Xi(f)){const b=Gd(f,g);if(b.result==="error")throw new Error(b.value.map(w=>`${w.key}: ${w.message}`).join(", "));return b.value}{let b=f;return g.type==="color"&&typeof f=="string"?b=mi.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(b=cn.parse(f)):b=fn.parse(f),{kind:"constant",evaluate:()=>b}}}(h===void 0?i.specification.default:h,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,h,f){return this.property.possiblyEvaluate(this,i,h,f)}}class Hl{constructor(i){this.property=i,this.value=new Gl(i,void 0)}transitioned(i,h){return new Dc(this.property,this.value,h,pt({},i.transition,this.transition),i.now)}untransitioned(){return new Dc(this.property,this.value,null,{},0)}}class Rc{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return kt(this._values[i].value.value)}setValue(i,h){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Hl(this._values[i].property)),this._values[i].value=new Gl(this._values[i].property,h===null?void 0:kt(h))}getTransition(i){return kt(this._values[i].transition)}setTransition(i,h){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Hl(this._values[i].property)),this._values[i].transition=kt(h)||void 0}serialize(){const i={};for(const h of Object.keys(this._values)){const f=this.getValue(h);f!==void 0&&(i[h]=f);const g=this.getTransition(h);g!==void 0&&(i[`${h}-transition`]=g)}return i}transitioned(i,h){const f=new sf(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(i,h._values[g]);return f}untransitioned(){const i=new sf(this._properties);for(const h of Object.keys(this._values))i._values[h]=this._values[h].untransitioned();return i}}class Dc{constructor(i,h,f,g,b){this.property=i,this.value=h,this.begin=b+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(i,h,f){const g=i.now||0,b=this.value.possiblyEvaluate(i,h,f),w=this.prior;if(w){if(g>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(g<this.begin)return w.possiblyEvaluate(i,h,f);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(i,h,f),b,function(P){if(P<=0)return 0;if(P>=1)return 1;const k=P*P,O=k*P;return 4*(P<.5?O:3*(P-k)+O-.75)}(T))}}return b}}class sf{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,h,f){const g=new Oo(this._properties);for(const b of Object.keys(this._values))g._values[b]=this._values[b].possiblyEvaluate(i,h,f);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Am{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return kt(this._values[i].value)}setValue(i,h){this._values[i]=new Gl(this._values[i].property,h===null?void 0:kt(h))}serialize(){const i={};for(const h of Object.keys(this._values)){const f=this.getValue(h);f!==void 0&&(i[h]=f)}return i}possiblyEvaluate(i,h,f){const g=new Oo(this._properties);for(const b of Object.keys(this._values))g._values[b]=this._values[b].possiblyEvaluate(i,h,f);return g}}class Hs{constructor(i,h,f){this.property=i,this.value=h,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,h,f,g){return this.property.evaluate(this.value,this.parameters,i,h,f,g)}}class Oo{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Ye{constructor(i){this.specification=i}possiblyEvaluate(i,h){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(h)}interpolate(i,h,f){const g=vs[this.specification.type];return g?g(i,h,f):i}}class ri{constructor(i,h){this.specification=i,this.overrides=h}possiblyEvaluate(i,h,f,g){return new Hs(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(h,null,{},f,g)}:i.expression,h)}interpolate(i,h,f){if(i.value.kind!=="constant"||h.value.kind!=="constant")return i;if(i.value.value===void 0||h.value.value===void 0)return new Hs(this,{kind:"constant",value:void 0},i.parameters);const g=vs[this.specification.type];if(g){const b=g(i.value.value,h.value.value,f);return new Hs(this,{kind:"constant",value:b},i.parameters)}return i}evaluate(i,h,f,g,b,w){return i.kind==="constant"?i.value:i.evaluate(h,f,g,b,w)}}class ra extends ri{possiblyEvaluate(i,h,f,g){if(i.value===void 0)return new Hs(this,{kind:"constant",value:void 0},h);if(i.expression.kind==="constant"){const b=i.expression.evaluate(h,null,{},f,g),w=i.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,T=this._calculate(w,w,w,h);return new Hs(this,{kind:"constant",value:T},h)}if(i.expression.kind==="camera"){const b=this._calculate(i.expression.evaluate({zoom:h.zoom-1}),i.expression.evaluate({zoom:h.zoom}),i.expression.evaluate({zoom:h.zoom+1}),h);return new Hs(this,{kind:"constant",value:b},h)}return new Hs(this,i.expression,h)}evaluate(i,h,f,g,b,w){if(i.kind==="source"){const T=i.evaluate(h,f,g,b,w);return this._calculate(T,T,T,h)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(h.zoom)-1},f,g),i.evaluate({zoom:Math.floor(h.zoom)},f,g),i.evaluate({zoom:Math.floor(h.zoom)+1},f,g),h):i.value}_calculate(i,h,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:h}:{from:f,to:h}}interpolate(i){return i}}class zc{constructor(i){this.specification=i}possiblyEvaluate(i,h,f,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const b=i.expression.evaluate(h,null,{},f,g);return this._calculate(b,b,b,h)}return this._calculate(i.expression.evaluate(new Ki(Math.floor(h.zoom-1),h)),i.expression.evaluate(new Ki(Math.floor(h.zoom),h)),i.expression.evaluate(new Ki(Math.floor(h.zoom+1),h)),h)}}_calculate(i,h,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:h}:{from:f,to:h}}interpolate(i){return i}}class No{constructor(i){this.specification=i}possiblyEvaluate(i,h,f,g){return!!i.expression.evaluate(h,null,{},f,g)}interpolate(){return!1}}class as{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in i){const f=i[h];f.specification.overridable&&this.overridableProperties.push(h);const g=this.defaultPropertyValues[h]=new Gl(f,void 0),b=this.defaultTransitionablePropertyValues[h]=new Hl(f);this.defaultTransitioningPropertyValues[h]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=g.possiblyEvaluate({})}}}Ne("DataDrivenProperty",ri),Ne("DataConstantProperty",Ye),Ne("CrossFadedDataDrivenProperty",ra),Ne("CrossFadedProperty",zc),Ne("ColorRampProperty",No);const rf="-transition";class Ws extends Ce{constructor(i,h){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),h.layout&&(this._unevaluatedLayout=new Am(h.layout)),h.paint)){this._transitionablePaint=new Rc(h.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Oo(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,h,f={}){h!=null&&this._validate(Tc,`layers.${this.id}.layout.${i}`,i,h,f)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,h):this.visibility=h)}getPaintProperty(i){return i.endsWith(rf)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,h,f={}){if(h!=null&&this._validate(Sm,`layers.${this.id}.paint.${i}`,i,h,f))return!1;if(i.endsWith(rf))return this._transitionablePaint.setTransition(i.slice(0,-11),h||void 0),!1;{const g=this._transitionablePaint._values[i],b=g.property.specification["property-type"]==="cross-faded-data-driven",w=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(i,h),this._handleSpecialPaintPropertyUpdate(i);const P=this._transitionablePaint._values[i].value;return P.isDataDriven()||w||b||this._handleOverridablePaintPropertyUpdate(i,T,P)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,h,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,h){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,h)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),ot(i,(h,f)=>!(h===void 0||f==="layout"&&!Object.keys(h).length||f==="paint"&&!Object.keys(h).length))}_validate(i,h,f,g,b={}){return(!b||b.validate!==!1)&&tf(this,i.call(qa,{key:h,layerType:this.type,objectKey:f,value:g,styleSpec:Pt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const h=this.paint.get(i);if(h instanceof Hs&&Ba(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const af={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ja{constructor(i,h){this._structArray=i,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ln{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,h){return i._trim(),h&&(i.isTransferred=!0,h.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const h=Object.create(this.prototype);return h.arrayBuffer=i.arrayBuffer,h.length=i.length,h.capacity=i.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function mn(r,i=1){let h=0,f=0;return{members:r.map(g=>{const b=af[g.type].BYTES_PER_ELEMENT,w=h=of(h,Math.max(i,b)),T=g.components||1;return f=Math.max(f,b),h+=b*T,{name:g.name,type:g.type,components:T,offset:w}}),size:of(h,Math.max(f,i)),alignment:i}}function of(r,i){return Math.ceil(r/i)*i}class Uo extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,h){const f=this.length;return this.resize(f+1),this.emplace(f,i,h)}emplace(i,h,f){const g=2*i;return this.int16[g+0]=h,this.int16[g+1]=f,i}}Uo.prototype.bytesPerElement=4,Ne("StructArrayLayout2i4",Uo);class Wl extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,h,f)}emplace(i,h,f,g){const b=3*i;return this.int16[b+0]=h,this.int16[b+1]=f,this.int16[b+2]=g,i}}Wl.prototype.bytesPerElement=6,Ne("StructArrayLayout3i6",Wl);class kr extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,h,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,h,f,g)}emplace(i,h,f,g,b){const w=4*i;return this.int16[w+0]=h,this.int16[w+1]=f,this.int16[w+2]=g,this.int16[w+3]=b,i}}kr.prototype.bytesPerElement=8,Ne("StructArrayLayout4i8",kr);class kc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,h,f,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,h,f,g,b,w)}emplace(i,h,f,g,b,w,T){const P=6*i;return this.int16[P+0]=h,this.int16[P+1]=f,this.int16[P+2]=g,this.int16[P+3]=b,this.int16[P+4]=w,this.int16[P+5]=T,i}}kc.prototype.bytesPerElement=12,Ne("StructArrayLayout2i4i12",kc);class Fc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,h,f,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,h,f,g,b,w)}emplace(i,h,f,g,b,w,T){const P=4*i,k=8*i;return this.int16[P+0]=h,this.int16[P+1]=f,this.uint8[k+4]=g,this.uint8[k+5]=b,this.uint8[k+6]=w,this.uint8[k+7]=T,i}}Fc.prototype.bytesPerElement=8,Ne("StructArrayLayout2i4ub8",Fc);class Vo extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,h){const f=this.length;return this.resize(f+1),this.emplace(f,i,h)}emplace(i,h,f){const g=2*i;return this.float32[g+0]=h,this.float32[g+1]=f,i}}Vo.prototype.bytesPerElement=8,Ne("StructArrayLayout2f8",Vo);class Bc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,h,f,g,b,w,T,P,k,O){const N=this.length;return this.resize(N+1),this.emplace(N,i,h,f,g,b,w,T,P,k,O)}emplace(i,h,f,g,b,w,T,P,k,O,N){const $=10*i;return this.uint16[$+0]=h,this.uint16[$+1]=f,this.uint16[$+2]=g,this.uint16[$+3]=b,this.uint16[$+4]=w,this.uint16[$+5]=T,this.uint16[$+6]=P,this.uint16[$+7]=k,this.uint16[$+8]=O,this.uint16[$+9]=N,i}}Bc.prototype.bytesPerElement=20,Ne("StructArrayLayout10ui20",Bc);class ql extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,h,f,g,b,w,T,P,k,O,N,$){const X=this.length;return this.resize(X+1),this.emplace(X,i,h,f,g,b,w,T,P,k,O,N,$)}emplace(i,h,f,g,b,w,T,P,k,O,N,$,X){const J=12*i;return this.int16[J+0]=h,this.int16[J+1]=f,this.int16[J+2]=g,this.int16[J+3]=b,this.uint16[J+4]=w,this.uint16[J+5]=T,this.uint16[J+6]=P,this.uint16[J+7]=k,this.int16[J+8]=O,this.int16[J+9]=N,this.int16[J+10]=$,this.int16[J+11]=X,i}}ql.prototype.bytesPerElement=24,Ne("StructArrayLayout4i4ui4i24",ql);class Oc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,h,f)}emplace(i,h,f,g){const b=3*i;return this.float32[b+0]=h,this.float32[b+1]=f,this.float32[b+2]=g,i}}Oc.prototype.bytesPerElement=12,Ne("StructArrayLayout3f12",Oc);class Nc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const h=this.length;return this.resize(h+1),this.emplace(h,i)}emplace(i,h){return this.uint32[1*i+0]=h,i}}Nc.prototype.bytesPerElement=4,Ne("StructArrayLayout1ul4",Nc);class yr extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,h,f,g,b,w,T,P,k){const O=this.length;return this.resize(O+1),this.emplace(O,i,h,f,g,b,w,T,P,k)}emplace(i,h,f,g,b,w,T,P,k,O){const N=10*i,$=5*i;return this.int16[N+0]=h,this.int16[N+1]=f,this.int16[N+2]=g,this.int16[N+3]=b,this.int16[N+4]=w,this.int16[N+5]=T,this.uint32[$+3]=P,this.uint16[N+8]=k,this.uint16[N+9]=O,i}}yr.prototype.bytesPerElement=20,Ne("StructArrayLayout6i1ul2ui20",yr);class $l extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,h,f,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,h,f,g,b,w)}emplace(i,h,f,g,b,w,T){const P=6*i;return this.int16[P+0]=h,this.int16[P+1]=f,this.int16[P+2]=g,this.int16[P+3]=b,this.int16[P+4]=w,this.int16[P+5]=T,i}}$l.prototype.bytesPerElement=12,Ne("StructArrayLayout2i2i2i12",$l);class Go extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,h,f,g,b){const w=this.length;return this.resize(w+1),this.emplace(w,i,h,f,g,b)}emplace(i,h,f,g,b,w){const T=4*i,P=8*i;return this.float32[T+0]=h,this.float32[T+1]=f,this.float32[T+2]=g,this.int16[P+6]=b,this.int16[P+7]=w,i}}Go.prototype.bytesPerElement=16,Ne("StructArrayLayout2f1f2i16",Go);class jl extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,h,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,h,f,g)}emplace(i,h,f,g,b){const w=12*i,T=3*i;return this.uint8[w+0]=h,this.uint8[w+1]=f,this.float32[T+1]=g,this.float32[T+2]=b,i}}jl.prototype.bytesPerElement=12,Ne("StructArrayLayout2ub2f12",jl);class Za extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,h,f)}emplace(i,h,f,g){const b=3*i;return this.uint16[b+0]=h,this.uint16[b+1]=f,this.uint16[b+2]=g,i}}Za.prototype.bytesPerElement=6,Ne("StructArrayLayout3ui6",Za);class Uc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,h,f,g,b,w,T,P,k,O,N,$,X,J,st,ct,_t){const Lt=this.length;return this.resize(Lt+1),this.emplace(Lt,i,h,f,g,b,w,T,P,k,O,N,$,X,J,st,ct,_t)}emplace(i,h,f,g,b,w,T,P,k,O,N,$,X,J,st,ct,_t,Lt){const xt=24*i,Et=12*i,Xt=48*i;return this.int16[xt+0]=h,this.int16[xt+1]=f,this.uint16[xt+2]=g,this.uint16[xt+3]=b,this.uint32[Et+2]=w,this.uint32[Et+3]=T,this.uint32[Et+4]=P,this.uint16[xt+10]=k,this.uint16[xt+11]=O,this.uint16[xt+12]=N,this.float32[Et+7]=$,this.float32[Et+8]=X,this.uint8[Xt+36]=J,this.uint8[Xt+37]=st,this.uint8[Xt+38]=ct,this.uint32[Et+10]=_t,this.int16[xt+22]=Lt,i}}Uc.prototype.bytesPerElement=48,Ne("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Uc);class Xa extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,h,f,g,b,w,T,P,k,O,N,$,X,J,st,ct,_t,Lt,xt,Et,Xt,te,Le,qe,Ie,Te,ve,Ve){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,i,h,f,g,b,w,T,P,k,O,N,$,X,J,st,ct,_t,Lt,xt,Et,Xt,te,Le,qe,Ie,Te,ve,Ve)}emplace(i,h,f,g,b,w,T,P,k,O,N,$,X,J,st,ct,_t,Lt,xt,Et,Xt,te,Le,qe,Ie,Te,ve,Ve,Ae){const ue=32*i,ti=16*i;return this.int16[ue+0]=h,this.int16[ue+1]=f,this.int16[ue+2]=g,this.int16[ue+3]=b,this.int16[ue+4]=w,this.int16[ue+5]=T,this.int16[ue+6]=P,this.int16[ue+7]=k,this.uint16[ue+8]=O,this.uint16[ue+9]=N,this.uint16[ue+10]=$,this.uint16[ue+11]=X,this.uint16[ue+12]=J,this.uint16[ue+13]=st,this.uint16[ue+14]=ct,this.uint16[ue+15]=_t,this.uint16[ue+16]=Lt,this.uint16[ue+17]=xt,this.uint16[ue+18]=Et,this.uint16[ue+19]=Xt,this.uint16[ue+20]=te,this.uint16[ue+21]=Le,this.uint16[ue+22]=qe,this.uint32[ti+12]=Ie,this.float32[ti+13]=Te,this.float32[ti+14]=ve,this.uint16[ue+30]=Ve,this.uint16[ue+31]=Ae,i}}Xa.prototype.bytesPerElement=64,Ne("StructArrayLayout8i15ui1ul2f2ui64",Xa);class Fr extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const h=this.length;return this.resize(h+1),this.emplace(h,i)}emplace(i,h){return this.float32[1*i+0]=h,i}}Fr.prototype.bytesPerElement=4,Ne("StructArrayLayout1f4",Fr);class Vc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,h,f)}emplace(i,h,f,g){const b=3*i;return this.uint16[6*i+0]=h,this.float32[b+1]=f,this.float32[b+2]=g,i}}Vc.prototype.bytesPerElement=12,Ne("StructArrayLayout1ui2f12",Vc);class Zl extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,h,f)}emplace(i,h,f,g){const b=4*i;return this.uint32[2*i+0]=h,this.uint16[b+2]=f,this.uint16[b+3]=g,i}}Zl.prototype.bytesPerElement=8,Ne("StructArrayLayout1ul2ui8",Zl);class aa extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,h){const f=this.length;return this.resize(f+1),this.emplace(f,i,h)}emplace(i,h,f){const g=2*i;return this.uint16[g+0]=h,this.uint16[g+1]=f,i}}aa.prototype.bytesPerElement=4,Ne("StructArrayLayout2ui4",aa);class Gc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const h=this.length;return this.resize(h+1),this.emplace(h,i)}emplace(i,h){return this.uint16[1*i+0]=h,i}}Gc.prototype.bytesPerElement=2,Ne("StructArrayLayout1ui2",Gc);class Hc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,h,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,h,f,g)}emplace(i,h,f,g,b){const w=4*i;return this.float32[w+0]=h,this.float32[w+1]=f,this.float32[w+2]=g,this.float32[w+3]=b,i}}Hc.prototype.bytesPerElement=16,Ne("StructArrayLayout4f16",Hc);class Wc extends ja{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new M(this.anchorPointX,this.anchorPointY)}}Wc.prototype.size=20;class lf extends yr{get(i){return new Wc(this,i)}}Ne("CollisionBoxArray",lf);class y extends ja{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}y.prototype.size=48;class n extends Uc{get(i){return new y(this,i)}}Ne("PlacedSymbolArray",n);class u extends ja{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}u.prototype.size=64;class p extends Xa{get(i){return new u(this,i)}}Ne("SymbolInstanceArray",p);class m extends Fr{getoffsetX(i){return this.float32[1*i+0]}}Ne("GlyphOffsetArray",m);class x extends Wl{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Ne("SymbolLineVertexArray",x);class E extends ja{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}E.prototype.size=12;class I extends Vc{get(i){return new E(this,i)}}Ne("TextAnchorOffsetArray",I);class D extends ja{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}D.prototype.size=8;class B extends Zl{get(i){return new D(this,i)}}Ne("FeatureIndexArray",B);class U extends Uo{}class q extends Uo{}class Y extends Uo{}class ht extends kc{}class lt extends Fc{}class dt extends Vo{}class it extends Bc{}class wt extends ql{}class Ft extends Oc{}class gt extends Nc{}class Ct extends $l{}class Nt extends jl{}class Vt extends Za{}class qt extends aa{}const oe=mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ne}=oe;class ae{constructor(i=[]){this.segments=i}prepareSegment(i,h,f,g){let b=this.segments[this.segments.length-1];return i>ae.MAX_VERTEX_ARRAY_LENGTH&&It(`Max vertices per segment is ${ae.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!b||b.vertexLength+i>ae.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==g)&&(b={vertexOffset:h.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(b.sortKey=g),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const i of this.segments)for(const h in i.vaos)i.vaos[h].destroy()}static simpleSegment(i,h,f,g){return new ae([{vertexOffset:i,primitiveOffset:h,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function Be(r,i){return 256*(r=Q(Math.floor(r),0,255))+Q(Math.floor(i),0,255)}ae.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ne("SegmentVector",ae);const _i=mn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Se={exports:{}},hi={exports:{}};hi.exports=function(r,i){var h,f,g,b,w,T,P,k;for(f=r.length-(h=3&r.length),g=i,w=3432918353,T=461845907,k=0;k<f;)P=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,g=27492+(65535&(b=5*(65535&(g=(g^=P=(65535&(P=(P=(65535&P)*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(P=0,h){case 3:P^=(255&r.charCodeAt(k+2))<<16;case 2:P^=(255&r.charCodeAt(k+1))<<8;case 1:g^=P=(65535&(P=(P=(65535&(P^=255&r.charCodeAt(k)))*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var vi=hi.exports,Ei={exports:{}};Ei.exports=function(r,i){for(var h,f=r.length,g=i^f,b=0;f>=4;)h=1540483477*(65535&(h=255&r.charCodeAt(b)|(255&r.charCodeAt(++b))<<8|(255&r.charCodeAt(++b))<<16|(255&r.charCodeAt(++b))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),f-=4,++b;switch(f){case 3:g^=(255&r.charCodeAt(b+2))<<16;case 2:g^=(255&r.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var fi=vi,bi=Ei.exports;Se.exports=fi,Se.exports.murmur3=fi,Se.exports.murmur2=bi;var wi=_(Se.exports);class an{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,h,f,g){this.ids.push(qi(i)),this.positions.push(h,f,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=qi(i);let f=0,g=this.ids.length-1;for(;f<g;){const w=f+g>>1;this.ids[w]>=h?g=w:f=w+1}const b=[];for(;this.ids[f]===h;)b.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return b}static serialize(i,h){const f=new Float64Array(i.ids),g=new Uint32Array(i.positions);return os(f,g,0,f.length-1),h&&h.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(i){const h=new an;return h.ids=i.ids,h.positions=i.positions,h.indexed=!0,h}}function qi(r){const i=+r;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:wi(String(r))}function os(r,i,h,f){for(;h<f;){const g=r[h+f>>1];let b=h-1,w=f+1;for(;;){do b++;while(r[b]<g);do w--;while(r[w]>g);if(b>=w)break;vn(r,b,w),vn(i,3*b,3*w),vn(i,3*b+1,3*w+1),vn(i,3*b+2,3*w+2)}w-h<f-w?(os(r,i,h,w),h=w+1):(os(r,i,w+1,f),f=w)}}function vn(r,i,h){const f=r[i];r[i]=r[h],r[h]=f}Ne("FeaturePositionMap",an);class Yi{constructor(i,h){this.gl=i.gl,this.location=h}}class $n extends Yi{constructor(i,h){super(i,h),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class qs extends Yi{constructor(i,h){super(i,h),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class lr extends Yi{constructor(i,h){super(i,h),this.current=mi.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const oa=new Float32Array(16);function la(r){return[Be(255*r.r,255*r.g),Be(255*r.b,255*r.a)]}class hr{constructor(i,h,f){this.value=i,this.uniformNames=h.map(g=>`u_${g}`),this.type=f}setUniform(i,h,f){i.set(f.constantOr(this.value))}getBinding(i,h,f){return this.type==="color"?new lr(i,h):new $n(i,h)}}class $s{constructor(i,h){this.uniformNames=h.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=i.tlbr}setUniform(i,h,f,g){const b=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&i.set(b)}getBinding(i,h,f){return f.substr(0,9)==="u_pattern"?new qs(i,h):new $n(i,h)}}class hn{constructor(i,h,f,g){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=h.map(b=>({name:`a_${b}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,h,f,g,b){const w=this.paintVertexArray.length,T=this.expression.evaluate(new Ki(0),h,{},g,[],b);this.paintVertexArray.resize(i),this._setPaintValue(w,i,T)}updatePaintArray(i,h,f,g){const b=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(i,h,b)}_setPaintValue(i,h,f){if(this.type==="color"){const g=la(f);for(let b=i;b<h;b++)this.paintVertexArray.emplace(b,g[0],g[1])}else{for(let g=i;g<h;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qi{constructor(i,h,f,g,b,w){this.expression=i,this.uniformNames=h.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=h.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(i,h,f,g,b){const w=this.expression.evaluate(new Ki(this.zoom),h,{},g,[],b),T=this.expression.evaluate(new Ki(this.zoom+1),h,{},g,[],b),P=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(P,i,w,T)}updatePaintArray(i,h,f,g){const b=this.expression.evaluate({zoom:this.zoom},f,g),w=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(i,h,b,w)}_setPaintValue(i,h,f,g){if(this.type==="color"){const b=la(f),w=la(g);for(let T=i;T<h;T++)this.paintVertexArray.emplace(T,b[0],b[1],w[0],w[1])}else{for(let b=i;b<h;b++)this.paintVertexArray.emplace(b,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,h){const f=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,g=Q(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,h,f){return new $n(i,h)}}class dn{constructor(i,h,f,g,b,w){this.expression=i,this.type=h,this.useIntegerZoom=f,this.zoom=g,this.layerId=w,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(i,h,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,h.patterns&&h.patterns[this.layerId],f)}updatePaintArray(i,h,f,g,b){this._setPaintValues(i,h,f.patterns&&f.patterns[this.layerId],b)}_setPaintValues(i,h,f,g){if(!g||!f)return;const{min:b,mid:w,max:T}=f,P=g[b],k=g[w],O=g[T];if(P&&k&&O)for(let N=i;N<h;N++)this.zoomInPaintVertexArray.emplace(N,k.tl[0],k.tl[1],k.br[0],k.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],k.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(N,k.tl[0],k.tl[1],k.br[0],k.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],k.pixelRatio,O.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,_i.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,_i.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ya{constructor(i,h,f){this.binders={},this._buffers=[];const g=[];for(const b in i.paint._values){if(!f(b))continue;const w=i.paint.get(b);if(!(w instanceof Hs&&Ba(w.property.specification)))continue;const T=On(b,i.type),P=w.value,k=w.property.specification.type,O=w.property.useIntegerZoom,N=w.property.specification["property-type"],$=N==="cross-faded"||N==="cross-faded-data-driven";if(P.kind==="constant")this.binders[b]=$?new $s(P.value,T):new hr(P.value,T,k),g.push(`/u_${b}`);else if(P.kind==="source"||$){const X=bs(b,k,"source");this.binders[b]=$?new dn(P,k,O,h,X,i.id):new hn(P,T,k,X),g.push(`/a_${b}`)}else{const X=bs(b,k,"composite");this.binders[b]=new Qi(P,T,k,O,h,X),g.push(`/z_${b}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const h=this.binders[i];return h instanceof hn||h instanceof Qi?h.maxValue:0}populatePaintArrays(i,h,f,g,b){for(const w in this.binders){const T=this.binders[w];(T instanceof hn||T instanceof Qi||T instanceof dn)&&T.populatePaintArray(i,h,f,g,b)}}setConstantPatternPositions(i,h){for(const f in this.binders){const g=this.binders[f];g instanceof $s&&g.setConstantPatternPositions(i,h)}}updatePaintArrays(i,h,f,g,b){let w=!1;for(const T in i){const P=h.getPositions(T);for(const k of P){const O=f.feature(k.index);for(const N in this.binders){const $=this.binders[N];if(($ instanceof hn||$ instanceof Qi||$ instanceof dn)&&$.expression.isStateDependent===!0){const X=g.paint.get(N);$.expression=X.value,$.updatePaintArray(k.start,k.end,O,i[T],b),w=!0}}}}return w}defines(){const i=[];for(const h in this.binders){const f=this.binders[h];(f instanceof hr||f instanceof $s)&&i.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof hn||f instanceof Qi)for(let g=0;g<f.paintVertexAttributes.length;g++)i.push(f.paintVertexAttributes[g].name);else if(f instanceof dn)for(let g=0;g<_i.members.length;g++)i.push(_i.members[g].name)}return i}getBinderUniforms(){const i=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof hr||f instanceof $s||f instanceof Qi)for(const g of f.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,h){const f=[];for(const g in this.binders){const b=this.binders[g];if(b instanceof hr||b instanceof $s||b instanceof Qi){for(const w of b.uniformNames)if(h[w]){const T=b.getBinding(i,h[w],w);f.push({name:w,property:g,binding:T})}}}return f}setUniforms(i,h,f,g){for(const{name:b,property:w,binding:T}of h)this.binders[w].setUniform(T,g,f.get(w),b)}updatePaintBuffers(i){this._buffers=[];for(const h in this.binders){const f=this.binders[h];if(i&&f instanceof dn){const g=i.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof hn||f instanceof Qi)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(i){for(const h in this.binders){const f=this.binders[h];(f instanceof hn||f instanceof Qi||f instanceof dn)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const h=this.binders[i];(h instanceof hn||h instanceof Qi||h instanceof dn)&&h.destroy()}}}class en{constructor(i,h,f=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new Ya(g,h,f);this.needsUpload=!1,this._featureMap=new an,this._bufferOffset=0}populatePaintArrays(i,h,f,g,b,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,h,g,b,w);h.id!==void 0&&this._featureMap.add(h.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,h,f,g){for(const b of f)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(i,this._featureMap,h,b,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function On(r,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${i}-`,"").replace(/-/g,"_")]}function bs(r,i,h){const f={color:{source:Vo,composite:Hc},number:{source:Fr,composite:Vo}},g=function(b){return{"line-pattern":{source:it,composite:it},"fill-pattern":{source:it,composite:it},"fill-extrusion-pattern":{source:it,composite:it}}[b]}(r);return g&&g[h]||f[i][h]}Ne("ConstantBinder",hr),Ne("CrossFadedConstantBinder",$s),Ne("SourceExpressionBinder",hn),Ne("CrossFadedCompositeBinder",dn),Ne("CompositeExpressionBinder",Qi),Ne("ProgramConfiguration",Ya,{omit:["_buffers"]}),Ne("ProgramConfigurationSet",en);const Ti=8192,qc=Math.pow(2,14)-1,hf=-qc-1;function ha(r){const i=Ti/r.extent,h=r.loadGeometry();for(let f=0;f<h.length;f++){const g=h[f];for(let b=0;b<g.length;b++){const w=g[b],T=Math.round(w.x*i),P=Math.round(w.y*i);w.x=Q(T,hf,qc),w.y=Q(P,hf,qc),(T<w.x||T>w.x+1||P<w.y||P>w.y+1)&&It("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function ca(r,i){return{type:r.type,id:r.id,properties:r.properties,geometry:i?ha(r):[]}}function Xl(r,i,h,f,g){r.emplaceBack(2*i+(f+1)/2,2*h+(g+1)/2)}class $c{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(h=>h.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new q,this.indexArray=new Vt,this.segments=new ae,this.programConfigurations=new en(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(i,h,f){const g=this.layers[0],b=[];let w=null,T=!1;g.type==="circle"&&(w=g.layout.get("circle-sort-key"),T=!w.isConstant());for(const{feature:P,id:k,index:O,sourceLayerIndex:N}of i){const $=this.layers[0]._featureFilter.needGeometry,X=ca(P,$);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),X,f))continue;const J=T?w.evaluate(X,{},f):void 0,st={id:k,properties:P.properties,type:P.type,sourceLayerIndex:N,index:O,geometry:$?X.geometry:ha(P),patterns:{},sortKey:J};b.push(st)}T&&b.sort((P,k)=>P.sortKey-k.sortKey);for(const P of b){const{geometry:k,index:O,sourceLayerIndex:N}=P,$=i[O].feature;this.addFeature(P,k,O,f),h.featureIndex.insert($,k,O,N,this.index)}}update(i,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,h,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ne),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,h,f,g){for(const b of h)for(const w of b){const T=w.x,P=w.y;if(T<0||T>=Ti||P<0||P>=Ti)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),O=k.vertexLength;Xl(this.layoutVertexArray,T,P,-1,-1),Xl(this.layoutVertexArray,T,P,1,-1),Xl(this.layoutVertexArray,T,P,1,1),Xl(this.layoutVertexArray,T,P,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},g)}}function ua(r,i){for(let h=0;h<r.length;h++)if(Yl(i,r[h]))return!0;for(let h=0;h<i.length;h++)if(Yl(r,i[h]))return!0;return!!Ho(r,i)}function cf(r,i,h){return!!Yl(r,i)||!!Wo(i,r,h)}function jc(r,i){if(r.length===1)return L0(i,r[0]);for(let h=0;h<i.length;h++){const f=i[h];for(let g=0;g<f.length;g++)if(Yl(r,f[g]))return!0}for(let h=0;h<r.length;h++)if(L0(i,r[h]))return!0;for(let h=0;h<i.length;h++)if(Ho(r,i[h]))return!0;return!1}function uf(r,i,h){if(r.length>1){if(Ho(r,i))return!0;for(let f=0;f<i.length;f++)if(Wo(i[f],r,h))return!0}for(let f=0;f<r.length;f++)if(Wo(r[f],i,h))return!0;return!1}function Ho(r,i){if(r.length===0||i.length===0)return!1;for(let h=0;h<r.length-1;h++){const f=r[h],g=r[h+1];for(let b=0;b<i.length-1;b++)if(df(f,g,i[b],i[b+1]))return!0}return!1}function df(r,i,h,f){return Dt(r,h,f)!==Dt(i,h,f)&&Dt(r,i,h)!==Dt(r,i,f)}function Wo(r,i,h){const f=h*h;if(i.length===1)return r.distSqr(i[0])<f;for(let g=1;g<i.length;g++)if(P0(r,i[g-1],i[g])<f)return!0;return!1}function P0(r,i,h){const f=i.distSqr(h);if(f===0)return r.distSqr(i);const g=((r.x-i.x)*(h.x-i.x)+(r.y-i.y)*(h.y-i.y))/f;return r.distSqr(g<0?i:g>1?h:h.sub(i)._mult(g)._add(i))}function L0(r,i){let h,f,g,b=!1;for(let w=0;w<r.length;w++){h=r[w];for(let T=0,P=h.length-1;T<h.length;P=T++)f=h[T],g=h[P],f.y>i.y!=g.y>i.y&&i.x<(g.x-f.x)*(i.y-f.y)/(g.y-f.y)+f.x&&(b=!b)}return b}function Yl(r,i){let h=!1;for(let f=0,g=r.length-1;f<r.length;g=f++){const b=r[f],w=r[g];b.y>i.y!=w.y>i.y&&i.x<(w.x-b.x)*(i.y-b.y)/(w.y-b.y)+b.x&&(h=!h)}return h}function Pw(r,i,h){const f=h[0],g=h[2];if(r.x<f.x&&i.x<f.x||r.x>g.x&&i.x>g.x||r.y<f.y&&i.y<f.y||r.y>g.y&&i.y>g.y)return!1;const b=Dt(r,i,h[0]);return b!==Dt(r,i,h[1])||b!==Dt(r,i,h[2])||b!==Dt(r,i,h[3])}function Zc(r,i,h){const f=i.paint.get(r).value;return f.kind==="constant"?f.value:h.programConfigurations.get(i.id).getMaxValue(r)}function ff(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function pf(r,i,h,f,g){if(!i[0]&&!i[1])return r;const b=M.convert(i)._mult(g);h==="viewport"&&b._rotate(-f);const w=[];for(let T=0;T<r.length;T++)w.push(r[T].sub(b));return w}let R0,D0;Ne("CircleBucket",$c,{omit:["layers"]});var Lw={get paint(){return D0=D0||new as({"circle-radius":new ri(Pt.paint_circle["circle-radius"]),"circle-color":new ri(Pt.paint_circle["circle-color"]),"circle-blur":new ri(Pt.paint_circle["circle-blur"]),"circle-opacity":new ri(Pt.paint_circle["circle-opacity"]),"circle-translate":new Ye(Pt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ye(Pt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ye(Pt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ye(Pt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ri(Pt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ri(Pt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ri(Pt.paint_circle["circle-stroke-opacity"])})},get layout(){return R0=R0||new as({"circle-sort-key":new ri(Pt.layout_circle["circle-sort-key"])})}},ls=1e-6,Jl=typeof Float32Array<"u"?Float32Array:Array;function Tm(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function z0(r,i,h){var f=i[0],g=i[1],b=i[2],w=i[3],T=i[4],P=i[5],k=i[6],O=i[7],N=i[8],$=i[9],X=i[10],J=i[11],st=i[12],ct=i[13],_t=i[14],Lt=i[15],xt=h[0],Et=h[1],Xt=h[2],te=h[3];return r[0]=xt*f+Et*T+Xt*N+te*st,r[1]=xt*g+Et*P+Xt*$+te*ct,r[2]=xt*b+Et*k+Xt*X+te*_t,r[3]=xt*w+Et*O+Xt*J+te*Lt,r[4]=(xt=h[4])*f+(Et=h[5])*T+(Xt=h[6])*N+(te=h[7])*st,r[5]=xt*g+Et*P+Xt*$+te*ct,r[6]=xt*b+Et*k+Xt*X+te*_t,r[7]=xt*w+Et*O+Xt*J+te*Lt,r[8]=(xt=h[8])*f+(Et=h[9])*T+(Xt=h[10])*N+(te=h[11])*st,r[9]=xt*g+Et*P+Xt*$+te*ct,r[10]=xt*b+Et*k+Xt*X+te*_t,r[11]=xt*w+Et*O+Xt*J+te*Lt,r[12]=(xt=h[12])*f+(Et=h[13])*T+(Xt=h[14])*N+(te=h[15])*st,r[13]=xt*g+Et*P+Xt*$+te*ct,r[14]=xt*b+Et*k+Xt*X+te*_t,r[15]=xt*w+Et*O+Xt*J+te*Lt,r}Math.hypot||(Math.hypot=function(){for(var r=0,i=arguments.length;i--;)r+=arguments[i]*arguments[i];return Math.sqrt(r)});var Xc,Rw=z0;function mf(r,i,h){var f=i[0],g=i[1],b=i[2],w=i[3];return r[0]=h[0]*f+h[4]*g+h[8]*b+h[12]*w,r[1]=h[1]*f+h[5]*g+h[9]*b+h[13]*w,r[2]=h[2]*f+h[6]*g+h[10]*b+h[14]*w,r[3]=h[3]*f+h[7]*g+h[11]*b+h[15]*w,r}Xc=new Jl(4),Jl!=Float32Array&&(Xc[0]=0,Xc[1]=0,Xc[2]=0,Xc[3]=0);class Dw extends Ws{constructor(i){super(i,Lw)}createBucket(i){return new $c(i)}queryRadius(i){const h=i;return Zc("circle-radius",this,h)+Zc("circle-stroke-width",this,h)+ff(this.paint.get("circle-translate"))}queryIntersectsFeature(i,h,f,g,b,w,T,P){const k=pf(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,T),O=this.paint.get("circle-radius").evaluate(h,f)+this.paint.get("circle-stroke-width").evaluate(h,f),N=this.paint.get("circle-pitch-alignment")==="map",$=N?k:function(J,st){return J.map(ct=>k0(ct,st))}(k,P),X=N?O*T:O;for(const J of g)for(const st of J){const ct=N?st:k0(st,P);let _t=X;const Lt=mf([],[st.x,st.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?_t*=Lt[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(_t*=w.cameraToCenterDistance/Lt[3]),cf($,ct,_t))return!0}return!1}}function k0(r,i){const h=mf([],[r.x,r.y,0,1],i);return new M(h[0]/h[3],h[1]/h[3])}class F0 extends $c{}let B0;Ne("HeatmapBucket",F0,{omit:["layers"]});var zw={get paint(){return B0=B0||new as({"heatmap-radius":new ri(Pt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ri(Pt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ye(Pt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new No(Pt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ye(Pt.paint_heatmap["heatmap-opacity"])})}};function Em(r,{width:i,height:h},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*h*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*h*f}`)}else g=new Uint8Array(i*h*f);return r.width=i,r.height=h,r.data=g,r}function O0(r,{width:i,height:h},f){if(i===r.width&&h===r.height)return;const g=Em({},{width:i,height:h},f);Cm(r,g,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,i),height:Math.min(r.height,h)},f),r.width=i,r.height=h,r.data=g.data}function Cm(r,i,h,f,g,b){if(g.width===0||g.height===0)return i;if(g.width>r.width||g.height>r.height||h.x>r.width-g.width||h.y>r.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||f.x>i.width-g.width||f.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const w=r.data,T=i.data;if(w===T)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<g.height;P++){const k=((h.y+P)*r.width+h.x)*b,O=((f.y+P)*i.width+f.x)*b;for(let N=0;N<g.width*b;N++)T[O+N]=w[k+N]}return i}class Yc{constructor(i,h){Em(this,i,1,h)}resize(i){O0(this,i,1)}clone(){return new Yc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,h,f,g,b){Cm(i,h,f,g,b,1)}}class js{constructor(i,h){Em(this,i,4,h)}resize(i){O0(this,i,4)}replace(i,h){h?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new js({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,h,f,g,b){Cm(i,h,f,g,b,4)}}function N0(r){const i={},h=r.resolution||256,f=r.clips?r.clips.length:1,g=r.image||new js({width:h,height:f});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const b=(w,T,P)=>{i[r.evaluationKey]=P;const k=r.expression.evaluate(i);g.data[w+T+0]=Math.floor(255*k.r/k.a),g.data[w+T+1]=Math.floor(255*k.g/k.a),g.data[w+T+2]=Math.floor(255*k.b/k.a),g.data[w+T+3]=Math.floor(255*k.a)};if(r.clips)for(let w=0,T=0;w<f;++w,T+=4*h)for(let P=0,k=0;P<h;P++,k+=4){const O=P/(h-1),{start:N,end:$}=r.clips[w];b(T,k,N*(1-O)+$*O)}else for(let w=0,T=0;w<h;w++,T+=4)b(0,T,w/(h-1));return g}Ne("AlphaImage",Yc),Ne("RGBAImage",js);class kw extends Ws{createBucket(i){return new F0(i)}constructor(i){super(i,zw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=N0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let U0;var Fw={get paint(){return U0=U0||new as({"hillshade-illumination-direction":new Ye(Pt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ye(Pt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ye(Pt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ye(Pt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ye(Pt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ye(Pt.paint_hillshade["hillshade-accent-color"])})}};class Bw extends Ws{constructor(i){super(i,Fw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Ow=mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Nw}=Ow;var Im={exports:{}};function gf(r,i,h){h=h||2;var f,g,b,w,T,P,k,O=i&&i.length,N=O?i[0]*h:r.length,$=V0(r,0,N,h,!0),X=[];if(!$||$.next===$.prev)return X;if(O&&($=function(st,ct,_t,Lt){var xt,Et,Xt,te=[];for(xt=0,Et=ct.length;xt<Et;xt++)(Xt=V0(st,ct[xt]*Lt,xt<Et-1?ct[xt+1]*Lt:st.length,Lt,!1))===Xt.next&&(Xt.steiner=!0),te.push(jw(Xt));for(te.sort(Ww),xt=0;xt<te.length;xt++)_t=qw(te[xt],_t);return _t}(r,i,$,h)),r.length>80*h){f=b=r[0],g=w=r[1];for(var J=h;J<N;J+=h)(T=r[J])<f&&(f=T),(P=r[J+1])<g&&(g=P),T>b&&(b=T),P>w&&(w=P);k=(k=Math.max(b-f,w-g))!==0?32767/k:0}return Jc($,X,h,f,g,k,0),X}function V0(r,i,h,f,g){var b,w;if(g===Rm(r,i,h,f)>0)for(b=i;b<h;b+=f)w=W0(b,r[b],r[b+1],w);else for(b=h-f;b>=i;b-=f)w=W0(b,r[b],r[b+1],w);return w&&_f(w,w.next)&&(Qc(w),w=w.next),w}function qo(r,i){if(!r)return r;i||(i=r);var h,f=r;do if(h=!1,f.steiner||!_f(f,f.next)&&gn(f.prev,f,f.next)!==0)f=f.next;else{if(Qc(f),(f=i=f.prev)===f.next)break;h=!0}while(h||f!==i);return i}function Jc(r,i,h,f,g,b,w){if(r){!w&&b&&function(O,N,$,X){var J=O;do J.z===0&&(J.z=Pm(J.x,J.y,N,$,X)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==O);J.prevZ.nextZ=null,J.prevZ=null,function(st){var ct,_t,Lt,xt,Et,Xt,te,Le,qe=1;do{for(_t=st,st=null,Et=null,Xt=0;_t;){for(Xt++,Lt=_t,te=0,ct=0;ct<qe&&(te++,Lt=Lt.nextZ);ct++);for(Le=qe;te>0||Le>0&&Lt;)te!==0&&(Le===0||!Lt||_t.z<=Lt.z)?(xt=_t,_t=_t.nextZ,te--):(xt=Lt,Lt=Lt.nextZ,Le--),Et?Et.nextZ=xt:st=xt,xt.prevZ=Et,Et=xt;_t=Lt}Et.nextZ=null,qe*=2}while(Xt>1)}(J)}(r,f,g,b);for(var T,P,k=r;r.prev!==r.next;)if(T=r.prev,P=r.next,b?Vw(r,f,g,b):Uw(r))i.push(T.i/h|0),i.push(r.i/h|0),i.push(P.i/h|0),Qc(r),r=P.next,k=P.next;else if((r=P)===k){w?w===1?Jc(r=Gw(qo(r),i,h),i,h,f,g,b,2):w===2&&Hw(r,i,h,f,g,b):Jc(qo(r),i,h,f,g,b,1);break}}}function Uw(r){var i=r.prev,h=r,f=r.next;if(gn(i,h,f)>=0)return!1;for(var g=i.x,b=h.x,w=f.x,T=i.y,P=h.y,k=f.y,O=g<b?g<w?g:w:b<w?b:w,N=T<P?T<k?T:k:P<k?P:k,$=g>b?g>w?g:w:b>w?b:w,X=T>P?T>k?T:k:P>k?P:k,J=f.next;J!==i;){if(J.x>=O&&J.x<=$&&J.y>=N&&J.y<=X&&Kl(g,T,b,P,w,k,J.x,J.y)&&gn(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function Vw(r,i,h,f){var g=r.prev,b=r,w=r.next;if(gn(g,b,w)>=0)return!1;for(var T=g.x,P=b.x,k=w.x,O=g.y,N=b.y,$=w.y,X=T<P?T<k?T:k:P<k?P:k,J=O<N?O<$?O:$:N<$?N:$,st=T>P?T>k?T:k:P>k?P:k,ct=O>N?O>$?O:$:N>$?N:$,_t=Pm(X,J,i,h,f),Lt=Pm(st,ct,i,h,f),xt=r.prevZ,Et=r.nextZ;xt&&xt.z>=_t&&Et&&Et.z<=Lt;){if(xt.x>=X&&xt.x<=st&&xt.y>=J&&xt.y<=ct&&xt!==g&&xt!==w&&Kl(T,O,P,N,k,$,xt.x,xt.y)&&gn(xt.prev,xt,xt.next)>=0||(xt=xt.prevZ,Et.x>=X&&Et.x<=st&&Et.y>=J&&Et.y<=ct&&Et!==g&&Et!==w&&Kl(T,O,P,N,k,$,Et.x,Et.y)&&gn(Et.prev,Et,Et.next)>=0))return!1;Et=Et.nextZ}for(;xt&&xt.z>=_t;){if(xt.x>=X&&xt.x<=st&&xt.y>=J&&xt.y<=ct&&xt!==g&&xt!==w&&Kl(T,O,P,N,k,$,xt.x,xt.y)&&gn(xt.prev,xt,xt.next)>=0)return!1;xt=xt.prevZ}for(;Et&&Et.z<=Lt;){if(Et.x>=X&&Et.x<=st&&Et.y>=J&&Et.y<=ct&&Et!==g&&Et!==w&&Kl(T,O,P,N,k,$,Et.x,Et.y)&&gn(Et.prev,Et,Et.next)>=0)return!1;Et=Et.nextZ}return!0}function Gw(r,i,h){var f=r;do{var g=f.prev,b=f.next.next;!_f(g,b)&&G0(g,f,f.next,b)&&Kc(g,b)&&Kc(b,g)&&(i.push(g.i/h|0),i.push(f.i/h|0),i.push(b.i/h|0),Qc(f),Qc(f.next),f=r=b),f=f.next}while(f!==r);return qo(f)}function Hw(r,i,h,f,g,b){var w=r;do{for(var T=w.next.next;T!==w.prev;){if(w.i!==T.i&&Zw(w,T)){var P=H0(w,T);return w=qo(w,w.next),P=qo(P,P.next),Jc(w,i,h,f,g,b,0),void Jc(P,i,h,f,g,b,0)}T=T.next}w=w.next}while(w!==r)}function Ww(r,i){return r.x-i.x}function qw(r,i){var h=function(g,b){var w,T=b,P=g.x,k=g.y,O=-1/0;do{if(k<=T.y&&k>=T.next.y&&T.next.y!==T.y){var N=T.x+(k-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(N<=P&&N>O&&(O=N,w=T.x<T.next.x?T:T.next,N===P))return w}T=T.next}while(T!==b);if(!w)return null;var $,X=w,J=w.x,st=w.y,ct=1/0;T=w;do P>=T.x&&T.x>=J&&P!==T.x&&Kl(k<st?P:O,k,J,st,k<st?O:P,k,T.x,T.y)&&($=Math.abs(k-T.y)/(P-T.x),Kc(T,g)&&($<ct||$===ct&&(T.x>w.x||T.x===w.x&&$w(w,T)))&&(w=T,ct=$)),T=T.next;while(T!==X);return w}(r,i);if(!h)return i;var f=H0(h,r);return qo(f,f.next),qo(h,h.next)}function $w(r,i){return gn(r.prev,r,i.prev)<0&&gn(i.next,r,r.next)<0}function Pm(r,i,h,f,g){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-f)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function jw(r){var i=r,h=r;do(i.x<h.x||i.x===h.x&&i.y<h.y)&&(h=i),i=i.next;while(i!==r);return h}function Kl(r,i,h,f,g,b,w,T){return(g-w)*(i-T)>=(r-w)*(b-T)&&(r-w)*(f-T)>=(h-w)*(i-T)&&(h-w)*(b-T)>=(g-w)*(f-T)}function Zw(r,i){return r.next.i!==i.i&&r.prev.i!==i.i&&!function(h,f){var g=h;do{if(g.i!==h.i&&g.next.i!==h.i&&g.i!==f.i&&g.next.i!==f.i&&G0(g,g.next,h,f))return!0;g=g.next}while(g!==h);return!1}(r,i)&&(Kc(r,i)&&Kc(i,r)&&function(h,f){var g=h,b=!1,w=(h.x+f.x)/2,T=(h.y+f.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&w<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(b=!b),g=g.next;while(g!==h);return b}(r,i)&&(gn(r.prev,r,i.prev)||gn(r,i.prev,i))||_f(r,i)&&gn(r.prev,r,r.next)>0&&gn(i.prev,i,i.next)>0)}function gn(r,i,h){return(i.y-r.y)*(h.x-i.x)-(i.x-r.x)*(h.y-i.y)}function _f(r,i){return r.x===i.x&&r.y===i.y}function G0(r,i,h,f){var g=vf(gn(r,i,h)),b=vf(gn(r,i,f)),w=vf(gn(h,f,r)),T=vf(gn(h,f,i));return g!==b&&w!==T||!(g!==0||!yf(r,h,i))||!(b!==0||!yf(r,f,i))||!(w!==0||!yf(h,r,f))||!(T!==0||!yf(h,i,f))}function yf(r,i,h){return i.x<=Math.max(r.x,h.x)&&i.x>=Math.min(r.x,h.x)&&i.y<=Math.max(r.y,h.y)&&i.y>=Math.min(r.y,h.y)}function vf(r){return r>0?1:r<0?-1:0}function Kc(r,i){return gn(r.prev,r,r.next)<0?gn(r,i,r.next)>=0&&gn(r,r.prev,i)>=0:gn(r,i,r.prev)<0||gn(r,r.next,i)<0}function H0(r,i){var h=new Lm(r.i,r.x,r.y),f=new Lm(i.i,i.x,i.y),g=r.next,b=i.prev;return r.next=i,i.prev=r,h.next=g,g.prev=h,f.next=h,h.prev=f,b.next=f,f.prev=b,f}function W0(r,i,h,f){var g=new Lm(r,i,h);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function Qc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Lm(r,i,h){this.i=r,this.x=i,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rm(r,i,h,f){for(var g=0,b=i,w=h-f;b<h;b+=f)g+=(r[w]-r[b])*(r[b+1]+r[w+1]),w=b;return g}Im.exports=gf,Im.exports.default=gf,gf.deviation=function(r,i,h,f){var g=i&&i.length,b=Math.abs(Rm(r,0,g?i[0]*h:r.length,h));if(g)for(var w=0,T=i.length;w<T;w++)b-=Math.abs(Rm(r,i[w]*h,w<T-1?i[w+1]*h:r.length,h));var P=0;for(w=0;w<f.length;w+=3){var k=f[w]*h,O=f[w+1]*h,N=f[w+2]*h;P+=Math.abs((r[k]-r[N])*(r[O+1]-r[k+1])-(r[k]-r[O])*(r[N+1]-r[k+1]))}return b===0&&P===0?0:Math.abs((P-b)/b)},gf.flatten=function(r){for(var i=r[0][0].length,h={vertices:[],holes:[],dimensions:i},f=0,g=0;g<r.length;g++){for(var b=0;b<r[g].length;b++)for(var w=0;w<i;w++)h.vertices.push(r[g][b][w]);g>0&&h.holes.push(f+=r[g-1].length)}return h};var q0=_(Im.exports);function Xw(r,i,h,f,g){$0(r,i,h||0,f||r.length-1,g||Yw)}function $0(r,i,h,f,g){for(;f>h;){if(f-h>600){var b=f-h+1,w=i-h+1,T=Math.log(b),P=.5*Math.exp(2*T/3),k=.5*Math.sqrt(T*P*(b-P)/b)*(w-b/2<0?-1:1);$0(r,i,Math.max(h,Math.floor(i-w*P/b+k)),Math.min(f,Math.floor(i+(b-w)*P/b+k)),g)}var O=r[i],N=h,$=f;for(tu(r,h,i),g(r[f],O)>0&&tu(r,h,f);N<$;){for(tu(r,N,$),N++,$--;g(r[N],O)<0;)N++;for(;g(r[$],O)>0;)$--}g(r[h],O)===0?tu(r,h,$):tu(r,++$,f),$<=i&&(h=$+1),i<=$&&(f=$-1)}}function tu(r,i,h){var f=r[i];r[i]=r[h],r[h]=f}function Yw(r,i){return r<i?-1:r>i?1:0}function Dm(r,i){const h=r.length;if(h<=1)return[r];const f=[];let g,b;for(let w=0;w<h;w++){const T=Wt(r[w]);T!==0&&(r[w].area=Math.abs(T),b===void 0&&(b=T<0),b===T<0?(g&&f.push(g),g=[r[w]]):g.push(r[w]))}if(g&&f.push(g),i>1)for(let w=0;w<f.length;w++)f[w].length<=i||(Xw(f[w],i,1,f[w].length-1,Jw),f[w]=f[w].slice(0,i));return f}function Jw(r,i){return i.area-r.area}function zm(r,i,h){const f=h.patternDependencies;let g=!1;for(const b of i){const w=b.paint.get(`${r}-pattern`);w.isConstant()||(g=!0);const T=w.constantOr(null);T&&(g=!0,f[T.to]=!0,f[T.from]=!0)}return g}function km(r,i,h,f,g){const b=g.patternDependencies;for(const w of i){const T=w.paint.get(`${r}-pattern`).value;if(T.kind!=="constant"){let P=T.evaluate({zoom:f-1},h,{},g.availableImages),k=T.evaluate({zoom:f},h,{},g.availableImages),O=T.evaluate({zoom:f+1},h,{},g.availableImages);P=P&&P.name?P.name:P,k=k&&k.name?k.name:k,O=O&&O.name?O.name:O,b[P]=!0,b[k]=!0,b[O]=!0,h.patterns[w.id]={min:P,mid:k,max:O}}}return h}class Fm{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(h=>h.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Y,this.indexArray=new Vt,this.indexArray2=new qt,this.programConfigurations=new en(i.layers,i.zoom),this.segments=new ae,this.segments2=new ae,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(i,h,f){this.hasPattern=zm("fill",this.layers,h);const g=this.layers[0].layout.get("fill-sort-key"),b=!g.isConstant(),w=[];for(const{feature:T,id:P,index:k,sourceLayerIndex:O}of i){const N=this.layers[0]._featureFilter.needGeometry,$=ca(T,N);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),$,f))continue;const X=b?g.evaluate($,{},f,h.availableImages):void 0,J={id:P,properties:T.properties,type:T.type,sourceLayerIndex:O,index:k,geometry:N?$.geometry:ha(T),patterns:{},sortKey:X};w.push(J)}b&&w.sort((T,P)=>T.sortKey-P.sortKey);for(const T of w){const{geometry:P,index:k,sourceLayerIndex:O}=T;if(this.hasPattern){const N=km("fill",this.layers,T,this.zoom,h);this.patternFeatures.push(N)}else this.addFeature(T,P,k,f,{});h.featureIndex.insert(i[k].feature,P,k,O,this.index)}}update(i,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,h,this.stateDependentLayers,f)}addFeatures(i,h,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Nw),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,h,f,g,b){for(const w of Dm(h,500)){let T=0;for(const X of w)T+=X.length;const P=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),k=P.vertexLength,O=[],N=[];for(const X of w){if(X.length===0)continue;X!==w[0]&&N.push(O.length/2);const J=this.segments2.prepareSegment(X.length,this.layoutVertexArray,this.indexArray2),st=J.vertexLength;this.layoutVertexArray.emplaceBack(X[0].x,X[0].y),this.indexArray2.emplaceBack(st+X.length-1,st),O.push(X[0].x),O.push(X[0].y);for(let ct=1;ct<X.length;ct++)this.layoutVertexArray.emplaceBack(X[ct].x,X[ct].y),this.indexArray2.emplaceBack(st+ct-1,st+ct),O.push(X[ct].x),O.push(X[ct].y);J.vertexLength+=X.length,J.primitiveLength+=X.length}const $=q0(O,N);for(let X=0;X<$.length;X+=3)this.indexArray.emplaceBack(k+$[X],k+$[X+1],k+$[X+2]);P.vertexLength+=T,P.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,g)}}let j0,Z0;Ne("FillBucket",Fm,{omit:["layers","patternFeatures"]});var Kw={get paint(){return Z0=Z0||new as({"fill-antialias":new Ye(Pt.paint_fill["fill-antialias"]),"fill-opacity":new ri(Pt.paint_fill["fill-opacity"]),"fill-color":new ri(Pt.paint_fill["fill-color"]),"fill-outline-color":new ri(Pt.paint_fill["fill-outline-color"]),"fill-translate":new Ye(Pt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ye(Pt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ra(Pt.paint_fill["fill-pattern"])})},get layout(){return j0=j0||new as({"fill-sort-key":new ri(Pt.layout_fill["fill-sort-key"])})}};class Qw extends Ws{constructor(i){super(i,Kw)}recalculate(i,h){super.recalculate(i,h);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Fm(i)}queryRadius(){return ff(this.paint.get("fill-translate"))}queryIntersectsFeature(i,h,f,g,b,w,T){return jc(pf(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,T),g)}isTileClipped(){return!0}}const tM=mn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),eM=mn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:iM}=tM;var Ja={},nM=v,X0=Ql;function Ql(r,i,h,f,g){this.properties={},this.extent=h,this.type=0,this._pbf=r,this._geometry=-1,this._keys=f,this._values=g,r.readFields(sM,this,i)}function sM(r,i,h){r==1?i.id=h.readVarint():r==2?function(f,g){for(var b=f.readVarint()+f.pos;f.pos<b;){var w=g._keys[f.readVarint()],T=g._values[f.readVarint()];g.properties[w]=T}}(h,i):r==3?i.type=h.readVarint():r==4&&(i._geometry=h.pos)}function rM(r){for(var i,h,f=0,g=0,b=r.length,w=b-1;g<b;w=g++)f+=((h=r[w]).x-(i=r[g]).x)*(i.y+h.y);return f}Ql.types=["Unknown","Point","LineString","Polygon"],Ql.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var i,h=r.readVarint()+r.pos,f=1,g=0,b=0,w=0,T=[];r.pos<h;){if(g<=0){var P=r.readVarint();f=7&P,g=P>>3}if(g--,f===1||f===2)b+=r.readSVarint(),w+=r.readSVarint(),f===1&&(i&&T.push(i),i=[]),i.push(new nM(b,w));else{if(f!==7)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&T.push(i),T},Ql.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var i=r.readVarint()+r.pos,h=1,f=0,g=0,b=0,w=1/0,T=-1/0,P=1/0,k=-1/0;r.pos<i;){if(f<=0){var O=r.readVarint();h=7&O,f=O>>3}if(f--,h===1||h===2)(g+=r.readSVarint())<w&&(w=g),g>T&&(T=g),(b+=r.readSVarint())<P&&(P=b),b>k&&(k=b);else if(h!==7)throw new Error("unknown command "+h)}return[w,P,T,k]},Ql.prototype.toGeoJSON=function(r,i,h){var f,g,b=this.extent*Math.pow(2,h),w=this.extent*r,T=this.extent*i,P=this.loadGeometry(),k=Ql.types[this.type];function O(X){for(var J=0;J<X.length;J++){var st=X[J];X[J]=[360*(st.x+w)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(st.y+T)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(f=0;f<P.length;f++)N[f]=P[f][0];O(P=N);break;case 2:for(f=0;f<P.length;f++)O(P[f]);break;case 3:for(P=function(X){var J=X.length;if(J<=1)return[X];for(var st,ct,_t=[],Lt=0;Lt<J;Lt++){var xt=rM(X[Lt]);xt!==0&&(ct===void 0&&(ct=xt<0),ct===xt<0?(st&&_t.push(st),st=[X[Lt]]):st.push(X[Lt]))}return st&&_t.push(st),_t}(P),f=0;f<P.length;f++)for(g=0;g<P[f].length;g++)O(P[f][g])}P.length===1?P=P[0]:k="Multi"+k;var $={type:"Feature",geometry:{type:k,coordinates:P},properties:this.properties};return"id"in this&&($.id=this.id),$};var aM=X0,Y0=J0;function J0(r,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(oM,this,i),this.length=this._features.length}function oM(r,i,h){r===15?i.version=h.readVarint():r===1?i.name=h.readString():r===5?i.extent=h.readVarint():r===2?i._features.push(h.pos):r===3?i._keys.push(h.readString()):r===4&&i._values.push(function(f){for(var g=null,b=f.readVarint()+f.pos;f.pos<b;){var w=f.readVarint()>>3;g=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return g}(h))}J0.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var i=this._pbf.readVarint()+this._pbf.pos;return new aM(this._pbf,i,this.extent,this._keys,this._values)};var lM=Y0;function hM(r,i,h){if(r===3){var f=new lM(h,h.readVarint()+h.pos);f.length&&(i[f.name]=f)}}Ja.VectorTile=function(r,i){this.layers=r.readFields(hM,{},i)},Ja.VectorTileFeature=X0,Ja.VectorTileLayer=Y0;const cM=Ja.VectorTileFeature.types,Bm=Math.pow(2,13);function eu(r,i,h,f,g,b,w,T){r.emplaceBack(i,h,2*Math.floor(f*Bm)+w,g*Bm*2,b*Bm*2,Math.round(T))}class Om{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(h=>h.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new ht,this.centroidVertexArray=new U,this.indexArray=new Vt,this.programConfigurations=new en(i.layers,i.zoom),this.segments=new ae,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(i,h,f){this.features=[],this.hasPattern=zm("fill-extrusion",this.layers,h);for(const{feature:g,id:b,index:w,sourceLayerIndex:T}of i){const P=this.layers[0]._featureFilter.needGeometry,k=ca(g,P);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),k,f))continue;const O={id:b,sourceLayerIndex:T,index:w,geometry:P?k.geometry:ha(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(km("fill-extrusion",this.layers,O,this.zoom,h)):this.addFeature(O,O.geometry,w,f,{}),h.featureIndex.insert(g,O.geometry,w,T,this.index,!0)}}addFeatures(i,h,f){for(const g of this.features){const{geometry:b}=g;this.addFeature(g,b,g.index,h,f)}}update(i,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,h,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,iM),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,eM.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,h,f,g,b){const w={x:0,y:0,vertexCount:0};for(const T of Dm(h,500)){let P=0;for(const J of T)P+=J.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const J of T){if(J.length===0||dM(J))continue;let st=0;for(let ct=0;ct<J.length;ct++){const _t=J[ct];if(ct>=1){const Lt=J[ct-1];if(!uM(_t,Lt)){k.vertexLength+4>ae.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const xt=_t.sub(Lt)._perp()._unit(),Et=Lt.dist(_t);st+Et>32768&&(st=0),eu(this.layoutVertexArray,_t.x,_t.y,xt.x,xt.y,0,0,st),eu(this.layoutVertexArray,_t.x,_t.y,xt.x,xt.y,0,1,st),w.x+=2*_t.x,w.y+=2*_t.y,w.vertexCount+=2,st+=Et,eu(this.layoutVertexArray,Lt.x,Lt.y,xt.x,xt.y,0,0,st),eu(this.layoutVertexArray,Lt.x,Lt.y,xt.x,xt.y,0,1,st),w.x+=2*Lt.x,w.y+=2*Lt.y,w.vertexCount+=2;const Xt=k.vertexLength;this.indexArray.emplaceBack(Xt,Xt+2,Xt+1),this.indexArray.emplaceBack(Xt+1,Xt+2,Xt+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+P>ae.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),cM[i.type]!=="Polygon")continue;const O=[],N=[],$=k.vertexLength;for(const J of T)if(J.length!==0){J!==T[0]&&N.push(O.length/2);for(let st=0;st<J.length;st++){const ct=J[st];eu(this.layoutVertexArray,ct.x,ct.y,0,0,1,1,0),w.x+=ct.x,w.y+=ct.y,w.vertexCount+=1,O.push(ct.x),O.push(ct.y)}}const X=q0(O,N);for(let J=0;J<X.length;J+=3)this.indexArray.emplaceBack($+X[J],$+X[J+2],$+X[J+1]);k.primitiveLength+=X.length/3,k.vertexLength+=P}for(let T=0;T<w.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,g)}}function uM(r,i){return r.x===i.x&&(r.x<0||r.x>Ti)||r.y===i.y&&(r.y<0||r.y>Ti)}function dM(r){return r.every(i=>i.x<0)||r.every(i=>i.x>Ti)||r.every(i=>i.y<0)||r.every(i=>i.y>Ti)}let K0;Ne("FillExtrusionBucket",Om,{omit:["layers","features"]});var fM={get paint(){return K0=K0||new as({"fill-extrusion-opacity":new Ye(Pt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ri(Pt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ye(Pt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ye(Pt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ra(Pt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ri(Pt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ri(Pt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ye(Pt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class pM extends Ws{constructor(i){super(i,fM)}createBucket(i){return new Om(i)}queryRadius(){return ff(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,h,f,g,b,w,T,P){const k=pf(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,T),O=this.paint.get("fill-extrusion-height").evaluate(h,f),N=this.paint.get("fill-extrusion-base").evaluate(h,f),$=function(J,st,ct,_t){const Lt=[];for(const xt of J){const Et=[xt.x,xt.y,0,1];mf(Et,Et,st),Lt.push(new M(Et[0]/Et[3],Et[1]/Et[3]))}return Lt}(k,P),X=function(J,st,ct,_t){const Lt=[],xt=[],Et=_t[8]*st,Xt=_t[9]*st,te=_t[10]*st,Le=_t[11]*st,qe=_t[8]*ct,Ie=_t[9]*ct,Te=_t[10]*ct,ve=_t[11]*ct;for(const Ve of J){const Ae=[],ue=[];for(const ti of Ve){const Ze=ti.x,Ai=ti.y,tn=_t[0]*Ze+_t[4]*Ai+_t[12],nn=_t[1]*Ze+_t[5]*Ai+_t[13],An=_t[2]*Ze+_t[6]*Ai+_t[14],Ds=_t[3]*Ze+_t[7]*Ai+_t[15],hs=An+te,xn=Ds+Le,Un=tn+qe,Zn=nn+Ie,cs=An+Te,us=Ds+ve,Tn=new M((tn+Et)/xn,(nn+Xt)/xn);Tn.z=hs/xn,Ae.push(Tn);const En=new M(Un/us,Zn/us);En.z=cs/us,ue.push(En)}Lt.push(Ae),xt.push(ue)}return[Lt,xt]}(g,N,O,P);return function(J,st,ct){let _t=1/0;jc(ct,st)&&(_t=Q0(ct,st[0]));for(let Lt=0;Lt<st.length;Lt++){const xt=st[Lt],Et=J[Lt];for(let Xt=0;Xt<xt.length-1;Xt++){const te=xt[Xt],Le=[te,xt[Xt+1],Et[Xt+1],Et[Xt],te];ua(ct,Le)&&(_t=Math.min(_t,Q0(ct,Le)))}}return _t!==1/0&&_t}(X[0],X[1],$)}}function iu(r,i){return r.x*i.x+r.y*i.y}function Q0(r,i){if(r.length===1){let h=0;const f=i[h++];let g;for(;!g||f.equals(g);)if(g=i[h++],!g)return 1/0;for(;h<i.length;h++){const b=i[h],w=r[0],T=g.sub(f),P=b.sub(f),k=w.sub(f),O=iu(T,T),N=iu(T,P),$=iu(P,P),X=iu(k,T),J=iu(k,P),st=O*$-N*N,ct=($*X-N*J)/st,_t=(O*J-N*X)/st,Lt=f.z*(1-ct-_t)+g.z*ct+b.z*_t;if(isFinite(Lt))return Lt}return 1/0}{let h=1/0;for(const f of i)h=Math.min(h,f.z);return h}}const mM=mn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:gM}=mM,_M=mn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:yM}=_M,vM=Ja.VectorTileFeature.types,xM=Math.cos(Math.PI/180*37.5),ty=Math.pow(2,14)/.5;class Nm{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(h=>h.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new lt,this.layoutVertexArray2=new dt,this.indexArray=new Vt,this.programConfigurations=new en(i.layers,i.zoom),this.segments=new ae,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(i,h,f){this.hasPattern=zm("line",this.layers,h);const g=this.layers[0].layout.get("line-sort-key"),b=!g.isConstant(),w=[];for(const{feature:T,id:P,index:k,sourceLayerIndex:O}of i){const N=this.layers[0]._featureFilter.needGeometry,$=ca(T,N);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),$,f))continue;const X=b?g.evaluate($,{},f):void 0,J={id:P,properties:T.properties,type:T.type,sourceLayerIndex:O,index:k,geometry:N?$.geometry:ha(T),patterns:{},sortKey:X};w.push(J)}b&&w.sort((T,P)=>T.sortKey-P.sortKey);for(const T of w){const{geometry:P,index:k,sourceLayerIndex:O}=T;if(this.hasPattern){const N=km("line",this.layers,T,this.zoom,h);this.patternFeatures.push(N)}else this.addFeature(T,P,k,f,{});h.featureIndex.insert(i[k].feature,P,k,O,this.index)}}update(i,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,h,this.stateDependentLayers,f)}addFeatures(i,h,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,yM)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,gM),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,h,f,g,b){const w=this.layers[0].layout,T=w.get("line-join").evaluate(i,{}),P=w.get("line-cap"),k=w.get("line-miter-limit"),O=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const N of h)this.addLine(N,i,T,P,k,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,g)}addLine(i,h,f,g,b,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let _t=0;_t<i.length-1;_t++)this.totalDistance+=i[_t].dist(i[_t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=vM[h.type]==="Polygon";let P=i.length;for(;P>=2&&i[P-1].equals(i[P-2]);)P--;let k=0;for(;k<P-1&&i[k].equals(i[k+1]);)k++;if(P<(T?3:2))return;f==="bevel"&&(b=1.05);const O=this.overscaling<=16?15*Ti/(512*this.overscaling):0,N=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let $,X,J,st,ct;this.e1=this.e2=-1,T&&($=i[P-2],ct=i[k].sub($)._unit()._perp());for(let _t=k;_t<P;_t++){if(J=_t===P-1?T?i[k+1]:void 0:i[_t+1],J&&i[_t].equals(J))continue;ct&&(st=ct),$&&(X=$),$=i[_t],ct=J?J.sub($)._unit()._perp():st,st=st||ct;let Lt=st.add(ct);Lt.x===0&&Lt.y===0||Lt._unit();const xt=st.x*ct.x+st.y*ct.y,Et=Lt.x*ct.x+Lt.y*ct.y,Xt=Et!==0?1/Et:1/0,te=2*Math.sqrt(2-2*Et),Le=Et<xM&&X&&J,qe=st.x*ct.y-st.y*ct.x>0;if(Le&&_t>k){const ve=$.dist(X);if(ve>2*O){const Ve=$.sub($.sub(X)._mult(O/ve)._round());this.updateDistance(X,Ve),this.addCurrentVertex(Ve,st,0,0,N),X=Ve}}const Ie=X&&J;let Te=Ie?f:T?"butt":g;if(Ie&&Te==="round"&&(Xt<w?Te="miter":Xt<=2&&(Te="fakeround")),Te==="miter"&&Xt>b&&(Te="bevel"),Te==="bevel"&&(Xt>2&&(Te="flipbevel"),Xt<b&&(Te="miter")),X&&this.updateDistance(X,$),Te==="miter")Lt._mult(Xt),this.addCurrentVertex($,Lt,0,0,N);else if(Te==="flipbevel"){if(Xt>100)Lt=ct.mult(-1);else{const ve=Xt*st.add(ct).mag()/st.sub(ct).mag();Lt._perp()._mult(ve*(qe?-1:1))}this.addCurrentVertex($,Lt,0,0,N),this.addCurrentVertex($,Lt.mult(-1),0,0,N)}else if(Te==="bevel"||Te==="fakeround"){const ve=-Math.sqrt(Xt*Xt-1),Ve=qe?ve:0,Ae=qe?0:ve;if(X&&this.addCurrentVertex($,st,Ve,Ae,N),Te==="fakeround"){const ue=Math.round(180*te/Math.PI/20);for(let ti=1;ti<ue;ti++){let Ze=ti/ue;if(Ze!==.5){const tn=Ze-.5;Ze+=Ze*tn*(Ze-1)*((1.0904+xt*(xt*(3.55645-1.43519*xt)-3.2452))*tn*tn+(.848013+xt*(.215638*xt-1.06021)))}const Ai=ct.sub(st)._mult(Ze)._add(st)._unit()._mult(qe?-1:1);this.addHalfVertex($,Ai.x,Ai.y,!1,qe,0,N)}}J&&this.addCurrentVertex($,ct,-Ve,-Ae,N)}else if(Te==="butt")this.addCurrentVertex($,Lt,0,0,N);else if(Te==="square"){const ve=X?1:-1;this.addCurrentVertex($,Lt,ve,ve,N)}else Te==="round"&&(X&&(this.addCurrentVertex($,st,0,0,N),this.addCurrentVertex($,st,1,1,N,!0)),J&&(this.addCurrentVertex($,ct,-1,-1,N,!0),this.addCurrentVertex($,ct,0,0,N)));if(Le&&_t<P-1){const ve=$.dist(J);if(ve>2*O){const Ve=$.add(J.sub($)._mult(O/ve)._round());this.updateDistance($,Ve),this.addCurrentVertex(Ve,ct,0,0,N),$=Ve}}}}addCurrentVertex(i,h,f,g,b,w=!1){const T=h.y*g-h.x,P=-h.y-h.x*g;this.addHalfVertex(i,h.x+h.y*f,h.y-h.x*f,w,!1,f,b),this.addHalfVertex(i,T,P,w,!0,-g,b),this.distance>ty/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,h,f,g,b,w))}addHalfVertex({x:i,y:h},f,g,b,w,T,P){const k=.5*(this.lineClips?this.scaledDistance*(ty-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(b?1:0),(h<<1)+(w?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),P.primitiveLength++),w?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,h){this.distance+=i.dist(h),this.updateScaledDistance()}}let ey,iy;Ne("LineBucket",Nm,{omit:["layers","patternFeatures"]});var ny={get paint(){return iy=iy||new as({"line-opacity":new ri(Pt.paint_line["line-opacity"]),"line-color":new ri(Pt.paint_line["line-color"]),"line-translate":new Ye(Pt.paint_line["line-translate"]),"line-translate-anchor":new Ye(Pt.paint_line["line-translate-anchor"]),"line-width":new ri(Pt.paint_line["line-width"]),"line-gap-width":new ri(Pt.paint_line["line-gap-width"]),"line-offset":new ri(Pt.paint_line["line-offset"]),"line-blur":new ri(Pt.paint_line["line-blur"]),"line-dasharray":new zc(Pt.paint_line["line-dasharray"]),"line-pattern":new ra(Pt.paint_line["line-pattern"]),"line-gradient":new No(Pt.paint_line["line-gradient"])})},get layout(){return ey=ey||new as({"line-cap":new Ye(Pt.layout_line["line-cap"]),"line-join":new ri(Pt.layout_line["line-join"]),"line-miter-limit":new Ye(Pt.layout_line["line-miter-limit"]),"line-round-limit":new Ye(Pt.layout_line["line-round-limit"]),"line-sort-key":new ri(Pt.layout_line["line-sort-key"])})}};class bM extends ri{possiblyEvaluate(i,h){return h=new Ki(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(i,h)}evaluate(i,h,f,g){return h=pt({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(i,h,f,g)}}let xf;class wM extends Ws{constructor(i){super(i,ny),this.gradientVersion=0,xf||(xf=new bM(ny.paint.properties["line-width"].specification),xf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Ra,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,h){super.recalculate(i,h),this.paint._values["line-floorwidth"]=xf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Nm(i)}queryRadius(i){const h=i,f=sy(Zc("line-width",this,h),Zc("line-gap-width",this,h)),g=Zc("line-offset",this,h);return f/2+Math.abs(g)+ff(this.paint.get("line-translate"))}queryIntersectsFeature(i,h,f,g,b,w,T){const P=pf(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,T),k=T/2*sy(this.paint.get("line-width").evaluate(h,f),this.paint.get("line-gap-width").evaluate(h,f)),O=this.paint.get("line-offset").evaluate(h,f);return O&&(g=function(N,$){const X=[];for(let J=0;J<N.length;J++){const st=N[J],ct=[];for(let _t=0;_t<st.length;_t++){const Lt=st[_t-1],xt=st[_t],Et=st[_t+1],Xt=_t===0?new M(0,0):xt.sub(Lt)._unit()._perp(),te=_t===st.length-1?new M(0,0):Et.sub(xt)._unit()._perp(),Le=Xt._add(te)._unit(),qe=Le.x*te.x+Le.y*te.y;qe!==0&&Le._mult(1/qe),ct.push(Le._mult($)._add(xt))}X.push(ct)}return X}(g,O*T)),function(N,$,X){for(let J=0;J<$.length;J++){const st=$[J];if(N.length>=3){for(let ct=0;ct<st.length;ct++)if(Yl(N,st[ct]))return!0}if(uf(N,st,X))return!0}return!1}(P,g,k)}isTileClipped(){return!0}}function sy(r,i){return i>0?i+2*r:r}const MM=mn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),SM=mn([{name:"a_projected_pos",components:3,type:"Float32"}],4);mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const AM=mn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);mn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ry=mn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),TM=mn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function EM(r,i,h){return r.sections.forEach(f=>{f.text=function(g,b,w){const T=b.layout.get("text-transform").evaluate(w,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),sa.applyArabicShaping&&(g=sa.applyArabicShaping(g)),g}(f.text,i,h)}),r}mn([{name:"triangle",components:3,type:"Uint16"}]),mn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),mn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),mn([{type:"Float32",name:"offsetX"}]),mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),mn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const nu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Sn=24,ay=Hi,oy=function(r,i,h,f,g){var b,w,T=8*g-f-1,P=(1<<T)-1,k=P>>1,O=-7,N=h?g-1:0,$=h?-1:1,X=r[i+N];for(N+=$,b=X&(1<<-O)-1,X>>=-O,O+=T;O>0;b=256*b+r[i+N],N+=$,O-=8);for(w=b&(1<<-O)-1,b>>=-O,O+=f;O>0;w=256*w+r[i+N],N+=$,O-=8);if(b===0)b=1-k;else{if(b===P)return w?NaN:1/0*(X?-1:1);w+=Math.pow(2,f),b-=k}return(X?-1:1)*w*Math.pow(2,b-f)},ly=function(r,i,h,f,g,b){var w,T,P,k=8*b-g-1,O=(1<<k)-1,N=O>>1,$=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=f?0:b-1,J=f?1:-1,st=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(T=isNaN(i)?1:0,w=O):(w=Math.floor(Math.log(i)/Math.LN2),i*(P=Math.pow(2,-w))<1&&(w--,P*=2),(i+=w+N>=1?$/P:$*Math.pow(2,1-N))*P>=2&&(w++,P/=2),w+N>=O?(T=0,w=O):w+N>=1?(T=(i*P-1)*Math.pow(2,g),w+=N):(T=i*Math.pow(2,N-1)*Math.pow(2,g),w=0));g>=8;r[h+X]=255&T,X+=J,T/=256,g-=8);for(w=w<<g|T,k+=g;k>0;r[h+X]=255&w,X+=J,w/=256,k-=8);r[h+X-J]|=128*st};function Hi(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Hi.Varint=0,Hi.Fixed64=1,Hi.Bytes=2,Hi.Fixed32=5;var Um=4294967296,hy=1/Um,cy=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function da(r){return r.type===Hi.Bytes?r.readVarint()+r.pos:r.pos+1}function th(r,i,h){return h?4294967296*i+(r>>>0):4294967296*(i>>>0)+(r>>>0)}function uy(r,i,h){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));h.realloc(f);for(var g=h.pos-1;g>=r;g--)h.buf[g+f]=h.buf[g]}function CM(r,i){for(var h=0;h<r.length;h++)i.writeVarint(r[h])}function IM(r,i){for(var h=0;h<r.length;h++)i.writeSVarint(r[h])}function PM(r,i){for(var h=0;h<r.length;h++)i.writeFloat(r[h])}function LM(r,i){for(var h=0;h<r.length;h++)i.writeDouble(r[h])}function RM(r,i){for(var h=0;h<r.length;h++)i.writeBoolean(r[h])}function DM(r,i){for(var h=0;h<r.length;h++)i.writeFixed32(r[h])}function zM(r,i){for(var h=0;h<r.length;h++)i.writeSFixed32(r[h])}function kM(r,i){for(var h=0;h<r.length;h++)i.writeFixed64(r[h])}function FM(r,i){for(var h=0;h<r.length;h++)i.writeSFixed64(r[h])}function bf(r,i){return(r[i]|r[i+1]<<8|r[i+2]<<16)+16777216*r[i+3]}function eh(r,i,h){r[h]=i,r[h+1]=i>>>8,r[h+2]=i>>>16,r[h+3]=i>>>24}function dy(r,i){return(r[i]|r[i+1]<<8|r[i+2]<<16)+(r[i+3]<<24)}Hi.prototype={destroy:function(){this.buf=null},readFields:function(r,i,h){for(h=h||this.length;this.pos<h;){var f=this.readVarint(),g=f>>3,b=this.pos;this.type=7&f,r(g,i,this),this.pos===b&&this.skip(f)}return i},readMessage:function(r,i){return this.readFields(r,i,this.readVarint()+this.pos)},readFixed32:function(){var r=bf(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=dy(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=bf(this.buf,this.pos)+bf(this.buf,this.pos+4)*Um;return this.pos+=8,r},readSFixed64:function(){var r=bf(this.buf,this.pos)+dy(this.buf,this.pos+4)*Um;return this.pos+=8,r},readFloat:function(){var r=oy(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=oy(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var i,h,f=this.buf;return i=127&(h=f[this.pos++]),h<128?i:(i|=(127&(h=f[this.pos++]))<<7,h<128?i:(i|=(127&(h=f[this.pos++]))<<14,h<128?i:(i|=(127&(h=f[this.pos++]))<<21,h<128?i:function(g,b,w){var T,P,k=w.buf;if(T=(112&(P=k[w.pos++]))>>4,P<128||(T|=(127&(P=k[w.pos++]))<<3,P<128)||(T|=(127&(P=k[w.pos++]))<<10,P<128)||(T|=(127&(P=k[w.pos++]))<<17,P<128)||(T|=(127&(P=k[w.pos++]))<<24,P<128)||(T|=(1&(P=k[w.pos++]))<<31,P<128))return th(g,T,b);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(h=f[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,i=this.pos;return this.pos=r,r-i>=12&&cy?function(h,f,g){return cy.decode(h.subarray(f,g))}(this.buf,i,r):function(h,f,g){for(var b="",w=f;w<g;){var T,P,k,O=h[w],N=null,$=O>239?4:O>223?3:O>191?2:1;if(w+$>g)break;$===1?O<128&&(N=O):$===2?(192&(T=h[w+1]))==128&&(N=(31&O)<<6|63&T)<=127&&(N=null):$===3?(P=h[w+2],(192&(T=h[w+1]))==128&&(192&P)==128&&((N=(15&O)<<12|(63&T)<<6|63&P)<=2047||N>=55296&&N<=57343)&&(N=null)):$===4&&(P=h[w+2],k=h[w+3],(192&(T=h[w+1]))==128&&(192&P)==128&&(192&k)==128&&((N=(15&O)<<18|(63&T)<<12|(63&P)<<6|63&k)<=65535||N>=1114112)&&(N=null)),N===null?(N=65533,$=1):N>65535&&(N-=65536,b+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),b+=String.fromCharCode(N),w+=$}return b}(this.buf,i,r)},readBytes:function(){var r=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,r);return this.pos=r,i},readPackedVarint:function(r,i){if(this.type!==Hi.Bytes)return r.push(this.readVarint(i));var h=da(this);for(r=r||[];this.pos<h;)r.push(this.readVarint(i));return r},readPackedSVarint:function(r){if(this.type!==Hi.Bytes)return r.push(this.readSVarint());var i=da(this);for(r=r||[];this.pos<i;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Hi.Bytes)return r.push(this.readBoolean());var i=da(this);for(r=r||[];this.pos<i;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Hi.Bytes)return r.push(this.readFloat());var i=da(this);for(r=r||[];this.pos<i;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Hi.Bytes)return r.push(this.readDouble());var i=da(this);for(r=r||[];this.pos<i;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Hi.Bytes)return r.push(this.readFixed32());var i=da(this);for(r=r||[];this.pos<i;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Hi.Bytes)return r.push(this.readSFixed32());var i=da(this);for(r=r||[];this.pos<i;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Hi.Bytes)return r.push(this.readFixed64());var i=da(this);for(r=r||[];this.pos<i;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Hi.Bytes)return r.push(this.readSFixed64());var i=da(this);for(r=r||[];this.pos<i;)r.push(this.readSFixed64());return r},skip:function(r){var i=7&r;if(i===Hi.Varint)for(;this.buf[this.pos++]>127;);else if(i===Hi.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Hi.Fixed32)this.pos+=4;else{if(i!==Hi.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(r,i){this.writeVarint(r<<3|i)},realloc:function(r){for(var i=this.length||16;i<this.pos+r;)i*=2;if(i!==this.length){var h=new Uint8Array(i);h.set(this.buf),this.buf=h,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),eh(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),eh(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),eh(this.buf,-1&r,this.pos),eh(this.buf,Math.floor(r*hy),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),eh(this.buf,-1&r,this.pos),eh(this.buf,Math.floor(r*hy),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(i,h){var f,g;if(i>=0?(f=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(b,w,T){T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,T.buf[T.pos]=127&(b>>>=7)}(f,0,h),function(b,w){var T=(7&b)<<4;w.buf[w.pos++]|=T|((b>>>=3)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b)))))}(g,h)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var i=this.pos;this.pos=function(f,g,b){for(var w,T,P=0;P<g.length;P++){if((w=g.charCodeAt(P))>55295&&w<57344){if(!T){w>56319||P+1===g.length?(f[b++]=239,f[b++]=191,f[b++]=189):T=w;continue}if(w<56320){f[b++]=239,f[b++]=191,f[b++]=189,T=w;continue}w=T-55296<<10|w-56320|65536,T=null}else T&&(f[b++]=239,f[b++]=191,f[b++]=189,T=null);w<128?f[b++]=w:(w<2048?f[b++]=w>>6|192:(w<65536?f[b++]=w>>12|224:(f[b++]=w>>18|240,f[b++]=w>>12&63|128),f[b++]=w>>6&63|128),f[b++]=63&w|128)}return b}(this.buf,r,this.pos);var h=this.pos-i;h>=128&&uy(i,h,this),this.pos=i-1,this.writeVarint(h),this.pos+=h},writeFloat:function(r){this.realloc(4),ly(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),ly(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var i=r.length;this.writeVarint(i),this.realloc(i);for(var h=0;h<i;h++)this.buf[this.pos++]=r[h]},writeRawMessage:function(r,i){this.pos++;var h=this.pos;r(i,this);var f=this.pos-h;f>=128&&uy(h,f,this),this.pos=h-1,this.writeVarint(f),this.pos+=f},writeMessage:function(r,i,h){this.writeTag(r,Hi.Bytes),this.writeRawMessage(i,h)},writePackedVarint:function(r,i){i.length&&this.writeMessage(r,CM,i)},writePackedSVarint:function(r,i){i.length&&this.writeMessage(r,IM,i)},writePackedBoolean:function(r,i){i.length&&this.writeMessage(r,RM,i)},writePackedFloat:function(r,i){i.length&&this.writeMessage(r,PM,i)},writePackedDouble:function(r,i){i.length&&this.writeMessage(r,LM,i)},writePackedFixed32:function(r,i){i.length&&this.writeMessage(r,DM,i)},writePackedSFixed32:function(r,i){i.length&&this.writeMessage(r,zM,i)},writePackedFixed64:function(r,i){i.length&&this.writeMessage(r,kM,i)},writePackedSFixed64:function(r,i){i.length&&this.writeMessage(r,FM,i)},writeBytesField:function(r,i){this.writeTag(r,Hi.Bytes),this.writeBytes(i)},writeFixed32Field:function(r,i){this.writeTag(r,Hi.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(r,i){this.writeTag(r,Hi.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(r,i){this.writeTag(r,Hi.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(r,i){this.writeTag(r,Hi.Fixed64),this.writeSFixed64(i)},writeVarintField:function(r,i){this.writeTag(r,Hi.Varint),this.writeVarint(i)},writeSVarintField:function(r,i){this.writeTag(r,Hi.Varint),this.writeSVarint(i)},writeStringField:function(r,i){this.writeTag(r,Hi.Bytes),this.writeString(i)},writeFloatField:function(r,i){this.writeTag(r,Hi.Fixed32),this.writeFloat(i)},writeDoubleField:function(r,i){this.writeTag(r,Hi.Fixed64),this.writeDouble(i)},writeBooleanField:function(r,i){this.writeVarintField(r,!!i)}};var Vm=_(ay);const Gm=3;function BM(r,i,h){r===1&&h.readMessage(OM,i)}function OM(r,i,h){if(r===3){const{id:f,bitmap:g,width:b,height:w,left:T,top:P,advance:k}=h.readMessage(NM,{});i.push({id:f,bitmap:new Yc({width:b+2*Gm,height:w+2*Gm},g),metrics:{width:b,height:w,left:T,top:P,advance:k}})}}function NM(r,i,h){r===1?i.id=h.readVarint():r===2?i.bitmap=h.readBytes():r===3?i.width=h.readVarint():r===4?i.height=h.readVarint():r===5?i.left=h.readSVarint():r===6?i.top=h.readSVarint():r===7&&(i.advance=h.readVarint())}const fy=Gm;function py(r){let i=0,h=0;for(const w of r)i+=w.w*w.h,h=Math.max(h,w.w);r.sort((w,T)=>T.h-w.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),h),h:1/0}];let g=0,b=0;for(const w of r)for(let T=f.length-1;T>=0;T--){const P=f[T];if(!(w.w>P.w||w.h>P.h)){if(w.x=P.x,w.y=P.y,b=Math.max(b,w.y+w.h),g=Math.max(g,w.x+w.w),w.w===P.w&&w.h===P.h){const k=f.pop();T<f.length&&(f[T]=k)}else w.h===P.h?(P.x+=w.w,P.w-=w.w):w.w===P.w?(P.y+=w.h,P.h-=w.h):(f.push({x:P.x+w.w,y:P.y,w:P.w-w.w,h:w.h}),P.y+=w.h,P.h-=w.h);break}}return{w:g,h:b,fill:i/(g*b)||0}}const ws=1;class Hm{constructor(i,{pixelRatio:h,version:f,stretchX:g,stretchY:b,content:w}){this.paddedRect=i,this.pixelRatio=h,this.stretchX=g,this.stretchY=b,this.content=w,this.version=f}get tl(){return[this.paddedRect.x+ws,this.paddedRect.y+ws]}get br(){return[this.paddedRect.x+this.paddedRect.w-ws,this.paddedRect.y+this.paddedRect.h-ws]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ws)/this.pixelRatio,(this.paddedRect.h-2*ws)/this.pixelRatio]}}class my{constructor(i,h){const f={},g={};this.haveRenderCallbacks=[];const b=[];this.addImages(i,f,b),this.addImages(h,g,b);const{w,h:T}=py(b),P=new js({width:w||1,height:T||1});for(const k in i){const O=i[k],N=f[k].paddedRect;js.copy(O.data,P,{x:0,y:0},{x:N.x+ws,y:N.y+ws},O.data)}for(const k in h){const O=h[k],N=g[k].paddedRect,$=N.x+ws,X=N.y+ws,J=O.data.width,st=O.data.height;js.copy(O.data,P,{x:0,y:0},{x:$,y:X},O.data),js.copy(O.data,P,{x:0,y:st-1},{x:$,y:X-1},{width:J,height:1}),js.copy(O.data,P,{x:0,y:0},{x:$,y:X+st},{width:J,height:1}),js.copy(O.data,P,{x:J-1,y:0},{x:$-1,y:X},{width:1,height:st}),js.copy(O.data,P,{x:0,y:0},{x:$+J,y:X},{width:1,height:st})}this.image=P,this.iconPositions=f,this.patternPositions=g}addImages(i,h,f){for(const g in i){const b=i[g],w={x:0,y:0,w:b.data.width+2*ws,h:b.data.height+2*ws};f.push(w),h[g]=new Hm(w,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,h){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),h),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),h)}patchUpdatedImage(i,h,f){if(!i||!h||i.version===h.version)return;i.version=h.version;const[g,b]=i.tl;f.update(h.data,void 0,{x:g,y:b})}}var Ka;Ne("ImagePosition",Hm),Ne("ImageAtlas",my),d.ah=void 0,(Ka=d.ah||(d.ah={}))[Ka.none=0]="none",Ka[Ka.horizontal=1]="horizontal",Ka[Ka.vertical=2]="vertical",Ka[Ka.horizontalOnly=3]="horizontalOnly";const su=-17;class ru{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,h){const f=new ru;return f.scale=i||1,f.fontStack=h,f}static forImage(i){const h=new ru;return h.imageName=i,h}}class ih{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,h){const f=new ih;for(let g=0;g<i.sections.length;g++){const b=i.sections[g];b.image?f.addImageSection(b):f.addTextSection(b,h)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let h="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,b=i.charCodeAt(f-1)||null;h+=g&&Ic(g)&&!nu[i[f+1]]||b&&Ic(b)&&!nu[i[f-1]]||!nu[i[f]]?i[f]:nu[i[f]]}return h}(this.text)}trim(){let i=0;for(let f=0;f<this.text.length&&Mf[this.text.charCodeAt(f)];f++)i++;let h=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&Mf[this.text.charCodeAt(f)];f--)h--;this.text=this.text.substring(i,h),this.sectionIndex=this.sectionIndex.slice(i,h)}substring(i,h){const f=new ih;return f.text=this.text.substring(i,h),f.sectionIndex=this.sectionIndex.slice(i,h),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,h)=>Math.max(i,this.sections[h].scale),0)}addTextSection(i,h){this.text+=i.text,this.sections.push(ru.forText(i.scale,i.fontStack||h));const f=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(f)}addImageSection(i){const h=i.image?i.image.name:"";if(h.length===0)return void It("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(ru.forImage(h)),this.sectionIndex.push(this.sections.length-1)):It("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wf(r,i,h,f,g,b,w,T,P,k,O,N,$,X,J,st){const ct=ih.fromFeature(r,g);let _t;N===d.ah.vertical&&ct.verticalizePunctuation();const{processBidirectionalText:Lt,processStyledBidirectionalText:xt}=sa;if(Lt&&ct.sections.length===1){_t=[];const te=Lt(ct.toString(),Wm(ct,k,b,i,f,X,J));for(const Le of te){const qe=new ih;qe.text=Le,qe.sections=ct.sections;for(let Ie=0;Ie<Le.length;Ie++)qe.sectionIndex.push(0);_t.push(qe)}}else if(xt){_t=[];const te=xt(ct.text,ct.sectionIndex,Wm(ct,k,b,i,f,X,J));for(const Le of te){const qe=new ih;qe.text=Le[0],qe.sectionIndex=Le[1],qe.sections=ct.sections,_t.push(qe)}}else _t=function(te,Le){const qe=[],Ie=te.text;let Te=0;for(const ve of Le)qe.push(te.substring(Te,ve)),Te=ve;return Te<Ie.length&&qe.push(te.substring(Te,Ie.length)),qe}(ct,Wm(ct,k,b,i,f,X,J));const Et=[],Xt={positionedLines:Et,text:ct.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:N,iconsInText:!1,verticalizable:!1};return function(te,Le,qe,Ie,Te,ve,Ve,Ae,ue,ti,Ze,Ai){let tn=0,nn=su,An=0,Ds=0;const hs=Ae==="right"?1:Ae==="left"?0:.5;let xn=0;for(const Tn of Te){Tn.trim();const En=Tn.getMaxScale(),Kn=(En-1)*Sn,ds={positionedGlyphs:[],lineOffset:0};te.positionedLines[xn]=ds;const Qn=ds.positionedGlyphs;let Ms=0;if(!Tn.length()){nn+=ve,++xn;continue}for(let Cn=0;Cn<Tn.length();Cn++){const Ci=Tn.getSection(Cn),ts=Tn.getSectionIndex(Cn),Xn=Tn.getCharCode(Cn);let In=0,cr=null,vr=null,xr=null,fa=Sn;const ur=!(ue===d.ah.horizontal||!Ze&&!Vl(Xn)||Ze&&(Mf[Xn]||(Un=Xn,ze.Arabic(Un)||ze["Arabic Supplement"](Un)||ze["Arabic Extended-A"](Un)||ze["Arabic Presentation Forms-A"](Un)||ze["Arabic Presentation Forms-B"](Un))));if(Ci.imageName){const Xs=Ie[Ci.imageName];if(!Xs)continue;xr=Ci.imageName,te.iconsInText=te.iconsInText||!0,vr=Xs.paddedRect;const As=Xs.displaySize;Ci.scale=Ci.scale*Sn/Ai,cr={width:As[0],height:As[1],left:ws,top:-fy,advance:ur?As[1]:As[0]},In=Kn+(Sn-As[1]*Ci.scale),fa=cr.advance;const pa=ur?As[0]*Ci.scale-Sn*En:As[1]*Ci.scale-Sn*En;pa>0&&pa>Ms&&(Ms=pa)}else{const Xs=qe[Ci.fontStack],As=Xs&&Xs[Xn];if(As&&As.rect)vr=As.rect,cr=As.metrics;else{const pa=Le[Ci.fontStack],cu=pa&&pa[Xn];if(!cu)continue;cr=cu.metrics}In=(En-Ci.scale)*Sn}ur?(te.verticalizable=!0,Qn.push({glyph:Xn,imageName:xr,x:tn,y:nn+In,vertical:ur,scale:Ci.scale,fontStack:Ci.fontStack,sectionIndex:ts,metrics:cr,rect:vr}),tn+=fa*Ci.scale+ti):(Qn.push({glyph:Xn,imageName:xr,x:tn,y:nn+In,vertical:ur,scale:Ci.scale,fontStack:Ci.fontStack,sectionIndex:ts,metrics:cr,rect:vr}),tn+=cr.advance*Ci.scale+ti)}Qn.length!==0&&(An=Math.max(tn-ti,An),GM(Qn,0,Qn.length-1,hs,Ms)),tn=0;const Ss=ve*En+Ms;ds.lineOffset=Math.max(Ms,Kn),nn+=Ss,Ds=Math.max(Ss,Ds),++xn}var Un;const Zn=nn-su,{horizontalAlign:cs,verticalAlign:us}=qm(Ve);(function(Tn,En,Kn,ds,Qn,Ms,Ss,Cn,Ci){const ts=(En-Kn)*Qn;let Xn=0;Xn=Ms!==Ss?-Cn*ds-su:(-ds*Ci+.5)*Ss;for(const In of Tn)for(const cr of In.positionedGlyphs)cr.x+=ts,cr.y+=Xn})(te.positionedLines,hs,cs,us,An,Ds,ve,Zn,Te.length),te.top+=-us*Zn,te.bottom=te.top+Zn,te.left+=-cs*An,te.right=te.left+An}(Xt,i,h,f,_t,w,T,P,N,k,$,st),!function(te){for(const Le of te)if(Le.positionedGlyphs.length!==0)return!1;return!0}(Et)&&Xt}const Mf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},UM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function gy(r,i,h,f,g,b){if(i.imageName){const w=f[i.imageName];return w?w.displaySize[0]*i.scale*Sn/b+g:0}{const w=h[i.fontStack],T=w&&w[r];return T?T.metrics.advance*i.scale+g:0}}function _y(r,i,h,f){const g=Math.pow(r-i,2);return f?r<i?g/2:2*g:g+Math.abs(h)*h}function VM(r,i,h){let f=0;return r===10&&(f-=1e4),h&&(f+=150),r!==40&&r!==65288||(f+=50),i!==41&&i!==65289||(f+=50),f}function yy(r,i,h,f,g,b){let w=null,T=_y(i,h,g,b);for(const P of f){const k=_y(i-P.x,h,g,b)+P.badness;k<=T&&(w=P,T=k)}return{index:r,x:i,priorBreak:w,badness:T}}function vy(r){return r?vy(r.priorBreak).concat(r.index):[]}function Wm(r,i,h,f,g,b,w){if(b!=="point")return[];if(!r)return[];const T=[],P=function($,X,J,st,ct,_t){let Lt=0;for(let xt=0;xt<$.length();xt++){const Et=$.getSection(xt);Lt+=gy($.getCharCode(xt),Et,st,ct,X,_t)}return Lt/Math.max(1,Math.ceil(Lt/J))}(r,i,h,f,g,w),k=r.text.indexOf("")>=0;let O=0;for(let $=0;$<r.length();$++){const X=r.getSection($),J=r.getCharCode($);if(Mf[J]||(O+=gy(J,X,f,g,i,w)),$<r.length()-1){const st=!((N=J)<11904||!(ze["Bopomofo Extended"](N)||ze.Bopomofo(N)||ze["CJK Compatibility Forms"](N)||ze["CJK Compatibility Ideographs"](N)||ze["CJK Compatibility"](N)||ze["CJK Radicals Supplement"](N)||ze["CJK Strokes"](N)||ze["CJK Symbols and Punctuation"](N)||ze["CJK Unified Ideographs Extension A"](N)||ze["CJK Unified Ideographs"](N)||ze["Enclosed CJK Letters and Months"](N)||ze["Halfwidth and Fullwidth Forms"](N)||ze.Hiragana(N)||ze["Ideographic Description Characters"](N)||ze["Kangxi Radicals"](N)||ze["Katakana Phonetic Extensions"](N)||ze.Katakana(N)||ze["Vertical Forms"](N)||ze["Yi Radicals"](N)||ze["Yi Syllables"](N)));(UM[J]||st||X.imageName)&&T.push(yy($+1,O,P,T,VM(J,r.getCharCode($+1),st&&k),!1))}}var N;return vy(yy(r.length(),O,P,T,0,!0))}function qm(r){let i=.5,h=.5;switch(r){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:i,verticalAlign:h}}function GM(r,i,h,f,g){if(!f&&!g)return;const b=r[h],w=(r[h].x+b.metrics.advance*b.scale)*f;for(let T=i;T<=h;T++)r[T].x-=w,r[T].y+=g}function HM(r,i,h){const{horizontalAlign:f,verticalAlign:g}=qm(h),b=i[0]-r.displaySize[0]*f,w=i[1]-r.displaySize[1]*g;return{image:r,top:w,bottom:w+r.displaySize[1],left:b,right:b+r.displaySize[0]}}function xy(r,i,h,f,g,b){const w=r.image;let T;if(w.content){const ct=w.content,_t=w.pixelRatio||1;T=[ct[0]/_t,ct[1]/_t,w.displaySize[0]-ct[2]/_t,w.displaySize[1]-ct[3]/_t]}const P=i.left*b,k=i.right*b;let O,N,$,X;h==="width"||h==="both"?(X=g[0]+P-f[3],N=g[0]+k+f[1]):(X=g[0]+(P+k-w.displaySize[0])/2,N=X+w.displaySize[0]);const J=i.top*b,st=i.bottom*b;return h==="height"||h==="both"?(O=g[1]+J-f[0],$=g[1]+st+f[2]):(O=g[1]+(J+st-w.displaySize[1])/2,$=O+w.displaySize[1]),{image:w,top:O,right:N,bottom:$,left:X,collisionPadding:T}}const au=255,Br=128,Qa=au*Br;function by(r,i){const{expression:h}=i;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Ki(r+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=h;let b=0;for(;b<f.length&&f[b]<=r;)b++;b=Math.max(0,b-1);let w=b;for(;w<f.length&&f[w]<r+1;)w++;w=Math.min(f.length-1,w);const T=f[b],P=f[w];return h.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:P,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:P,minSize:h.evaluate(new Ki(T)),maxSize:h.evaluate(new Ki(P)),interpolationType:g}}}function $m(r,i,h){let f="never";const g=r.get(i);return g?f=g:r.get(h)&&(f="always"),f}const WM=Ja.VectorTileFeature.types,qM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sf(r,i,h,f,g,b,w,T,P,k,O,N,$){const X=T?Math.min(Qa,Math.round(T[0])):0,J=T?Math.min(Qa,Math.round(T[1])):0;r.emplaceBack(i,h,Math.round(32*f),Math.round(32*g),b,w,(X<<1)+(P?1:0),J,16*k,16*O,256*N,256*$)}function jm(r,i,h){r.emplaceBack(i.x,i.y,h),r.emplaceBack(i.x,i.y,h),r.emplaceBack(i.x,i.y,h),r.emplaceBack(i.x,i.y,h)}function $M(r){for(const i of r.sections)if(nf(i.text))return!0;return!1}class Zm{constructor(i){this.layoutVertexArray=new wt,this.indexArray=new Vt,this.programConfigurations=i,this.segments=new ae,this.dynamicLayoutVertexArray=new Ft,this.opacityVertexArray=new gt,this.hasVisibleVertices=!1,this.placedSymbolArray=new n}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,h,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,MM.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,SM.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,qM,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ne("SymbolBuffers",Zm);class Xm{constructor(i,h,f){this.layoutVertexArray=new i,this.layoutAttributes=h,this.indexArray=new f,this.segments=new ae,this.collisionVertexArray=new Nt}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,AM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ne("CollisionBuffers",Xm);class nh{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(w=>w.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Tm([]),this.placementViewportMatrix=Tm([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=by(this.zoom,h["text-size"]),this.iconSizeData=by(this.zoom,h["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),b=f.get("symbol-z-order");this.canOverlap=$m(f,"text-overlap","text-allow-overlap")!=="never"||$m(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(w=>d.ah[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=i.sourceID}createArrays(){this.text=new Zm(new en(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Zm(new en(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new m,this.lineVertexArray=new x,this.symbolInstances=new p,this.textAnchorOffsets=new I}calculateGlyphDependencies(i,h,f,g,b){for(let w=0;w<i.length;w++)if(h[i.charCodeAt(w)]=!0,(f||g)&&b){const T=nu[i.charAt(w)];T&&(h[T.charCodeAt(0)]=!0)}}populate(i,h,f){const g=this.layers[0],b=g.layout,w=b.get("text-font"),T=b.get("text-field"),P=b.get("icon-image"),k=(T.value.kind!=="constant"||T.value.value instanceof Oi&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),O=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,N=b.get("symbol-sort-key");if(this.features=[],!k&&!O)return;const $=h.iconDependencies,X=h.glyphDependencies,J=h.availableImages,st=new Ki(this.zoom);for(const{feature:ct,id:_t,index:Lt,sourceLayerIndex:xt}of i){const Et=g._featureFilter.needGeometry,Xt=ca(ct,Et);if(!g._featureFilter.filter(st,Xt,f))continue;let te,Le;if(Et||(Xt.geometry=ha(ct)),k){const Ie=g.getValueAndResolveTokens("text-field",Xt,f,J),Te=Oi.factory(Ie),ve=this.hasRTLText=this.hasRTLText||$M(Te);(!ve||sa.getRTLTextPluginStatus()==="unavailable"||ve&&sa.isParsed())&&(te=EM(Te,g,Xt))}if(O){const Ie=g.getValueAndResolveTokens("icon-image",Xt,f,J);Le=Ie instanceof Wn?Ie:Wn.fromString(Ie)}if(!te&&!Le)continue;const qe=this.sortFeaturesByKey?N.evaluate(Xt,{},f):void 0;if(this.features.push({id:_t,text:te,icon:Le,index:Lt,sourceLayerIndex:xt,geometry:Xt.geometry,properties:ct.properties,type:WM[ct.type],sortKey:qe}),Le&&($[Le.name]=!0),te){const Ie=w.evaluate(Xt,{},f).join(","),Te=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ah.vertical)>=0;for(const ve of te.sections)if(ve.image)$[ve.image.name]=!0;else{const Ve=Bo(te.toString()),Ae=ve.fontStack||Ie,ue=X[Ae]=X[Ae]||{};this.calculateGlyphDependencies(ve.text,ue,Te,this.allowVerticalPlacement,Ve)}}}b.get("symbol-placement")==="line"&&(this.features=function(ct){const _t={},Lt={},xt=[];let Et=0;function Xt(Ie){xt.push(ct[Ie]),Et++}function te(Ie,Te,ve){const Ve=Lt[Ie];return delete Lt[Ie],Lt[Te]=Ve,xt[Ve].geometry[0].pop(),xt[Ve].geometry[0]=xt[Ve].geometry[0].concat(ve[0]),Ve}function Le(Ie,Te,ve){const Ve=_t[Te];return delete _t[Te],_t[Ie]=Ve,xt[Ve].geometry[0].shift(),xt[Ve].geometry[0]=ve[0].concat(xt[Ve].geometry[0]),Ve}function qe(Ie,Te,ve){const Ve=ve?Te[0][Te[0].length-1]:Te[0][0];return`${Ie}:${Ve.x}:${Ve.y}`}for(let Ie=0;Ie<ct.length;Ie++){const Te=ct[Ie],ve=Te.geometry,Ve=Te.text?Te.text.toString():null;if(!Ve){Xt(Ie);continue}const Ae=qe(Ve,ve),ue=qe(Ve,ve,!0);if(Ae in Lt&&ue in _t&&Lt[Ae]!==_t[ue]){const ti=Le(Ae,ue,ve),Ze=te(Ae,ue,xt[ti].geometry);delete _t[Ae],delete Lt[ue],Lt[qe(Ve,xt[Ze].geometry,!0)]=Ze,xt[ti].geometry=null}else Ae in Lt?te(Ae,ue,ve):ue in _t?Le(Ae,ue,ve):(Xt(Ie),_t[Ae]=Et-1,Lt[ue]=Et-1)}return xt.filter(Ie=>Ie.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ct,_t)=>ct.sortKey-_t.sortKey)}update(i,h,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,h,this.layers,f),this.icon.programConfigurations.updatePaintArrays(i,h,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,h){const f=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(h[i.segment+1]),b=i.dist(h[i.segment]);const w={};for(let T=i.segment+1;T<h.length;T++)w[T]={x:h[T].x,y:h[T].y,tileUnitDistanceFromAnchor:g},T<h.length-1&&(g+=h[T+1].dist(h[T]));for(let T=i.segment||0;T>=0;T--)w[T]={x:h[T].x,y:h[T].y,tileUnitDistanceFromAnchor:b},T>0&&(b+=h[T-1].dist(h[T]));for(let T=0;T<h.length;T++){const P=w[T];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,h,f,g,b,w,T,P,k,O,N,$){const X=i.indexArray,J=i.layoutVertexArray,st=i.segments.prepareSegment(4*h.length,J,X,this.canOverlap?w.sortKey:void 0),ct=this.glyphOffsetArray.length,_t=st.vertexLength,Lt=this.allowVerticalPlacement&&T===d.ah.vertical?Math.PI/2:0,xt=w.text&&w.text.sections;for(let Et=0;Et<h.length;Et++){const{tl:Xt,tr:te,bl:Le,br:qe,tex:Ie,pixelOffsetTL:Te,pixelOffsetBR:ve,minFontScaleX:Ve,minFontScaleY:Ae,glyphOffset:ue,isSDF:ti,sectionIndex:Ze}=h[Et],Ai=st.vertexLength,tn=ue[1];Sf(J,P.x,P.y,Xt.x,tn+Xt.y,Ie.x,Ie.y,f,ti,Te.x,Te.y,Ve,Ae),Sf(J,P.x,P.y,te.x,tn+te.y,Ie.x+Ie.w,Ie.y,f,ti,ve.x,Te.y,Ve,Ae),Sf(J,P.x,P.y,Le.x,tn+Le.y,Ie.x,Ie.y+Ie.h,f,ti,Te.x,ve.y,Ve,Ae),Sf(J,P.x,P.y,qe.x,tn+qe.y,Ie.x+Ie.w,Ie.y+Ie.h,f,ti,ve.x,ve.y,Ve,Ae),jm(i.dynamicLayoutVertexArray,P,Lt),X.emplaceBack(Ai,Ai+1,Ai+2),X.emplaceBack(Ai+1,Ai+2,Ai+3),st.vertexLength+=4,st.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ue[0]),Et!==h.length-1&&Ze===h[Et+1].sectionIndex||i.programConfigurations.populatePaintArrays(J.length,w,w.index,{},$,xt&&xt[Ze])}i.placedSymbolArray.emplaceBack(P.x,P.y,ct,this.glyphOffsetArray.length-ct,_t,k,O,P.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,N)}_addCollisionDebugVertex(i,h,f,g,b,w){return h.emplaceBack(0,0),i.emplaceBack(f.x,f.y,g,b,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(i,h,f,g,b,w,T){const P=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),k=P.vertexLength,O=b.layoutVertexArray,N=b.collisionVertexArray,$=T.anchorX,X=T.anchorY;this._addCollisionDebugVertex(O,N,w,$,X,new M(i,h)),this._addCollisionDebugVertex(O,N,w,$,X,new M(f,h)),this._addCollisionDebugVertex(O,N,w,$,X,new M(f,g)),this._addCollisionDebugVertex(O,N,w,$,X,new M(i,g)),P.vertexLength+=4;const J=b.indexArray;J.emplaceBack(k,k+1),J.emplaceBack(k+1,k+2),J.emplaceBack(k+2,k+3),J.emplaceBack(k+3,k),P.primitiveLength+=4}addDebugCollisionBoxes(i,h,f,g){for(let b=i;b<h;b++){const w=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,g?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xm(Ct,ry.members,qt),this.iconCollisionBox=new Xm(Ct,ry.members,qt);for(let i=0;i<this.symbolInstances.length;i++){const h=this.symbolInstances.get(i);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(i,h,f,g,b,w,T,P,k){const O={};for(let N=h;N<f;N++){const $=i.get(N);O.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.textFeatureIndex=$.featureIndex;break}for(let N=g;N<b;N++){const $=i.get(N);O.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.verticalTextFeatureIndex=$.featureIndex;break}for(let N=w;N<T;N++){const $=i.get(N);O.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.iconFeatureIndex=$.featureIndex;break}for(let N=P;N<k;N++){const $=i.get(N);O.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.verticalIconFeatureIndex=$.featureIndex;break}return O}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,h){const f=i.placedSymbolArray.get(h),g=f.vertexStartIndex+4*f.numGlyphs;for(let b=f.vertexStartIndex;b<g;b+=4)i.indexArray.emplaceBack(b,b+1,b+2),i.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(i),f=Math.cos(i),g=[],b=[],w=[];for(let T=0;T<this.symbolInstances.length;++T){w.push(T);const P=this.symbolInstances.get(T);g.push(0|Math.round(h*P.anchorX+f*P.anchorY)),b.push(P.featureIndex)}return w.sort((T,P)=>g[T]-g[P]||b[P]-b[T]),w}addToSortKeyRanges(i,h){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===h?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const f=this.symbolInstances.get(h);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,b,w)=>{g>=0&&w.indexOf(g)===b&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let wy,My;Ne("SymbolBucket",nh,{omit:["layers","collisionBoxArray","features","compareText"]}),nh.MAX_GLYPHS=65535,nh.addDynamicAttributes=jm;var Ym={get paint(){return My=My||new as({"icon-opacity":new ri(Pt.paint_symbol["icon-opacity"]),"icon-color":new ri(Pt.paint_symbol["icon-color"]),"icon-halo-color":new ri(Pt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ri(Pt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ri(Pt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ye(Pt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ye(Pt.paint_symbol["icon-translate-anchor"]),"text-opacity":new ri(Pt.paint_symbol["text-opacity"]),"text-color":new ri(Pt.paint_symbol["text-color"],{runtimeType:yi,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ri(Pt.paint_symbol["text-halo-color"]),"text-halo-width":new ri(Pt.paint_symbol["text-halo-width"]),"text-halo-blur":new ri(Pt.paint_symbol["text-halo-blur"]),"text-translate":new Ye(Pt.paint_symbol["text-translate"]),"text-translate-anchor":new Ye(Pt.paint_symbol["text-translate-anchor"])})},get layout(){return wy=wy||new as({"symbol-placement":new Ye(Pt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ye(Pt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ye(Pt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ri(Pt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ye(Pt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ye(Pt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ye(Pt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ye(Pt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ye(Pt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ye(Pt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ri(Pt.layout_symbol["icon-size"]),"icon-text-fit":new Ye(Pt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ye(Pt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ri(Pt.layout_symbol["icon-image"]),"icon-rotate":new ri(Pt.layout_symbol["icon-rotate"]),"icon-padding":new ri(Pt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ye(Pt.layout_symbol["icon-keep-upright"]),"icon-offset":new ri(Pt.layout_symbol["icon-offset"]),"icon-anchor":new ri(Pt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ye(Pt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ye(Pt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ye(Pt.layout_symbol["text-rotation-alignment"]),"text-field":new ri(Pt.layout_symbol["text-field"]),"text-font":new ri(Pt.layout_symbol["text-font"]),"text-size":new ri(Pt.layout_symbol["text-size"]),"text-max-width":new ri(Pt.layout_symbol["text-max-width"]),"text-line-height":new Ye(Pt.layout_symbol["text-line-height"]),"text-letter-spacing":new ri(Pt.layout_symbol["text-letter-spacing"]),"text-justify":new ri(Pt.layout_symbol["text-justify"]),"text-radial-offset":new ri(Pt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ye(Pt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ri(Pt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ri(Pt.layout_symbol["text-anchor"]),"text-max-angle":new Ye(Pt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ye(Pt.layout_symbol["text-writing-mode"]),"text-rotate":new ri(Pt.layout_symbol["text-rotate"]),"text-padding":new Ye(Pt.layout_symbol["text-padding"]),"text-keep-upright":new Ye(Pt.layout_symbol["text-keep-upright"]),"text-transform":new ri(Pt.layout_symbol["text-transform"]),"text-offset":new ri(Pt.layout_symbol["text-offset"]),"text-allow-overlap":new Ye(Pt.layout_symbol["text-allow-overlap"]),"text-overlap":new Ye(Pt.layout_symbol["text-overlap"]),"text-ignore-placement":new Ye(Pt.layout_symbol["text-ignore-placement"]),"text-optional":new Ye(Pt.layout_symbol["text-optional"])})}};class Sy{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:oi,this.defaultValue=i}evaluate(i){if(i.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(i.formattedSection))return h.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ne("FormatSectionOverride",Sy,{omit:["defaultValue"]});class Af extends Ws{constructor(i){super(i,Ym)}recalculate(i,h){if(super.recalculate(i,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const b of f)g.indexOf(b)<0&&g.push(b);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,h,f,g){const b=this.layout.get(i).evaluate(h,{},f,g),w=this._unevaluatedLayout._values[i];return w.isDataDriven()||Xi(w.value)||!b?b:function(T,P){return P.replace(/{([^{}]+)}/g,(k,O)=>T&&O in T?String(T[O]):"")}(h.properties,b)}createBucket(i){return new nh(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of Ym.paint.overridableProperties){if(!Af.hasPaintOverride(this.layout,i))continue;const h=this.paint.get(i),f=new Sy(h),g=new Do(f,h.property.specification);let b=null;b=h.value.kind==="constant"||h.value.kind==="source"?new Na("source",g):new zl("composite",g,h.value.zoomStops),this.paint._values[i]=new Hs(h.property,b,h.parameters)}}_handleOverridablePaintPropertyUpdate(i,h,f){return!(!this.layout||h.isDataDriven()||f.isDataDriven())&&Af.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,h){const f=i.get("text-field"),g=Ym.paint.properties[h];let b=!1;const w=T=>{for(const P of T)if(g.overrides&&g.overrides.hasOverride(P))return void(b=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Oi)w(f.value.value.sections);else if(f.value.kind==="source"){const T=k=>{b||(k instanceof Vs&&sn(k.value)===fe?w(k.value.sections):k instanceof Dl?w(k.sections):k.eachChild(T))},P=f.value;P._styleExpression&&T(P._styleExpression.expression)}return b}}let Ay;var jM={get paint(){return Ay=Ay||new as({"background-color":new Ye(Pt.paint_background["background-color"]),"background-pattern":new zc(Pt.paint_background["background-pattern"]),"background-opacity":new Ye(Pt.paint_background["background-opacity"])})}};class ZM extends Ws{constructor(i){super(i,jM)}}let Ty;var XM={get paint(){return Ty=Ty||new as({"raster-opacity":new Ye(Pt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ye(Pt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ye(Pt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ye(Pt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ye(Pt.paint_raster["raster-saturation"]),"raster-contrast":new Ye(Pt.paint_raster["raster-contrast"]),"raster-resampling":new Ye(Pt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ye(Pt.paint_raster["raster-fade-duration"])})}};class YM extends Ws{constructor(i){super(i,XM)}}class JM extends Ws{constructor(i){super(i,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class KM{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Jm=63710088e-1;class to{constructor(i,h){if(isNaN(i)||isNaN(h))throw new Error(`Invalid LngLat object: (${i}, ${h})`);if(this.lng=+i,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new to(nt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const h=Math.PI/180,f=this.lat*h,g=i.lat*h,b=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((i.lng-this.lng)*h);return Jm*Math.acos(Math.min(b,1))}static convert(i){if(i instanceof to)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new to(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new to(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ey=2*Math.PI*Jm;function Cy(r){return Ey*Math.cos(r*Math.PI/180)}function Iy(r){return(180+r)/360}function Py(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Ly(r,i){return r/Cy(i)}function Km(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Tf{constructor(i,h,f=0){this.x=+i,this.y=+h,this.z=+f}static fromLngLat(i,h=0){const f=to.convert(i);return new Tf(Iy(f.lng),Py(f.lat),Ly(h,f.lat))}toLngLat(){return new to(360*this.x-180,Km(this.y))}toAltitude(){return this.z*Cy(Km(this.y))}meterInMercatorCoordinateUnits(){return 1/Ey*(i=Km(this.y),1/Math.cos(i*Math.PI/180));var i}}function Ry(r,i,h){var f=2*Math.PI*6378137/256/Math.pow(2,h);return[r*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class Qm{constructor(i,h,f){if(i<0||i>25||f<0||f>=Math.pow(2,i)||h<0||h>=Math.pow(2,i))throw new Error(`x=${h}, y=${f}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=h,this.y=f,this.key=ou(0,i,i,h,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,h,f){const g=(w=this.y,T=this.z,P=Ry(256*(b=this.x),256*(w=Math.pow(2,T)-w-1),T),k=Ry(256*(b+1),256*(w+1),T),P[0]+","+P[1]+","+k[0]+","+k[1]);var b,w,T,P,k;const O=function(N,$,X){let J,st="";for(let ct=N;ct>0;ct--)J=1<<ct-1,st+=($&J?1:0)+(X&J?2:0);return st}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const h=this.z-i.z;return h>0&&i.x===this.x>>h&&i.y===this.y>>h}getTilePoint(i){const h=Math.pow(2,this.z);return new M((i.x*h-this.x)*Ti,(i.y*h-this.y)*Ti)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dy{constructor(i,h){this.wrap=i,this.canonical=h,this.key=ou(i,h.z,h.z,h.x,h.y)}}class Zs{constructor(i,h,f,g,b){if(i<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${f}`);this.overscaledZ=i,this.wrap=h,this.canonical=new Qm(f,+g,+b),this.key=ou(h,i,f,g,b)}clone(){return new Zs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-i;return i>this.canonical.z?new Zs(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zs(i,this.wrap,i,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(i,h){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-i;return i>this.canonical.z?ou(this.wrap*+h,i,this.canonical.z,this.canonical.x,this.canonical.y):ou(this.wrap*+h,i,i,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const h=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>h&&i.canonical.y===this.canonical.y>>h}children(i){if(this.overscaledZ>=i)return[new Zs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new Zs(h,this.wrap,h,f,g),new Zs(h,this.wrap,h,f+1,g),new Zs(h,this.wrap,h,f,g+1),new Zs(h,this.wrap,h,f+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Zs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Zs(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Tf(i.x-this.wrap,i.y))}}function ou(r,i,h,f,g){(r*=2)<0&&(r=-1*r-1);const b=1<<h;return(b*b*r+b*g+f).toString(36)+h.toString(36)+i.toString(36)}Ne("CanonicalTileID",Qm),Ne("OverscaledTileID",Zs,{omit:["posMatrix"]});class zy{constructor(i,h,f,g=1,b=1,w=1,T=0){if(this.uid=i,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void It(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const P=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=b,this.blueFactor=w,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<P;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(P,k)]=this.data[this._idx(P-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,P)]=this.data[this._idx(k,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<P;k++)for(let O=0;O<P;O++){const N=this.get(k,O);N>this.max&&(this.max=N),N<this.min&&(this.min=N)}}get(i,h){const f=new Uint8Array(this.data.buffer),g=4*this._idx(i,h);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,h){if(i<-1||i>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(i+1)}unpack(i,h,f){return i*this.redFactor+h*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new js({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,h,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=h*this.dim,b=h*this.dim+this.dim,w=f*this.dim,T=f*this.dim+this.dim;switch(h){case-1:g=b-1;break;case 1:b=g+1}switch(f){case-1:w=T-1;break;case 1:T=w+1}const P=-h*this.dim,k=-f*this.dim;for(let O=w;O<T;O++)for(let N=g;N<b;N++)this.data[this._idx(N,O)]=i.data[this._idx(N+P,O+k)]}}Ne("DEMData",zy);class ky{constructor(i){this._stringToNumber={},this._numberToString=[];for(let h=0;h<i.length;h++){const f=i[h];this._stringToNumber[f]=h,this._numberToString[h]=f}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class Fy{constructor(i,h,f,g,b){this.type="Feature",this._vectorTileFeature=i,i._z=h,i._x=f,i._y=g,this.properties=i.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(i[h]=this[h]);return i}}class By{constructor(i,h){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new _r(Ti,16,0),this.grid3D=new _r(Ti,16,0),this.featureIndexArray=new B,this.promoteId=h}insert(i,h,f,g,b,w){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,b);const P=w?this.grid3D:this.grid;for(let k=0;k<h.length;k++){const O=h[k],N=[1/0,1/0,-1/0,-1/0];for(let $=0;$<O.length;$++){const X=O[$];N[0]=Math.min(N[0],X.x),N[1]=Math.min(N[1],X.y),N[2]=Math.max(N[2],X.x),N[3]=Math.max(N[3],X.y)}N[0]<Ti&&N[1]<Ti&&N[2]>=0&&N[3]>=0&&P.insert(T,N[0],N[1],N[2],N[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ja.VectorTile(new Vm(this.rawTileData)).layers,this.sourceLayerCoder=new ky(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,h,f,g){this.loadVTLayers();const b=i.params||{},w=Ti/i.tileSize/i.scale,T=Bl(b.filter),P=i.queryGeometry,k=i.queryPadding*w,O=Ny(P),N=this.grid.query(O.minX-k,O.minY-k,O.maxX+k,O.maxY+k),$=Ny(i.cameraQueryGeometry),X=this.grid3D.query($.minX-k,$.minY-k,$.maxX+k,$.maxY+k,(ct,_t,Lt,xt)=>function(Et,Xt,te,Le,qe){for(const Te of Et)if(Xt<=Te.x&&te<=Te.y&&Le>=Te.x&&qe>=Te.y)return!0;const Ie=[new M(Xt,te),new M(Xt,qe),new M(Le,qe),new M(Le,te)];if(Et.length>2){for(const Te of Ie)if(Yl(Et,Te))return!0}for(let Te=0;Te<Et.length-1;Te++)if(Pw(Et[Te],Et[Te+1],Ie))return!0;return!1}(i.cameraQueryGeometry,ct-k,_t-k,Lt+k,xt+k));for(const ct of X)N.push(ct);N.sort(QM);const J={};let st;for(let ct=0;ct<N.length;ct++){const _t=N[ct];if(_t===st)continue;st=_t;const Lt=this.featureIndexArray.get(_t);let xt=null;this.loadMatchingFeature(J,Lt.bucketIndex,Lt.sourceLayerIndex,Lt.featureIndex,T,b.layers,b.availableImages,h,f,g,(Et,Xt,te)=>(xt||(xt=ha(Et)),Xt.queryIntersectsFeature(P,Et,te,xt,this.z,i.transform,w,i.pixelPosMatrix)))}return J}loadMatchingFeature(i,h,f,g,b,w,T,P,k,O,N){const $=this.bucketLayerIDs[h];if(w&&!function(ct,_t){for(let Lt=0;Lt<ct.length;Lt++)if(_t.indexOf(ct[Lt])>=0)return!0;return!1}(w,$))return;const X=this.sourceLayerCoder.decode(f),J=this.vtLayers[X].feature(g);if(b.needGeometry){const ct=ca(J,!0);if(!b.filter(new Ki(this.tileID.overscaledZ),ct,this.tileID.canonical))return}else if(!b.filter(new Ki(this.tileID.overscaledZ),J))return;const st=this.getId(J,X);for(let ct=0;ct<$.length;ct++){const _t=$[ct];if(w&&w.indexOf(_t)<0)continue;const Lt=P[_t];if(!Lt)continue;let xt={};st&&O&&(xt=O.getState(Lt.sourceLayer||"_geojsonTileLayer",st));const Et=pt({},k[_t]);Et.paint=Oy(Et.paint,Lt.paint,J,xt,T),Et.layout=Oy(Et.layout,Lt.layout,J,xt,T);const Xt=!N||N(J,Lt,xt);if(!Xt)continue;const te=new Fy(J,this.z,this.x,this.y,st);te.layer=Et;let Le=i[_t];Le===void 0&&(Le=i[_t]=[]),Le.push({featureIndex:g,feature:te,intersectionZ:Xt})}}lookupSymbolFeatures(i,h,f,g,b,w,T,P){const k={};this.loadVTLayers();const O=Bl(b);for(const N of i)this.loadMatchingFeature(k,f,g,N,O,w,T,P,h);return k}hasLayer(i){for(const h of this.bucketLayerIDs)for(const f of h)if(i===f)return!0;return!1}getId(i,h){let f=i.id;return this.promoteId&&(f=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof f=="boolean"&&(f=Number(f))),f}}function Oy(r,i,h,f,g){return K(r,(b,w)=>{const T=i instanceof Oo?i.get(w):null;return T&&T.evaluate?T.evaluate(h,f,g):T})}function Ny(r){let i=1/0,h=1/0,f=-1/0,g=-1/0;for(const b of r)i=Math.min(i,b.x),h=Math.min(h,b.y),f=Math.max(f,b.x),g=Math.max(g,b.y);return{minX:i,minY:h,maxX:f,maxY:g}}function QM(r,i){return i-r}function Uy(r,i,h,f,g){const b=[];for(let w=0;w<r.length;w++){const T=r[w];let P;for(let k=0;k<T.length-1;k++){let O=T[k],N=T[k+1];O.x<i&&N.x<i||(O.x<i?O=new M(i,O.y+(i-O.x)/(N.x-O.x)*(N.y-O.y))._round():N.x<i&&(N=new M(i,O.y+(i-O.x)/(N.x-O.x)*(N.y-O.y))._round()),O.y<h&&N.y<h||(O.y<h?O=new M(O.x+(h-O.y)/(N.y-O.y)*(N.x-O.x),h)._round():N.y<h&&(N=new M(O.x+(h-O.y)/(N.y-O.y)*(N.x-O.x),h)._round()),O.x>=f&&N.x>=f||(O.x>=f?O=new M(f,O.y+(f-O.x)/(N.x-O.x)*(N.y-O.y))._round():N.x>=f&&(N=new M(f,O.y+(f-O.x)/(N.x-O.x)*(N.y-O.y))._round()),O.y>=g&&N.y>=g||(O.y>=g?O=new M(O.x+(g-O.y)/(N.y-O.y)*(N.x-O.x),g)._round():N.y>=g&&(N=new M(O.x+(g-O.y)/(N.y-O.y)*(N.x-O.x),g)._round()),P&&O.equals(P[P.length-1])||(P=[O],b.push(P)),P.push(N)))))}}return b}Ne("FeatureIndex",By,{omit:["rawTileData","sourceLayerCoder"]});class eo extends M{constructor(i,h,f,g){super(i,h),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new eo(this.x,this.y,this.angle,this.segment)}}function Vy(r,i,h,f,g){if(i.segment===void 0||h===0)return!0;let b=i,w=i.segment+1,T=0;for(;T>-h/2;){if(w--,w<0)return!1;T-=r[w].dist(b),b=r[w]}T+=r[w].dist(r[w+1]),w++;const P=[];let k=0;for(;T<h/2;){const O=r[w],N=r[w+1];if(!N)return!1;let $=r[w-1].angleTo(O)-O.angleTo(N);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:T,angleDelta:$}),k+=$;T-P[0].distance>f;)k-=P.shift().angleDelta;if(k>g)return!1;w++,T+=O.dist(N)}return!0}function Gy(r){let i=0;for(let h=0;h<r.length-1;h++)i+=r[h].dist(r[h+1]);return i}function Hy(r,i,h){return r?.6*i*h:0}function Wy(r,i){return Math.max(r?r.right-r.left:0,i?i.right-i.left:0)}function tS(r,i,h,f,g,b){const w=Hy(h,g,b),T=Wy(h,f)*b;let P=0;const k=Gy(r)/2;for(let O=0;O<r.length-1;O++){const N=r[O],$=r[O+1],X=N.dist($);if(P+X>k){const J=(k-P)/X,st=vs.number(N.x,$.x,J),ct=vs.number(N.y,$.y,J),_t=new eo(st,ct,$.angleTo(N),O);return _t._round(),!w||Vy(r,_t,T,w,i)?_t:void 0}P+=X}}function eS(r,i,h,f,g,b,w,T,P){const k=Hy(f,b,w),O=Wy(f,g),N=O*w,$=r[0].x===0||r[0].x===P||r[0].y===0||r[0].y===P;return i-N<i/4&&(i=N+i/4),qy(r,$?i/2*T%i:(O/2+2*b)*w*T%i,i,k,h,N,$,!1,P)}function qy(r,i,h,f,g,b,w,T,P){const k=b/2,O=Gy(r);let N=0,$=i-h,X=[];for(let J=0;J<r.length-1;J++){const st=r[J],ct=r[J+1],_t=st.dist(ct),Lt=ct.angleTo(st);for(;$+h<N+_t;){$+=h;const xt=($-N)/_t,Et=vs.number(st.x,ct.x,xt),Xt=vs.number(st.y,ct.y,xt);if(Et>=0&&Et<P&&Xt>=0&&Xt<P&&$-k>=0&&$+k<=O){const te=new eo(Et,Xt,Lt,J);te._round(),f&&!Vy(r,te,b,f,g)||X.push(te)}}N+=_t}return T||X.length||w||(X=qy(r,N/2,h,f,g,b,w,!0,P)),X}Ne("Anchor",eo);const sh=ws;function $y(r,i,h,f){const g=[],b=r.image,w=b.pixelRatio,T=b.paddedRect.w-2*sh,P=b.paddedRect.h-2*sh,k=r.right-r.left,O=r.bottom-r.top,N=b.stretchX||[[0,T]],$=b.stretchY||[[0,P]],X=(ve,Ve)=>ve+Ve[1]-Ve[0],J=N.reduce(X,0),st=$.reduce(X,0),ct=T-J,_t=P-st;let Lt=0,xt=J,Et=0,Xt=st,te=0,Le=ct,qe=0,Ie=_t;if(b.content&&f){const ve=b.content;Lt=Ef(N,0,ve[0]),Et=Ef($,0,ve[1]),xt=Ef(N,ve[0],ve[2]),Xt=Ef($,ve[1],ve[3]),te=ve[0]-Lt,qe=ve[1]-Et,Le=ve[2]-ve[0]-xt,Ie=ve[3]-ve[1]-Xt}const Te=(ve,Ve,Ae,ue)=>{const ti=Cf(ve.stretch-Lt,xt,k,r.left),Ze=If(ve.fixed-te,Le,ve.stretch,J),Ai=Cf(Ve.stretch-Et,Xt,O,r.top),tn=If(Ve.fixed-qe,Ie,Ve.stretch,st),nn=Cf(Ae.stretch-Lt,xt,k,r.left),An=If(Ae.fixed-te,Le,Ae.stretch,J),Ds=Cf(ue.stretch-Et,Xt,O,r.top),hs=If(ue.fixed-qe,Ie,ue.stretch,st),xn=new M(ti,Ai),Un=new M(nn,Ai),Zn=new M(nn,Ds),cs=new M(ti,Ds),us=new M(Ze/w,tn/w),Tn=new M(An/w,hs/w),En=i*Math.PI/180;if(En){const Qn=Math.sin(En),Ms=Math.cos(En),Ss=[Ms,-Qn,Qn,Ms];xn._matMult(Ss),Un._matMult(Ss),cs._matMult(Ss),Zn._matMult(Ss)}const Kn=ve.stretch+ve.fixed,ds=Ve.stretch+Ve.fixed;return{tl:xn,tr:Un,bl:cs,br:Zn,tex:{x:b.paddedRect.x+sh+Kn,y:b.paddedRect.y+sh+ds,w:Ae.stretch+Ae.fixed-Kn,h:ue.stretch+ue.fixed-ds},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:us,pixelOffsetBR:Tn,minFontScaleX:Le/w/k,minFontScaleY:Ie/w/O,isSDF:h}};if(f&&(b.stretchX||b.stretchY)){const ve=jy(N,ct,J),Ve=jy($,_t,st);for(let Ae=0;Ae<ve.length-1;Ae++){const ue=ve[Ae],ti=ve[Ae+1];for(let Ze=0;Ze<Ve.length-1;Ze++)g.push(Te(ue,Ve[Ze],ti,Ve[Ze+1]))}}else g.push(Te({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:P+1}));return g}function Ef(r,i,h){let f=0;for(const g of r)f+=Math.max(i,Math.min(h,g[1]))-Math.max(i,Math.min(h,g[0]));return f}function jy(r,i,h){const f=[{fixed:-sh,stretch:0}];for(const[g,b]of r){const w=f[f.length-1];f.push({fixed:g-w.stretch,stretch:w.stretch}),f.push({fixed:g-w.stretch,stretch:w.stretch+(b-g)})}return f.push({fixed:i+sh,stretch:h}),f}function Cf(r,i,h,f){return r/i*h+f}function If(r,i,h,f){return r-i*h/f}class Pf{constructor(i,h,f,g,b,w,T,P,k,O){if(this.boxStartIndex=i.length,k){let N=w.top,$=w.bottom;const X=w.collisionPadding;X&&(N-=X[1],$+=X[3]);let J=$-N;J>0&&(J=Math.max(10,J),this.circleDiameter=J)}else{let N=w.top*T-P[0],$=w.bottom*T+P[2],X=w.left*T-P[3],J=w.right*T+P[1];const st=w.collisionPadding;if(st&&(X-=st[0]*T,N-=st[1]*T,J+=st[2]*T,$+=st[3]*T),O){const ct=new M(X,N),_t=new M(J,N),Lt=new M(X,$),xt=new M(J,$),Et=O*Math.PI/180;ct._rotate(Et),_t._rotate(Et),Lt._rotate(Et),xt._rotate(Et),X=Math.min(ct.x,_t.x,Lt.x,xt.x),J=Math.max(ct.x,_t.x,Lt.x,xt.x),N=Math.min(ct.y,_t.y,Lt.y,xt.y),$=Math.max(ct.y,_t.y,Lt.y,xt.y)}i.emplaceBack(h.x,h.y,X,N,J,$,f,g,b)}this.boxEndIndex=i.length}}class iS{constructor(i=[],h=nS){if(this.data=i,this.length=this.data.length,this.compare=h,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:h,compare:f}=this,g=h[i];for(;i>0;){const b=i-1>>1,w=h[b];if(f(g,w)>=0)break;h[i]=w,i=b}h[i]=g}_down(i){const{data:h,compare:f}=this,g=this.length>>1,b=h[i];for(;i<g;){let w=1+(i<<1),T=h[w];const P=w+1;if(P<this.length&&f(h[P],T)<0&&(w=P,T=h[P]),f(T,b)>=0)break;h[i]=T,i=w}h[i]=b}}function nS(r,i){return r<i?-1:r>i?1:0}function sS(r,i=1,h=!1){let f=1/0,g=1/0,b=-1/0,w=-1/0;const T=r[0];for(let X=0;X<T.length;X++){const J=T[X];(!X||J.x<f)&&(f=J.x),(!X||J.y<g)&&(g=J.y),(!X||J.x>b)&&(b=J.x),(!X||J.y>w)&&(w=J.y)}const P=Math.min(b-f,w-g);let k=P/2;const O=new iS([],rS);if(P===0)return new M(f,g);for(let X=f;X<b;X+=P)for(let J=g;J<w;J+=P)O.push(new rh(X+k,J+k,k,r));let N=function(X){let J=0,st=0,ct=0;const _t=X[0];for(let Lt=0,xt=_t.length,Et=xt-1;Lt<xt;Et=Lt++){const Xt=_t[Lt],te=_t[Et],Le=Xt.x*te.y-te.x*Xt.y;st+=(Xt.x+te.x)*Le,ct+=(Xt.y+te.y)*Le,J+=3*Le}return new rh(st/J,ct/J,0,X)}(r),$=O.length;for(;O.length;){const X=O.pop();(X.d>N.d||!N.d)&&(N=X,h&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,$)),X.max-N.d<=i||(k=X.h/2,O.push(new rh(X.p.x-k,X.p.y-k,k,r)),O.push(new rh(X.p.x+k,X.p.y-k,k,r)),O.push(new rh(X.p.x-k,X.p.y+k,k,r)),O.push(new rh(X.p.x+k,X.p.y+k,k,r)),$+=4)}return h&&(console.log(`num probes: ${$}`),console.log(`best distance: ${N.d}`)),N.p}function rS(r,i){return i.max-r.max}function rh(r,i,h,f){this.p=new M(r,i),this.h=h,this.d=function(g,b){let w=!1,T=1/0;for(let P=0;P<b.length;P++){const k=b[P];for(let O=0,N=k.length,$=N-1;O<N;$=O++){const X=k[O],J=k[$];X.y>g.y!=J.y>g.y&&g.x<(J.x-X.x)*(g.y-X.y)/(J.y-X.y)+X.x&&(w=!w),T=Math.min(T,P0(g,X,J))}}return(w?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var jn;d.ap=void 0,(jn=d.ap||(d.ap={}))[jn.center=1]="center",jn[jn.left=2]="left",jn[jn.right=3]="right",jn[jn.top=4]="top",jn[jn.bottom=5]="bottom",jn[jn["top-left"]=6]="top-left",jn[jn["top-right"]=7]="top-right",jn[jn["bottom-left"]=8]="bottom-left",jn[jn["bottom-right"]=9]="bottom-right";const io=7,tg=Number.POSITIVE_INFINITY;function Zy(r,i){return i[1]!==tg?function(h,f,g){let b=0,w=0;switch(f=Math.abs(f),g=Math.abs(g),h){case"top-right":case"top-left":case"top":w=g-io;break;case"bottom-right":case"bottom-left":case"bottom":w=-g+io}switch(h){case"top-right":case"bottom-right":case"right":b=-f;break;case"top-left":case"bottom-left":case"left":b=f}return[b,w]}(r,i[0],i[1]):function(h,f){let g=0,b=0;f<0&&(f=0);const w=f/Math.SQRT2;switch(h){case"top-right":case"top-left":b=w-io;break;case"bottom-right":case"bottom-left":b=-w+io;break;case"bottom":b=-f+io;break;case"top":b=f-io}switch(h){case"top-right":case"bottom-right":g=-w;break;case"top-left":case"bottom-left":g=w;break;case"left":g=f;break;case"right":g=-f}return[g,b]}(r,i[0])}function Xy(r,i,h){var f;const g=r.layout,b=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(i,{},h);if(b){const T=b.values,P=[];for(let k=0;k<T.length;k+=2){const O=P[k]=T[k],N=T[k+1].map($=>$*Sn);O.startsWith("top")?N[1]-=io:O.startsWith("bottom")&&(N[1]+=io),P[k+1]=N}return new cn(P)}const w=g.get("text-variable-anchor");if(w){let T;T=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},h)*Sn,tg]:g.get("text-offset").evaluate(i,{},h).map(k=>k*Sn);const P=[];for(const k of w)P.push(k,Zy(k,T));return new cn(P)}return null}function eg(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function aS(r,i,h,f,g,b,w,T,P,k,O){let N=b.textMaxSize.evaluate(i,{});N===void 0&&(N=w);const $=r.layers[0].layout,X=$.get("icon-offset").evaluate(i,{},O),J=Jy(h.horizontal),st=w/24,ct=r.tilePixelRatio*st,_t=r.tilePixelRatio*N/24,Lt=r.tilePixelRatio*T,xt=r.tilePixelRatio*$.get("symbol-spacing"),Et=$.get("text-padding")*r.tilePixelRatio,Xt=function(ue,ti,Ze,Ai=1){const tn=ue.get("icon-padding").evaluate(ti,{},Ze),nn=tn&&tn.values;return[nn[0]*Ai,nn[1]*Ai,nn[2]*Ai,nn[3]*Ai]}($,i,O,r.tilePixelRatio),te=$.get("text-max-angle")/180*Math.PI,Le=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",qe=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Ie=$.get("symbol-placement"),Te=xt/2,ve=$.get("icon-text-fit");let Ve;f&&ve!=="none"&&(r.allowVerticalPlacement&&h.vertical&&(Ve=xy(f,h.vertical,ve,$.get("icon-text-fit-padding"),X,st)),J&&(f=xy(f,J,ve,$.get("icon-text-fit-padding"),X,st)));const Ae=(ue,ti)=>{ti.x<0||ti.x>=Ti||ti.y<0||ti.y>=Ti||function(Ze,Ai,tn,nn,An,Ds,hs,xn,Un,Zn,cs,us,Tn,En,Kn,ds,Qn,Ms,Ss,Cn,Ci,ts,Xn,In,cr){const vr=Ze.addToLineVertexArray(Ai,tn);let xr,fa,ur,Xs,As=0,pa=0,cu=0,ev=0,hg=-1,cg=-1;const ma={};let iv=wi("");if(Ze.allowVerticalPlacement&&nn.vertical){const es=xn.layout.get("text-rotate").evaluate(Ci,{},In)+90;ur=new Pf(Un,Ai,Zn,cs,us,nn.vertical,Tn,En,Kn,es),hs&&(Xs=new Pf(Un,Ai,Zn,cs,us,hs,Qn,Ms,Kn,es))}if(An){const es=xn.layout.get("icon-rotate").evaluate(Ci,{}),Ys=xn.layout.get("icon-text-fit")!=="none",$o=$y(An,es,Xn,Ys),wr=hs?$y(hs,es,Xn,Ys):void 0;fa=new Pf(Un,Ai,Zn,cs,us,An,Qn,Ms,!1,es),As=4*$o.length;const jo=Ze.iconSizeData;let Or=null;jo.kind==="source"?(Or=[Br*xn.layout.get("icon-size").evaluate(Ci,{})],Or[0]>Qa&&It(`${Ze.layerIds[0]}: Value for "icon-size" is >= ${au}. Reduce your "icon-size".`)):jo.kind==="composite"&&(Or=[Br*ts.compositeIconSizes[0].evaluate(Ci,{},In),Br*ts.compositeIconSizes[1].evaluate(Ci,{},In)],(Or[0]>Qa||Or[1]>Qa)&&It(`${Ze.layerIds[0]}: Value for "icon-size" is >= ${au}. Reduce your "icon-size".`)),Ze.addSymbols(Ze.icon,$o,Or,Cn,Ss,Ci,d.ah.none,Ai,vr.lineStartIndex,vr.lineLength,-1,In),hg=Ze.icon.placedSymbolArray.length-1,wr&&(pa=4*wr.length,Ze.addSymbols(Ze.icon,wr,Or,Cn,Ss,Ci,d.ah.vertical,Ai,vr.lineStartIndex,vr.lineLength,-1,In),cg=Ze.icon.placedSymbolArray.length-1)}const nv=Object.keys(nn.horizontal);for(const es of nv){const Ys=nn.horizontal[es];if(!xr){iv=wi(Ys.text);const wr=xn.layout.get("text-rotate").evaluate(Ci,{},In);xr=new Pf(Un,Ai,Zn,cs,us,Ys,Tn,En,Kn,wr)}const $o=Ys.positionedLines.length===1;if(cu+=Yy(Ze,Ai,Ys,Ds,xn,Kn,Ci,ds,vr,nn.vertical?d.ah.horizontal:d.ah.horizontalOnly,$o?nv:[es],ma,hg,ts,In),$o)break}nn.vertical&&(ev+=Yy(Ze,Ai,nn.vertical,Ds,xn,Kn,Ci,ds,vr,d.ah.vertical,["vertical"],ma,cg,ts,In));const hS=xr?xr.boxStartIndex:Ze.collisionBoxArray.length,cS=xr?xr.boxEndIndex:Ze.collisionBoxArray.length,uS=ur?ur.boxStartIndex:Ze.collisionBoxArray.length,dS=ur?ur.boxEndIndex:Ze.collisionBoxArray.length,fS=fa?fa.boxStartIndex:Ze.collisionBoxArray.length,pS=fa?fa.boxEndIndex:Ze.collisionBoxArray.length,mS=Xs?Xs.boxStartIndex:Ze.collisionBoxArray.length,gS=Xs?Xs.boxEndIndex:Ze.collisionBoxArray.length;let br=-1;const Rf=(es,Ys)=>es&&es.circleDiameter?Math.max(es.circleDiameter,Ys):Ys;br=Rf(xr,br),br=Rf(ur,br),br=Rf(fa,br),br=Rf(Xs,br);const sv=br>-1?1:0;sv&&(br*=cr/Sn),Ze.glyphOffsetArray.length>=nh.MAX_GLYPHS&&It("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ci.sortKey!==void 0&&Ze.addToSortKeyRanges(Ze.symbolInstances.length,Ci.sortKey);const _S=Xy(xn,Ci,In),[yS,vS]=function(es,Ys){const $o=es.length,wr=Ys==null?void 0:Ys.values;if((wr==null?void 0:wr.length)>0)for(let jo=0;jo<wr.length;jo+=2){const Or=wr[jo+1];es.emplaceBack(d.ap[wr[jo]],Or[0],Or[1])}return[$o,es.length]}(Ze.textAnchorOffsets,_S);Ze.symbolInstances.emplaceBack(Ai.x,Ai.y,ma.right>=0?ma.right:-1,ma.center>=0?ma.center:-1,ma.left>=0?ma.left:-1,ma.vertical||-1,hg,cg,iv,hS,cS,uS,dS,fS,pS,mS,gS,Zn,cu,ev,As,pa,sv,0,Tn,br,yS,vS)}(r,ti,ue,h,f,g,Ve,r.layers[0],r.collisionBoxArray,i.index,i.sourceLayerIndex,r.index,ct,[Et,Et,Et,Et],Le,P,Lt,Xt,qe,X,i,b,k,O,w)};if(Ie==="line")for(const ue of Uy(i.geometry,0,0,Ti,Ti)){const ti=eS(ue,xt,te,h.vertical||J,f,24,_t,r.overscaling,Ti);for(const Ze of ti)J&&oS(r,J.text,Te,Ze)||Ae(ue,Ze)}else if(Ie==="line-center"){for(const ue of i.geometry)if(ue.length>1){const ti=tS(ue,te,h.vertical||J,f,24,_t);ti&&Ae(ue,ti)}}else if(i.type==="Polygon")for(const ue of Dm(i.geometry,0)){const ti=sS(ue,16);Ae(ue[0],new eo(ti.x,ti.y,0))}else if(i.type==="LineString")for(const ue of i.geometry)Ae(ue,new eo(ue[0].x,ue[0].y,0));else if(i.type==="Point")for(const ue of i.geometry)for(const ti of ue)Ae([ti],new eo(ti.x,ti.y,0))}function Yy(r,i,h,f,g,b,w,T,P,k,O,N,$,X,J){const st=function(Lt,xt,Et,Xt,te,Le,qe,Ie){const Te=Xt.layout.get("text-rotate").evaluate(Le,{})*Math.PI/180,ve=[];for(const Ve of xt.positionedLines)for(const Ae of Ve.positionedGlyphs){if(!Ae.rect)continue;const ue=Ae.rect||{};let ti=fy+1,Ze=!0,Ai=1,tn=0;const nn=(te||Ie)&&Ae.vertical,An=Ae.metrics.advance*Ae.scale/2;if(Ie&&xt.verticalizable&&(tn=Ve.lineOffset/2-(Ae.imageName?-(Sn-Ae.metrics.width*Ae.scale)/2:(Ae.scale-1)*Sn)),Ae.imageName){const Cn=qe[Ae.imageName];Ze=Cn.sdf,Ai=Cn.pixelRatio,ti=ws/Ai}const Ds=te?[Ae.x+An,Ae.y]:[0,0];let hs=te?[0,0]:[Ae.x+An+Et[0],Ae.y+Et[1]-tn],xn=[0,0];nn&&(xn=hs,hs=[0,0]);const Un=Ae.metrics.isDoubleResolution?2:1,Zn=(Ae.metrics.left-ti)*Ae.scale-An+hs[0],cs=(-Ae.metrics.top-ti)*Ae.scale+hs[1],us=Zn+ue.w/Un*Ae.scale/Ai,Tn=cs+ue.h/Un*Ae.scale/Ai,En=new M(Zn,cs),Kn=new M(us,cs),ds=new M(Zn,Tn),Qn=new M(us,Tn);if(nn){const Cn=new M(-An,An-su),Ci=-Math.PI/2,ts=Sn/2-An,Xn=new M(5-su-ts,-(Ae.imageName?ts:0)),In=new M(...xn);En._rotateAround(Ci,Cn)._add(Xn)._add(In),Kn._rotateAround(Ci,Cn)._add(Xn)._add(In),ds._rotateAround(Ci,Cn)._add(Xn)._add(In),Qn._rotateAround(Ci,Cn)._add(Xn)._add(In)}if(Te){const Cn=Math.sin(Te),Ci=Math.cos(Te),ts=[Ci,-Cn,Cn,Ci];En._matMult(ts),Kn._matMult(ts),ds._matMult(ts),Qn._matMult(ts)}const Ms=new M(0,0),Ss=new M(0,0);ve.push({tl:En,tr:Kn,bl:ds,br:Qn,tex:ue,writingMode:xt.writingMode,glyphOffset:Ds,sectionIndex:Ae.sectionIndex,isSDF:Ze,pixelOffsetTL:Ms,pixelOffsetBR:Ss,minFontScaleX:0,minFontScaleY:0})}return ve}(0,h,T,g,b,w,f,r.allowVerticalPlacement),ct=r.textSizeData;let _t=null;ct.kind==="source"?(_t=[Br*g.layout.get("text-size").evaluate(w,{})],_t[0]>Qa&&It(`${r.layerIds[0]}: Value for "text-size" is >= ${au}. Reduce your "text-size".`)):ct.kind==="composite"&&(_t=[Br*X.compositeTextSizes[0].evaluate(w,{},J),Br*X.compositeTextSizes[1].evaluate(w,{},J)],(_t[0]>Qa||_t[1]>Qa)&&It(`${r.layerIds[0]}: Value for "text-size" is >= ${au}. Reduce your "text-size".`)),r.addSymbols(r.text,st,_t,T,b,w,k,i,P.lineStartIndex,P.lineLength,$,J);for(const Lt of O)N[Lt]=r.text.placedSymbolArray.length-1;return 4*st.length}function Jy(r){for(const i in r)return r[i];return null}function oS(r,i,h,f){const g=r.compareText;if(i in g){const b=g[i];for(let w=b.length-1;w>=0;w--)if(f.dist(b[w])<h)return!0}else g[i]=[];return g[i].push(f),!1}const Ky=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ig{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,f]=new Uint8Array(i,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const b=Ky[15&f];if(!b)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(i,2,1),[T]=new Uint32Array(i,4,1);return new ig(T,w,b,i)}constructor(i,h=64,f=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=f,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const b=Ky.indexOf(this.ArrayType),w=2*i*this.ArrayType.BYTES_PER_ELEMENT,T=i*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-T%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+P,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+w+T+P),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+P,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=i)}add(i,h){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=i,this.coords[this._pos++]=h,f}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return ng(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,h,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:w,nodeSize:T}=this,P=[0,b.length-1,0],k=[];for(;P.length;){const O=P.pop()||0,N=P.pop()||0,$=P.pop()||0;if(N-$<=T){for(let ct=$;ct<=N;ct++){const _t=w[2*ct],Lt=w[2*ct+1];_t>=i&&_t<=f&&Lt>=h&&Lt<=g&&k.push(b[ct])}continue}const X=$+N>>1,J=w[2*X],st=w[2*X+1];J>=i&&J<=f&&st>=h&&st<=g&&k.push(b[X]),(O===0?i<=J:h<=st)&&(P.push($),P.push(X-1),P.push(1-O)),(O===0?f>=J:g>=st)&&(P.push(X+1),P.push(N),P.push(1-O))}return k}within(i,h,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:b,nodeSize:w}=this,T=[0,g.length-1,0],P=[],k=f*f;for(;T.length;){const O=T.pop()||0,N=T.pop()||0,$=T.pop()||0;if(N-$<=w){for(let ct=$;ct<=N;ct++)tv(b[2*ct],b[2*ct+1],i,h)<=k&&P.push(g[ct]);continue}const X=$+N>>1,J=b[2*X],st=b[2*X+1];tv(J,st,i,h)<=k&&P.push(g[X]),(O===0?i-f<=J:h-f<=st)&&(T.push($),T.push(X-1),T.push(1-O)),(O===0?i+f>=J:h+f>=st)&&(T.push(X+1),T.push(N),T.push(1-O))}return P}}function ng(r,i,h,f,g,b){if(g-f<=h)return;const w=f+g>>1;Qy(r,i,w,f,g,b),ng(r,i,h,f,w-1,1-b),ng(r,i,h,w+1,g,1-b)}function Qy(r,i,h,f,g,b){for(;g>f;){if(g-f>600){const k=g-f+1,O=h-f+1,N=Math.log(k),$=.5*Math.exp(2*N/3),X=.5*Math.sqrt(N*$*(k-$)/k)*(O-k/2<0?-1:1);Qy(r,i,h,Math.max(f,Math.floor(h-O*$/k+X)),Math.min(g,Math.floor(h+(k-O)*$/k+X)),b)}const w=i[2*h+b];let T=f,P=g;for(lu(r,i,f,h),i[2*g+b]>w&&lu(r,i,f,g);T<P;){for(lu(r,i,T,P),T++,P--;i[2*T+b]<w;)T++;for(;i[2*P+b]>w;)P--}i[2*f+b]===w?lu(r,i,f,P):(P++,lu(r,i,P,g)),P<=h&&(f=P+1),h<=P&&(g=P-1)}}function lu(r,i,h,f){sg(r,h,f),sg(i,2*h,2*f),sg(i,2*h+1,2*f+1)}function sg(r,i,h){const f=r[i];r[i]=r[h],r[h]=f}function tv(r,i,h,f){const g=r-h,b=i-f;return g*g+b*b}var rg;d.bd=void 0,(rg=d.bd||(d.bd={})).create="create",rg.load="load",rg.fullLoad="fullLoad";let Lf=null,hu=[];const ag=1e3/60,og="loadTime",lg="fullLoadTime",lS={mark(r){performance.mark(r)},frame(r){const i=r;Lf!=null&&hu.push(i-Lf),Lf=i},clearMetrics(){Lf=null,hu=[],performance.clearMeasures(og),performance.clearMeasures(lg);for(const r in d.bd)performance.clearMarks(d.bd[r])},getPerformanceMetrics(){performance.measure(og,d.bd.create,d.bd.load),performance.measure(lg,d.bd.create,d.bd.fullLoad);const r=performance.getEntriesByName(og)[0].duration,i=performance.getEntriesByName(lg)[0].duration,h=hu.length,f=1/(hu.reduce((b,w)=>b+w,0)/h/1e3),g=hu.filter(b=>b>ag).reduce((b,w)=>b+(w-ag)/ag,0);return{loadTime:r,fullLoadTime:i,fps:f,percentDroppedFrames:g/(h+g)*100,totalFrames:h}}};d.$=ae,d.A=Jl,d.B=function(r){if(ce==null){const i=r.navigator?r.navigator.userAgent:null;ce=!!r.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return ce},d.C=class{constructor(r,i){this.target=r,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new KM(()=>this.process()),this.subscription=function(h,f,g,b){return h.addEventListener(f,g,!1),{unsubscribe:()=>{h.removeEventListener(f,g,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=se(self)?r:window}registerMessageHandler(r,i){this.messageHandlers[r]=i}sendAsync(r,i){return new Promise((h,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:h,reject:f},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const T={id:g,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const b=[],w=Object.assign(Object.assign({},r),{id:g,sourceMapId:this.mapId,origin:location.origin,data:na(r.data,b)});this.target.postMessage(w,{transfer:b})})}receive(r){const i=r.data,h=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[h];const f=this.abortControllers[h];return delete this.abortControllers[h],void(f&&f.abort())}if(se(self)||i.mustQueue)return this.tasks[h]=i,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,i)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),i=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(r,i)}processTask(r,i){return a(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[r];return delete this.resolveRejects[r],g?void(i.error?g.reject($a(i.error)):g.resolve($a(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=$a(i.data),f=new AbortController;this.abortControllers[r]=f;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,h,f);this.completeTask(r,null,g)}catch(g){this.completeTask(r,g)}})}completeTask(r,i,h){const f=[];delete this.abortControllers[r];const g={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?na(i):null,data:na(h,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.D=Ye,d.E=Ce,d.F=function(){var r=new Jl(16);return Jl!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},d.G=Gt,d.H=function(r,i,h){var f,g,b,w,T,P,k,O,N,$,X,J,st=h[0],ct=h[1],_t=h[2];return i===r?(r[12]=i[0]*st+i[4]*ct+i[8]*_t+i[12],r[13]=i[1]*st+i[5]*ct+i[9]*_t+i[13],r[14]=i[2]*st+i[6]*ct+i[10]*_t+i[14],r[15]=i[3]*st+i[7]*ct+i[11]*_t+i[15]):(g=i[1],b=i[2],w=i[3],T=i[4],P=i[5],k=i[6],O=i[7],N=i[8],$=i[9],X=i[10],J=i[11],r[0]=f=i[0],r[1]=g,r[2]=b,r[3]=w,r[4]=T,r[5]=P,r[6]=k,r[7]=O,r[8]=N,r[9]=$,r[10]=X,r[11]=J,r[12]=f*st+T*ct+N*_t+i[12],r[13]=g*st+P*ct+$*_t+i[13],r[14]=b*st+k*ct+X*_t+i[14],r[15]=w*st+O*ct+J*_t+i[15]),r},d.I=Hm,d.J=function(r,i,h){var f=h[0],g=h[1],b=h[2];return r[0]=i[0]*f,r[1]=i[1]*f,r[2]=i[2]*f,r[3]=i[3]*f,r[4]=i[4]*g,r[5]=i[5]*g,r[6]=i[6]*g,r[7]=i[7]*g,r[8]=i[8]*b,r[9]=i[9]*b,r[10]=i[10]*b,r[11]=i[11]*b,r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],r},d.K=z0,d.L=function(r,i){const h={};for(let f=0;f<i.length;f++){const g=i[f];g in r&&(h[g]=r[g])}return h},d.M=to,d.N=Iy,d.O=Py,d.P=M,d.Q=Zs,d.R=js,d.S=L,d.T=Rc,d.U=W,d.V=de,d.W=Ti,d.X=mn,d.Y=Tf,d.Z=class extends kr{},d._=a,d.a=Re,d.a$=function(r,i,h){return r[0]=i[0]*h[0],r[1]=i[1]*h[1],r[2]=i[2]*h[2],r[3]=i[3]*h[3],r},d.a0=Qm,d.a1=Ut,d.a2=r=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(h=>{i.onloadstart=()=>{h(i)};for(const f of r){const g=window.document.createElement("source");Qe(f)||(i.crossOrigin="Anonymous"),g.src=f,i.appendChild(g)}})},d.a3=function(){return ft++},d.a4=lf,d.a5=nh,d.a6=Bl,d.a7=ca,d.a8=Ki,d.a9=Fy,d.aA=kt,d.aB=function(r,i){if(!r)return[{command:"setStyle",args:[i]}];let h=[];try{if(!Oe(r.version,i.version))return[{command:"setStyle",args:[i]}];Oe(r.center,i.center)||h.push({command:"setCenter",args:[i.center]}),Oe(r.zoom,i.zoom)||h.push({command:"setZoom",args:[i.zoom]}),Oe(r.bearing,i.bearing)||h.push({command:"setBearing",args:[i.bearing]}),Oe(r.pitch,i.pitch)||h.push({command:"setPitch",args:[i.pitch]}),Oe(r.sprite,i.sprite)||h.push({command:"setSprite",args:[i.sprite]}),Oe(r.glyphs,i.glyphs)||h.push({command:"setGlyphs",args:[i.glyphs]}),Oe(r.transition,i.transition)||h.push({command:"setTransition",args:[i.transition]}),Oe(r.light,i.light)||h.push({command:"setLight",args:[i.light]}),Oe(r.terrain,i.terrain)||h.push({command:"setTerrain",args:[i.terrain]}),Oe(r.sky,i.sky)||h.push({command:"setSky",args:[i.sky]});const f={},g=[];(function(w,T,P,k){let O;for(O in T=T||{},w=w||{})Object.prototype.hasOwnProperty.call(w,O)&&(Object.prototype.hasOwnProperty.call(T,O)||rt(O,P,k));for(O in T)Object.prototype.hasOwnProperty.call(T,O)&&(Object.prototype.hasOwnProperty.call(w,O)?Oe(w[O],T[O])||(w[O].type==="geojson"&&T[O].type==="geojson"&&pe(w,T,O)?gi(P,{command:"setGeoJSONSourceData",args:[O,T[O].data]}):$t(O,T,P,k)):mt(O,T,P))})(r.sources,i.sources,g,f);const b=[];r.layers&&r.layers.forEach(w=>{"source"in w&&f[w.source]?h.push({command:"removeLayer",args:[w.id]}):b.push(w)}),h=h.concat(g),function(w,T,P){T=T||[];const k=(w=w||[]).map(ke),O=T.map(ke),N=w.reduce(ui,{}),$=T.reduce(ui,{}),X=k.slice(),J=Object.create(null);let st,ct,_t,Lt,xt;for(let Et=0,Xt=0;Et<k.length;Et++)st=k[Et],Object.prototype.hasOwnProperty.call($,st)?Xt++:(gi(P,{command:"removeLayer",args:[st]}),X.splice(X.indexOf(st,Xt),1));for(let Et=0,Xt=0;Et<O.length;Et++)st=O[O.length-1-Et],X[X.length-1-Et]!==st&&(Object.prototype.hasOwnProperty.call(N,st)?(gi(P,{command:"removeLayer",args:[st]}),X.splice(X.lastIndexOf(st,X.length-Xt),1)):Xt++,Lt=X[X.length-Et],gi(P,{command:"addLayer",args:[$[st],Lt]}),X.splice(X.length-Et,0,st),J[st]=!0);for(let Et=0;Et<O.length;Et++)if(st=O[Et],ct=N[st],_t=$[st],!J[st]&&!Oe(ct,_t))if(Oe(ct.source,_t.source)&&Oe(ct["source-layer"],_t["source-layer"])&&Oe(ct.type,_t.type)){for(xt in ye(ct.layout,_t.layout,P,st,null,"setLayoutProperty"),ye(ct.paint,_t.paint,P,st,null,"setPaintProperty"),Oe(ct.filter,_t.filter)||gi(P,{command:"setFilter",args:[st,_t.filter]}),Oe(ct.minzoom,_t.minzoom)&&Oe(ct.maxzoom,_t.maxzoom)||gi(P,{command:"setLayerZoomRange",args:[st,_t.minzoom,_t.maxzoom]}),ct)Object.prototype.hasOwnProperty.call(ct,xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&(xt.indexOf("paint.")===0?ye(ct[xt],_t[xt],P,st,xt.slice(6),"setPaintProperty"):Oe(ct[xt],_t[xt])||gi(P,{command:"setLayerProperty",args:[st,xt,_t[xt]]}));for(xt in _t)Object.prototype.hasOwnProperty.call(_t,xt)&&!Object.prototype.hasOwnProperty.call(ct,xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&(xt.indexOf("paint.")===0?ye(ct[xt],_t[xt],P,st,xt.slice(6),"setPaintProperty"):Oe(ct[xt],_t[xt])||gi(P,{command:"setLayerProperty",args:[st,xt,_t[xt]]}))}else gi(P,{command:"removeLayer",args:[st]}),Lt=X[X.lastIndexOf(st)+1],gi(P,{command:"addLayer",args:[_t,Lt]})}(b,i.layers,h)}catch(f){console.warn("Unable to compute style diff:",f),h=[{command:"setStyle",args:[i]}]}return h},d.aC=function(r){const i=[],h=r.id;return h===void 0&&i.push({message:`layers.${h}: missing required property "id"`}),r.render===void 0&&i.push({message:`layers.${h}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&i.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),i},d.aD=function r(i,h){if(Array.isArray(i)){if(!Array.isArray(h)||i.length!==h.length)return!1;for(let f=0;f<i.length;f++)if(!r(i[f],h[f]))return!1;return!0}if(typeof i=="object"&&i!==null&&h!==null){if(typeof h!="object"||Object.keys(i).length!==Object.keys(h).length)return!1;for(const f in i)if(!r(i[f],h[f]))return!1;return!0}return i===h},d.aE=K,d.aF=ot,d.aG=class extends Yi{constructor(r,i){super(r,i),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},d.aH=$n,d.aI=class extends Yi{constructor(r,i){super(r,i),this.current=oa}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let i=1;i<16;i++)if(r[i]!==this.current[i]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},d.aJ=qs,d.aK=class extends Yi{constructor(r,i){super(r,i),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},d.aL=class extends Yi{constructor(r,i){super(r,i),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},d.aM=lr,d.aN=function(r,i,h,f,g,b,w){var T=1/(i-h),P=1/(f-g),k=1/(b-w);return r[0]=-2*T,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*P,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(i+h)*T,r[13]=(g+f)*P,r[14]=(w+b)*k,r[15]=1,r},d.aO=mi,d.aP=Rw,d.aQ=class extends Go{},d.aR=TM,d.aS=class extends Za{},d.aT=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},d.aU=N0,d.aV=U,d.aW=class extends Gc{},d.aX=Vt,d.aY=function(r,i){return r[0]===i[0]&&r[1]===i[1]&&r[2]===i[2]&&r[3]===i[3]&&r[4]===i[4]&&r[5]===i[5]&&r[6]===i[6]&&r[7]===i[7]&&r[8]===i[8]&&r[9]===i[9]&&r[10]===i[10]&&r[11]===i[11]&&r[12]===i[12]&&r[13]===i[13]&&r[14]===i[14]&&r[15]===i[15]},d.aZ=function(r,i){var h=r[0],f=r[1],g=r[2],b=r[3],w=r[4],T=r[5],P=r[6],k=r[7],O=r[8],N=r[9],$=r[10],X=r[11],J=r[12],st=r[13],ct=r[14],_t=r[15],Lt=i[0],xt=i[1],Et=i[2],Xt=i[3],te=i[4],Le=i[5],qe=i[6],Ie=i[7],Te=i[8],ve=i[9],Ve=i[10],Ae=i[11],ue=i[12],ti=i[13],Ze=i[14],Ai=i[15];return Math.abs(h-Lt)<=ls*Math.max(1,Math.abs(h),Math.abs(Lt))&&Math.abs(f-xt)<=ls*Math.max(1,Math.abs(f),Math.abs(xt))&&Math.abs(g-Et)<=ls*Math.max(1,Math.abs(g),Math.abs(Et))&&Math.abs(b-Xt)<=ls*Math.max(1,Math.abs(b),Math.abs(Xt))&&Math.abs(w-te)<=ls*Math.max(1,Math.abs(w),Math.abs(te))&&Math.abs(T-Le)<=ls*Math.max(1,Math.abs(T),Math.abs(Le))&&Math.abs(P-qe)<=ls*Math.max(1,Math.abs(P),Math.abs(qe))&&Math.abs(k-Ie)<=ls*Math.max(1,Math.abs(k),Math.abs(Ie))&&Math.abs(O-Te)<=ls*Math.max(1,Math.abs(O),Math.abs(Te))&&Math.abs(N-ve)<=ls*Math.max(1,Math.abs(N),Math.abs(ve))&&Math.abs($-Ve)<=ls*Math.max(1,Math.abs($),Math.abs(Ve))&&Math.abs(X-Ae)<=ls*Math.max(1,Math.abs(X),Math.abs(Ae))&&Math.abs(J-ue)<=ls*Math.max(1,Math.abs(J),Math.abs(ue))&&Math.abs(st-ti)<=ls*Math.max(1,Math.abs(st),Math.abs(ti))&&Math.abs(ct-Ze)<=ls*Math.max(1,Math.abs(ct),Math.abs(Ze))&&Math.abs(_t-Ai)<=ls*Math.max(1,Math.abs(_t),Math.abs(Ai))},d.a_=function(r,i){return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],r},d.aa=function(r){const i={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,f,g,b)=>{const w=g||b;return i[f]=!w||w.toLowerCase(),""}),i["max-age"]){const h=parseInt(i["max-age"],10);isNaN(h)?delete i["max-age"]:i["max-age"]=h}return i},d.ab=function(r,i){const h=[];for(const f in r)f in i||h.push(f);return h},d.ac=Q,d.ad=function(r,i,h){var f=Math.sin(h),g=Math.cos(h),b=i[0],w=i[1],T=i[2],P=i[3],k=i[4],O=i[5],N=i[6],$=i[7];return i!==r&&(r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15]),r[0]=b*g+k*f,r[1]=w*g+O*f,r[2]=T*g+N*f,r[3]=P*g+$*f,r[4]=k*g-b*f,r[5]=O*g-w*f,r[6]=N*g-T*f,r[7]=$*g-P*f,r},d.ae=function(r){var i=new Jl(16);return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i},d.af=mf,d.ag=function(r,i){let h=0,f=0;if(r.kind==="constant")f=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:g,minZoom:b,maxZoom:w}=r,T=g?Q(Jn.interpolationFactor(g,i,b,w),0,1):0;r.kind==="camera"?f=vs.number(r.minSize,r.maxSize,T):h=T}return{uSizeT:h,uSize:f}},d.ai=function(r,{uSize:i,uSizeT:h},{lowerSize:f,upperSize:g}){return r.kind==="source"?f/Br:r.kind==="composite"?vs.number(f/Br,g/Br,h):i},d.aj=jm,d.ak=function(r,i,h,f){const g=i.y-r.y,b=i.x-r.x,w=f.y-h.y,T=f.x-h.x,P=w*b-T*g;if(P===0)return null;const k=(T*(r.y-h.y)-w*(r.x-h.x))/P;return new M(r.x+k*b,r.y+k*g)},d.al=Uy,d.am=ua,d.an=Tm,d.ao=Sn,d.aq=$m,d.ar=function(r,i){var h=i[0],f=i[1],g=i[2],b=i[3],w=i[4],T=i[5],P=i[6],k=i[7],O=i[8],N=i[9],$=i[10],X=i[11],J=i[12],st=i[13],ct=i[14],_t=i[15],Lt=h*T-f*w,xt=h*P-g*w,Et=h*k-b*w,Xt=f*P-g*T,te=f*k-b*T,Le=g*k-b*P,qe=O*st-N*J,Ie=O*ct-$*J,Te=O*_t-X*J,ve=N*ct-$*st,Ve=N*_t-X*st,Ae=$*_t-X*ct,ue=Lt*Ae-xt*Ve+Et*ve+Xt*Te-te*Ie+Le*qe;return ue?(r[0]=(T*Ae-P*Ve+k*ve)*(ue=1/ue),r[1]=(g*Ve-f*Ae-b*ve)*ue,r[2]=(st*Le-ct*te+_t*Xt)*ue,r[3]=($*te-N*Le-X*Xt)*ue,r[4]=(P*Te-w*Ae-k*Ie)*ue,r[5]=(h*Ae-g*Te+b*Ie)*ue,r[6]=(ct*Et-J*Le-_t*xt)*ue,r[7]=(O*Le-$*Et+X*xt)*ue,r[8]=(w*Ve-T*Te+k*qe)*ue,r[9]=(f*Te-h*Ve-b*qe)*ue,r[10]=(J*te-st*Et+_t*Lt)*ue,r[11]=(N*Et-O*te-X*Lt)*ue,r[12]=(T*Ie-w*ve-P*qe)*ue,r[13]=(h*ve-f*Ie+g*qe)*ue,r[14]=(st*xt-J*Xt-ct*Lt)*ue,r[15]=(O*Xt-N*xt+$*Lt)*ue,r):null},d.as=eg,d.at=qm,d.au=ig,d.av=function(){const r={},i=Pt.$version;for(const h in Pt.$root){const f=Pt.$root[h];if(f.required){let g=null;g=h==="version"?i:f.type==="array"?[]:{},g!=null&&(r[h]=g)}}return r},d.aw=Cc,d.ax=ci,d.ay=function(r){r=r.slice();const i=Object.create(null);for(let h=0;h<r.length;h++)i[r[h].id]=r[h];for(let h=0;h<r.length;h++)"ref"in r[h]&&(r[h]=ni(r[h],i[r[h].ref]));return r},d.az=function(r){if(r.type==="custom")return new JM(r);switch(r.type){case"background":return new ZM(r);case"circle":return new Dw(r);case"fill":return new Qw(r);case"fill-extrusion":return new pM(r);case"heatmap":return new kw(r);case"hillshade":return new Bw(r);case"line":return new wM(r);case"raster":return new YM(r);case"symbol":return new Af(r)}},d.b=ie,d.b0=function(r,i){return r[0]*i[0]+r[1]*i[1]+r[2]*i[2]+r[3]*i[3]},d.b1=nt,d.b2=Dy,d.b3=Ly,d.b4=function(r,i,h,f,g){var b,w=1/Math.tan(i/2);return r[0]=w/h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=w,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,g!=null&&g!==1/0?(r[10]=(g+f)*(b=1/(f-g)),r[14]=2*g*f*b):(r[10]=-1,r[14]=-2*f),r},d.b5=function(r,i,h){var f=Math.sin(h),g=Math.cos(h),b=i[4],w=i[5],T=i[6],P=i[7],k=i[8],O=i[9],N=i[10],$=i[11];return i!==r&&(r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15]),r[4]=b*g+k*f,r[5]=w*g+O*f,r[6]=T*g+N*f,r[7]=P*g+$*f,r[8]=k*g-b*f,r[9]=O*g-w*f,r[10]=N*g-T*f,r[11]=$*g-P*f,r},d.b6=G,d.b7=H,d.b8=function(r){return r*Math.PI/180},d.b9=function(r,i){return r[0]=i[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=i[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},d.bA=sa,d.ba=class extends Wl{},d.bb=Jm,d.bc=lS,d.be=ei,d.bf=function(r,i){Re.REGISTERED_PROTOCOLS[r]=i},d.bg=function(r){delete Re.REGISTERED_PROTOCOLS[r]},d.bh=function(r,i){const h={};for(let g=0;g<r.length;g++){const b=i&&i[r[g].id]||Mm(r[g]);i&&(i[r[g].id]=b);let w=h[b];w||(w=h[b]=[]),w.push(r[g])}const f=[];for(const g in h)f.push(h[g]);return f},d.bi=Ne,d.bj=ky,d.bk=By,d.bl=my,d.bm=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Ti/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const i=r.bucket.layers[0],h=i.layout,f=i._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new Ki(r.bucket.zoom+1),r.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Ki(r.bucket.zoom+1),r.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Ki(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:O}=r.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Ki(k),r.canonical),f["text-size"].possiblyEvaluate(new Ki(O),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:O}=r.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Ki(k),r.canonical),f["icon-size"].possiblyEvaluate(new Ki(O),r.canonical)]}const b=h.get("text-line-height")*Sn,w=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",T=h.get("text-keep-upright"),P=h.get("text-size");for(const k of r.bucket.features){const O=h.get("text-font").evaluate(k,{},r.canonical).join(","),N=P.evaluate(k,{},r.canonical),$=g.layoutTextSize.evaluate(k,{},r.canonical),X=g.layoutIconSize.evaluate(k,{},r.canonical),J={horizontal:{},vertical:void 0},st=k.text;let ct,_t=[0,0];if(st){const Et=st.toString(),Xt=h.get("text-letter-spacing").evaluate(k,{},r.canonical)*Sn,te=Ul(Et)?Xt:0,Le=h.get("text-anchor").evaluate(k,{},r.canonical),qe=Xy(i,k,r.canonical);if(!qe){const Ae=h.get("text-radial-offset").evaluate(k,{},r.canonical);_t=Ae?Zy(Le,[Ae*Sn,tg]):h.get("text-offset").evaluate(k,{},r.canonical).map(ue=>ue*Sn)}let Ie=w?"center":h.get("text-justify").evaluate(k,{},r.canonical);const Te=h.get("symbol-placement"),ve=Te==="point"?h.get("text-max-width").evaluate(k,{},r.canonical)*Sn:0,Ve=()=>{r.bucket.allowVerticalPlacement&&Bo(Et)&&(J.vertical=wf(st,r.glyphMap,r.glyphPositions,r.imagePositions,O,ve,b,Le,"left",te,_t,d.ah.vertical,!0,Te,$,N))};if(!w&&qe){const Ae=new Set;if(Ie==="auto")for(let ti=0;ti<qe.values.length;ti+=2)Ae.add(eg(qe.values[ti]));else Ae.add(Ie);let ue=!1;for(const ti of Ae)if(!J.horizontal[ti])if(ue)J.horizontal[ti]=J.horizontal[0];else{const Ze=wf(st,r.glyphMap,r.glyphPositions,r.imagePositions,O,ve,b,"center",ti,te,_t,d.ah.horizontal,!1,Te,$,N);Ze&&(J.horizontal[ti]=Ze,ue=Ze.positionedLines.length===1)}Ve()}else{Ie==="auto"&&(Ie=eg(Le));const Ae=wf(st,r.glyphMap,r.glyphPositions,r.imagePositions,O,ve,b,Le,Ie,te,_t,d.ah.horizontal,!1,Te,$,N);Ae&&(J.horizontal[Ie]=Ae),Ve(),Bo(Et)&&w&&T&&(J.vertical=wf(st,r.glyphMap,r.glyphPositions,r.imagePositions,O,ve,b,Le,Ie,te,_t,d.ah.vertical,!1,Te,$,N))}}let Lt=!1;if(k.icon&&k.icon.name){const Et=r.imageMap[k.icon.name];Et&&(ct=HM(r.imagePositions[k.icon.name],h.get("icon-offset").evaluate(k,{},r.canonical),h.get("icon-anchor").evaluate(k,{},r.canonical)),Lt=!!Et.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=Lt:r.bucket.sdfIcons!==Lt&&It("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Et.pixelRatio!==r.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const xt=Jy(J.horizontal)||J.vertical;r.bucket.iconsInText=!!xt&&xt.iconsInText,(xt||ct)&&aS(r.bucket,k,J,ct,r.imageMap,g,$,X,_t,Lt,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},d.bn=Nm,d.bo=Fm,d.bp=Om,d.bq=Ja,d.br=Vm,d.bs=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},d.bt=function(r,i,h,f,g){return a(this,void 0,void 0,function*(){if(W())try{return yield de(r,i,h,f,g)}catch{}return function(b,w,T,P,k){const O=b.width,N=b.height;$e&&_e||($e=new OffscreenCanvas(O,N),_e=$e.getContext("2d",{willReadFrequently:!0})),$e.width=O,$e.height=N,_e.drawImage(b,0,0,O,N);const $=_e.getImageData(w,T,P,k);return _e.clearRect(0,0,O,N),$.data}(r,i,h,f,g)})},d.bu=zy,d.bv=_,d.bw=v,d.bx=ay,d.by=Wi,d.bz=function(r){return r.message===Yt},d.c=re,d.d=r=>a(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(i)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.e=pt,d.f=r=>new Promise((i,h)=>{const f=new Image;f.onload=()=>{i(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=be})},f.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(r)],{type:"image/png"});f.src=r.byteLength?URL.createObjectURL(g):be}),d.g=Fe,d.h=(r,i)=>xe(pt(r,{type:"json"}),i),d.i=se,d.j=Ee,d.k=he,d.l=(r,i)=>xe(pt(r,{type:"arrayBuffer"}),i),d.m=xe,d.n=function(r){return new Vm(r).readFields(BM,[])},d.o=Yc,d.p=py,d.q=as,d.r=Ac,d.s=Qe,d.t=tf,d.u=ze,d.v=Pt,d.w=It,d.x=qa,d.y=function([r,i,h]){return i+=90,i*=Math.PI/180,h*=Math.PI/180,{x:r*Math.cos(i)*Math.sin(h),y:r*Math.sin(i)*Math.sin(h),z:r*Math.cos(h)}},d.z=vs}),o("worker",["./shared"],function(d){class a{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,j){for(const at of V){this._layerConfigs[at.id]=at;const Mt=this._layers[at.id]=d.az(at);Mt._featureFilter=d.a6(Mt.filter),this.keyCache[at.id]&&delete this.keyCache[at.id]}for(const at of j)delete this.keyCache[at],delete this._layerConfigs[at],delete this._layers[at];this.familiesBySource={};const Z=d.bh(Object.values(this._layerConfigs),this.keyCache);for(const at of Z){const Mt=at.map(jt=>this._layers[jt.id]),bt=Mt[0];if(bt.visibility==="none")continue;const Tt=bt.source||"";let yt=this.familiesBySource[Tt];yt||(yt=this.familiesBySource[Tt]={});const Rt=bt.sourceLayer||"_geojsonTileLayer";let ee=yt[Rt];ee||(ee=yt[Rt]=[]),ee.push(Mt)}}}class _{constructor(V){const j={},Z=[];for(const Tt in V){const yt=V[Tt],Rt=j[Tt]={};for(const ee in yt){const jt=yt[+ee];if(!jt||jt.bitmap.width===0||jt.bitmap.height===0)continue;const Qt={x:0,y:0,w:jt.bitmap.width+2,h:jt.bitmap.height+2};Z.push(Qt),Rt[ee]={rect:Qt,metrics:jt.metrics}}}const{w:at,h:Mt}=d.p(Z),bt=new d.o({width:at||1,height:Mt||1});for(const Tt in V){const yt=V[Tt];for(const Rt in yt){const ee=yt[+Rt];if(!ee||ee.bitmap.width===0||ee.bitmap.height===0)continue;const jt=j[Tt][Rt].rect;d.o.copy(ee.bitmap,bt,{x:0,y:0},{x:jt.x+1,y:jt.y+1},ee.bitmap)}}this.image=bt,this.positions=j}}d.bi("GlyphAtlas",_);class v{constructor(V){this.tileID=new d.Q(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,j,Z,at){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new d.a4;const Mt=new d.bj(Object.keys(V.layers).sort()),bt=new d.bk(this.tileID,this.promoteId);bt.bucketLayerIDs=[];const Tt={},yt={featureIndex:bt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Z},Rt=j.familiesBySource[this.source];for(const we in Rt){const Ke=V.layers[we];if(!Ke)continue;Ke.version===1&&d.w(`Vector tile source "${this.source}" layer "${we}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const li=Mt.encode(we),pi=[];for(let di=0;di<Ke.length;di++){const Mi=Ke.feature(di),Gi=bt.getId(Mi,we);pi.push({feature:Mi,id:Gi,index:di,sourceLayerIndex:li})}for(const di of Rt[we]){const Mi=di[0];Mi.source!==this.source&&d.w(`layer.source = ${Mi.source} does not equal this.source = ${this.source}`),Mi.minzoom&&this.zoom<Math.floor(Mi.minzoom)||Mi.maxzoom&&this.zoom>=Mi.maxzoom||Mi.visibility!=="none"&&(S(di,this.zoom,Z),(Tt[Mi.id]=Mi.createBucket({index:bt.bucketLayerIDs.length,layers:di,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:li,sourceID:this.source})).populate(pi,yt,this.tileID.canonical),bt.bucketLayerIDs.push(di.map(Gi=>Gi.id)))}}const ee=d.aE(yt.glyphDependencies,we=>Object.keys(we).map(Number));this.inFlightDependencies.forEach(we=>we==null?void 0:we.abort()),this.inFlightDependencies=[];let jt=Promise.resolve({});if(Object.keys(ee).length){const we=new AbortController;this.inFlightDependencies.push(we),jt=at.sendAsync({type:"getGlyphs",data:{stacks:ee,source:this.source,tileID:this.tileID,type:"glyphs"}},we)}const Qt=Object.keys(yt.iconDependencies);let We=Promise.resolve({});if(Qt.length){const we=new AbortController;this.inFlightDependencies.push(we),We=at.sendAsync({type:"getImages",data:{icons:Qt,source:this.source,tileID:this.tileID,type:"icons"}},we)}const et=Object.keys(yt.patternDependencies);let At=Promise.resolve({});if(et.length){const we=new AbortController;this.inFlightDependencies.push(we),At=at.sendAsync({type:"getImages",data:{icons:et,source:this.source,tileID:this.tileID,type:"patterns"}},we)}const[Ot,St,Ht]=yield Promise.all([jt,We,At]),De=new _(Ot),je=new d.bl(St,Ht);for(const we in Tt){const Ke=Tt[we];Ke instanceof d.a5?(S(Ke.layers,this.zoom,Z),d.bm({bucket:Ke,glyphMap:Ot,glyphPositions:De.positions,imageMap:St,imagePositions:je.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ke.hasPattern&&(Ke instanceof d.bn||Ke instanceof d.bo||Ke instanceof d.bp)&&(S(Ke.layers,this.zoom,Z),Ke.addFeatures(yt,this.tileID.canonical,je.patternPositions))}return this.status="done",{buckets:Object.values(Tt).filter(we=>!we.isEmpty()),featureIndex:bt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:De.image,imageAtlas:je,glyphMap:this.returnDependencies?Ot:null,iconMap:this.returnDependencies?St:null,glyphPositions:this.returnDependencies?De.positions:null}})}}function S(tt,V,j){const Z=new d.a8(V);for(const at of tt)at.recalculate(Z,j)}class M{constructor(V,j,Z){this.actor=V,this.layerIndex=j,this.availableImages=Z,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,j){return d._(this,void 0,void 0,function*(){const Z=yield d.l(V.request,j);try{return{vectorTile:new d.bq.VectorTile(new d.br(Z.data)),rawData:Z.data,cacheControl:Z.cacheControl,expires:Z.expires}}catch(at){const Mt=new Uint8Array(Z.data);let bt=`Unable to parse the tile at ${V.request.url}, `;throw bt+=Mt[0]===31&&Mt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${at.messge}`,new Error(bt)}})}loadTile(V){return d._(this,void 0,void 0,function*(){const j=V.uid,Z=!!(V&&V.request&&V.request.collectResourceTiming)&&new d.bs(V.request),at=new v(V);this.loading[j]=at;const Mt=new AbortController;at.abort=Mt;try{const bt=yield this.loadVectorTile(V,Mt);if(delete this.loading[j],!bt)return null;const Tt=bt.rawData,yt={};bt.expires&&(yt.expires=bt.expires),bt.cacheControl&&(yt.cacheControl=bt.cacheControl);const Rt={};if(Z){const jt=Z.finish();jt&&(Rt.resourceTiming=JSON.parse(JSON.stringify(jt)))}at.vectorTile=bt.vectorTile;const ee=at.parse(bt.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[j]=at,this.fetching[j]={rawTileData:Tt,cacheControl:yt,resourceTiming:Rt};try{const jt=yield ee;return d.e({rawTileData:Tt.slice(0)},jt,yt,Rt)}finally{delete this.fetching[j]}}catch(bt){throw delete this.loading[j],at.status="done",this.loaded[j]=at,bt}})}reloadTile(V){return d._(this,void 0,void 0,function*(){const j=V.uid;if(!this.loaded||!this.loaded[j])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Z=this.loaded[j];if(Z.showCollisionBoxes=V.showCollisionBoxes,Z.status==="parsing"){const at=yield Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor);let Mt;if(this.fetching[j]){const{rawTileData:bt,cacheControl:Tt,resourceTiming:yt}=this.fetching[j];delete this.fetching[j],Mt=d.e({rawTileData:bt.slice(0)},at,Tt,yt)}else Mt=at;return Mt}if(Z.status==="done"&&Z.vectorTile)return Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(V){return d._(this,void 0,void 0,function*(){const j=this.loading,Z=V.uid;j&&j[Z]&&j[Z].abort&&(j[Z].abort.abort(),delete j[Z])})}removeTile(V){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]})}}class A{constructor(){this.loaded={}}loadTile(V){return d._(this,void 0,void 0,function*(){const{uid:j,encoding:Z,rawImageData:at,redFactor:Mt,greenFactor:bt,blueFactor:Tt,baseShift:yt}=V,Rt=at.width+2,ee=at.height+2,jt=d.b(at)?new d.R({width:Rt,height:ee},yield d.bt(at,-1,-1,Rt,ee)):at,Qt=new d.bu(j,jt,Z,Mt,bt,Tt,yt);return this.loaded=this.loaded||{},this.loaded[j]=Qt,Qt})}removeTile(V){const j=this.loaded,Z=V.uid;j&&j[Z]&&delete j[Z]}}function C(tt,V){if(tt.length!==0){R(tt[0],V);for(var j=1;j<tt.length;j++)R(tt[j],!V)}}function R(tt,V){for(var j=0,Z=0,at=0,Mt=tt.length,bt=Mt-1;at<Mt;bt=at++){var Tt=(tt[at][0]-tt[bt][0])*(tt[bt][1]+tt[at][1]),yt=j+Tt;Z+=Math.abs(j)>=Math.abs(Tt)?j-yt+Tt:Tt-yt+j,j=yt}j+Z>=0!=!!V&&tt.reverse()}var F=d.bv(function tt(V,j){var Z,at=V&&V.type;if(at==="FeatureCollection")for(Z=0;Z<V.features.length;Z++)tt(V.features[Z],j);else if(at==="GeometryCollection")for(Z=0;Z<V.geometries.length;Z++)tt(V.geometries[Z],j);else if(at==="Feature")tt(V.geometry,j);else if(at==="Polygon")C(V.coordinates,j);else if(at==="MultiPolygon")for(Z=0;Z<V.coordinates.length;Z++)C(V.coordinates[Z],j);return V});const z=d.bq.VectorTileFeature.prototype.toGeoJSON;var L={exports:{}},W=d.bw,G=d.bq.VectorTileFeature,H=Q;function Q(tt,V){this.options=V||{},this.features=tt,this.length=tt.length}function nt(tt,V){this.id=typeof tt.id=="number"?tt.id:void 0,this.type=tt.type,this.rawGeometry=tt.type===1?[tt.geometry]:tt.geometry,this.properties=tt.tags,this.extent=V||4096}Q.prototype.feature=function(tt){return new nt(this.features[tt],this.options.extent)},nt.prototype.loadGeometry=function(){var tt=this.rawGeometry;this.geometry=[];for(var V=0;V<tt.length;V++){for(var j=tt[V],Z=[],at=0;at<j.length;at++)Z.push(new W(j[at][0],j[at][1]));this.geometry.push(Z)}return this.geometry},nt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var tt=this.geometry,V=1/0,j=-1/0,Z=1/0,at=-1/0,Mt=0;Mt<tt.length;Mt++)for(var bt=tt[Mt],Tt=0;Tt<bt.length;Tt++){var yt=bt[Tt];V=Math.min(V,yt.x),j=Math.max(j,yt.x),Z=Math.min(Z,yt.y),at=Math.max(at,yt.y)}return[V,Z,j,at]},nt.prototype.toGeoJSON=G.prototype.toGeoJSON;var pt=d.bx,ft=H;function K(tt){var V=new pt;return function(j,Z){for(var at in j.layers)Z.writeMessage(3,ot,j.layers[at])}(tt,V),V.finish()}function ot(tt,V){var j;V.writeVarintField(15,tt.version||1),V.writeStringField(1,tt.name||""),V.writeVarintField(5,tt.extent||4096);var Z={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<tt.length;j++)Z.feature=tt.feature(j),V.writeMessage(2,kt,Z);var at=Z.keys;for(j=0;j<at.length;j++)V.writeStringField(3,at[j]);var Mt=Z.values;for(j=0;j<Mt.length;j++)V.writeMessage(4,se,Mt[j])}function kt(tt,V){var j=tt.feature;j.id!==void 0&&V.writeVarintField(1,j.id),V.writeMessage(2,zt,tt),V.writeVarintField(3,j.type),V.writeMessage(4,Wt,j)}function zt(tt,V){var j=tt.feature,Z=tt.keys,at=tt.values,Mt=tt.keycache,bt=tt.valuecache;for(var Tt in j.properties){var yt=j.properties[Tt],Rt=Mt[Tt];if(yt!==null){Rt===void 0&&(Z.push(Tt),Mt[Tt]=Rt=Z.length-1),V.writeVarint(Rt);var ee=typeof yt;ee!=="string"&&ee!=="boolean"&&ee!=="number"&&(yt=JSON.stringify(yt));var jt=ee+":"+yt,Qt=bt[jt];Qt===void 0&&(at.push(yt),bt[jt]=Qt=at.length-1),V.writeVarint(Qt)}}}function It(tt,V){return(V<<3)+(7&tt)}function Dt(tt){return tt<<1^tt>>31}function Wt(tt,V){for(var j=tt.loadGeometry(),Z=tt.type,at=0,Mt=0,bt=j.length,Tt=0;Tt<bt;Tt++){var yt=j[Tt],Rt=1;Z===1&&(Rt=yt.length),V.writeVarint(It(1,Rt));for(var ee=Z===3?yt.length-1:yt.length,jt=0;jt<ee;jt++){jt===1&&Z!==1&&V.writeVarint(It(2,ee-1));var Qt=yt[jt].x-at,We=yt[jt].y-Mt;V.writeVarint(Dt(Qt)),V.writeVarint(Dt(We)),at+=Qt,Mt+=We}Z===3&&V.writeVarint(It(7,1))}}function se(tt,V){var j=typeof tt;j==="string"?V.writeStringField(1,tt):j==="boolean"?V.writeBooleanField(7,tt):j==="number"&&(tt%1!=0?V.writeDoubleField(3,tt):tt<0?V.writeSVarintField(6,tt):V.writeVarintField(5,tt))}L.exports=K,L.exports.fromVectorTileJs=K,L.exports.fromGeojsonVt=function(tt,V){V=V||{};var j={};for(var Z in tt)j[Z]=new ft(tt[Z].features,V),j[Z].name=Z,j[Z].version=V.version,j[Z].extent=V.extent;return K({layers:j})},L.exports.GeoJSONWrapper=ft;var ce=d.bv(L.exports);const ie={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:tt=>tt},be=Math.fround||(de=new Float32Array(1),tt=>(de[0]=+tt,de[0]));var de;const $e=3,_e=5,Yt=6;class re{constructor(V){this.options=Object.assign(Object.create(ie),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:j,minZoom:Z,maxZoom:at}=this.options;j&&console.time("total time");const Mt=`prepare ${V.length} points`;j&&console.time(Mt),this.points=V;const bt=[];for(let yt=0;yt<V.length;yt++){const Rt=V[yt];if(!Rt.geometry)continue;const[ee,jt]=Rt.geometry.coordinates,Qt=be(Gt(ee)),We=be(ei(jt));bt.push(Qt,We,1/0,yt,-1,1),this.options.reduce&&bt.push(0)}let Tt=this.trees[at+1]=this._createTree(bt);j&&console.timeEnd(Mt);for(let yt=at;yt>=Z;yt--){const Rt=+Date.now();Tt=this.trees[yt]=this._createTree(this._cluster(Tt,yt)),j&&console.log("z%d: %d clusters in %dms",yt,Tt.numItems,+Date.now()-Rt)}return j&&console.timeEnd("total time"),this}getClusters(V,j){let Z=((V[0]+180)%360+360)%360-180;const at=Math.max(-90,Math.min(90,V[1]));let Mt=V[2]===180?180:((V[2]+180)%360+360)%360-180;const bt=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)Z=-180,Mt=180;else if(Z>Mt){const jt=this.getClusters([Z,at,180,bt],j),Qt=this.getClusters([-180,at,Mt,bt],j);return jt.concat(Qt)}const Tt=this.trees[this._limitZoom(j)],yt=Tt.range(Gt(Z),ei(bt),Gt(Mt),ei(at)),Rt=Tt.data,ee=[];for(const jt of yt){const Qt=this.stride*jt;ee.push(Rt[Qt+_e]>1?Re(Rt,Qt,this.clusterProps):this.points[Rt[Qt+$e]])}return ee}getChildren(V){const j=this._getOriginId(V),Z=this._getOriginZoom(V),at="No cluster with the specified id.",Mt=this.trees[Z];if(!Mt)throw new Error(at);const bt=Mt.data;if(j*this.stride>=bt.length)throw new Error(at);const Tt=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),yt=Mt.within(bt[j*this.stride],bt[j*this.stride+1],Tt),Rt=[];for(const ee of yt){const jt=ee*this.stride;bt[jt+4]===V&&Rt.push(bt[jt+_e]>1?Re(bt,jt,this.clusterProps):this.points[bt[jt+$e]])}if(Rt.length===0)throw new Error(at);return Rt}getLeaves(V,j,Z){const at=[];return this._appendLeaves(at,V,j=j||10,Z=Z||0,0),at}getTile(V,j,Z){const at=this.trees[this._limitZoom(V)],Mt=Math.pow(2,V),{extent:bt,radius:Tt}=this.options,yt=Tt/bt,Rt=(Z-yt)/Mt,ee=(Z+1+yt)/Mt,jt={features:[]};return this._addTileFeatures(at.range((j-yt)/Mt,Rt,(j+1+yt)/Mt,ee),at.data,j,Z,Mt,jt),j===0&&this._addTileFeatures(at.range(1-yt/Mt,Rt,1,ee),at.data,Mt,Z,Mt,jt),j===Mt-1&&this._addTileFeatures(at.range(0,Rt,yt/Mt,ee),at.data,-1,Z,Mt,jt),jt.features.length?jt:null}getClusterExpansionZoom(V){let j=this._getOriginZoom(V)-1;for(;j<=this.options.maxZoom;){const Z=this.getChildren(V);if(j++,Z.length!==1)break;V=Z[0].properties.cluster_id}return j}_appendLeaves(V,j,Z,at,Mt){const bt=this.getChildren(j);for(const Tt of bt){const yt=Tt.properties;if(yt&&yt.cluster?Mt+yt.point_count<=at?Mt+=yt.point_count:Mt=this._appendLeaves(V,yt.cluster_id,Z,at,Mt):Mt<at?Mt++:V.push(Tt),V.length===Z)break}return Mt}_createTree(V){const j=new d.au(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Z=0;Z<V.length;Z+=this.stride)j.add(V[Z],V[Z+1]);return j.finish(),j.data=V,j}_addTileFeatures(V,j,Z,at,Mt,bt){for(const Tt of V){const yt=Tt*this.stride,Rt=j[yt+_e]>1;let ee,jt,Qt;if(Rt)ee=Fe(j,yt,this.clusterProps),jt=j[yt],Qt=j[yt+1];else{const At=this.points[j[yt+$e]];ee=At.properties;const[Ot,St]=At.geometry.coordinates;jt=Gt(Ot),Qt=ei(St)}const We={type:1,geometry:[[Math.round(this.options.extent*(jt*Mt-Z)),Math.round(this.options.extent*(Qt*Mt-at))]],tags:ee};let et;et=Rt||this.options.generateId?j[yt+$e]:this.points[j[yt+$e]].id,et!==void 0&&(We.id=et),bt.features.push(We)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,j){const{radius:Z,extent:at,reduce:Mt,minPoints:bt}=this.options,Tt=Z/(at*Math.pow(2,j)),yt=V.data,Rt=[],ee=this.stride;for(let jt=0;jt<yt.length;jt+=ee){if(yt[jt+2]<=j)continue;yt[jt+2]=j;const Qt=yt[jt],We=yt[jt+1],et=V.within(yt[jt],yt[jt+1],Tt),At=yt[jt+_e];let Ot=At;for(const St of et){const Ht=St*ee;yt[Ht+2]>j&&(Ot+=yt[Ht+_e])}if(Ot>At&&Ot>=bt){let St,Ht=Qt*At,De=We*At,je=-1;const we=((jt/ee|0)<<5)+(j+1)+this.points.length;for(const Ke of et){const li=Ke*ee;if(yt[li+2]<=j)continue;yt[li+2]=j;const pi=yt[li+_e];Ht+=yt[li]*pi,De+=yt[li+1]*pi,yt[li+4]=we,Mt&&(St||(St=this._map(yt,jt,!0),je=this.clusterProps.length,this.clusterProps.push(St)),Mt(St,this._map(yt,li)))}yt[jt+4]=we,Rt.push(Ht/Ot,De/Ot,1/0,we,-1,Ot),Mt&&Rt.push(je)}else{for(let St=0;St<ee;St++)Rt.push(yt[jt+St]);if(Ot>1)for(const St of et){const Ht=St*ee;if(!(yt[Ht+2]<=j)){yt[Ht+2]=j;for(let De=0;De<ee;De++)Rt.push(yt[Ht+De])}}}}return Rt}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,j,Z){if(V[j+_e]>1){const bt=this.clusterProps[V[j+Yt]];return Z?Object.assign({},bt):bt}const at=this.points[V[j+$e]].properties,Mt=this.options.map(at);return Z&&Mt===at?Object.assign({},Mt):Mt}}function Re(tt,V,j){return{type:"Feature",id:tt[V+$e],properties:Fe(tt,V,j),geometry:{type:"Point",coordinates:[(Z=tt[V],360*(Z-.5)),ci(tt[V+1])]}};var Z}function Fe(tt,V,j){const Z=tt[V+_e],at=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z,Mt=tt[V+Yt],bt=Mt===-1?{}:Object.assign({},j[Mt]);return Object.assign(bt,{cluster:!0,cluster_id:tt[V+$e],point_count:Z,point_count_abbreviated:at})}function Gt(tt){return tt/360+.5}function ei(tt){const V=Math.sin(tt*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function ci(tt){const V=(180-360*tt)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function xe(tt,V,j,Z){for(var at,Mt=Z,bt=j-V>>1,Tt=j-V,yt=tt[V],Rt=tt[V+1],ee=tt[j],jt=tt[j+1],Qt=V+3;Qt<j;Qt+=3){var We=Qe(tt[Qt],tt[Qt+1],yt,Rt,ee,jt);if(We>Mt)at=Qt,Mt=We;else if(We===Mt){var et=Math.abs(Qt-bt);et<Tt&&(at=Qt,Tt=et)}}Mt>Z&&(at-V>3&&xe(tt,V,at,Z),tt[at+2]=Mt,j-at>3&&xe(tt,at,j,Z))}function Qe(tt,V,j,Z,at,Mt){var bt=at-j,Tt=Mt-Z;if(bt!==0||Tt!==0){var yt=((tt-j)*bt+(V-Z)*Tt)/(bt*bt+Tt*Tt);yt>1?(j=at,Z=Mt):yt>0&&(j+=bt*yt,Z+=Tt*yt)}return(bt=tt-j)*bt+(Tt=V-Z)*Tt}function le(tt,V,j,Z){var at={id:tt===void 0?null:tt,type:V,geometry:j,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Mt){var bt=Mt.geometry,Tt=Mt.type;if(Tt==="Point"||Tt==="MultiPoint"||Tt==="LineString")Kt(Mt,bt);else if(Tt==="Polygon"||Tt==="MultiLineString")for(var yt=0;yt<bt.length;yt++)Kt(Mt,bt[yt]);else if(Tt==="MultiPolygon")for(yt=0;yt<bt.length;yt++)for(var Rt=0;Rt<bt[yt].length;Rt++)Kt(Mt,bt[yt][Rt])}(at),at}function Kt(tt,V){for(var j=0;j<V.length;j+=3)tt.minX=Math.min(tt.minX,V[j]),tt.minY=Math.min(tt.minY,V[j+1]),tt.maxX=Math.max(tt.maxX,V[j]),tt.maxY=Math.max(tt.maxY,V[j+1])}function he(tt,V,j,Z){if(V.geometry){var at=V.geometry.coordinates,Mt=V.geometry.type,bt=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),Tt=[],yt=V.id;if(j.promoteId?yt=V.properties[j.promoteId]:j.generateId&&(yt=Z||0),Mt==="Point")Ee(at,Tt);else if(Mt==="MultiPoint")for(var Rt=0;Rt<at.length;Rt++)Ee(at[Rt],Tt);else if(Mt==="LineString")Ce(at,Tt,bt,!1);else if(Mt==="MultiLineString"){if(j.lineMetrics){for(Rt=0;Rt<at.length;Rt++)Ce(at[Rt],Tt=[],bt,!1),tt.push(le(yt,"LineString",Tt,V.properties));return}Pt(at,Tt,bt,!1)}else if(Mt==="Polygon")Pt(at,Tt,bt,!0);else{if(Mt!=="MultiPolygon"){if(Mt==="GeometryCollection"){for(Rt=0;Rt<V.geometry.geometries.length;Rt++)he(tt,{id:yt,geometry:V.geometry.geometries[Rt],properties:V.properties},j,Z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Rt=0;Rt<at.length;Rt++){var ee=[];Pt(at[Rt],ee,bt,!0),Tt.push(ee)}}tt.push(le(yt,Mt,Tt,V.properties))}}function Ee(tt,V){V.push(ai(tt[0])),V.push(ni(tt[1])),V.push(0)}function Ce(tt,V,j,Z){for(var at,Mt,bt=0,Tt=0;Tt<tt.length;Tt++){var yt=ai(tt[Tt][0]),Rt=ni(tt[Tt][1]);V.push(yt),V.push(Rt),V.push(0),Tt>0&&(bt+=Z?(at*Rt-yt*Mt)/2:Math.sqrt(Math.pow(yt-at,2)+Math.pow(Rt-Mt,2))),at=yt,Mt=Rt}var ee=V.length-3;V[2]=1,xe(V,0,ee,j),V[ee+2]=1,V.size=Math.abs(bt),V.start=0,V.end=V.size}function Pt(tt,V,j,Z){for(var at=0;at<tt.length;at++){var Mt=[];Ce(tt[at],Mt,j,Z),V.push(Mt)}}function ai(tt){return tt/360+.5}function ni(tt){var V=Math.sin(tt*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function Oe(tt,V,j,Z,at,Mt,bt,Tt){if(Z/=V,Mt>=(j/=V)&&bt<Z)return tt;if(bt<j||Mt>=Z)return null;for(var yt=[],Rt=0;Rt<tt.length;Rt++){var ee=tt[Rt],jt=ee.geometry,Qt=ee.type,We=at===0?ee.minX:ee.minY,et=at===0?ee.maxX:ee.maxY;if(We>=j&&et<Z)yt.push(ee);else if(!(et<j||We>=Z)){var At=[];if(Qt==="Point"||Qt==="MultiPoint")gi(jt,At,j,Z,at);else if(Qt==="LineString")mt(jt,At,j,Z,at,!1,Tt.lineMetrics);else if(Qt==="MultiLineString")$t(jt,At,j,Z,at,!1);else if(Qt==="Polygon")$t(jt,At,j,Z,at,!0);else if(Qt==="MultiPolygon")for(var Ot=0;Ot<jt.length;Ot++){var St=[];$t(jt[Ot],St,j,Z,at,!0),St.length&&At.push(St)}if(At.length){if(Tt.lineMetrics&&Qt==="LineString"){for(Ot=0;Ot<At.length;Ot++)yt.push(le(ee.id,Qt,At[Ot],ee.tags));continue}Qt!=="LineString"&&Qt!=="MultiLineString"||(At.length===1?(Qt="LineString",At=At[0]):Qt="MultiLineString"),Qt!=="Point"&&Qt!=="MultiPoint"||(Qt=At.length===3?"Point":"MultiPoint"),yt.push(le(ee.id,Qt,At,ee.tags))}}}return yt.length?yt:null}function gi(tt,V,j,Z,at){for(var Mt=0;Mt<tt.length;Mt+=3){var bt=tt[Mt+at];bt>=j&&bt<=Z&&(V.push(tt[Mt]),V.push(tt[Mt+1]),V.push(tt[Mt+2]))}}function mt(tt,V,j,Z,at,Mt,bt){for(var Tt,yt,Rt=rt(tt),ee=at===0?ye:ke,jt=tt.start,Qt=0;Qt<tt.length-3;Qt+=3){var We=tt[Qt],et=tt[Qt+1],At=tt[Qt+2],Ot=tt[Qt+3],St=tt[Qt+4],Ht=at===0?We:et,De=at===0?Ot:St,je=!1;bt&&(Tt=Math.sqrt(Math.pow(We-Ot,2)+Math.pow(et-St,2))),Ht<j?De>j&&(yt=ee(Rt,We,et,Ot,St,j),bt&&(Rt.start=jt+Tt*yt)):Ht>Z?De<Z&&(yt=ee(Rt,We,et,Ot,St,Z),bt&&(Rt.start=jt+Tt*yt)):pe(Rt,We,et,At),De<j&&Ht>=j&&(yt=ee(Rt,We,et,Ot,St,j),je=!0),De>Z&&Ht<=Z&&(yt=ee(Rt,We,et,Ot,St,Z),je=!0),!Mt&&je&&(bt&&(Rt.end=jt+Tt*yt),V.push(Rt),Rt=rt(tt)),bt&&(jt+=Tt)}var we=tt.length-3;We=tt[we],et=tt[we+1],At=tt[we+2],(Ht=at===0?We:et)>=j&&Ht<=Z&&pe(Rt,We,et,At),we=Rt.length-3,Mt&&we>=3&&(Rt[we]!==Rt[0]||Rt[we+1]!==Rt[1])&&pe(Rt,Rt[0],Rt[1],Rt[2]),Rt.length&&V.push(Rt)}function rt(tt){var V=[];return V.size=tt.size,V.start=tt.start,V.end=tt.end,V}function $t(tt,V,j,Z,at,Mt){for(var bt=0;bt<tt.length;bt++)mt(tt[bt],V,j,Z,at,Mt,!1)}function pe(tt,V,j,Z){tt.push(V),tt.push(j),tt.push(Z)}function ye(tt,V,j,Z,at,Mt){var bt=(Mt-V)/(Z-V);return tt.push(Mt),tt.push(j+(at-j)*bt),tt.push(1),bt}function ke(tt,V,j,Z,at,Mt){var bt=(Mt-j)/(at-j);return tt.push(V+(Z-V)*bt),tt.push(Mt),tt.push(1),bt}function ui(tt,V){for(var j=[],Z=0;Z<tt.length;Z++){var at,Mt=tt[Z],bt=Mt.type;if(bt==="Point"||bt==="MultiPoint"||bt==="LineString")at=Ut(Mt.geometry,V);else if(bt==="MultiLineString"||bt==="Polygon"){at=[];for(var Tt=0;Tt<Mt.geometry.length;Tt++)at.push(Ut(Mt.geometry[Tt],V))}else if(bt==="MultiPolygon")for(at=[],Tt=0;Tt<Mt.geometry.length;Tt++){for(var yt=[],Rt=0;Rt<Mt.geometry[Tt].length;Rt++)yt.push(Ut(Mt.geometry[Tt][Rt],V));at.push(yt)}j.push(le(Mt.id,bt,at,Mt.tags))}return j}function Ut(tt,V){var j=[];j.size=tt.size,tt.start!==void 0&&(j.start=tt.start,j.end=tt.end);for(var Z=0;Z<tt.length;Z+=3)j.push(tt[Z]+V,tt[Z+1],tt[Z+2]);return j}function Zt(tt,V){if(tt.transformed)return tt;var j,Z,at,Mt=1<<tt.z,bt=tt.x,Tt=tt.y;for(j=0;j<tt.features.length;j++){var yt=tt.features[j],Rt=yt.geometry,ee=yt.type;if(yt.geometry=[],ee===1)for(Z=0;Z<Rt.length;Z+=2)yt.geometry.push(Ge(Rt[Z],Rt[Z+1],V,Mt,bt,Tt));else for(Z=0;Z<Rt.length;Z++){var jt=[];for(at=0;at<Rt[Z].length;at+=2)jt.push(Ge(Rt[Z][at],Rt[Z][at+1],V,Mt,bt,Tt));yt.geometry.push(jt)}}return tt.transformed=!0,tt}function Ge(tt,V,j,Z,at,Mt){return[Math.round(j*(tt*Z-at)),Math.round(j*(V*Z-Mt))]}function si(tt,V,j,Z,at){for(var Mt=V===at.maxZoom?0:at.tolerance/((1<<V)*at.extent),bt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:Z,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Tt=0;Tt<tt.length;Tt++){bt.numFeatures++,oi(bt,tt[Tt],Mt,at);var yt=tt[Tt].minX,Rt=tt[Tt].minY,ee=tt[Tt].maxX,jt=tt[Tt].maxY;yt<bt.minX&&(bt.minX=yt),Rt<bt.minY&&(bt.minY=Rt),ee>bt.maxX&&(bt.maxX=ee),jt>bt.maxY&&(bt.maxY=jt)}return bt}function oi(tt,V,j,Z){var at=V.geometry,Mt=V.type,bt=[];if(Mt==="Point"||Mt==="MultiPoint")for(var Tt=0;Tt<at.length;Tt+=3)bt.push(at[Tt]),bt.push(at[Tt+1]),tt.numPoints++,tt.numSimplified++;else if(Mt==="LineString")Bt(bt,at,tt,j,!1,!1);else if(Mt==="MultiLineString"||Mt==="Polygon")for(Tt=0;Tt<at.length;Tt++)Bt(bt,at[Tt],tt,j,Mt==="Polygon",Tt===0);else if(Mt==="MultiPolygon")for(var yt=0;yt<at.length;yt++){var Rt=at[yt];for(Tt=0;Tt<Rt.length;Tt++)Bt(bt,Rt[Tt],tt,j,!0,Tt===0)}if(bt.length){var ee=V.tags||null;if(Mt==="LineString"&&Z.lineMetrics){for(var jt in ee={},V.tags)ee[jt]=V.tags[jt];ee.mapbox_clip_start=at.start/at.size,ee.mapbox_clip_end=at.end/at.size}var Qt={geometry:bt,type:Mt==="Polygon"||Mt==="MultiPolygon"?3:Mt==="LineString"||Mt==="MultiLineString"?2:1,tags:ee};V.id!==null&&(Qt.id=V.id),tt.features.push(Qt)}}function Bt(tt,V,j,Z,at,Mt){var bt=Z*Z;if(Z>0&&V.size<(at?bt:Z))j.numPoints+=V.length/3;else{for(var Tt=[],yt=0;yt<V.length;yt+=3)(Z===0||V[yt+2]>bt)&&(j.numSimplified++,Tt.push(V[yt]),Tt.push(V[yt+1])),j.numPoints++;at&&function(Rt,ee){for(var jt=0,Qt=0,We=Rt.length,et=We-2;Qt<We;et=Qt,Qt+=2)jt+=(Rt[Qt]-Rt[et])*(Rt[Qt+1]+Rt[et+1]);if(jt>0===ee)for(Qt=0,We=Rt.length;Qt<We/2;Qt+=2){var At=Rt[Qt],Ot=Rt[Qt+1];Rt[Qt]=Rt[We-2-Qt],Rt[Qt+1]=Rt[We-1-Qt],Rt[We-2-Qt]=At,Rt[We-1-Qt]=Ot}}(Tt,Mt),tt.push(Tt)}}function ge(tt,V){var j=(V=this.options=function(at,Mt){for(var bt in Mt)at[bt]=Mt[bt];return at}(Object.create(this.options),V)).debug;if(j&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var Z=function(at,Mt){var bt=[];if(at.type==="FeatureCollection")for(var Tt=0;Tt<at.features.length;Tt++)he(bt,at.features[Tt],Mt,Tt);else he(bt,at.type==="Feature"?at:{geometry:at},Mt);return bt}(tt,V);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Z=function(at,Mt){var bt=Mt.buffer/Mt.extent,Tt=at,yt=Oe(at,1,-1-bt,bt,0,-1,2,Mt),Rt=Oe(at,1,1-bt,2+bt,0,-1,2,Mt);return(yt||Rt)&&(Tt=Oe(at,1,-bt,1+bt,0,-1,2,Mt)||[],yt&&(Tt=ui(yt,1).concat(Tt)),Rt&&(Tt=Tt.concat(ui(Rt,-1)))),Tt}(Z,V),Z.length&&this.splitTile(Z,0,0,0),j&&(Z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Pe(tt,V,j){return 32*((1<<tt)*j+V)+tt}function yi(tt,V){return V?tt.properties[V]:tt.id}function Fi(tt,V){if(tt==null)return!0;if(tt.type==="Feature")return yi(tt,V)!=null;if(tt.type==="FeatureCollection"){const j=new Set;for(const Z of tt.features){const at=yi(Z,V);if(at==null||j.has(at))return!1;j.add(at)}return!0}return!1}function vt(tt,V){const j=new Map;if(tt!=null)if(tt.type==="Feature")j.set(yi(tt,V),tt);else for(const Z of tt.features)j.set(yi(Z,V),Z);return j}ge.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ge.prototype.splitTile=function(tt,V,j,Z,at,Mt,bt){for(var Tt=[tt,V,j,Z],yt=this.options,Rt=yt.debug;Tt.length;){Z=Tt.pop(),j=Tt.pop(),V=Tt.pop(),tt=Tt.pop();var ee=1<<V,jt=Pe(V,j,Z),Qt=this.tiles[jt];if(!Qt&&(Rt>1&&console.time("creation"),Qt=this.tiles[jt]=si(tt,V,j,Z,yt),this.tileCoords.push({z:V,x:j,y:Z}),Rt)){Rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,j,Z,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));var We="z"+V;this.stats[We]=(this.stats[We]||0)+1,this.total++}if(Qt.source=tt,at){if(V===yt.maxZoom||V===at)continue;var et=1<<at-V;if(j!==Math.floor(Mt/et)||Z!==Math.floor(bt/et))continue}else if(V===yt.indexMaxZoom||Qt.numPoints<=yt.indexMaxPoints)continue;if(Qt.source=null,tt.length!==0){Rt>1&&console.time("clipping");var At,Ot,St,Ht,De,je,we=.5*yt.buffer/yt.extent,Ke=.5-we,li=.5+we,pi=1+we;At=Ot=St=Ht=null,De=Oe(tt,ee,j-we,j+li,0,Qt.minX,Qt.maxX,yt),je=Oe(tt,ee,j+Ke,j+pi,0,Qt.minX,Qt.maxX,yt),tt=null,De&&(At=Oe(De,ee,Z-we,Z+li,1,Qt.minY,Qt.maxY,yt),Ot=Oe(De,ee,Z+Ke,Z+pi,1,Qt.minY,Qt.maxY,yt),De=null),je&&(St=Oe(je,ee,Z-we,Z+li,1,Qt.minY,Qt.maxY,yt),Ht=Oe(je,ee,Z+Ke,Z+pi,1,Qt.minY,Qt.maxY,yt),je=null),Rt>1&&console.timeEnd("clipping"),Tt.push(At||[],V+1,2*j,2*Z),Tt.push(Ot||[],V+1,2*j,2*Z+1),Tt.push(St||[],V+1,2*j+1,2*Z),Tt.push(Ht||[],V+1,2*j+1,2*Z+1)}}},ge.prototype.getTile=function(tt,V,j){var Z=this.options,at=Z.extent,Mt=Z.debug;if(tt<0||tt>24)return null;var bt=1<<tt,Tt=Pe(tt,V=(V%bt+bt)%bt,j);if(this.tiles[Tt])return Zt(this.tiles[Tt],at);Mt>1&&console.log("drilling down to z%d-%d-%d",tt,V,j);for(var yt,Rt=tt,ee=V,jt=j;!yt&&Rt>0;)Rt--,ee=Math.floor(ee/2),jt=Math.floor(jt/2),yt=this.tiles[Pe(Rt,ee,jt)];return yt&&yt.source?(Mt>1&&console.log("found parent tile z%d-%d-%d",Rt,ee,jt),Mt>1&&console.time("drilling down"),this.splitTile(yt.source,Rt,ee,jt,tt,V,j),Mt>1&&console.timeEnd("drilling down"),this.tiles[Tt]?Zt(this.tiles[Tt],at):null):null};class Jt extends M{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,j){return d._(this,void 0,void 0,function*(){const Z=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const at=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!at)return null;const Mt=new class{constructor(Tt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.W,this.length=Tt.length,this._features=Tt}feature(Tt){return new class{constructor(yt){this._feature=yt,this.extent=d.W,this.type=yt.type,this.properties=yt.tags,"id"in yt&&!isNaN(yt.id)&&(this.id=parseInt(yt.id,10))}loadGeometry(){if(this._feature.type===1){const yt=[];for(const Rt of this._feature.geometry)yt.push([new d.P(Rt[0],Rt[1])]);return yt}{const yt=[];for(const Rt of this._feature.geometry){const ee=[];for(const jt of Rt)ee.push(new d.P(jt[0],jt[1]));yt.push(ee)}return yt}}toGeoJSON(yt,Rt,ee){return z.call(this,yt,Rt,ee)}}(this._features[Tt])}}(at.features);let bt=ce(Mt);return bt.byteOffset===0&&bt.byteLength===bt.buffer.byteLength||(bt=new Uint8Array(bt)),{vectorTile:Mt,rawData:bt.buffer}})}loadData(V){return d._(this,void 0,void 0,function*(){var j;(j=this._pendingRequest)===null||j===void 0||j.abort();const Z=!!(V&&V.request&&V.request.collectResourceTiming)&&new d.bs(V.request);this._pendingRequest=new AbortController;try{let at=yield this.loadGeoJSON(V,this._pendingRequest);if(delete this._pendingRequest,typeof at!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(F(at,!0),V.filter){const bt=d.by(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(bt.result==="error")throw new Error(bt.value.map(yt=>`${yt.key}: ${yt.message}`).join(", "));at={type:"FeatureCollection",features:at.features.filter(yt=>bt.value.evaluate({zoom:0},yt))}}this._geoJSONIndex=V.cluster?new re(function({superclusterOptions:bt,clusterProperties:Tt}){if(!Tt||!bt)return bt;const yt={},Rt={},ee={accumulated:null,zoom:0},jt={properties:null},Qt=Object.keys(Tt);for(const We of Qt){const[et,At]=Tt[We],Ot=d.by(At),St=d.by(typeof et=="string"?[et,["accumulated"],["get",We]]:et);yt[We]=Ot.value,Rt[We]=St.value}return bt.map=We=>{jt.properties=We;const et={};for(const At of Qt)et[At]=yt[At].evaluate(ee,jt);return et},bt.reduce=(We,et)=>{jt.properties=et;for(const At of Qt)ee.accumulated=We[At],We[At]=Rt[At].evaluate(ee,jt)},bt}(V)).load(at.features):function(bt,Tt){return new ge(bt,Tt)}(at,V.geojsonVtOptions),this.loaded={};const Mt={};if(Z){const bt=Z.finish();bt&&(Mt.resourceTiming={},Mt.resourceTiming[V.source]=JSON.parse(JSON.stringify(bt)))}return Mt}catch(at){if(delete this._pendingRequest,d.bz(at))return{abandoned:!0};throw at}})}reloadTile(V){const j=this.loaded;return j&&j[V.uid]?super.reloadTile(V):this.loadTile(V)}loadGeoJSON(V,j){return d._(this,void 0,void 0,function*(){const{promoteId:Z}=V;if(V.request){const at=yield d.h(V.request,j);return this._dataUpdateable=Fi(at.data,Z)?vt(at.data,Z):void 0,at.data}if(typeof V.data=="string")try{const at=JSON.parse(V.data);return this._dataUpdateable=Fi(at,Z)?vt(at,Z):void 0,at}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V.source}`);return function(at,Mt,bt){var Tt,yt,Rt,ee;if(Mt.removeAll&&at.clear(),Mt.remove)for(const jt of Mt.remove)at.delete(jt);if(Mt.add)for(const jt of Mt.add){const Qt=yi(jt,bt);Qt!=null&&at.set(Qt,jt)}if(Mt.update)for(const jt of Mt.update){let Qt=at.get(jt.id);if(Qt==null)continue;const We=!jt.removeAllProperties&&(((Tt=jt.removeProperties)===null||Tt===void 0?void 0:Tt.length)>0||((yt=jt.addOrUpdateProperties)===null||yt===void 0?void 0:yt.length)>0);if((jt.newGeometry||jt.removeAllProperties||We)&&(Qt=Object.assign({},Qt),at.set(jt.id,Qt),We&&(Qt.properties=Object.assign({},Qt.properties))),jt.newGeometry&&(Qt.geometry=jt.newGeometry),jt.removeAllProperties)Qt.properties={};else if(((Rt=jt.removeProperties)===null||Rt===void 0?void 0:Rt.length)>0)for(const et of jt.removeProperties)Object.prototype.hasOwnProperty.call(Qt.properties,et)&&delete Qt.properties[et];if(((ee=jt.addOrUpdateProperties)===null||ee===void 0?void 0:ee.length)>0)for(const{key:et,value:At}of jt.addOrUpdateProperties)Qt.properties[et]=At}}(this._dataUpdateable,V.dataDiff,Z),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(V){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}class fe{constructor(V){this.self=V,this.actor=new d.C(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(j,Z)=>{if(this.externalWorkerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.externalWorkerSourceTypes[j]=Z},this.self.addProtocol=d.bf,this.self.removeProtocol=d.bg,this.self.registerRTLTextPlugin=j=>{if(d.bA.isParsed())throw new Error("RTL text plugin already registered.");d.bA.setMethods(j)},this.actor.registerMessageHandler("loadDEMTile",(j,Z)=>this._getDEMWorkerSource(j,Z.source).loadTile(Z)),this.actor.registerMessageHandler("removeDEMTile",(j,Z)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(j,Z.source).removeTile(Z)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(j,Z)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(j,Z.type,Z.source).getClusterExpansionZoom(Z)})),this.actor.registerMessageHandler("getClusterChildren",(j,Z)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(j,Z.type,Z.source).getClusterChildren(Z)})),this.actor.registerMessageHandler("getClusterLeaves",(j,Z)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(j,Z.type,Z.source).getClusterLeaves(Z)})),this.actor.registerMessageHandler("loadData",(j,Z)=>this._getWorkerSource(j,Z.type,Z.source).loadData(Z)),this.actor.registerMessageHandler("loadTile",(j,Z)=>this._getWorkerSource(j,Z.type,Z.source).loadTile(Z)),this.actor.registerMessageHandler("reloadTile",(j,Z)=>this._getWorkerSource(j,Z.type,Z.source).reloadTile(Z)),this.actor.registerMessageHandler("abortTile",(j,Z)=>this._getWorkerSource(j,Z.type,Z.source).abortTile(Z)),this.actor.registerMessageHandler("removeTile",(j,Z)=>this._getWorkerSource(j,Z.type,Z.source).removeTile(Z)),this.actor.registerMessageHandler("removeSource",(j,Z)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[j]||!this.workerSources[j][Z.type]||!this.workerSources[j][Z.type][Z.source])return;const at=this.workerSources[j][Z.type][Z.source];delete this.workerSources[j][Z.type][Z.source],at.removeSource!==void 0&&at.removeSource(Z)})),this.actor.registerMessageHandler("removeMap",j=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j]})),this.actor.registerMessageHandler("setReferrer",(j,Z)=>d._(this,void 0,void 0,function*(){this.referrer=Z})),this.actor.registerMessageHandler("syncRTLPluginState",(j,Z)=>this._syncRTLPluginState(j,Z)),this.actor.registerMessageHandler("importScript",(j,Z)=>d._(this,void 0,void 0,function*(){this.self.importScripts(Z)})),this.actor.registerMessageHandler("setImages",(j,Z)=>this._setImages(j,Z)),this.actor.registerMessageHandler("updateLayers",(j,Z)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(j).update(Z.layers,Z.removedIds)})),this.actor.registerMessageHandler("setLayers",(j,Z)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(j).replace(Z)}))}_setImages(V,j){return d._(this,void 0,void 0,function*(){this.availableImages[V]=j;for(const Z in this.workerSources[V]){const at=this.workerSources[V][Z];for(const Mt in at)at[Mt].availableImages=j}})}_syncRTLPluginState(V,j){return d._(this,void 0,void 0,function*(){if(d.bA.isParsed())return d.bA.getState();if(j.pluginStatus!=="loading")return d.bA.setState(j),j;const Z=j.pluginURL;if(this.self.importScripts(Z),d.bA.isParsed()){const at={pluginStatus:"loaded",pluginURL:Z};return d.bA.setState(at),at}throw d.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${Z}`)})}_getAvailableImages(V){let j=this.availableImages[V];return j||(j=[]),j}_getLayerIndex(V){let j=this.layerIndexes[V];return j||(j=this.layerIndexes[V]=new a),j}_getWorkerSource(V,j,Z){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][j]||(this.workerSources[V][j]={}),!this.workerSources[V][j][Z]){const at={sendAsync:(Mt,bt)=>(Mt.targetMapId=V,this.actor.sendAsync(Mt,bt))};switch(j){case"vector":this.workerSources[V][j][Z]=new M(at,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][j][Z]=new Jt(at,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][j][Z]=new this.externalWorkerSourceTypes[j](at,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][j][Z]}_getDEMWorkerSource(V,j){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][j]||(this.demWorkerSources[V][j]=new A),this.demWorkerSources[V][j]}}return d.i(self)&&(self.worker=new fe(self)),fe}),o("index",["exports","./shared"],function(d,a){var _="4.1.2";let v,S;const M={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((n,u)=>{const p=requestAnimationFrame(n);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),u(a.c())})}),getImageData(y,n=0){return this.getImageCanvasContext(y).getImageData(-n,-n,y.width+2*n,y.height+2*n)},getImageCanvasContext(y){const n=window.document.createElement("canvas"),u=n.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return n.width=y.width,n.height=y.height,u.drawImage(y,0,0,y.width,y.height),u},resolveURL:y=>(v||(v=document.createElement("a")),v.href=y,v.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(S==null&&(S=matchMedia("(prefers-reduced-motion: reduce)")),S.matches)}};class A{static testProp(n){if(!A.docStyle)return n[0];for(let u=0;u<n.length;u++)if(n[u]in A.docStyle)return n[u];return n[0]}static create(n,u,p){const m=window.document.createElement(n);return u!==void 0&&(m.className=u),p&&p.appendChild(m),m}static createNS(n,u){return window.document.createElementNS(n,u)}static disableDrag(){A.docStyle&&A.selectProp&&(A.userSelect=A.docStyle[A.selectProp],A.docStyle[A.selectProp]="none")}static enableDrag(){A.docStyle&&A.selectProp&&(A.docStyle[A.selectProp]=A.userSelect)}static setTransform(n,u){n.style[A.transformProp]=u}static addEventListener(n,u,p,m={}){n.addEventListener(u,p,"passive"in m?m:m.capture)}static removeEventListener(n,u,p,m={}){n.removeEventListener(u,p,"passive"in m?m:m.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",A.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",A.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",A.suppressClickInternal,!0)},0)}static getScale(n){const u=n.getBoundingClientRect();return{x:u.width/n.offsetWidth||1,y:u.height/n.offsetHeight||1,boundingClientRect:u}}static getPoint(n,u,p){const m=u.boundingClientRect;return new a.P((p.clientX-m.left)/u.x-n.clientLeft,(p.clientY-m.top)/u.y-n.clientTop)}static mousePos(n,u){const p=A.getScale(n);return A.getPoint(n,p,u)}static touchPos(n,u){const p=[],m=A.getScale(n);for(let x=0;x<u.length;x++)p.push(A.getPoint(n,m,u[x]));return p}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}}A.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,A.selectProp=A.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),A.transformProp=A.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(y){!z&&F&&(L?W(y):R=y)}};let R,F,z=!1,L=!1;function W(y){const n=y.createTexture();y.bindTexture(y.TEXTURE_2D,n);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,F),y.isContextLost())return;C.supported=!0}catch{}y.deleteTexture(n),z=!0}var G,H;typeof document<"u"&&(F=document.createElement("img"),F.onload=function(){R&&W(R),R=null,L=!0},F.onerror=function(){z=!0,R=null},F.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let n,u,p,m;y.resetRequestQueue=()=>{n=[],u=0,p=0,m={}},y.addThrottleControl=D=>{const B=p++;return m[B]=D,B},y.removeThrottleControl=D=>{delete m[D],E()},y.getImage=(D,B,U=!0)=>new Promise((q,Y)=>{C.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),a.e(D,{type:"image"}),n.push({abortController:B,requestParameters:D,supportImageRefresh:U,state:"queued",onError:ht=>{Y(ht)},onSuccess:ht=>{q(ht)}}),E()});const x=D=>a._(this,void 0,void 0,function*(){D.state="running";const{requestParameters:B,supportImageRefresh:U,onError:q,onSuccess:Y,abortController:ht}=D,lt=U===!1&&!a.i(self)&&!a.g(B.url)&&(!B.headers||Object.keys(B.headers).reduce((wt,Ft)=>wt&&Ft==="accept",!0));u++;const dt=lt?I(B,ht):a.m(B,ht);try{const wt=yield dt;delete D.abortController,D.state="completed",wt.data instanceof HTMLImageElement||a.b(wt.data)?Y(wt):wt.data&&Y({data:yield(it=wt.data,typeof createImageBitmap=="function"?a.d(it):a.f(it)),cacheControl:wt.cacheControl,expires:wt.expires})}catch(wt){delete D.abortController,q(wt)}finally{u--,E()}var it}),E=()=>{const D=(()=>{for(const B of Object.keys(m))if(m[B]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let B=u;B<D&&n.length>0;B++){const U=n.shift();U.abortController.signal.aborted?B--:x(U)}},I=(D,B)=>new Promise((U,q)=>{const Y=new Image,ht=D.url,lt=D.credentials;lt&&lt==="include"?Y.crossOrigin="use-credentials":(lt&&lt==="same-origin"||!a.s(ht))&&(Y.crossOrigin="anonymous"),B.signal.addEventListener("abort",()=>{Y.src="",q(a.c())}),Y.fetchPriority="high",Y.onload=()=>{Y.onerror=Y.onload=null,U({data:Y})},Y.onerror=()=>{Y.onerror=Y.onload=null,B.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Y.src=ht})}(G||(G={})),G.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(H||(H={}));class Q{constructor(n){this._transformRequestFn=n}transformRequest(n,u){return this._transformRequestFn&&this._transformRequestFn(n,u)||{url:n}}normalizeSpriteURL(n,u,p){const m=function(x){const E=x.match(nt);if(!E)throw new Error(`Unable to parse URL "${x}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(n);return m.path+=`${u}${p}`,function(x){const E=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${E}`}(m)}setTransformRequest(n){this._transformRequestFn=n}}const nt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function pt(y){var n=new a.A(3);return n[0]=y[0],n[1]=y[1],n[2]=y[2],n}var ft,K=function(y,n,u){return y[0]=n[0]-u[0],y[1]=n[1]-u[1],y[2]=n[2]-u[2],y};ft=new a.A(3),a.A!=Float32Array&&(ft[0]=0,ft[1]=0,ft[2]=0);var ot=function(y){var n=y[0],u=y[1];return n*n+u*u};function kt(y){const n=[];if(typeof y=="string")n.push({id:"default",url:y});else if(y&&y.length>0){const u=[];for(const{id:p,url:m}of y){const x=`${p}${m}`;u.indexOf(x)===-1&&(u.push(x),n.push({id:p,url:m}))}}return n}(function(){var y=new a.A(2);a.A!=Float32Array&&(y[0]=0,y[1]=0)})();class zt{constructor(n,u,p,m){this.context=n,this.format=p,this.texture=n.gl.createTexture(),this.update(u,m)}update(n,u,p){const{width:m,height:x}=n,E=!(this.size&&this.size[0]===m&&this.size[1]===x||p),{context:I}=this,{gl:D}=I;if(this.useMipmap=!!(u&&u.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!u||u.premultiply!==!1)),E)this.size=[m,x],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||a.b(n)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,n):D.texImage2D(D.TEXTURE_2D,0,this.format,m,x,0,this.format,D.UNSIGNED_BYTE,n.data);else{const{x:B,y:U}=p||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||a.b(n)?D.texSubImage2D(D.TEXTURE_2D,0,B,U,D.RGBA,D.UNSIGNED_BYTE,n):D.texSubImage2D(D.TEXTURE_2D,0,B,U,m,x,D.RGBA,D.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D)}bind(n,u,p){const{context:m}=this,{gl:x}=m;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),n!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,n),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||n),this.filter=n),u!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,u),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}function It(y){const{userImage:n}=y;return!!(n&&n.render&&n.render())&&(y.data.replace(new Uint8Array(n.data.buffer)),!0)}class Dt extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:u,promiseResolve:p}of this.requestors)p(this._getImagesForIds(u));this.requestors=[]}}getImage(n){const u=this.images[n];if(u&&!u.data&&u.spriteData){const p=u.spriteData;u.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),u.spriteData=null}return u}addImage(n,u){if(this.images[n])throw new Error(`Image id ${n} already exist, use updateImage instead`);this._validate(n,u)&&(this.images[n]=u)}_validate(n,u){let p=!0;const m=u.data||u.spriteData;return this._validateStretch(u.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${n}" has invalid "stretchX" value`))),p=!1),this._validateStretch(u.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${n}" has invalid "stretchY" value`))),p=!1),this._validateContent(u.content,u)||(this.fire(new a.j(new Error(`Image "${n}" has invalid "content" value`))),p=!1),p}_validateStretch(n,u){if(!n)return!0;let p=0;for(const m of n){if(m[0]<p||m[1]<m[0]||u<m[1])return!1;p=m[1]}return!0}_validateContent(n,u){if(!n)return!0;if(n.length!==4)return!1;const p=u.spriteData,m=p&&p.width||u.data.width,x=p&&p.height||u.data.height;return!(n[0]<0||m<n[0]||n[1]<0||x<n[1]||n[2]<0||m<n[2]||n[3]<0||x<n[3]||n[2]<n[0]||n[3]<n[1])}updateImage(n,u,p=!0){const m=this.getImage(n);if(p&&(m.data.width!==u.data.width||m.data.height!==u.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=m.version+1,this.images[n]=u,this.updatedImages[n]=!0}removeImage(n){const u=this.images[n];delete this.images[n],delete this.patterns[n],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n){return new Promise((u,p)=>{let m=!0;if(!this.isLoaded())for(const x of n)this.images[x]||(m=!1);this.isLoaded()||m?u(this._getImagesForIds(n)):this.requestors.push({ids:n,promiseResolve:u})})}_getImagesForIds(n){const u={};for(const p of n){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?u[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:n,height:u}=this.atlasImage;return{width:n,height:u}}getPattern(n){const u=this.patterns[n],p=this.getImage(n);if(!p)return null;if(u&&u.position.version===p.version)return u.position;if(u)u.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new a.I(m,p);this.patterns[n]={bin:m,position:x}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const u=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new zt(n,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const x in this.patterns)n.push(this.patterns[x].bin);const{w:u,h:p}=a.p(n),m=this.atlasImage;m.resize({width:u||1,height:p||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],I=E.x+1,D=E.y+1,B=this.getImage(x).data,U=B.width,q=B.height;a.R.copy(B,m,{x:0,y:0},{x:I,y:D},{width:U,height:q}),a.R.copy(B,m,{x:0,y:q-1},{x:I,y:D-1},{width:U,height:1}),a.R.copy(B,m,{x:0,y:0},{x:I,y:D+q},{width:U,height:1}),a.R.copy(B,m,{x:U-1,y:0},{x:I-1,y:D},{width:1,height:q}),a.R.copy(B,m,{x:0,y:0},{x:I+U,y:D},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const u of n){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const p=this.getImage(u);p||a.w(`Image with ID: "${u}" was not found`),It(p)&&this.updateImage(u,p)}}}const Wt=1e20;function se(y,n,u,p,m,x,E,I,D){for(let B=n;B<n+p;B++)ce(y,u*x+B,x,m,E,I,D);for(let B=u;B<u+m;B++)ce(y,B*x+n,1,p,E,I,D)}function ce(y,n,u,p,m,x,E){x[0]=0,E[0]=-Wt,E[1]=Wt,m[0]=y[n];for(let I=1,D=0,B=0;I<p;I++){m[I]=y[n+I*u];const U=I*I;do{const q=x[D];B=(m[I]-m[q]+U-q*q)/(I-q)/2}while(B<=E[D]&&--D>-1);D++,x[D]=I,E[D]=B,E[D+1]=Wt}for(let I=0,D=0;I<p;I++){for(;E[D+1]<I;)D++;const B=x[D],U=I-B;y[n+I*u]=m[B]+U*U}}class ie{constructor(n,u){this.requestManager=n,this.localIdeographFontFamily=u,this.entries={}}setURL(n){this.url=n}getGlyphs(n){return a._(this,void 0,void 0,function*(){const u=[];for(const x in n)for(const E of n[x])u.push(this._getAndCacheGlyphsPromise(x,E));const p=yield Promise.all(u),m={};for(const{stack:x,id:E,glyph:I}of p)m[x]||(m[x]={}),m[x][E]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};return m})}_getAndCacheGlyphsPromise(n,u){return a._(this,void 0,void 0,function*(){let p=this.entries[n];p||(p=this.entries[n]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[u];if(m!==void 0)return{stack:n,id:u,glyph:m};if(m=this._tinySDF(p,n,u),m)return p.glyphs[u]=m,{stack:n,id:u,glyph:m};const x=Math.floor(u/256);if(256*x>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[x])return{stack:n,id:u,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[x]){const I=ie.loadGlyphRange(n,x,this.url,this.requestManager);p.requests[x]=I}const E=yield p.requests[x];for(const I in E)this._doesCharSupportLocalGlyph(+I)||(p.glyphs[+I]=E[+I]);return p.ranges[x]=!0,{stack:n,id:u,glyph:E[u]||null}})}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](n)||a.u["Hangul Syllables"](n)||a.u.Hiragana(n)||a.u.Katakana(n))}_tinySDF(n,u,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let x=n.tinySDF;if(!x){let I="400";/bold/i.test(u)?I="900":/medium/i.test(u)?I="500":/light/i.test(u)&&(I="200"),x=n.tinySDF=new ie.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:I})}const E=x.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}ie.loadGlyphRange=function(y,n,u,p){return a._(this,void 0,void 0,function*(){const m=256*n,x=m+255,E=p.transformRequest(u.replace("{fontstack}",y).replace("{range}",`${m}-${x}`),H.Glyphs),I=yield a.l(E,new AbortController);if(!I||!I.data)throw new Error(`Could not load glyph range. range: ${n}, ${m}-${x}`);const D={};for(const B of a.n(I.data))D[B.id]=B;return D})},ie.TinySDF=class{constructor({fontSize:y=24,buffer:n=3,radius:u=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:x="normal",fontStyle:E="normal"}={}){this.buffer=n,this.cutoff=p,this.radius=u;const I=this.size=y+4*n,D=this._createCanvas(I),B=this.ctx=D.getContext("2d",{willReadFrequently:!0});B.font=`${E} ${x} ${y}px ${m}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(y){const n=document.createElement("canvas");return n.width=n.height=y,n}draw(y){const{width:n,actualBoundingBoxAscent:u,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:x}=this.ctx.measureText(y),E=Math.ceil(u),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-m))),D=Math.min(this.size-this.buffer,E+Math.ceil(p)),B=I+2*this.buffer,U=D+2*this.buffer,q=Math.max(B*U,0),Y=new Uint8ClampedArray(q),ht={data:Y,width:B,height:U,glyphWidth:I,glyphHeight:D,glyphTop:E,glyphLeft:0,glyphAdvance:n};if(I===0||D===0)return ht;const{ctx:lt,buffer:dt,gridInner:it,gridOuter:wt}=this;lt.clearRect(dt,dt,I,D),lt.fillText(y,dt,dt+E);const Ft=lt.getImageData(dt,dt,I,D);wt.fill(Wt,0,q),it.fill(0,0,q);for(let gt=0;gt<D;gt++)for(let Ct=0;Ct<I;Ct++){const Nt=Ft.data[4*(gt*I+Ct)+3]/255;if(Nt===0)continue;const Vt=(gt+dt)*B+Ct+dt;if(Nt===1)wt[Vt]=0,it[Vt]=Wt;else{const qt=.5-Nt;wt[Vt]=qt>0?qt*qt:0,it[Vt]=qt<0?qt*qt:0}}se(wt,0,0,B,U,B,this.f,this.v,this.z),se(it,dt,dt,I,D,B,this.f,this.v,this.z);for(let gt=0;gt<q;gt++){const Ct=Math.sqrt(wt[gt])-Math.sqrt(it[gt]);Y[gt]=Math.round(255-255*(Ct/this.radius+this.cutoff))}return ht}};class be{constructor(){this.specification=a.v.light.position}possiblyEvaluate(n,u){return a.y(n.expression.evaluate(u))}interpolate(n,u,p){return{x:a.z.number(n.x,u.x,p),y:a.z.number(n.y,u.y,p),z:a.z.number(n.z,u.z,p)}}}let de;class $e extends a.E{constructor(n){super(),de=de||new a.q({anchor:new a.D(a.v.light.anchor),position:new be,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(de),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,u={}){if(!this._validate(a.r,n,u))for(const p in n){const m=n[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,p){return(!p||p.validate!==!1)&&a.t(this,n.call(a.x,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class _e{constructor(n,u){this.width=n,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,u){const p=n.join(",")+String(u);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(n,u)),this.dashEntry[p]}getDashRanges(n,u,p){const m=[];let x=n.length%2==1?-n[n.length-1]*p:0,E=n[0]*p,I=!0;m.push({left:x,right:E,isDash:I,zeroLength:n[0]===0});let D=n[0];for(let B=1;B<n.length;B++){I=!I;const U=n[B];x=D*p,D+=U,E=D*p,m.push({left:x,right:E,isDash:I,zeroLength:U===0})}return m}addRoundDash(n,u,p){const m=u/2;for(let x=-p;x<=p;x++){const E=this.width*(this.nextRow+p+x);let I=0,D=n[I];for(let B=0;B<this.width;B++){B/D.right>1&&(D=n[++I]);const U=Math.abs(B-D.left),q=Math.abs(B-D.right),Y=Math.min(U,q);let ht;const lt=x/p*(m+1);if(D.isDash){const dt=m-Math.abs(lt);ht=Math.sqrt(Y*Y+dt*dt)}else ht=m-Math.sqrt(Y*Y+lt*lt);this.data[E+B]=Math.max(0,Math.min(255,ht+128))}}}addRegularDash(n){for(let I=n.length-1;I>=0;--I){const D=n[I],B=n[I+1];D.zeroLength?n.splice(I,1):B&&B.isDash===D.isDash&&(B.left=D.left,n.splice(I,1))}const u=n[0],p=n[n.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const m=this.width*this.nextRow;let x=0,E=n[x];for(let I=0;I<this.width;I++){I/E.right>1&&(E=n[++x]);const D=Math.abs(I-E.left),B=Math.abs(I-E.right),U=Math.min(D,B);this.data[m+I]=Math.max(0,Math.min(255,(E.isDash?U:-U)+128))}}addDash(n,u){const p=u?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let x=0;for(let I=0;I<n.length;I++)x+=n[I];if(x!==0){const I=this.width/x,D=this.getDashRanges(n,this.width,I);u?this.addRoundDash(D,I,p):this.addRegularDash(D)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:x};return this.nextRow+=m,this.dirty=!0,E}bind(n){const u=n.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const Yt="maplibre_preloaded_worker_pool";class re{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<re.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Yt]}numActive(){return Object.keys(this.active).length}}const Re=Math.floor(M.hardwareConcurrency/2);let Fe,Gt;function ei(){return Fe||(Fe=new re),Fe}re.workerCount=a.B(globalThis)?Math.max(Math.min(Re,3),1):1;class ci{constructor(n,u){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=u;const p=this.workerPool.acquire(u);for(let m=0;m<p.length;m++){const x=new a.C(p[m],u);x.name=`Worker ${m}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(n,u){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:n,data:u}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(n=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],n&&this.workerPool.release(this.id)}registerMessageHandler(n,u){for(const p of this.actors)p.registerMessageHandler(n,u)}}function xe(){return Gt||(Gt=new ci(ei(),a.G),Gt.registerMessageHandler("getResource",(y,n,u)=>a.m(n,u))),Gt}function Qe(y,n){const u=a.F();return a.H(u,u,[1,1,0]),a.J(u,u,[.5*y.width,.5*y.height,1]),a.K(u,u,y.calculatePosMatrix(n.toUnwrapped()))}function le(y,n,u,p,m,x){const E=function(q,Y,ht){if(q)for(const lt of q){const dt=Y[lt];if(dt&&dt.source===ht&&dt.type==="fill-extrusion")return!0}else for(const lt in Y){const dt=Y[lt];if(dt.source===ht&&dt.type==="fill-extrusion")return!0}return!1}(m&&m.layers,n,y.id),I=x.maxPitchScaleFactor(),D=y.tilesIn(p,I,E);D.sort(Kt);const B=[];for(const q of D)B.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(n,u,y._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,m,x,I,Qe(y.transform,q.tileID))});const U=function(q){const Y={},ht={};for(const lt of q){const dt=lt.queryResults,it=lt.wrappedTileID,wt=ht[it]=ht[it]||{};for(const Ft in dt){const gt=dt[Ft],Ct=wt[Ft]=wt[Ft]||{},Nt=Y[Ft]=Y[Ft]||[];for(const Vt of gt)Ct[Vt.featureIndex]||(Ct[Vt.featureIndex]=!0,Nt.push(Vt))}}return Y}(B);for(const q in U)U[q].forEach(Y=>{const ht=Y.feature,lt=y.getFeatureState(ht.layer["source-layer"],ht.id);ht.source=ht.layer.source,ht.layer["source-layer"]&&(ht.sourceLayer=ht.layer["source-layer"]),ht.state=lt});return U}function Kt(y,n){const u=y.tileID,p=n.tileID;return u.overscaledZ-p.overscaledZ||u.canonical.y-p.canonical.y||u.wrap-p.wrap||u.canonical.x-p.canonical.x}function he(y,n,u){return a._(this,void 0,void 0,function*(){let p=y;if(y.url?p=(yield a.h(n.transformRequest(y.url,H.Source),u)).data:yield M.frameAsync(u),!p)return null;const m=a.L(a.e(p,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(x=>x.id)),m})}class Ee{constructor(n,u){n&&(u?this.setSouthWest(n).setNorthEast(u):Array.isArray(n)&&(n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1])))}setNorthEast(n){return this._ne=n instanceof a.M?new a.M(n.lng,n.lat):a.M.convert(n),this}setSouthWest(n){return this._sw=n instanceof a.M?new a.M(n.lng,n.lat):a.M.convert(n),this}extend(n){const u=this._sw,p=this._ne;let m,x;if(n instanceof a.M)m=n,x=n;else{if(!(n instanceof Ee))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Ee.convert(n)):this.extend(a.M.convert(n)):n&&("lng"in n||"lon"in n)&&"lat"in n?this.extend(a.M.convert(n)):this;if(m=n._sw,x=n._ne,!m||!x)return this}return u||p?(u.lng=Math.min(m.lng,u.lng),u.lat=Math.min(m.lat,u.lat),p.lng=Math.max(x.lng,p.lng),p.lat=Math.max(x.lat,p.lat)):(this._sw=new a.M(m.lng,m.lat),this._ne=new a.M(x.lng,x.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:u,lat:p}=a.M.convert(n);let m=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(n){return n instanceof Ee?n:n&&new Ee(n)}static fromLngLat(n,u=0){const p=360*u/40075017,m=p/Math.cos(Math.PI/180*n.lat);return new Ee(new a.M(n.lng-m,n.lat-p),new a.M(n.lng+m,n.lat+p))}}class Ce{constructor(n,u,p){this.bounds=Ee.convert(this.validateBounds(n)),this.minzoom=u||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const u=Math.pow(2,n.z),p=Math.floor(a.N(this.bounds.getWest())*u),m=Math.floor(a.O(this.bounds.getNorth())*u),x=Math.ceil(a.N(this.bounds.getEast())*u),E=Math.ceil(a.O(this.bounds.getSouth())*u);return n.x>=p&&n.x<x&&n.y>=m&&n.y<E}}class Pt extends a.E{constructor(n,u,p,m){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(u,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield he(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),n&&(a.e(this,n),n.bounds&&(this.tileBounds=new Ce(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(n){this._tileJSONRequest=null,this.fire(new a.j(n))}})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.abort(),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(n){return a._(this,void 0,void 0,function*(){const u=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(u,H.Tile),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="reloadTile";if(n.actor&&n.state!=="expired"){if(n.state==="loading")return new Promise((x,E)=>{n.reloadPromise={resolve:x,reject:E}})}else n.actor=this.dispatcher.getActor(),m="loadTile";n.abortController=new AbortController;try{const x=yield n.actor.sendAsync({type:m,data:p},n.abortController);if(delete n.abortController,n.aborted)return;this._afterTileLoadWorkerResponse(n,x)}catch(x){if(delete n.abortController,n.aborted)return;if(x&&x.status!==404)throw x;this._afterTileLoadWorkerResponse(n,null)}})}_afterTileLoadWorkerResponse(n,u){if(u&&u.resourceTiming&&(n.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&n.setExpiryData(u),n.loadVectorData(u,this.map.painter),n.reloadPromise){const p=n.reloadPromise;n.reloadPromise=null,this.loadTile(n).then(p.resolve).catch(p.reject)}}abortTile(n){return a._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.actor&&(yield n.actor.sendAsync({type:"abortTile",data:{uid:n.uid,type:this.type,source:this.id}}))})}unloadTile(n){return a._(this,void 0,void 0,function*(){n.unloadVectorData(),n.actor&&(yield n.actor.sendAsync({type:"removeTile",data:{uid:n.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ai extends a.E{constructor(n,u,p,m){super(),this.id=n,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},u),a.e(this,a.L(u,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield he(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(a.e(this,n),n.bounds&&(this.tileBounds=new Ce(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(n){this._tileJSONRequest=null,this.fire(new a.j(n))}})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(n){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}serialize(){return a.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n){return a._(this,void 0,void 0,function*(){const u=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.abortController=new AbortController;try{const p=yield G.getImage(this.map._requestManager.transformRequest(u,H.Tile),n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&n.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,x=m.gl,E=p.data;n.texture=this.map.painter.getTileTexture(E.width),n.texture?n.texture.update(E,{useMipmap:!0}):(n.texture=new zt(m,E,x.RGBA,{useMipmap:!0}),n.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&x.texParameterf(x.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),n.state="loaded"}}catch(p){if(delete n.abortController,n.aborted)n.state="unloaded";else if(p)throw n.state="errored",p}})}abortTile(n){return a._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController)})}unloadTile(n){return a._(this,void 0,void 0,function*(){n.texture&&this.map.painter.saveTileTexture(n.texture)})}hasTransition(){return!1}}class ni extends ai{constructor(n,u,p,m){super(n,u,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(n){return a._(this,void 0,void 0,function*(){const u=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(u,H.Tile);n.neighboringTiles=this._getNeighboringTiles(n.tileID),n.abortController=new AbortController;try{const m=yield G.getImage(p,n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(m&&m.data){const x=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&n.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const E=a.b(x)&&a.S()?x:yield this.readImageNow(x),I={type:this.type,uid:n.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!n.actor||n.state==="expired"){n.actor=this.dispatcher.getActor();const D=yield n.actor.sendAsync({type:"loadDEMTile",data:I});n.dem=D,n.needsHillshadePrepare=!0,n.needsTerrainPrepare=!0,n.state="loaded"}}}catch(m){if(delete n.abortController,n.aborted)n.state="unloaded";else if(m)throw n.state="errored",m}})}readImageNow(n){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const u=n.width+2,p=n.height+2;try{return new a.R({width:u,height:p},yield a.V(n,-1,-1,u,p))}catch{}}return M.getImageData(n,1)})}_getNeighboringTiles(n){const u=n.canonical,p=Math.pow(2,u.z),m=(u.x-1+p)%p,x=u.x===0?n.wrap-1:n.wrap,E=(u.x+1+p)%p,I=u.x+1===p?n.wrap+1:n.wrap,D={};return D[new a.Q(n.overscaledZ,x,u.z,m,u.y).key]={backfilled:!1},D[new a.Q(n.overscaledZ,I,u.z,E,u.y).key]={backfilled:!1},u.y>0&&(D[new a.Q(n.overscaledZ,x,u.z,m,u.y-1).key]={backfilled:!1},D[new a.Q(n.overscaledZ,n.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},D[new a.Q(n.overscaledZ,I,u.z,E,u.y-1).key]={backfilled:!1}),u.y+1<p&&(D[new a.Q(n.overscaledZ,x,u.z,m,u.y+1).key]={backfilled:!1},D[new a.Q(n.overscaledZ,n.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},D[new a.Q(n.overscaledZ,I,u.z,E,u.y+1).key]={backfilled:!1}),D}unloadTile(n){return a._(this,void 0,void 0,function*(){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&(yield n.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:n.uid,source:this.id}}))})}}class Oe extends a.E{constructor(n,u,p,m){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=u.data,this._options=a.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const x=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*x,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*x,extent:a.W,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:a.W,radius:(u.clusterRadius||50)*x,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._updateWorkerData(),this}updateData(n){return this._updateWorkerData(n),this}setClusterOptions(n){return this.workerOptions.cluster=n.cluster,n&&(n.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=n.clusterRadius),n.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=n.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(n){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:n,source:this.id}})}getClusterChildren(n){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:n,source:this.id}})}getClusterLeaves(n,u,p){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:n,limit:u,offset:p}})}_updateWorkerData(n){return a._(this,void 0,void 0,function*(){const u=a.e({type:this.type},this.workerOptions);n?u.dataDiff=n:typeof this._data=="string"?(u.request=this.map._requestManager.transformRequest(M.resolveURL(this._data),H.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"loadData",data:u});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const x={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(x,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(n){return a._(this,void 0,void 0,function*(){const u=n.actor?"reloadTile":"loadTile";n.actor=this.actor;const p={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};n.abortController=new AbortController;const m=yield this.actor.sendAsync({type:u,data:p},n.abortController);delete n.abortController,n.unloadVectorData(),n.aborted||n.loadVectorData(m,this.map.painter,u==="reloadTile")})}abortTile(n){return a._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.aborted=!0})}unloadTile(n){return a._(this,void 0,void 0,function*(){n.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:n.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var gi=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class mt extends a.E{constructor(n,u,p,m){super(),this.id=n,this.dispatcher=p,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=u}load(n){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield G.getImage(this.map._requestManager.transformRequest(this.url,H.Image),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,n&&(this.coordinates=n),this._finishLoading())}catch(u){this._request=null,this.fire(new a.j(u))}})}loaded(){return this._loaded}updateImage(n){return n.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=n.url,this.load(n.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(n){this.coordinates=n;const u=n.map(a.Y.fromLngLat);this.tileID=function(m){let x=1/0,E=1/0,I=-1/0,D=-1/0;for(const Y of m)x=Math.min(x,Y.x),E=Math.min(E,Y.y),I=Math.max(I,Y.x),D=Math.max(D,Y.y);const B=Math.max(I-x,D-E),U=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),q=Math.pow(2,U);return new a.a0(U,Math.floor((x+I)/2*q),Math.floor((E+D)/2*q))}(u),this.minzoom=this.maxzoom=this.tileID.z;const p=u.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.W,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.W),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,u=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,gi.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new zt(n,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const x=this.tiles[m];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(n){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={}):n.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class rt extends mt{constructor(n,u,p,m){super(n,u,p,m),this.roundZoom=!0,this.type="video",this.options=u}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const n=this.options;this.urls=[];for(const u of n.urls)this.urls.push(this.map._requestManager.transformRequest(u,H.Source).url);try{const u=yield a.a2(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new a.j(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const u=this.video.seekable;n<u.start(0)||n>u.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const n=this.map.painter.context,u=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,gi.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new zt(n,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const x=this.tiles[m];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class $t extends mt{constructor(n,u,p,m){super(n,u,p,m),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(E=>typeof E!="number"))||this.fire(new a.j(new a.a1(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${n}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${n}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,p=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,gi.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new zt(u,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const x in this.tiles){const E=this.tiles[x];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}const pe={},ye=y=>{switch(y){case"geojson":return Oe;case"image":return mt;case"raster":return ai;case"raster-dem":return ni;case"vector":return Pt;case"video":return rt;case"canvas":return $t}return pe[y]},ke="RTLPluginLoaded";class ui extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=xe()}_syncState(n){return this.status=n,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:n,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(n){return a._(this,arguments,void 0,function*(u,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=M.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(ke))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ut=null;function Zt(){return Ut||(Ut=new ui),Ut}class Ge{constructor(n,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=n,this.uid=a.a3(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(n){const u=n+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(n){this.demTexture&&n.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(n,u,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(m,x){const E={};if(!x)return E;for(const I of m){const D=I.layerIds.map(B=>x.getLayer(B)).filter(Boolean);if(D.length!==0){I.layers=D,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(B=>D.filter(U=>U.id===B)[0]));for(const B of D)E[B.id]=I}}return E}(n.buckets,u.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const x=this.buckets[m];if(x instanceof a.a5){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const x=this.buckets[m];if(x instanceof a.a5&&x.hasRTLText){this.hasRTLText=!0,Zt().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const x=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(m).queryRadius(x))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(n)}const u=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new zt(n,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new zt(n,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,u,p,m,x,E,I,D,B,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:U,transform:D,params:I,queryPadding:this.queryPadding*B},n,u,p):{}}querySourceFeatures(n,u){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),x=u&&u.sourceLayer?u.sourceLayer:"",E=m._geojsonTileLayer||m[x];if(!E)return;const I=a.a6(u&&u.filter),{z:D,x:B,y:U}=this.tileID.canonical,q={z:D,x:B,y:U};for(let Y=0;Y<E.length;Y++){const ht=E.feature(Y);if(I.needGeometry){const it=a.a7(ht,!0);if(!I.filter(new a.a8(this.tileID.overscaledZ),it,this.tileID.canonical))continue}else if(!I.filter(new a.a8(this.tileID.overscaledZ),ht))continue;const lt=p.getId(ht,x),dt=new a.a9(ht,D,B,U,lt);dt.tile=q,n.push(dt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const u=this.expirationTime;if(n.cacheControl){const p=a.aa(n.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(u)if(this.expirationTime<u)m=!0;else{const x=this.expirationTime-u;x?this.expirationTime=p+Math.max(x,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!u.style.hasLayer(m))continue;const x=this.buckets[m],E=x.layers[0].sourceLayer||"_geojsonTileLayer",I=p[E],D=n[E];if(!I||!D||Object.keys(D).length===0)continue;x.update(D,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const B=u&&u.style&&u.style.getLayer(m);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<M.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=M.now()+n}setDependencies(n,u){const p={};for(const m of u)p[m]=!0;this.dependencies[n]=p}hasDependency(n,u){for(const p of n){const m=this.dependencies[p];if(m){for(const x of u)if(m[x])return!0}}return!1}}class si{constructor(n,u){this.max=n,this.onRemove=u,this.reset()}reset(){for(const n in this.data)for(const u of this.data[n])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(n,u,p){const m=n.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const x={value:u,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(n,x)},p)),this.data[m].push(x),this.order.push(m),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value}getByKey(n){const u=this.data[n];return u?u[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,u){if(!this.has(n))return this;const p=n.wrapped().key,m=u===void 0?0:this.data[p].indexOf(u),x=this.data[p][m];return this.data[p].splice(m,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(n){const u=[];for(const p in this.data)for(const m of this.data[p])n(m.value)||u.push(m);for(const p of u)this.remove(p.value.tileID,p)}}class oi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,u,p){const m=String(u);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][m]=this.stateChanges[n][m]||{},a.e(this.stateChanges[n][m],p),this.deletedStates[n]===null){this.deletedStates[n]={};for(const x in this.state[n])x!==m&&(this.deletedStates[n][x]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][m]===null){this.deletedStates[n][m]={};for(const x in this.state[n][m])p[x]||(this.deletedStates[n][m][x]=null)}else for(const x in p)this.deletedStates[n]&&this.deletedStates[n][m]&&this.deletedStates[n][m][x]===null&&delete this.deletedStates[n][m][x]}removeFeatureState(n,u,p){if(this.deletedStates[n]===null)return;const m=String(u);if(this.deletedStates[n]=this.deletedStates[n]||{},p&&u!==void 0)this.deletedStates[n][m]!==null&&(this.deletedStates[n][m]=this.deletedStates[n][m]||{},this.deletedStates[n][m][p]=null);else if(u!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][m])for(p in this.deletedStates[n][m]={},this.stateChanges[n][m])this.deletedStates[n][m][p]=null;else this.deletedStates[n][m]=null;else this.deletedStates[n]=null}getState(n,u){const p=String(u),m=a.e({},(this.state[n]||{})[p],(this.stateChanges[n]||{})[p]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const x=this.deletedStates[n][u];if(x===null)return{};for(const E in x)delete m[E]}return m}initializeTileState(n,u){n.setFeatureState(this.state,u)}coalesceChanges(n,u){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const x={};for(const E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),a.e(this.state[m][E],this.stateChanges[m][E]),x[E]=this.state[m][E];p[m]=x}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const x={};if(this.deletedStates[m]===null)for(const E in this.state[m])x[E]={},this.state[m][E]={};else for(const E in this.deletedStates[m]){if(this.deletedStates[m][E]===null)this.state[m][E]={};else for(const I of Object.keys(this.deletedStates[m][E]))delete this.state[m][E][I];x[E]=this.state[m][E]}p[m]=p[m]||{},a.e(p[m],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in n)n[m].setFeatureState(p,u)}}class Bt extends a.E{constructor(n,u,p){super(),this.id=n,this.dispatcher=p,this.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,x,E,I)=>{const D=new(ye(x.type))(m,x,E,I);if(D.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${D.id}`);return D})(n,u,p,this),this._tiles={},this._cache=new si(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new oi,this._didEmitContent=!1,this._updated=!1}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._maxTileCacheZoomLevels=n?n._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const n in this._tiles){const u=this._tiles[n];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(n,u,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(n),this._tileLoaded(n,u,p)}catch(m){n.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:n})):this.update(this.transform,this.terrain)}})}_unloadTile(n){this._source.unloadTile&&this._source.unloadTile(n)}_abortTile(n){this._source.abortTile&&this._source.abortTile(n),this._source.fire(new a.k("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const p=this._tiles[u];p.upload(n),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(ge).map(n=>n.key)}getRenderableIds(n){const u=[];for(const p in this._tiles)this._isIdRenderable(p,n)&&u.push(this._tiles[p]);return n?u.sort((p,m)=>{const x=p.tileID,E=m.tileID,I=new a.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),D=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-E.overscaledZ||D.y-I.y||D.x-I.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(ge).map(p=>p.key)}hasRenderableParent(n){const u=this.findLoadedParent(n,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(n,u){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(u||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(n,"reloading")}}_reloadTile(n,u){return a._(this,void 0,void 0,function*(){const p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=u),yield this._loadTile(p,n,u))})}_tileLoaded(n,u,p){n.timeAdded=M.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(u,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){const u=this.getRenderableIds();for(let m=0;m<u.length;m++){const x=u[m];if(n.neighboringTiles&&n.neighboringTiles[x]){const E=this.getTileByID(x);p(n,E),p(E,n)}}function p(m,x){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let E=x.tileID.canonical.x-m.tileID.canonical.x;const I=x.tileID.canonical.y-m.tileID.canonical.y,D=Math.pow(2,m.tileID.canonical.z),B=x.tileID.key;E===0&&I===0||Math.abs(I)>1||(Math.abs(E)>1&&(Math.abs(E+D)===1?E+=D:Math.abs(E-D)===1&&(E-=D)),x.dem&&m.dem&&(m.dem.backfillBorder(x.dem,E,I),m.neighboringTiles&&m.neighboringTiles[B]&&(m.neighboringTiles[B].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,u,p,m){for(const x in this._tiles){let E=this._tiles[x];if(m[x]||!E.hasData()||E.tileID.overscaledZ<=u||E.tileID.overscaledZ>p)continue;let I=E.tileID;for(;E&&E.tileID.overscaledZ>u+1;){const B=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[B.key],E&&E.hasData()&&(I=B)}let D=I;for(;D.overscaledZ>u;)if(D=D.scaledTo(D.overscaledZ-1),n[D.key]){m[I.key]=I;break}}}findLoadedParent(n,u){if(n.key in this._loadedParentTiles){const p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=u?p:null}for(let p=n.overscaledZ-1;p>=u;p--){const m=n.scaledTo(p),x=this._getLoadedTile(m);if(x)return x}}_getLoadedTile(n){const u=this._tiles[n.key];return u&&u.hasData()?u:this._cache.getByKey(n.wrapped().key)}updateCacheSize(n){const u=Math.ceil(n.width/this._source.tileSize)+1,p=Math.ceil(n.height/this._source.tileSize)+1,m=Math.floor(u*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(x)}handleWrapJump(n){const u=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,u){const p={};for(const m in this._tiles){const x=this._tiles[m];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+u),p[x.tileID.key]=x}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(n,u){if(this.transform=n,this.terrain=u,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new a.Q(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y)):(p=n.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u}),this._source.hasTile&&(p=p.filter(U=>this._source.hasTile(U)))):p=[];const m=n.coveringZoomLevel(this._source),x=Math.max(m-Bt.maxOverzooming,this._source.minzoom),E=Math.max(m+Bt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const U={};for(const q of p)if(q.canonical.z>this._source.minzoom){const Y=q.scaledTo(q.canonical.z-1);U[Y.key]=Y;const ht=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));U[ht.key]=ht}p=p.concat(Object.values(U))}const I=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,I&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const D=this._updateRetainedTiles(p,m);if(Pe(this._source.type)){const U={},q={},Y=Object.keys(D),ht=M.now();for(const lt of Y){const dt=D[lt],it=this._tiles[lt];if(!it||it.fadeEndTime!==0&&it.fadeEndTime<=ht)continue;const wt=this.findLoadedParent(dt,x);wt&&(this._addTile(wt.tileID),U[wt.tileID.key]=wt.tileID),q[lt]=dt}this._retainLoadedChildren(q,m,E,D);for(const lt in U)D[lt]||(this._coveredTiles[lt]=!0,D[lt]=U[lt]);if(u){const lt={},dt={};for(const it of p)this._tiles[it.key].hasData()?lt[it.key]=it:dt[it.key]=it;for(const it in dt){const wt=dt[it].children(this._source.maxzoom);this._tiles[wt[0].key]&&this._tiles[wt[1].key]&&this._tiles[wt[2].key]&&this._tiles[wt[3].key]&&(lt[wt[0].key]=D[wt[0].key]=wt[0],lt[wt[1].key]=D[wt[1].key]=wt[1],lt[wt[2].key]=D[wt[2].key]=wt[2],lt[wt[3].key]=D[wt[3].key]=wt[3],delete dt[it])}for(const it in dt){const wt=this.findLoadedParent(dt[it],this._source.minzoom);if(wt){lt[wt.tileID.key]=D[wt.tileID.key]=wt.tileID;for(const Ft in lt)lt[Ft].isChildOf(wt.tileID)&&delete lt[Ft]}}for(const it in this._tiles)lt[it]||(this._coveredTiles[it]=!0)}}for(const U in D)this._tiles[U].clearFadeHold();const B=a.ab(this._tiles,D);for(const U of B){const q=this._tiles[U];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(U)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)}_updateRetainedTiles(n,u){const p={},m={},x=Math.max(u-Bt.maxOverzooming,this._source.minzoom),E=Math.max(u+Bt.maxUnderzooming,this._source.minzoom),I={};for(const D of n){const B=this._addTile(D);p[D.key]=D,B.hasData()||u<this._source.maxzoom&&(I[D.key]=D)}this._retainLoadedChildren(I,u,E,p);for(const D of n){let B=this._tiles[D.key];if(B.hasData())continue;if(u+1>this._source.maxzoom){const q=D.children(this._source.maxzoom)[0],Y=this.getTile(q);if(Y&&Y.hasData()){p[q.key]=q;continue}}else{const q=D.children(this._source.maxzoom);if(p[q[0].key]&&p[q[1].key]&&p[q[2].key]&&p[q[3].key])continue}let U=B.wasRequested();for(let q=D.overscaledZ-1;q>=x;--q){const Y=D.scaledTo(q);if(m[Y.key])break;if(m[Y.key]=!0,B=this.getTile(Y),!B&&U&&(B=this._addTile(Y)),B){const ht=B.hasData();if((U||ht)&&(p[Y.key]=Y),U=B.wasRequested(),ht)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const u=[];let p,m=this._tiles[n].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}u.push(m.key);const x=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;m=x}for(const x of u)this._loadedParentTiles[x]=p}}_addTile(n){let u=this._tiles[n.key];if(u)return u;u=this._cache.getAndRemove(n),u&&(this._setTileReloadTimer(n.key,u),u.tileID=n,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,u)));const p=u;return u||(u=new Ge(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(u,n.key,u.state)),u.uses++,this._tiles[n.key]=u,p||this._source.fire(new a.k("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(n,u){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const p=u.getExpiryTimeout();p&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},p))}_removeTile(n){const u=this._tiles[n];u&&(u.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,u,p){const m=[],x=this.transform;if(!x)return m;const E=p?x.getCameraQueryGeometry(n):n,I=n.map(lt=>x.pointCoordinate(lt,this.terrain)),D=E.map(lt=>x.pointCoordinate(lt,this.terrain)),B=this.getIds();let U=1/0,q=1/0,Y=-1/0,ht=-1/0;for(const lt of D)U=Math.min(U,lt.x),q=Math.min(q,lt.y),Y=Math.max(Y,lt.x),ht=Math.max(ht,lt.y);for(let lt=0;lt<B.length;lt++){const dt=this._tiles[B[lt]];if(dt.holdingForFade())continue;const it=dt.tileID,wt=Math.pow(2,x.zoom-dt.tileID.overscaledZ),Ft=u*dt.queryPadding*a.W/dt.tileSize/wt,gt=[it.getTilePoint(new a.Y(U,q)),it.getTilePoint(new a.Y(Y,ht))];if(gt[0].x-Ft<a.W&&gt[0].y-Ft<a.W&&gt[1].x+Ft>=0&&gt[1].y+Ft>=0){const Ct=I.map(Vt=>it.getTilePoint(Vt)),Nt=D.map(Vt=>it.getTilePoint(Vt));m.push({tile:dt,tileID:it,queryGeometry:Ct,cameraQueryGeometry:Nt,scale:wt})}}return m}getVisibleCoordinates(n){const u=this.getRenderableIds(n).map(p=>this._tiles[p].tileID);for(const p of u)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(Pe(this._source.type)){const n=M.now();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=n)return!0}return!1}setFeatureState(n,u,p){this._state.updateState(n=n||"_geojsonTileLayer",u,p)}removeFeatureState(n,u,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",u,p)}getFeatureState(n,u){return this._state.getState(n=n||"_geojsonTileLayer",u)}setDependencies(n,u,p){const m=this._tiles[n];m&&m.setDependencies(u,p)}reloadTilesForDependencies(n,u){for(const p in this._tiles)this._tiles[p].hasDependency(n,u)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(n,u))}}function ge(y,n){const u=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return y.overscaledZ-n.overscaledZ||p-u||n.canonical.y-y.canonical.y||n.canonical.x-y.canonical.x}function Pe(y){return y==="raster"||y==="image"||y==="video"}Bt.maxOverzooming=10,Bt.maxUnderzooming=3;class yi{constructor(n,u){this.reset(n,u)}reset(n,u){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=a.ac(n,0,1);let u=1,p=this._distances[u];const m=n*this.paddedLength+this.padding;for(;p<m&&u<this._distances.length;)p=this._distances[++u];const x=u-1,E=this._distances[x],I=p-E,D=I>0?(m-E)/I:0;return this.points[x].mult(1-D).add(this.points[u].mult(D))}}function Fi(y,n){let u=!0;return y==="always"||y!=="never"&&n!=="never"||(u=!1),u}class vt{constructor(n,u,p){const m=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(u/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)m.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,u,p,m,x){this._forEachCell(u,p,m,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(x)}insertCircle(n,u,p,m){this._forEachCell(u-m,p-m,u+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(p),this.circles.push(m)}_insertBoxCell(n,u,p,m,x,E){this.boxCells[x].push(E)}_insertCircleCell(n,u,p,m,x,E){this.circleCells[x].push(E)}_query(n,u,p,m,x,E,I){if(p<0||n>this.width||m<0||u>this.height)return[];const D=[];if(n<=0&&u<=0&&this.width<=p&&this.height<=m){if(x)return[{key:null,x1:n,y1:u,x2:p,y2:m}];for(let B=0;B<this.boxKeys.length;B++)D.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const U=this.circles[3*B],q=this.circles[3*B+1],Y=this.circles[3*B+2];D.push({key:this.circleKeys[B],x1:U-Y,y1:q-Y,x2:U+Y,y2:q+Y})}}else this._forEachCell(n,u,p,m,this._queryCell,D,{hitTest:x,overlapMode:E,seenUids:{box:{},circle:{}}},I);return D}query(n,u,p,m){return this._query(n,u,p,m,!1,null)}hitTest(n,u,p,m,x,E){return this._query(n,u,p,m,!0,x,E).length>0}hitTestCircle(n,u,p,m,x){const E=n-p,I=n+p,D=u-p,B=u+p;if(I<0||E>this.width||B<0||D>this.height)return!1;const U=[];return this._forEachCell(E,D,I,B,this._queryCellCircle,U,{hitTest:!0,overlapMode:m,circle:{x:n,y:u,radius:p},seenUids:{box:{},circle:{}}},x),U.length>0}_queryCell(n,u,p,m,x,E,I,D){const{seenUids:B,hitTest:U,overlapMode:q}=I,Y=this.boxCells[x];if(Y!==null){const lt=this.bboxes;for(const dt of Y)if(!B.box[dt]){B.box[dt]=!0;const it=4*dt,wt=this.boxKeys[dt];if(n<=lt[it+2]&&u<=lt[it+3]&&p>=lt[it+0]&&m>=lt[it+1]&&(!D||D(wt))&&(!U||!Fi(q,wt.overlapMode))&&(E.push({key:wt,x1:lt[it],y1:lt[it+1],x2:lt[it+2],y2:lt[it+3]}),U))return!0}}const ht=this.circleCells[x];if(ht!==null){const lt=this.circles;for(const dt of ht)if(!B.circle[dt]){B.circle[dt]=!0;const it=3*dt,wt=this.circleKeys[dt];if(this._circleAndRectCollide(lt[it],lt[it+1],lt[it+2],n,u,p,m)&&(!D||D(wt))&&(!U||!Fi(q,wt.overlapMode))){const Ft=lt[it],gt=lt[it+1],Ct=lt[it+2];if(E.push({key:wt,x1:Ft-Ct,y1:gt-Ct,x2:Ft+Ct,y2:gt+Ct}),U)return!0}}}return!1}_queryCellCircle(n,u,p,m,x,E,I,D){const{circle:B,seenUids:U,overlapMode:q}=I,Y=this.boxCells[x];if(Y!==null){const lt=this.bboxes;for(const dt of Y)if(!U.box[dt]){U.box[dt]=!0;const it=4*dt,wt=this.boxKeys[dt];if(this._circleAndRectCollide(B.x,B.y,B.radius,lt[it+0],lt[it+1],lt[it+2],lt[it+3])&&(!D||D(wt))&&!Fi(q,wt.overlapMode))return E.push(!0),!0}}const ht=this.circleCells[x];if(ht!==null){const lt=this.circles;for(const dt of ht)if(!U.circle[dt]){U.circle[dt]=!0;const it=3*dt,wt=this.circleKeys[dt];if(this._circlesCollide(lt[it],lt[it+1],lt[it+2],B.x,B.y,B.radius)&&(!D||D(wt))&&!Fi(q,wt.overlapMode))return E.push(!0),!0}}}_forEachCell(n,u,p,m,x,E,I,D){const B=this._convertToXCellCoord(n),U=this._convertToYCellCoord(u),q=this._convertToXCellCoord(p),Y=this._convertToYCellCoord(m);for(let ht=B;ht<=q;ht++)for(let lt=U;lt<=Y;lt++)if(x.call(this,n,u,p,m,this.xCellCount*lt+ht,E,I,D))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,u,p,m,x,E){const I=m-n,D=x-u,B=p+E;return B*B>I*I+D*D}_circleAndRectCollide(n,u,p,m,x,E,I){const D=(E-m)/2,B=Math.abs(n-(m+D));if(B>D+p)return!1;const U=(I-x)/2,q=Math.abs(u-(x+U));if(q>U+p)return!1;if(B<=D||q<=U)return!0;const Y=B-D,ht=q-U;return Y*Y+ht*ht<=p*p}}function Jt(y,n,u,p,m){const x=a.F();return n?(a.J(x,x,[1/m,1/m,1]),u||a.ad(x,x,p.angle)):a.K(x,p.labelPlaneMatrix,y),x}function fe(y,n,u,p,m){if(n){const x=a.ae(y);return a.J(x,x,[m,m,1]),u||a.ad(x,x,-p.angle),x}return p.glCoordMatrix}function tt(y,n,u){let p;u?(p=[y.x,y.y,u(y.x,y.y),1],a.af(p,p,n)):(p=[y.x,y.y,0,1],et(p,p,n));const m=p[3];return{point:new a.P(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function V(y,n){return .5+y/n*.5}function j(y,n){const u=y[0]/y[3],p=y[1]/y[3];return u>=-n[0]&&u<=n[0]&&p>=-n[1]&&p<=n[1]}function Z(y,n,u,p,m,x,E,I,D,B){const U=p?y.textSizeData:y.iconSizeData,q=a.ag(U,u.transform.zoom),Y=[256/u.width*2+1,256/u.height*2+1],ht=p?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;ht.clear();const lt=y.lineVertexArray,dt=p?y.text.placedSymbolArray:y.icon.placedSymbolArray,it=u.transform.width/u.transform.height;let wt=!1;for(let Ft=0;Ft<dt.length;Ft++){const gt=dt.get(Ft);if(gt.hidden||gt.writingMode===a.ah.vertical&&!wt){We(gt.numGlyphs,ht);continue}let Ct;if(wt=!1,B?(Ct=[gt.anchorX,gt.anchorY,B(gt.anchorX,gt.anchorY),1],a.af(Ct,Ct,n)):(Ct=[gt.anchorX,gt.anchorY,0,1],et(Ct,Ct,n)),!j(Ct,Y)){We(gt.numGlyphs,ht);continue}const Nt=V(u.transform.cameraToCenterDistance,Ct[3]),Vt=a.ai(U,q,gt),qt=E?Vt/Nt:Vt*Nt,oe=new a.P(gt.anchorX,gt.anchorY),ne=tt(oe,m,B).point,ae={projections:{},offsets:{}},Be=bt(gt,qt,!1,I,n,m,x,y.glyphOffsetArray,lt,ht,ne,oe,ae,it,D,B);wt=Be.useVertical,(Be.notEnoughRoom||wt||Be.needsFlipping&&bt(gt,qt,!0,I,n,m,x,y.glyphOffsetArray,lt,ht,ne,oe,ae,it,D,B).notEnoughRoom)&&We(gt.numGlyphs,ht)}p?y.text.dynamicLayoutVertexBuffer.updateData(ht):y.icon.dynamicLayoutVertexBuffer.updateData(ht)}function at(y,n,u,p,m,x,E,I,D,B,U,q,Y){const ht=I.glyphStartIndex+I.numGlyphs,lt=I.lineStartIndex,dt=I.lineStartIndex+I.lineLength,it=n.getoffsetX(I.glyphStartIndex),wt=n.getoffsetX(ht-1),Ft=jt(y*it,u,p,m,x,E,I.segment,lt,dt,D,B,U,q,Y);if(!Ft)return null;const gt=jt(y*wt,u,p,m,x,E,I.segment,lt,dt,D,B,U,q,Y);return gt?{first:Ft,last:gt}:null}function Mt(y,n,u,p){return y===a.ah.horizontal&&Math.abs(u.y-n.y)>Math.abs(u.x-n.x)*p?{useVertical:!0}:(y===a.ah.vertical?n.y<u.y:n.x>u.x)?{needsFlipping:!0}:null}function bt(y,n,u,p,m,x,E,I,D,B,U,q,Y,ht,lt,dt){const it=n/24,wt=y.lineOffsetX*it,Ft=y.lineOffsetY*it;let gt;if(y.numGlyphs>1){const Ct=y.glyphStartIndex+y.numGlyphs,Nt=y.lineStartIndex,Vt=y.lineStartIndex+y.lineLength,qt=at(it,I,wt,Ft,u,U,q,y,D,x,Y,lt,dt);if(!qt)return{notEnoughRoom:!0};const oe=tt(qt.first.point,E,dt).point,ne=tt(qt.last.point,E,dt).point;if(p&&!u){const ae=Mt(y.writingMode,oe,ne,ht);if(ae)return ae}gt=[qt.first];for(let ae=y.glyphStartIndex+1;ae<Ct-1;ae++)gt.push(jt(it*I.getoffsetX(ae),wt,Ft,u,U,q,y.segment,Nt,Vt,D,x,Y,lt,dt));gt.push(qt.last)}else{if(p&&!u){const Nt=tt(q,m,dt).point,Vt=y.lineStartIndex+y.segment+1,qt=new a.P(D.getx(Vt),D.gety(Vt)),oe=tt(qt,m,dt),ne=oe.signedDistanceFromCamera>0?oe.point:Tt(q,qt,Nt,1,m,dt),ae=Mt(y.writingMode,Nt,ne,ht);if(ae)return ae}const Ct=jt(it*I.getoffsetX(y.glyphStartIndex),wt,Ft,u,U,q,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,D,x,Y,lt,dt);if(!Ct)return{notEnoughRoom:!0};gt=[Ct]}for(const Ct of gt)a.aj(B,Ct.point,Ct.angle);return{}}function Tt(y,n,u,p,m,x){const E=tt(y.add(y.sub(n)._unit()),m,x).point,I=u.sub(E);return u.add(I._mult(p/I.mag()))}function yt(y,n){const{projectionCache:u,lineVertexArray:p,labelPlaneMatrix:m,tileAnchorPoint:x,distanceFromAnchor:E,getElevation:I,previousVertex:D,direction:B,absOffsetX:U}=n;if(u.projections[y])return u.projections[y];const q=new a.P(p.getx(y),p.gety(y)),Y=tt(q,m,I);if(Y.signedDistanceFromCamera>0)return u.projections[y]=Y.point,Y.point;const ht=y-B;return Tt(E===0?x:new a.P(p.getx(ht),p.gety(ht)),q,D,U-E+1,m,I)}function Rt(y,n,u){return y._unit()._perp()._mult(n*u)}function ee(y,n,u,p,m,x,E,I){const{projectionCache:D,direction:B}=I;if(D.offsets[y])return D.offsets[y];const U=u.add(n);if(y+B<p||y+B>=m)return D.offsets[y]=U,U;const q=yt(y+B,I),Y=Rt(q.sub(u),E,B),ht=u.add(Y),lt=q.add(Y);return D.offsets[y]=a.ak(x,U,ht,lt)||U,D.offsets[y]}function jt(y,n,u,p,m,x,E,I,D,B,U,q,Y,ht){const lt=p?y-n:y+n;let dt=lt>0?1:-1,it=0;p&&(dt*=-1,it=Math.PI),dt<0&&(it+=Math.PI);let wt,Ft,gt=dt>0?I+E:I+E+1,Ct=m,Nt=m,Vt=0,qt=0;const oe=Math.abs(lt),ne=[];let ae;for(;Vt+qt<=oe;){if(gt+=dt,gt<I||gt>=D)return null;Vt+=qt,Nt=Ct,Ft=wt;const Se={projectionCache:q,lineVertexArray:B,labelPlaneMatrix:U,tileAnchorPoint:x,distanceFromAnchor:Vt,getElevation:ht,previousVertex:Nt,direction:dt,absOffsetX:oe};if(Ct=yt(gt,Se),u===0)ne.push(Nt),ae=Ct.sub(Nt);else{let hi;const vi=Ct.sub(Nt);hi=vi.mag()===0?Rt(yt(gt+dt,Se).sub(Ct),u,dt):Rt(vi,u,dt),Ft||(Ft=Nt.add(hi)),wt=ee(gt,hi,Ct,I,D,Ft,u,Se),ne.push(Ft),ae=wt.sub(Ft)}qt=ae.mag()}const Be=ae._mult((oe-Vt)/qt)._add(Ft||Nt),_i=it+Math.atan2(Ct.y-Nt.y,Ct.x-Nt.x);return ne.push(Be),{point:Be,angle:Y?_i:0,path:ne}}const Qt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function We(y,n){for(let u=0;u<y;u++){const p=n.length;n.resize(p+4),n.float32.set(Qt,3*p)}}function et(y,n,u){const p=n[0],m=n[1];return y[0]=u[0]*p+u[4]*m+u[12],y[1]=u[1]*p+u[5]*m+u[13],y[3]=u[3]*p+u[7]*m+u[15],y}const At=100;class Ot{constructor(n,u=new vt(n.width+200,n.height+200,25),p=new vt(n.width+200,n.height+200,25)){this.transform=n,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+At,this.screenBottomBoundary=n.height+At,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(n,u,p,m,x,E){const I=this.projectAndGetPerspectiveRatio(m,n.anchorPointX,n.anchorPointY,E),D=p*I.perspectiveRatio,B=n.x1*D+I.point.x,U=n.y1*D+I.point.y,q=n.x2*D+I.point.x,Y=n.y2*D+I.point.y;return!this.isInsideGrid(B,U,q,Y)||u!=="always"&&this.grid.hitTest(B,U,q,Y,u,x)||I.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[B,U,q,Y],offscreen:this.isOffscreen(B,U,q,Y)}}placeCollisionCircles(n,u,p,m,x,E,I,D,B,U,q,Y,ht,lt){const dt=[],it=new a.P(u.anchorX,u.anchorY),wt=tt(it,E,lt),Ft=V(this.transform.cameraToCenterDistance,wt.signedDistanceFromCamera),gt=(U?x/Ft:x*Ft)/a.ao,Ct=tt(it,I,lt).point,Nt=at(gt,m,u.lineOffsetX*gt,u.lineOffsetY*gt,!1,Ct,it,u,p,I,{projections:{},offsets:{}},!1,lt);let Vt=!1,qt=!1,oe=!0;if(Nt){const ne=.5*Y*Ft+ht,ae=new a.P(-100,-100),Be=new a.P(this.screenRightBoundary,this.screenBottomBoundary),_i=new yi,Se=Nt.first,hi=Nt.last;let vi=[];for(let bi=Se.path.length-1;bi>=1;bi--)vi.push(Se.path[bi]);for(let bi=1;bi<hi.path.length;bi++)vi.push(hi.path[bi]);const Ei=2.5*ne;if(D){const bi=vi.map(wi=>tt(wi,D,lt));vi=bi.some(wi=>wi.signedDistanceFromCamera<=0)?[]:bi.map(wi=>wi.point)}let fi=[];if(vi.length>0){const bi=vi[0].clone(),wi=vi[0].clone();for(let an=1;an<vi.length;an++)bi.x=Math.min(bi.x,vi[an].x),bi.y=Math.min(bi.y,vi[an].y),wi.x=Math.max(wi.x,vi[an].x),wi.y=Math.max(wi.y,vi[an].y);fi=bi.x>=ae.x&&wi.x<=Be.x&&bi.y>=ae.y&&wi.y<=Be.y?[vi]:wi.x<ae.x||bi.x>Be.x||wi.y<ae.y||bi.y>Be.y?[]:a.al([vi],ae.x,ae.y,Be.x,Be.y)}for(const bi of fi){_i.reset(bi,.25*ne);let wi=0;wi=_i.length<=.5*ne?1:Math.ceil(_i.paddedLength/Ei)+1;for(let an=0;an<wi;an++){const qi=an/Math.max(wi-1,1),os=_i.lerp(qi),vn=os.x+At,Yi=os.y+At;dt.push(vn,Yi,ne,0);const $n=vn-ne,qs=Yi-ne,lr=vn+ne,oa=Yi+ne;if(oe=oe&&this.isOffscreen($n,qs,lr,oa),qt=qt||this.isInsideGrid($n,qs,lr,oa),n!=="always"&&this.grid.hitTestCircle(vn,Yi,ne,n,q)&&(Vt=!0,!B))return{circles:[],offscreen:!1,collisionDetected:Vt}}}}return{circles:!B&&Vt||!qt||Ft<this.perspectiveRatioCutoff?[]:dt,offscreen:oe,collisionDetected:Vt}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let p=1/0,m=1/0,x=-1/0,E=-1/0;for(const U of n){const q=new a.P(U.x+At,U.y+At);p=Math.min(p,q.x),m=Math.min(m,q.y),x=Math.max(x,q.x),E=Math.max(E,q.y),u.push(q)}const I=this.grid.query(p,m,x,E).concat(this.ignoredGrid.query(p,m,x,E)),D={},B={};for(const U of I){const q=U.key;if(D[q.bucketInstanceId]===void 0&&(D[q.bucketInstanceId]={}),D[q.bucketInstanceId][q.featureIndex])continue;const Y=[new a.P(U.x1,U.y1),new a.P(U.x2,U.y1),new a.P(U.x2,U.y2),new a.P(U.x1,U.y2)];a.am(u,Y)&&(D[q.bucketInstanceId][q.featureIndex]=!0,B[q.bucketInstanceId]===void 0&&(B[q.bucketInstanceId]=[]),B[q.bucketInstanceId].push(q.featureIndex))}return B}insertCollisionBox(n,u,p,m,x,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:E,overlapMode:u},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,u,p,m,x,E){const I=p?this.ignoredGrid:this.grid,D={bucketInstanceId:m,featureIndex:x,collisionGroupID:E,overlapMode:u};for(let B=0;B<n.length;B+=4)I.insertCircle(D,n[B],n[B+1],n[B+2])}projectAndGetPerspectiveRatio(n,u,p,m){let x;return m?(x=[u,p,m(u,p),1],a.af(x,x,n)):(x=[u,p,0,1],et(x,x,n)),{point:new a.P((x[0]/x[3]+1)/2*this.transform.width+At,(-x[1]/x[3]+1)/2*this.transform.height+At),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(n,u,p,m){return p<At||n>=this.screenRightBoundary||m<At||u>this.screenBottomBoundary}isInsideGrid(n,u,p,m){return p>=0&&n<this.gridRightBoundary&&m>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const n=a.an([]);return a.H(n,n,[-100,-100,0]),n}}function St(y,n,u){return n*(a.W/(y.tileSize*Math.pow(2,u-y.tileID.overscaledZ)))}class Ht{constructor(n,u,p,m){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class De{constructor(n,u,p,m,x){this.text=new Ht(n?n.text:null,u,p,x),this.icon=new Ht(n?n.icon:null,u,m,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class je{constructor(n,u,p){this.text=n,this.icon=u,this.skipFade=p}}class we{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class Ke{constructor(n,u,p,m,x){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=x}}class li{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:p=>p.collisionGroupID===u}}return this.collisionGroups[n]}}function pi(y,n,u,p,m){const{horizontalAlign:x,verticalAlign:E}=a.at(y);return new a.P(-(x-.5)*n+p[0]*m,-(E-.5)*u+p[1]*m)}function di(y,n,u,p,m,x){const{x1:E,x2:I,y1:D,y2:B,anchorPointX:U,anchorPointY:q}=y,Y=new a.P(n,u);return p&&Y._rotate(m?x:-x),{x1:E+Y.x,y1:D+Y.y,x2:I+Y.x,y2:B+Y.y,anchorPointX:U,anchorPointY:q}}class Mi{constructor(n,u,p,m,x){this.transform=n.clone(),this.terrain=u,this.collisionIndex=new Ot(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new li(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,u,p,m){const x=p.getBucket(u),E=p.latestFeatureIndex;if(!x||!E||u.id!==x.layerIds[0])return;const I=p.collisionBoxArray,D=x.layers[0].layout,B=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),U=p.tileSize/a.W,q=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),Y=D.get("text-pitch-alignment")==="map",ht=D.get("text-rotation-alignment")==="map",lt=St(p,1,this.transform.zoom),dt=Jt(q,Y,ht,this.transform,lt);let it=null;if(Y){const Ft=fe(q,Y,ht,this.transform,lt);it=a.K([],this.transform.labelPlaneMatrix,Ft)}this.retainedQueryData[x.bucketInstanceId]=new Ke(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,p.tileID);const wt={bucket:x,layout:D,posMatrix:q,textLabelPlaneMatrix:dt,labelToScreenMatrix:it,scale:B,textPixelRatio:U,holdingForFade:p.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:a.ag(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(m)for(const Ft of x.sortKeyRanges){const{sortKey:gt,symbolInstanceStart:Ct,symbolInstanceEnd:Nt}=Ft;n.push({sortKey:gt,symbolInstanceStart:Ct,symbolInstanceEnd:Nt,parameters:wt})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:wt})}attemptAnchorPlacement(n,u,p,m,x,E,I,D,B,U,q,Y,ht,lt,dt,it){const wt=a.ap[n.textAnchor],Ft=[n.textOffset0,n.textOffset1],gt=pi(wt,p,m,Ft,x),Ct=this.collisionIndex.placeCollisionBox(di(u,gt.x,gt.y,E,I,this.transform.angle),q,D,B,U.predicate,it);if((!dt||this.collisionIndex.placeCollisionBox(di(dt,gt.x,gt.y,E,I,this.transform.angle),q,D,B,U.predicate,it).box.length!==0)&&Ct.box.length>0){let Nt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(Nt=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),Y.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Y.crossTileID]={textOffset:Ft,width:p,height:m,anchor:wt,textBoxScale:x,prevAnchor:Nt},this.markUsedJustification(ht,wt,Y,lt),ht.allowVerticalPlacement&&(this.markUsedOrientation(ht,lt,Y),this.placedOrientations[Y.crossTileID]=lt),{shift:gt,placedGlyphBoxes:Ct}}}placeLayerBucketPart(n,u,p){const{bucket:m,layout:x,posMatrix:E,textLabelPlaneMatrix:I,labelToScreenMatrix:D,textPixelRatio:B,holdingForFade:U,collisionBoxArray:q,partiallyEvaluatedTextSize:Y,collisionGroup:ht}=n.parameters,lt=x.get("text-optional"),dt=x.get("icon-optional"),it=a.aq(x,"text-overlap","text-allow-overlap"),wt=it==="always",Ft=a.aq(x,"icon-overlap","icon-allow-overlap"),gt=Ft==="always",Ct=x.get("text-rotation-alignment")==="map",Nt=x.get("text-pitch-alignment")==="map",Vt=x.get("icon-text-fit")!=="none",qt=x.get("symbol-z-order")==="viewport-y",oe=wt&&(gt||!m.hasIconData()||dt),ne=gt&&(wt||!m.hasTextData()||lt);!m.collisionArrays&&q&&m.deserializeCollisionBoxes(q);const ae=this.retainedQueryData[m.bucketInstanceId].tileID,Be=this.terrain?(Se,hi)=>this.terrain.getElevation(ae,Se,hi):null,_i=(Se,hi)=>{var vi,Ei;if(u[Se.crossTileID])return;if(U)return void(this.placements[Se.crossTileID]=new je(!1,!1,!1));let fi=!1,bi=!1,wi=!0,an=null,qi={box:null,offscreen:null},os={box:null,offscreen:null},vn=null,Yi=null,$n=null,qs=0,lr=0,oa=0;hi.textFeatureIndex?qs=hi.textFeatureIndex:Se.useRuntimeCollisionCircles&&(qs=Se.featureIndex),hi.verticalTextFeatureIndex&&(lr=hi.verticalTextFeatureIndex);const la=hi.textBox;if(la){const hn=en=>{let On=a.ah.horizontal;if(m.allowVerticalPlacement&&!en&&this.prevPlacement){const bs=this.prevPlacement.placedOrientations[Se.crossTileID];bs&&(this.placedOrientations[Se.crossTileID]=bs,On=bs,this.markUsedOrientation(m,On,Se))}return On},Qi=(en,On)=>{if(m.allowVerticalPlacement&&Se.numVerticalGlyphVertices>0&&hi.verticalTextBox){for(const bs of m.writingModes)if(bs===a.ah.vertical?(qi=On(),os=qi):qi=en(),qi&&qi.box&&qi.box.length)break}else qi=en()},dn=Se.textAnchorOffsetStartIndex,Ya=Se.textAnchorOffsetEndIndex;if(Ya===dn){const en=(On,bs)=>{const Ti=this.collisionIndex.placeCollisionBox(On,it,B,E,ht.predicate,Be);return Ti&&Ti.box&&Ti.box.length&&(this.markUsedOrientation(m,bs,Se),this.placedOrientations[Se.crossTileID]=bs),Ti};Qi(()=>en(la,a.ah.horizontal),()=>{const On=hi.verticalTextBox;return m.allowVerticalPlacement&&Se.numVerticalGlyphVertices>0&&On?en(On,a.ah.vertical):{box:null,offscreen:null}}),hn(qi&&qi.box&&qi.box.length)}else{let en=a.ap[(Ei=(vi=this.prevPlacement)===null||vi===void 0?void 0:vi.variableOffsets[Se.crossTileID])===null||Ei===void 0?void 0:Ei.anchor];const On=(Ti,qc,hf)=>{const ha=Ti.x2-Ti.x1,ca=Ti.y2-Ti.y1,Xl=Se.textBoxScale,$c=Vt&&Ft==="never"?qc:null;let ua={box:[],offscreen:!1},cf=it==="never"?1:2,jc="never";en&&cf++;for(let uf=0;uf<cf;uf++){for(let Ho=dn;Ho<Ya;Ho++){const df=m.textAnchorOffsets.get(Ho);if(en&&df.textAnchor!==en)continue;const Wo=this.attemptAnchorPlacement(df,Ti,ha,ca,Xl,Ct,Nt,B,E,ht,jc,Se,m,hf,$c,Be);if(Wo&&(ua=Wo.placedGlyphBoxes,ua&&ua.box&&ua.box.length))return fi=!0,an=Wo.shift,ua}en?en=null:jc=it}return ua};Qi(()=>On(la,hi.iconBox,a.ah.horizontal),()=>{const Ti=hi.verticalTextBox;return m.allowVerticalPlacement&&!(qi&&qi.box&&qi.box.length)&&Se.numVerticalGlyphVertices>0&&Ti?On(Ti,hi.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),qi&&(fi=qi.box,wi=qi.offscreen);const bs=hn(qi&&qi.box);if(!fi&&this.prevPlacement){const Ti=this.prevPlacement.variableOffsets[Se.crossTileID];Ti&&(this.variableOffsets[Se.crossTileID]=Ti,this.markUsedJustification(m,Ti.anchor,Se,bs))}}}if(vn=qi,fi=vn&&vn.box&&vn.box.length>0,wi=vn&&vn.offscreen,Se.useRuntimeCollisionCircles){const hn=m.text.placedSymbolArray.get(Se.centerJustifiedTextSymbolIndex),Qi=a.ai(m.textSizeData,Y,hn),dn=x.get("text-padding");Yi=this.collisionIndex.placeCollisionCircles(it,hn,m.lineVertexArray,m.glyphOffsetArray,Qi,E,I,D,p,Nt,ht.predicate,Se.collisionCircleDiameter,dn,Be),Yi.circles.length&&Yi.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),fi=wt||Yi.circles.length>0&&!Yi.collisionDetected,wi=wi&&Yi.offscreen}if(hi.iconFeatureIndex&&(oa=hi.iconFeatureIndex),hi.iconBox){const hn=Qi=>{const dn=Vt&&an?di(Qi,an.x,an.y,Ct,Nt,this.transform.angle):Qi;return this.collisionIndex.placeCollisionBox(dn,Ft,B,E,ht.predicate,Be)};os&&os.box&&os.box.length&&hi.verticalIconBox?($n=hn(hi.verticalIconBox),bi=$n.box.length>0):($n=hn(hi.iconBox),bi=$n.box.length>0),wi=wi&&$n.offscreen}const hr=lt||Se.numHorizontalGlyphVertices===0&&Se.numVerticalGlyphVertices===0,$s=dt||Se.numIconVertices===0;if(hr||$s?$s?hr||(bi=bi&&fi):fi=bi&&fi:bi=fi=bi&&fi,fi&&vn&&vn.box&&this.collisionIndex.insertCollisionBox(vn.box,it,x.get("text-ignore-placement"),m.bucketInstanceId,os&&os.box&&lr?lr:qs,ht.ID),bi&&$n&&this.collisionIndex.insertCollisionBox($n.box,Ft,x.get("icon-ignore-placement"),m.bucketInstanceId,oa,ht.ID),Yi&&(fi&&this.collisionIndex.insertCollisionCircles(Yi.circles,it,x.get("text-ignore-placement"),m.bucketInstanceId,qs,ht.ID),p)){const hn=m.bucketInstanceId;let Qi=this.collisionCircleArrays[hn];Qi===void 0&&(Qi=this.collisionCircleArrays[hn]=new we);for(let dn=0;dn<Yi.circles.length;dn+=4)Qi.circles.push(Yi.circles[dn+0]),Qi.circles.push(Yi.circles[dn+1]),Qi.circles.push(Yi.circles[dn+2]),Qi.circles.push(Yi.collisionDetected?1:0)}if(Se.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Se.crossTileID]=new je(fi||oe,bi||ne,wi||m.justReloaded),u[Se.crossTileID]=!0};if(qt){if(n.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Se=m.getSortedSymbolIndexes(this.transform.angle);for(let hi=Se.length-1;hi>=0;--hi){const vi=Se[hi];_i(m.symbolInstances.get(vi),m.collisionArrays[vi])}}else for(let Se=n.symbolInstanceStart;Se<n.symbolInstanceEnd;Se++)_i(m.symbolInstances.get(Se),m.collisionArrays[Se]);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const Se=this.collisionCircleArrays[m.bucketInstanceId];a.ar(Se.invProjMatrix,E),Se.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(n,u,p,m){let x;x=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.as(u)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const I of E)I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=x>=0&&I!==x?0:p.crossTileID)}markUsedOrientation(n,u,p){const m=u===a.ah.horizontal||u===a.ah.horizontalOnly?u:0,x=u===a.ah.vertical?u:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const I of E)n.text.placedSymbolArray.get(I).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let p=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const m=u?u.symbolFadeChange(n):1,x=u?u.opacities:{},E=u?u.variableOffsets:{},I=u?u.placedOrientations:{};for(const D in this.placements){const B=this.placements[D],U=x[D];U?(this.opacities[D]=new De(U,m,B.text,B.icon),p=p||B.text!==U.text.placed||B.icon!==U.icon.placed):(this.opacities[D]=new De(null,m,B.text,B.icon,B.skipFade),p=p||B.text||B.icon)}for(const D in x){const B=x[D];if(!this.opacities[D]){const U=new De(B,m,!1,!1);U.isHidden()||(this.opacities[D]=U,p=p||B.text.placed||B.icon.placed)}}for(const D in E)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=E[D]);for(const D in I)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=I[D]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)}updateLayerOpacities(n,u){const p={};for(const m of u){const x=m.getBucket(n);x&&m.latestFeatureIndex&&n.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,m.collisionBoxArray)}}updateBucketOpacities(n,u,p){n.hasTextData()&&(n.text.opacityVertexArray.clear(),n.text.hasVisibleVertices=!1),n.hasIconData()&&(n.icon.opacityVertexArray.clear(),n.icon.hasVisibleVertices=!1),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const m=n.layers[0],x=m.layout,E=new De(null,0,!1,!1,!0),I=x.get("text-allow-overlap"),D=x.get("icon-allow-overlap"),B=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),U=x.get("text-rotation-alignment")==="map",q=x.get("text-pitch-alignment")==="map",Y=x.get("icon-text-fit")!=="none",ht=new De(null,0,I&&(D||!n.hasIconData()||x.get("icon-optional")),D&&(I||!n.hasTextData()||x.get("text-optional")),!0);!n.collisionArrays&&p&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(p);const lt=(dt,it,wt)=>{for(let Ft=0;Ft<it/4;Ft++)dt.opacityVertexArray.emplaceBack(wt);dt.hasVisibleVertices=dt.hasVisibleVertices||wt!==cn};for(let dt=0;dt<n.symbolInstances.length;dt++){const it=n.symbolInstances.get(dt),{numHorizontalGlyphVertices:wt,numVerticalGlyphVertices:Ft,crossTileID:gt}=it;let Ct=this.opacities[gt];u[gt]?Ct=E:Ct||(Ct=ht,this.opacities[gt]=Ct),u[gt]=!0;const Nt=it.numIconVertices>0,Vt=this.placedOrientations[it.crossTileID],qt=Vt===a.ah.vertical,oe=Vt===a.ah.horizontal||Vt===a.ah.horizontalOnly;if(wt>0||Ft>0){const ne=To(Ct.text);lt(n.text,wt,qt?cn:ne),lt(n.text,Ft,oe?cn:ne);const ae=Ct.text.isHidden();[it.rightJustifiedTextSymbolIndex,it.centerJustifiedTextSymbolIndex,it.leftJustifiedTextSymbolIndex].forEach(Se=>{Se>=0&&(n.text.placedSymbolArray.get(Se).hidden=ae||qt?1:0)}),it.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(it.verticalPlacedTextSymbolIndex).hidden=ae||oe?1:0);const Be=this.variableOffsets[it.crossTileID];Be&&this.markUsedJustification(n,Be.anchor,it,Vt);const _i=this.placedOrientations[it.crossTileID];_i&&(this.markUsedJustification(n,"left",it,_i),this.markUsedOrientation(n,_i,it))}if(Nt){const ne=To(Ct.icon),ae=!(Y&&it.verticalPlacedIconSymbolIndex&&qt);it.placedIconSymbolIndex>=0&&(lt(n.icon,it.numIconVertices,ae?ne:cn),n.icon.placedSymbolArray.get(it.placedIconSymbolIndex).hidden=Ct.icon.isHidden()),it.verticalPlacedIconSymbolIndex>=0&&(lt(n.icon,it.numVerticalIconVertices,ae?cn:ne),n.icon.placedSymbolArray.get(it.verticalPlacedIconSymbolIndex).hidden=Ct.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const ne=n.collisionArrays[dt];if(ne){let ae=new a.P(0,0);if(ne.textBox||ne.verticalTextBox){let _i=!0;if(B){const Se=this.variableOffsets[gt];Se?(ae=pi(Se.anchor,Se.width,Se.height,Se.textOffset,Se.textBoxScale),U&&ae._rotate(q?this.transform.angle:-this.transform.angle)):_i=!1}ne.textBox&&Gi(n.textCollisionBox.collisionVertexArray,Ct.text.placed,!_i||qt,ae.x,ae.y),ne.verticalTextBox&&Gi(n.textCollisionBox.collisionVertexArray,Ct.text.placed,!_i||oe,ae.x,ae.y)}const Be=!!(!oe&&ne.verticalIconBox);ne.iconBox&&Gi(n.iconCollisionBox.collisionVertexArray,Ct.icon.placed,Be,Y?ae.x:0,Y?ae.y:0),ne.verticalIconBox&&Gi(n.iconCollisionBox.collisionVertexArray,Ct.icon.placed,!Be,Y?ae.x:0,Y?ae.y:0)}}}if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.text.opacityVertexArray.length!==n.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${n.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${n.text.layoutVertexArray.length}) / 4`);if(n.icon.opacityVertexArray.length!==n.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${n.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${n.icon.layoutVertexArray.length}) / 4`);if(n.bucketInstanceId in this.collisionCircleArrays){const dt=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=dt.invProjMatrix,n.placementViewportMatrix=dt.viewportMatrix,n.collisionCircleArray=dt.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,u){const p=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function Gi(y,n,u,p,m){y.emplaceBack(n?1:0,u?1:0,p||0,m||0),y.emplaceBack(n?1:0,u?1:0,p||0,m||0),y.emplaceBack(n?1:0,u?1:0,p||0,m||0),y.emplaceBack(n?1:0,u?1:0,p||0,m||0)}const ss=Math.pow(2,25),gr=Math.pow(2,24),mi=Math.pow(2,17),Pi=Math.pow(2,16),Kr=Math.pow(2,9),Oi=Math.pow(2,8),fn=Math.pow(2,1);function To(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const n=y.placed?1:0,u=Math.floor(127*y.opacity);return u*ss+n*gr+u*mi+n*Pi+u*Kr+n*Oi+u*fn+n}const cn=0;class Wn{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,u,p,m,x){const E=this._bucketParts;for(;this._currentTileIndex<n.length;)if(u.getBucketParts(E,m,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((I,D)=>I.sortKey-D.sortKey));this._currentPartIndex<E.length;)if(u.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,x())return!0;return!1}}class Fn{constructor(n,u,p,m,x,E,I,D){this.placement=new Mi(n,u,E,I,D),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(n,u,p){const m=M.now(),x=()=>!this._forceFullPlacement&&M.now()-m>2;for(;this._currentPlacementIndex>=0;){const E=u[n[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=I)&&(!E.maxzoom||E.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Wn(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const qn=512/a.W/2;class sn{constructor(n,u,p){this.tileID=n,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let x=0;x<u.length;x++){const E=u.get(x),I=E.key,D=m.get(I);D?D.push(E):m.set(I,[E])}for(const[x,E]of m){const I={positions:E.map(D=>({x:Math.floor(D.anchorX*qn),y:Math.floor(D.anchorY*qn)})),crossTileIDs:E.map(D=>D.crossTileID)};if(I.positions.length>128){const D=new a.au(I.positions.length,16,Uint16Array);for(const{x:B,y:U}of I.positions)D.add(B,U);D.finish(),delete I.positions,I.index=D}this._symbolsByKey[x]=I}}getScaledCoordinates(n,u){const{x:p,y:m,z:x}=this.tileID.canonical,{x:E,y:I,z:D}=u.canonical,B=qn/Math.pow(2,D-x),U=(I*a.W+n.anchorY)*B,q=m*a.W*qn;return{x:Math.floor((E*a.W+n.anchorX)*B-p*a.W*qn),y:Math.floor(U-q)}}findMatches(n,u,p){const m=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let x=0;x<n.length;x++){const E=n.get(x);if(E.crossTileID)continue;const I=this._symbolsByKey[E.key];if(!I)continue;const D=this.getScaledCoordinates(E,u);if(I.index){const B=I.index.range(D.x-m,D.y-m,D.x+m,D.y+m).sort();for(const U of B){const q=I.crossTileIDs[U];if(!p[q]){p[q]=!0,E.crossTileID=q;break}}}else if(I.positions)for(let B=0;B<I.positions.length;B++){const U=I.positions[B],q=I.crossTileIDs[B];if(Math.abs(U.x-D.x)<=m&&Math.abs(U.y-D.y)<=m&&!p[q]){p[q]=!0,E.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:n})=>n)}}class Mn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Vs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const u=Math.round((n-this.lng)/360);if(u!==0)for(const p in this.indexes){const m=this.indexes[p],x={};for(const E in m){const I=m[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+u),x[I.tileID.key]=I}this.indexes[p]=x}this.lng=n}addBucket(n,u,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let x=0;x<u.symbolInstances.length;x++)u.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const m=this.usedCrossTileIDs[n.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>n.overscaledZ)for(const I in E){const D=E[I];D.tileID.isChildOf(n)&&D.findMatches(u.symbolInstances,n,m)}else{const I=E[n.scaledTo(Number(x)).key];I&&I.findMatches(u.symbolInstances,n,m)}}for(let x=0;x<u.symbolInstances.length;x++){const E=u.symbolInstances.get(x);E.crossTileID||(E.crossTileID=p.generate(),m[E.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new sn(n,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(n,u){for(const p of u.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[n][m]}removeStaleBuckets(n){let u=!1;for(const p in this.indexes){const m=this.indexes[p];for(const x in m)n[m[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[x]),delete m[x],u=!0)}return u}}class rn{constructor(){this.layerIndexes={},this.crossTileIDs=new Mn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,u,p){let m=this.layerIndexes[n.id];m===void 0&&(m=this.layerIndexes[n.id]=new Vs);let x=!1;const E={};m.handleWrapJump(p);for(const I of u){const D=I.getBucket(n);D&&n.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(I.tileID,D,this.crossTileIDs)&&(x=!0),E[D.bucketInstanceId]=!0)}return m.removeStaleBuckets(E)&&(x=!0),x}pruneUnusedLayers(n){const u={};n.forEach(p=>{u[p]=!0});for(const p in this.layerIndexes)u[p]||delete this.layerIndexes[p]}}const nr=(y,n)=>a.t(y,n&&n.filter(u=>u.identifier!=="source.canvas")),Gs=a.av();class wl extends a.E{constructor(n,u={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=n,this.dispatcher=new ci(ei(),n._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("getImages",(p,m)=>this.getImages(p,m)),this.imageManager=new Dt,this.imageManager.setEventedParent(this),this.glyphManager=new ie(n._requestManager,u.localIdeographFontFamily),this.lineAtlas=new _e(256,512),this.crossTileSymbolIndex=new rn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.ax()),Zt().on(ke,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const x=m.getSource();if(x&&x.vectorLayerIds)for(const E in this._layers){const I=this._layers[E];I.source===x.id&&this._validateLayer(I)}})}loadURL(n,u={},p){this.fire(new a.k("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;const m=this.map._requestManager.transformRequest(n,H.Style);this._loadStyleRequest=new AbortController,a.h(m,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,u,p)}).catch(x=>{this._loadStyleRequest=null,x&&this.fire(new a.j(x))})}loadJSON(n,u={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,M.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(n,u,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(Gs,{validate:!1})}_load(n,u,p){var m;const x=u.transformStyle?u.transformStyle(p,n):n;if(!u.validate||!nr(this,a.x(x))){this._loaded=!0,this.stylesheet=x;for(const E in x.sources)this.addSource(E,x.sources[E],{validate:!1});x.sprite?this._loadSprite(x.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(x.glyphs),this._createLayers(),this.light=new $e(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const n=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",n),this._order=n.map(u=>u.id),this._layers={},this._serializedLayers=null;for(const u of n){const p=a.az(u);p.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=p}}_loadSprite(n,u=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(x,E,I,D){return a._(this,void 0,void 0,function*(){const B=kt(x),U=I>1?"@2x":"",q={},Y={};for(const{id:ht,url:lt}of B){const dt=E.transformRequest(E.normalizeSpriteURL(lt,U,".json"),H.SpriteJSON);q[ht]=a.h(dt,D);const it=E.transformRequest(E.normalizeSpriteURL(lt,U,".png"),H.SpriteImage);Y[ht]=G.getImage(it,D)}return yield Promise.all([...Object.values(q),...Object.values(Y)]),function(ht,lt){return a._(this,void 0,void 0,function*(){const dt={};for(const it in ht){dt[it]={};const wt=M.getImageCanvasContext((yield lt[it]).data),Ft=(yield ht[it]).data;for(const gt in Ft){const{width:Ct,height:Nt,x:Vt,y:qt,sdf:oe,pixelRatio:ne,stretchX:ae,stretchY:Be,content:_i}=Ft[gt];dt[it][gt]={data:null,pixelRatio:ne,sdf:oe,stretchX:ae,stretchY:Be,content:_i,spriteData:{width:Ct,height:Nt,x:Vt,y:qt,context:wt}}}}return dt})}(q,Y)})}(n,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(x=>{if(this._spriteRequest=null,x)for(const E in x){this._spritesImagesIds[E]=[];const I=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(D=>!(D in x)):[];for(const D of I)this.imageManager.removeImage(D),this._changedImages[D]=!0;for(const D in x[E]){const B=E==="default"?D:`${E}:${D}`;this._spritesImagesIds[E].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,x[E][D],!1):this.imageManager.addImage(B,x[E][D]),u&&(this._changedImages[B]=!0)}}}).catch(x=>{this._spriteRequest=null,m=x,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const n of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(n),this._changedImages[n]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(n){const u=this.sourceCaches[n.source];if(!u)return;const p=n.sourceLayer;if(!p)return;const m=u.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(n){const u=this._serializedAllLayers();if(!n||n.length===0)return Object.values(u);const p=[];for(const m of n)u[m]&&p.push(u[m]);return p}_serializedAllLayers(){let n=this._serializedLayers;if(n)return n;n=this._serializedLayers={};const u=Object.keys(this._layers);for(const p of u){const m=this._layers[p];m.type!=="custom"&&(n[p]=m.serialize())}return n}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const n in this.sourceCaches)if(this.sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;const u=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(m.length||x.length)&&this._updateWorkerLayers(m,x);for(const E in this._updatedSources){const I=this._updatedSources[E];if(I==="reload")this._reloadSource(E);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(n);this.light.updateTransitions(n),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const x=this.sourceCaches[m];p[m]=x.used,x.used=!1}for(const m of this._order){const x=this._layers[m];x.recalculate(n,this._availableImages),!x.isHidden(n.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const m in p){const x=this.sourceCaches[m];p[m]!==x.used&&x.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(n),this.z=n.zoom,u&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(n,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(n),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(n,u={}){var p;this._checkLoaded();const m=this.serialize();if(n=u.transformStyle?u.transformStyle(m,n):n,((p=u.validate)===null||p===void 0||p)&&nr(this,a.x(n)))return!1;(n=a.aA(n)).layers=a.ay(n.layers);const x=a.aB(m,n),E=this._getOperationsToPerform(x);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const I of E.operations)I();return this.stylesheet=n,this._serializedLayers=null,!0}_getOperationsToPerform(n){const u=[],p=[];for(const m of n)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":u.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":u.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":u.push(()=>{});break;default:p.push(m.command)}return{operations:u,unimplemented:p}}addImage(n,u){if(this.getImage(n))return this.fire(new a.j(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,u),this._afterImageUpdated(n)}updateImage(n,u){this.imageManager.updateImage(n,u)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new a.j(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,u,p={}){if(this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error(`Source "${n}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(a.x.source,`sources.${n}`,u,null,p))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const m=this.sourceCaches[n]=new Bt(n,u,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:n})),m.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===n)return this.fire(new a.j(new Error(`Source "${n}" cannot be removed while layer "${p}" is using it.`)));const u=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],u.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,u){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error(`There is no source with this ID=${n}`);const p=this.sourceCaches[n].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(u),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,u,p={}){this._checkLoaded();const m=n.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let x;if(n.type==="custom"){if(nr(this,a.aC(n)))return;x=a.az(n)}else{if("source"in n&&typeof n.source=="object"&&(this.addSource(m,n.source),n=a.aA(n),n=a.e(n,{source:m})),this._validate(a.x.layer,`layers.${m}`,n,{arrayIndex:-1},p))return;x=a.az(n),this._validateLayer(x),x.setEventedParent(this,{layer:{id:m}})}const E=u?this._order.indexOf(u):this._order.length;if(u&&E===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${u}".`)));else{if(this._order.splice(E,0,m),this._layerOrderChanged=!0,this._layers[m]=x,this._removedLayers[m]&&x.source&&x.type!=="custom"){const I=this._removedLayers[m];delete this._removedLayers[m],I.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(n,u){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new a.j(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===u)return;const p=this._order.indexOf(n);this._order.splice(p,1);const m=u?this._order.indexOf(u):this._order.length;u&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${n}" before non-existing layer "${u}".`))):(this._order.splice(m,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();const u=this._layers[n];if(!u)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${n}".`)));u.setEventedParent(null);const p=this._order.indexOf(n);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=u,delete this._layers[n],this._serializedLayers&&delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],u.onRemove&&u.onRemove(this.map)}getLayer(n){return this._layers[n]}getLayersOrder(){return[...this._order]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,u,p){this._checkLoaded();const m=this.getLayer(n);m?m.minzoom===u&&m.maxzoom===p||(u!=null&&(m.minzoom=u),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,u,p={}){this._checkLoaded();const m=this.getLayer(n);if(m){if(!a.aD(m.filter,u))return u==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.x.filter,`layers.${m.id}.filter`,u,null,p)||(m.filter=a.aA(u),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return a.aA(this.getLayer(n).filter)}setLayoutProperty(n,u,p,m={}){this._checkLoaded();const x=this.getLayer(n);x?a.aD(x.getLayoutProperty(u),p)||(x.setLayoutProperty(u,p,m),this._updateLayer(x)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,u){const p=this.getLayer(n);if(p)return p.getLayoutProperty(u);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,u,p,m={}){this._checkLoaded();const x=this.getLayer(n);x?a.aD(x.getPaintProperty(u),p)||(x.setPaintProperty(u,p,m)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new a.j(new Error(`Cannot style non-existing layer "${n}".`)))}getPaintProperty(n,u){return this.getLayer(n).getPaintProperty(u)}setFeatureState(n,u){this._checkLoaded();const p=n.source,m=n.sourceLayer,x=this.sourceCaches[p];if(x===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const E=x.getSource().type;E==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||m?(n.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),x.setFeatureState(m,n.id,u)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,u){this._checkLoaded();const p=n.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const x=m.getSource().type,E=x==="vector"?n.sourceLayer:void 0;x!=="vector"||E?u&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(E,n.id,u):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();const u=n.source,p=n.sourceLayer,m=this.sourceCaches[u];if(m!==void 0)return m.getSource().type!=="vector"||p?(n.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,n.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const n=a.aE(this.sourceCaches,x=>x.serialize()),u=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:n,layers:u,terrain:p},x=>x!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(n){const u=E=>this._layers[E].type==="fill-extrusion",p={},m=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(u(I)){p[I]=E;for(const D of n){const B=D[I];if(B)for(const U of B)m.push(U)}}}m.sort((E,I)=>I.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(u(I))for(let D=m.length-1;D>=0;D--){const B=m[D].feature;if(p[B.layer.id]<E)break;x.push(B),m.pop()}else for(const D of n){const B=D[I];if(B)for(const U of B)x.push(U.feature)}}return x}queryRenderedFeatures(n,u,p){u&&u.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",u.filter,null,u);const m={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const I of u.layers){const D=this._layers[I];if(!D)return this.fire(new a.j(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];m[D.source]=!0}}const x=[];u.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const I in this.sourceCaches)u.layers&&!m[I]||x.push(le(this.sourceCaches[I],this._layers,E,n,u,p));return this.placement&&x.push(function(I,D,B,U,q,Y,ht){const lt={},dt=Y.queryRenderedSymbols(U),it=[];for(const wt of Object.keys(dt).map(Number))it.push(ht[wt]);it.sort(Kt);for(const wt of it){const Ft=wt.featureIndex.lookupSymbolFeatures(dt[wt.bucketInstanceId],D,wt.bucketIndex,wt.sourceLayerIndex,q.filter,q.layers,q.availableImages,I);for(const gt in Ft){const Ct=lt[gt]=lt[gt]||[],Nt=Ft[gt];Nt.sort((Vt,qt)=>{const oe=wt.featureSortOrder;if(oe){const ne=oe.indexOf(Vt.featureIndex);return oe.indexOf(qt.featureIndex)-ne}return qt.featureIndex-Vt.featureIndex});for(const Vt of Nt)Ct.push(Vt)}}for(const wt in lt)lt[wt].forEach(Ft=>{const gt=Ft.feature,Ct=B[I[wt].source].getFeatureState(gt.layer["source-layer"],gt.id);gt.source=gt.layer.source,gt.layer["source-layer"]&&(gt.sourceLayer=gt.layer["source-layer"]),gt.state=Ct});return lt}(this._layers,E,this.sourceCaches,n,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(n,u){u&&u.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",u.filter,null,u);const p=this.sourceCaches[n];return p?function(m,x){const E=m.getRenderableIds().map(B=>m.getTileByID(B)),I=[],D={};for(let B=0;B<E.length;B++){const U=E[B],q=U.tileID.canonical.key;D[q]||(D[q]=!0,U.querySourceFeatures(I,x))}return I}(p,u):[]}getLight(){return this.light.getLight()}setLight(n,u={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const E in n)if(!a.aD(n[E],p[E])){m=!0;break}if(!m)return;const x={now:M.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,u),this.light.updateTransitions(x)}_validate(n,u,p,m,x={}){return(!x||x.validate!==!1)&&nr(this,n.call(a.x,a.e({key:u,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(n=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Zt().off(ke,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const p=this.sourceCaches[u];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),n&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(n)}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(const u in this.sourceCaches)this.sourceCaches[u].update(n,this.map.terrain)}_generateCollisionBoxes(){for(const n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,u,p,m,x=!1){let E=!1,I=!1;const D={};for(const B of this._order){const U=this._layers[B];if(U.type!=="symbol")continue;if(!D[U.source]){const Y=this.sourceCaches[U.source];D[U.source]=Y.getRenderableIds(!0).map(ht=>Y.getTileByID(ht)).sort((ht,lt)=>lt.tileID.overscaledZ-ht.tileID.overscaledZ||(ht.tileID.isLessThan(lt.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(U,D[U.source],n.center.lng);E=E||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(M.now(),n.zoom))&&(this.pauseablePlacement=new Fn(n,this.map.terrain,this._order,x,u,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(M.now()),I=!0),E&&this.pauseablePlacement.placement.setStale()),I||E)for(const B of this._order){const U=this._layers[B];U.type==="symbol"&&this.placement.updateLayerOpacities(U,D[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(M.now())}_releaseSymbolFadeTiles(){for(const n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,u){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[u.source];return m&&m.setDependencies(u.tileID.key,u.type,u.icons),p})}getGlyphs(n,u){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(u.stacks),m=this.sourceCaches[u.source];return m&&m.setDependencies(u.tileID.key,u.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(n,u={}){this._checkLoaded(),n&&this._validate(a.x.glyphs,"glyphs",n,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=n,this.glyphManager.entries={},this.glyphManager.setURL(n))}addSprite(n,u,p={},m){this._checkLoaded();const x=[{id:n,url:u}],E=[...kt(this.stylesheet.sprite),...x];this._validate(a.x.sprite,"sprite",E,null,p)||(this.stylesheet.sprite=E,this._loadSprite(x,!0,m))}removeSprite(n){this._checkLoaded();const u=kt(this.stylesheet.sprite);if(u.find(p=>p.id===n)){if(this._spritesImagesIds[n])for(const p of this._spritesImagesIds[n])this.imageManager.removeImage(p),this._changedImages[p]=!0;u.splice(u.findIndex(p=>p.id===n),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[n],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${n}" doesn't exists on this map.`)))}getSprite(){return kt(this.stylesheet.sprite)}setSprite(n,u={},p){this._checkLoaded(),n&&this._validate(a.x.sprite,"sprite",n,null,u)||(this.stylesheet.sprite=n,n?this._loadSprite(n,!0,p):(this._unloadSprite(),p&&p(null)))}}var sr=a.X([{name:"a_pos",type:"Int16",components:2}]),sc="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const La={prelude:Ni(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ni(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ni(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ni(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ni("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ni(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ni(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ni("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ni("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ni(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ni(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ni(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ni(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ni(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ni(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ni(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ni(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ni(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ni(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ni(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ni(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ni(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ni(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ni("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",sc),terrainDepth:Ni("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",sc),terrainCoords:Ni("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",sc)};function Ni(y,n){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=n.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=x?x.concat(m):m,I={};return{fragmentSource:y=y.replace(u,(D,B,U,q,Y)=>(I[Y]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
varying ${U} ${q} ${Y};
#else
uniform ${U} ${q} u_${Y};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Y}
    ${U} ${q} ${Y} = u_${Y};
#endif
`)),vertexSource:n=n.replace(u,(D,B,U,q,Y)=>{const ht=q==="float"?"vec2":"vec4",lt=Y.match(/color/)?"color":ht;return I[Y]?B==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${U} ${ht} a_${Y};
varying ${U} ${q} ${Y};
#else
uniform ${U} ${q} u_${Y};
#endif
`:lt==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${U} ${q} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${lt}(a_${Y}, u_${Y}_t);
#else
    ${U} ${q} ${Y} = u_${Y};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${U} ${ht} a_${Y};
#else
uniform ${U} ${q} u_${Y};
#endif
`:lt==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${U} ${q} ${Y} = a_${Y};
#else
    ${U} ${q} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${U} ${q} ${Y} = unpack_mix_${lt}(a_${Y}, u_${Y}_t);
#else
    ${U} ${q} ${Y} = u_${Y};
#endif
`}),staticAttributes:p,staticUniforms:E}}class Ml{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,u,p,m,x,E,I,D,B){this.context=n;let U=this.boundPaintVertexBuffers.length!==m.length;for(let q=0;!U&&q<m.length;q++)this.boundPaintVertexBuffers[q]!==m[q]&&(U=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==p||U||this.boundIndexBuffer!==x||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==I||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==B?this.freshBind(u,p,m,x,E,I,D,B):(n.bindVertexArray.set(this.vao),I&&I.bind(),x&&x.dynamicDraw&&x.bind(),D&&D.bind(),B&&B.bind())}freshBind(n,u,p,m,x,E,I,D){const B=n.numAttributes,U=this.context,q=U.gl;this.vao&&this.destroy(),this.vao=U.createVertexArray(),U.bindVertexArray.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=D,u.enableAttributes(q,n);for(const Y of p)Y.enableAttributes(q,n);E&&E.enableAttributes(q,n),I&&I.enableAttributes(q,n),D&&D.enableAttributes(q,n),u.bind(),u.setVertexAttribPointers(q,n,x);for(const Y of p)Y.bind(),Y.setVertexAttribPointers(q,n,x);E&&(E.bind(),E.setVertexAttribPointers(q,n,x)),m&&m.bind(),I&&(I.bind(),I.setVertexAttribPointers(q,n,x)),D&&(D.bind(),D.setVertexAttribPointers(q,n,x)),U.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function rr(y){const n=[];for(let u=0;u<y.length;u++){if(y[u]===null)continue;const p=y[u].split(" ");n.push(p.pop())}return n}class rc{constructor(n,u,p,m,x,E){const I=n.gl;this.program=I.createProgram();const D=rr(u.staticAttributes),B=p?p.getBinderAttributes():[],U=D.concat(B),q=La.prelude.staticUniforms?rr(La.prelude.staticUniforms):[],Y=u.staticUniforms?rr(u.staticUniforms):[],ht=p?p.getBinderUniforms():[],lt=q.concat(Y).concat(ht),dt=[];for(const Vt of lt)dt.indexOf(Vt)<0&&dt.push(Vt);const it=p?p.defines():[];x&&it.push("#define OVERDRAW_INSPECTOR;"),E&&it.push("#define TERRAIN3D;");const wt=it.concat(La.prelude.fragmentSource,u.fragmentSource).join(`
`),Ft=it.concat(La.prelude.vertexSource,u.vertexSource).join(`
`),gt=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(gt,wt),I.compileShader(gt),!I.getShaderParameter(gt,I.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${I.getShaderInfoLog(gt)}`);I.attachShader(this.program,gt);const Ct=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(Ct,Ft),I.compileShader(Ct),!I.getShaderParameter(Ct,I.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${I.getShaderInfoLog(Ct)}`);I.attachShader(this.program,Ct),this.attributes={};const Nt={};this.numAttributes=U.length;for(let Vt=0;Vt<this.numAttributes;Vt++)U[Vt]&&(I.bindAttribLocation(this.program,Vt,U[Vt]),this.attributes[U[Vt]]=Vt);if(I.linkProgram(this.program),!I.getProgramParameter(this.program,I.LINK_STATUS))throw new Error(`Program failed to link: ${I.getProgramInfoLog(this.program)}`);I.deleteShader(Ct),I.deleteShader(gt);for(let Vt=0;Vt<dt.length;Vt++){const qt=dt[Vt];if(qt&&!Nt[qt]){const oe=I.getUniformLocation(this.program,qt);oe&&(Nt[qt]=oe)}}this.fixedUniforms=m(n,Nt),this.terrainUniforms=((Vt,qt)=>({u_depth:new a.aG(Vt,qt.u_depth),u_terrain:new a.aG(Vt,qt.u_terrain),u_terrain_dim:new a.aH(Vt,qt.u_terrain_dim),u_terrain_matrix:new a.aI(Vt,qt.u_terrain_matrix),u_terrain_unpack:new a.aJ(Vt,qt.u_terrain_unpack),u_terrain_exaggeration:new a.aH(Vt,qt.u_terrain_exaggeration)}))(n,Nt),this.binderUniforms=p?p.getUniforms(n,Nt):[]}draw(n,u,p,m,x,E,I,D,B,U,q,Y,ht,lt,dt,it,wt,Ft){const gt=n.gl;if(this.failedToCreate)return;if(n.program.set(this.program),n.setDepthMode(p),n.setStencilMode(m),n.setColorMode(x),n.setCullFace(E),D){n.activeTexture.set(gt.TEXTURE2),gt.bindTexture(gt.TEXTURE_2D,D.depthTexture),n.activeTexture.set(gt.TEXTURE3),gt.bindTexture(gt.TEXTURE_2D,D.texture);for(const Nt in this.terrainUniforms)this.terrainUniforms[Nt].set(D[Nt])}for(const Nt in this.fixedUniforms)this.fixedUniforms[Nt].set(I[Nt]);dt&&dt.setUniforms(n,this.binderUniforms,ht,{zoom:lt});let Ct=0;switch(u){case gt.LINES:Ct=2;break;case gt.TRIANGLES:Ct=3;break;case gt.LINE_STRIP:Ct=1}for(const Nt of Y.get()){const Vt=Nt.vaos||(Nt.vaos={});(Vt[B]||(Vt[B]=new Ml)).bind(n,this,U,dt?dt.getPaintVertexBuffers():[],q,Nt.vertexOffset,it,wt,Ft),gt.drawElements(u,Nt.primitiveLength*Ct,gt.UNSIGNED_SHORT,Nt.primitiveOffset*Ct*2)}}}function Eo(y,n,u){const p=1/St(u,1,n.transform.tileZoom),m=Math.pow(2,u.tileID.overscaledZ),x=u.tileSize*Math.pow(2,n.transform.tileZoom)/m,E=x*(u.tileID.canonical.x+u.tileID.wrap*m),I=x*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[E>>16,I>>16],u_pixel_coord_lower:[65535&E,65535&I]}}const Ed=(y,n,u,p)=>{const m=n.style.light,x=m.properties.get("position"),E=[x.x,x.y,x.z],I=function(){var B=new a.A(9);return a.A!=Float32Array&&(B[1]=0,B[2]=0,B[3]=0,B[5]=0,B[6]=0,B[7]=0),B[0]=1,B[4]=1,B[8]=1,B}();m.properties.get("anchor")==="viewport"&&function(B,U){var q=Math.sin(U),Y=Math.cos(U);B[0]=Y,B[1]=q,B[2]=0,B[3]=-q,B[4]=Y,B[5]=0,B[6]=0,B[7]=0,B[8]=1}(I,-n.transform.angle),function(B,U,q){var Y=U[0],ht=U[1],lt=U[2];B[0]=Y*q[0]+ht*q[3]+lt*q[6],B[1]=Y*q[1]+ht*q[4]+lt*q[7],B[2]=Y*q[2]+ht*q[5]+lt*q[8]}(E,E,I);const D=m.properties.get("color");return{u_matrix:y,u_lightpos:E,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+u,u_opacity:p}},hm=(y,n,u,p,m,x,E)=>a.e(Ed(y,n,u,p),Eo(x,n,E),{u_height_factor:-Math.pow(2,m.overscaledZ)/E.tileSize/8}),Sl=y=>({u_matrix:y}),Cd=(y,n,u,p)=>a.e(Sl(y),Eo(u,n,p)),Id=(y,n)=>({u_matrix:y,u_world:n}),cm=(y,n,u,p,m)=>a.e(Cd(y,n,u,p),{u_world:m}),Pd=(y,n,u,p)=>{const m=y.transform;let x,E;if(p.paint.get("circle-pitch-alignment")==="map"){const I=St(u,1,m.zoom);x=!0,E=[I,I]}else x=!1,E=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(n.posMatrix,u,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:E}},um=(y,n,u)=>{const p=St(u,1,n.zoom),m=Math.pow(2,n.zoom-u.tileID.overscaledZ),x=u.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:n.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[n.pixelsToGLUnits[0]/(p*m),n.pixelsToGLUnits[1]/(p*m)],u_overscale_factor:x}},Al=(y,n,u=1)=>({u_matrix:y,u_color:n,u_overlay:0,u_overlay_scale:u}),ac=y=>({u_matrix:y}),Ld=(y,n,u,p)=>({u_matrix:y,u_extrude_scale:St(n,1,u),u_intensity:p});function Rd(y,n){const u=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new a.Y(0,p/u).toLngLat().lat,new a.Y(0,(p+1)/u).toLngLat().lat]}const Tl=(y,n,u,p)=>{const m=y.transform;return{u_matrix:Io(y,n,u,p),u_ratio:1/St(n,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Qr=(y,n,u,p,m)=>a.e(Tl(y,n,u,m),{u_image:0,u_image_height:p}),El=(y,n,u,p,m)=>{const x=y.transform,E=Co(n,x);return{u_matrix:Io(y,n,u,m),u_texsize:n.imageAtlasTexture.size,u_ratio:1/St(n,1,x.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Ls=(y,n,u,p,m,x)=>{const E=y.lineAtlas,I=Co(n,y.transform),D=u.layout.get("line-cap")==="round",B=E.getDash(p.from,D),U=E.getDash(p.to,D),q=B.width*m.fromScale,Y=U.width*m.toScale;return a.e(Tl(y,n,u,x),{u_patternscale_a:[I/q,-B.height/2],u_patternscale_b:[I/Y,-U.height/2],u_sdfgamma:E.width/(256*Math.min(q,Y)*y.pixelRatio)/2,u_image:0,u_tex_y_a:B.y,u_tex_y_b:U.y,u_mix:m.t})};function Co(y,n){return 1/St(y,1,n.tileZoom)}function Io(y,n,u,p){return y.translatePosMatrix(p?p.posMatrix:n.tileID.posMatrix,n,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const Po=(y,n,u,p,m)=>{return{u_matrix:y,u_tl_parent:n,u_scale_parent:u,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(x=m.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Cl(m.paint.get("raster-hue-rotate"))};var x,E};function Cl(y){y*=Math.PI/180;const n=Math.sin(y),u=Math.cos(y);return[(2*u+1)/3,(-Math.sqrt(3)*n-u+1)/3,(Math.sqrt(3)*n-u+1)/3]}const Lo=(y,n,u,p,m,x,E,I,D,B)=>{const U=m.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:U.cameraToCenterDistance,u_pitch:U.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:U.width/U.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:I,u_is_text:+D,u_pitch_with_map:+p,u_texsize:B,u_texture:0}},Ra=(y,n,u,p,m,x,E,I,D,B,U)=>{const q=m.transform;return a.e(Lo(y,n,u,p,m,x,E,I,D,B),{u_gamma_scale:p?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+U})},dm=(y,n,u,p,m,x,E,I,D,B)=>a.e(Ra(y,n,u,p,m,x,E,I,!0,D,!0),{u_texsize_icon:B,u_texture_icon:1}),fm=(y,n,u)=>({u_matrix:y,u_opacity:n,u_color:u}),Dd=(y,n,u,p,m,x)=>a.e(function(E,I,D,B){const U=D.imageManager.getPattern(E.from.toString()),q=D.imageManager.getPattern(E.to.toString()),{width:Y,height:ht}=D.imageManager.getPixelSize(),lt=Math.pow(2,B.tileID.overscaledZ),dt=B.tileSize*Math.pow(2,D.transform.tileZoom)/lt,it=dt*(B.tileID.canonical.x+B.tileID.wrap*lt),wt=dt*B.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:U.tl,u_pattern_br_a:U.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[Y,ht],u_mix:I.t,u_pattern_size_a:U.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/St(B,1,D.transform.tileZoom),u_pixel_coord_upper:[it>>16,wt>>16],u_pixel_coord_lower:[65535&it,65535&wt]}}(p,x,u,m),{u_matrix:y,u_opacity:n}),pm={fillExtrusion:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_lightpos:new a.aK(y,n.u_lightpos),u_lightintensity:new a.aH(y,n.u_lightintensity),u_lightcolor:new a.aK(y,n.u_lightcolor),u_vertical_gradient:new a.aH(y,n.u_vertical_gradient),u_opacity:new a.aH(y,n.u_opacity)}),fillExtrusionPattern:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_lightpos:new a.aK(y,n.u_lightpos),u_lightintensity:new a.aH(y,n.u_lightintensity),u_lightcolor:new a.aK(y,n.u_lightcolor),u_vertical_gradient:new a.aH(y,n.u_vertical_gradient),u_height_factor:new a.aH(y,n.u_height_factor),u_image:new a.aG(y,n.u_image),u_texsize:new a.aL(y,n.u_texsize),u_pixel_coord_upper:new a.aL(y,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,n.u_pixel_coord_lower),u_scale:new a.aK(y,n.u_scale),u_fade:new a.aH(y,n.u_fade),u_opacity:new a.aH(y,n.u_opacity)}),fill:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix)}),fillPattern:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_image:new a.aG(y,n.u_image),u_texsize:new a.aL(y,n.u_texsize),u_pixel_coord_upper:new a.aL(y,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,n.u_pixel_coord_lower),u_scale:new a.aK(y,n.u_scale),u_fade:new a.aH(y,n.u_fade)}),fillOutline:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_world:new a.aL(y,n.u_world)}),fillOutlinePattern:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_world:new a.aL(y,n.u_world),u_image:new a.aG(y,n.u_image),u_texsize:new a.aL(y,n.u_texsize),u_pixel_coord_upper:new a.aL(y,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,n.u_pixel_coord_lower),u_scale:new a.aK(y,n.u_scale),u_fade:new a.aH(y,n.u_fade)}),circle:(y,n)=>({u_camera_to_center_distance:new a.aH(y,n.u_camera_to_center_distance),u_scale_with_map:new a.aG(y,n.u_scale_with_map),u_pitch_with_map:new a.aG(y,n.u_pitch_with_map),u_extrude_scale:new a.aL(y,n.u_extrude_scale),u_device_pixel_ratio:new a.aH(y,n.u_device_pixel_ratio),u_matrix:new a.aI(y,n.u_matrix)}),collisionBox:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_camera_to_center_distance:new a.aH(y,n.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(y,n.u_pixels_to_tile_units),u_extrude_scale:new a.aL(y,n.u_extrude_scale),u_overscale_factor:new a.aH(y,n.u_overscale_factor)}),collisionCircle:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_inv_matrix:new a.aI(y,n.u_inv_matrix),u_camera_to_center_distance:new a.aH(y,n.u_camera_to_center_distance),u_viewport_size:new a.aL(y,n.u_viewport_size)}),debug:(y,n)=>({u_color:new a.aM(y,n.u_color),u_matrix:new a.aI(y,n.u_matrix),u_overlay:new a.aG(y,n.u_overlay),u_overlay_scale:new a.aH(y,n.u_overlay_scale)}),clippingMask:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix)}),heatmap:(y,n)=>({u_extrude_scale:new a.aH(y,n.u_extrude_scale),u_intensity:new a.aH(y,n.u_intensity),u_matrix:new a.aI(y,n.u_matrix)}),heatmapTexture:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_world:new a.aL(y,n.u_world),u_image:new a.aG(y,n.u_image),u_color_ramp:new a.aG(y,n.u_color_ramp),u_opacity:new a.aH(y,n.u_opacity)}),hillshade:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_image:new a.aG(y,n.u_image),u_latrange:new a.aL(y,n.u_latrange),u_light:new a.aL(y,n.u_light),u_shadow:new a.aM(y,n.u_shadow),u_highlight:new a.aM(y,n.u_highlight),u_accent:new a.aM(y,n.u_accent)}),hillshadePrepare:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_image:new a.aG(y,n.u_image),u_dimension:new a.aL(y,n.u_dimension),u_zoom:new a.aH(y,n.u_zoom),u_unpack:new a.aJ(y,n.u_unpack)}),line:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_ratio:new a.aH(y,n.u_ratio),u_device_pixel_ratio:new a.aH(y,n.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,n.u_units_to_pixels)}),lineGradient:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_ratio:new a.aH(y,n.u_ratio),u_device_pixel_ratio:new a.aH(y,n.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,n.u_units_to_pixels),u_image:new a.aG(y,n.u_image),u_image_height:new a.aH(y,n.u_image_height)}),linePattern:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_texsize:new a.aL(y,n.u_texsize),u_ratio:new a.aH(y,n.u_ratio),u_device_pixel_ratio:new a.aH(y,n.u_device_pixel_ratio),u_image:new a.aG(y,n.u_image),u_units_to_pixels:new a.aL(y,n.u_units_to_pixels),u_scale:new a.aK(y,n.u_scale),u_fade:new a.aH(y,n.u_fade)}),lineSDF:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_ratio:new a.aH(y,n.u_ratio),u_device_pixel_ratio:new a.aH(y,n.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,n.u_units_to_pixels),u_patternscale_a:new a.aL(y,n.u_patternscale_a),u_patternscale_b:new a.aL(y,n.u_patternscale_b),u_sdfgamma:new a.aH(y,n.u_sdfgamma),u_image:new a.aG(y,n.u_image),u_tex_y_a:new a.aH(y,n.u_tex_y_a),u_tex_y_b:new a.aH(y,n.u_tex_y_b),u_mix:new a.aH(y,n.u_mix)}),raster:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_tl_parent:new a.aL(y,n.u_tl_parent),u_scale_parent:new a.aH(y,n.u_scale_parent),u_buffer_scale:new a.aH(y,n.u_buffer_scale),u_fade_t:new a.aH(y,n.u_fade_t),u_opacity:new a.aH(y,n.u_opacity),u_image0:new a.aG(y,n.u_image0),u_image1:new a.aG(y,n.u_image1),u_brightness_low:new a.aH(y,n.u_brightness_low),u_brightness_high:new a.aH(y,n.u_brightness_high),u_saturation_factor:new a.aH(y,n.u_saturation_factor),u_contrast_factor:new a.aH(y,n.u_contrast_factor),u_spin_weights:new a.aK(y,n.u_spin_weights)}),symbolIcon:(y,n)=>({u_is_size_zoom_constant:new a.aG(y,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,n.u_is_size_feature_constant),u_size_t:new a.aH(y,n.u_size_t),u_size:new a.aH(y,n.u_size),u_camera_to_center_distance:new a.aH(y,n.u_camera_to_center_distance),u_pitch:new a.aH(y,n.u_pitch),u_rotate_symbol:new a.aG(y,n.u_rotate_symbol),u_aspect_ratio:new a.aH(y,n.u_aspect_ratio),u_fade_change:new a.aH(y,n.u_fade_change),u_matrix:new a.aI(y,n.u_matrix),u_label_plane_matrix:new a.aI(y,n.u_label_plane_matrix),u_coord_matrix:new a.aI(y,n.u_coord_matrix),u_is_text:new a.aG(y,n.u_is_text),u_pitch_with_map:new a.aG(y,n.u_pitch_with_map),u_texsize:new a.aL(y,n.u_texsize),u_texture:new a.aG(y,n.u_texture)}),symbolSDF:(y,n)=>({u_is_size_zoom_constant:new a.aG(y,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,n.u_is_size_feature_constant),u_size_t:new a.aH(y,n.u_size_t),u_size:new a.aH(y,n.u_size),u_camera_to_center_distance:new a.aH(y,n.u_camera_to_center_distance),u_pitch:new a.aH(y,n.u_pitch),u_rotate_symbol:new a.aG(y,n.u_rotate_symbol),u_aspect_ratio:new a.aH(y,n.u_aspect_ratio),u_fade_change:new a.aH(y,n.u_fade_change),u_matrix:new a.aI(y,n.u_matrix),u_label_plane_matrix:new a.aI(y,n.u_label_plane_matrix),u_coord_matrix:new a.aI(y,n.u_coord_matrix),u_is_text:new a.aG(y,n.u_is_text),u_pitch_with_map:new a.aG(y,n.u_pitch_with_map),u_texsize:new a.aL(y,n.u_texsize),u_texture:new a.aG(y,n.u_texture),u_gamma_scale:new a.aH(y,n.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,n.u_device_pixel_ratio),u_is_halo:new a.aG(y,n.u_is_halo)}),symbolTextAndIcon:(y,n)=>({u_is_size_zoom_constant:new a.aG(y,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,n.u_is_size_feature_constant),u_size_t:new a.aH(y,n.u_size_t),u_size:new a.aH(y,n.u_size),u_camera_to_center_distance:new a.aH(y,n.u_camera_to_center_distance),u_pitch:new a.aH(y,n.u_pitch),u_rotate_symbol:new a.aG(y,n.u_rotate_symbol),u_aspect_ratio:new a.aH(y,n.u_aspect_ratio),u_fade_change:new a.aH(y,n.u_fade_change),u_matrix:new a.aI(y,n.u_matrix),u_label_plane_matrix:new a.aI(y,n.u_label_plane_matrix),u_coord_matrix:new a.aI(y,n.u_coord_matrix),u_is_text:new a.aG(y,n.u_is_text),u_pitch_with_map:new a.aG(y,n.u_pitch_with_map),u_texsize:new a.aL(y,n.u_texsize),u_texsize_icon:new a.aL(y,n.u_texsize_icon),u_texture:new a.aG(y,n.u_texture),u_texture_icon:new a.aG(y,n.u_texture_icon),u_gamma_scale:new a.aH(y,n.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,n.u_device_pixel_ratio),u_is_halo:new a.aG(y,n.u_is_halo)}),background:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_opacity:new a.aH(y,n.u_opacity),u_color:new a.aM(y,n.u_color)}),backgroundPattern:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_opacity:new a.aH(y,n.u_opacity),u_image:new a.aG(y,n.u_image),u_pattern_tl_a:new a.aL(y,n.u_pattern_tl_a),u_pattern_br_a:new a.aL(y,n.u_pattern_br_a),u_pattern_tl_b:new a.aL(y,n.u_pattern_tl_b),u_pattern_br_b:new a.aL(y,n.u_pattern_br_b),u_texsize:new a.aL(y,n.u_texsize),u_mix:new a.aH(y,n.u_mix),u_pattern_size_a:new a.aL(y,n.u_pattern_size_a),u_pattern_size_b:new a.aL(y,n.u_pattern_size_b),u_scale_a:new a.aH(y,n.u_scale_a),u_scale_b:new a.aH(y,n.u_scale_b),u_pixel_coord_upper:new a.aL(y,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,n.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(y,n.u_tile_units_to_pixels)}),terrain:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_texture:new a.aG(y,n.u_texture),u_ele_delta:new a.aH(y,n.u_ele_delta)}),terrainDepth:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_ele_delta:new a.aH(y,n.u_ele_delta)}),terrainCoords:(y,n)=>({u_matrix:new a.aI(y,n.u_matrix),u_texture:new a.aG(y,n.u_texture),u_terrain_coords_id:new a.aH(y,n.u_terrain_coords_id),u_ele_delta:new a.aH(y,n.u_ele_delta)})};class ta{constructor(n,u,p){this.context=n;const m=n.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Il={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class vs{constructor(n,u,p,m){this.length=u.length,this.attributes=p,this.itemSize=u.bytesPerElement,this.dynamicDraw=m,this.context=n;const x=n.gl;this.buffer=x.createBuffer(),n.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){if(n.length!==this.length)throw new Error(`Length of new data is ${n.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,u){for(let p=0;p<this.attributes.length;p++){const m=u.attributes[this.attributes[p].name];m!==void 0&&n.enableVertexAttribArray(m)}}setVertexAttribPointers(n,u,p){for(let m=0;m<this.attributes.length;m++){const x=this.attributes[m],E=u.attributes[x.name];E!==void 0&&n.vertexAttribPointer(E,x.components,n[Il[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Jn=new WeakMap;function Da(y){var n;if(Jn.has(y))return Jn.get(y);{const u=(n=y.getParameter(y.VERSION))===null||n===void 0?void 0:n.startsWith("WebGL 2.0");return Jn.set(y,u),u}}class zi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Pl extends zi{getDefault(){return a.aO.transparent}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class oc extends zi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class lc extends zi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Ll extends zi{getDefault(){return[!0,!0,!0,!0]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class hc extends zi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class cc extends zi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Rl extends zi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const u=this.current;(n.func!==u.func||n.ref!==u.ref||n.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class zd extends zi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class kd extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=n,this.dirty=!1}}class za extends zi{getDefault(){return[0,1]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class mm extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=n,this.dirty=!1}}class gm extends zi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class _m extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.BLEND):u.disable(u.BLEND),this.current=n,this.dirty=!1}}class ym extends zi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class vm extends zi{getDefault(){return a.aO.transparent}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class xm extends zi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class uc extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=n,this.dirty=!1}}class Dl extends zi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class dc extends zi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class fc extends zi{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class ka extends zi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Fd extends zi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Bd extends zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class pc extends zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class ea extends zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Od extends zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Fa extends zi{getDefault(){return null}set(n){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Ba extends zi{getDefault(){return null}set(n){var u;if(n===this.current&&!this.dirty)return;const p=this.gl;Da(p)?p.bindVertexArray(n):(u=p.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(n),this.current=n,this.dirty=!1}}class Nd extends zi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class mc extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Bi extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Oa extends zi{constructor(n,u){super(n),this.context=n,this.parent=u}getDefault(){return null}}class bm extends Oa{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Ud extends Oa{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ro extends Oa{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class wm{constructor(n,u,p,m,x){this.context=n,this.width=u,this.height=p;const E=n.gl,I=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new bm(n,I),m)this.depthAttachment=x?new Ro(n,I):new Ud(n,I);else if(x)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const n=this.context.gl,u=this.colorAttachment.get();if(u&&n.deleteTexture(u),this.depthAttachment){const p=this.depthAttachment.get();p&&n.deleteRenderbuffer(p)}n.deleteFramebuffer(this.framebuffer)}}class pn{constructor(n,u,p){this.blendFunction=n,this.blendColor=u,this.mask=p}}pn.Replace=[1,0],pn.disabled=new pn(pn.Replace,a.aO.transparent,[!1,!1,!1,!1]),pn.unblended=new pn(pn.Replace,a.aO.transparent,[!0,!0,!0,!0]),pn.alphaBlended=new pn([1,771],a.aO.transparent,[!0,!0,!0,!0]);class Vd{constructor(n){var u,p;if(this.gl=n,this.clearColor=new Pl(this),this.clearDepth=new oc(this),this.clearStencil=new lc(this),this.colorMask=new Ll(this),this.depthMask=new hc(this),this.stencilMask=new cc(this),this.stencilFunc=new Rl(this),this.stencilOp=new zd(this),this.stencilTest=new kd(this),this.depthRange=new za(this),this.depthTest=new mm(this),this.depthFunc=new gm(this),this.blend=new _m(this),this.blendFunc=new ym(this),this.blendColor=new vm(this),this.blendEquation=new xm(this),this.cullFace=new uc(this),this.cullFaceSide=new Dl(this),this.frontFace=new dc(this),this.program=new fc(this),this.activeTexture=new ka(this),this.viewport=new Fd(this),this.bindFramebuffer=new Bd(this),this.bindRenderbuffer=new pc(this),this.bindTexture=new ea(this),this.bindVertexBuffer=new Od(this),this.bindElementBuffer=new Fa(this),this.bindVertexArray=new Ba(this),this.pixelStoreUnpack=new Nd(this),this.pixelStoreUnpackPremultiplyAlpha=new mc(this),this.pixelStoreUnpackFlipY=new Bi(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),Da(n)){this.HALF_FLOAT=n.HALF_FLOAT;const m=n.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=n.RGBA16F)!==null&&u!==void 0?u:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=n.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,n.getExtension("EXT_color_buffer_float")}else{n.getExtension("EXT_color_buffer_half_float"),n.getExtension("OES_texture_half_float_linear");const m=n.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,u){return new ta(this,n,u)}createVertexBuffer(n,u,p){return new vs(this,n,u,p)}createRenderbuffer(n,u,p){const m=this.gl,x=m.createRenderbuffer();return this.bindRenderbuffer.set(x),m.renderbufferStorage(m.RENDERBUFFER,n,u,p),this.bindRenderbuffer.set(null),x}createFramebuffer(n,u,p,m){return new wm(this,n,u,p,m)}clear({color:n,depth:u,stencil:p}){const m=this.gl;let x=0;n&&(x|=m.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(x|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),p!==void 0&&(x|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(x)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){a.aD(n.blendFunction,pn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}createVertexArray(){var n;return Da(this.gl)?this.gl.createVertexArray():(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.createVertexArrayOES()}deleteVertexArray(n){var u;return Da(this.gl)?this.gl.deleteVertexArray(n):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(n)}unbindVAO(){this.bindVertexArray.set(null)}}class Di{constructor(n,u,p){this.func=n,this.mask=u,this.range=p}}Di.ReadOnly=!1,Di.ReadWrite=!0,Di.disabled=new Di(519,Di.ReadOnly,[0,1]);const Do=7680;class Xi{constructor(n,u,p,m,x,E){this.test=n,this.ref=u,this.mask=p,this.fail=m,this.depthFail=x,this.pass=E}}Xi.disabled=new Xi({func:519,mask:0},0,0,Do,Do,Do);class Wi{constructor(n,u,p){this.enable=n,this.mode=u,this.frontFace=p}}let Na;function zl(y,n,u,p,m,x,E){const I=y.context,D=I.gl,B=y.useProgram("collisionBox"),U=[];let q=0,Y=0;for(let gt=0;gt<p.length;gt++){const Ct=p[gt],Nt=n.getTile(Ct),Vt=Nt.getBucket(u);if(!Vt)continue;let qt=Ct.posMatrix;m[0]===0&&m[1]===0||(qt=y.translatePosMatrix(Ct.posMatrix,Nt,m,x));const oe=E?Vt.textCollisionBox:Vt.iconCollisionBox,ne=Vt.collisionCircleArray;if(ne.length>0){const ae=a.F(),Be=qt;a.aP(ae,Vt.placementInvProjMatrix,y.transform.glCoordMatrix),a.aP(ae,ae,Vt.placementViewportMatrix),U.push({circleArray:ne,circleOffset:Y,transform:Be,invTransform:ae,coord:Ct}),q+=ne.length/4,Y=q}oe&&B.draw(I,D.LINES,Di.disabled,Xi.disabled,y.colorModeForRenderPass(),Wi.disabled,um(qt,y.transform,Nt),y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ct),u.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,null,y.transform.zoom,null,null,oe.collisionVertexBuffer)}if(!E||!U.length)return;const ht=y.useProgram("collisionCircle"),lt=new a.aQ;lt.resize(4*q),lt._trim();let dt=0;for(const gt of U)for(let Ct=0;Ct<gt.circleArray.length/4;Ct++){const Nt=4*Ct,Vt=gt.circleArray[Nt+0],qt=gt.circleArray[Nt+1],oe=gt.circleArray[Nt+2],ne=gt.circleArray[Nt+3];lt.emplace(dt++,Vt,qt,oe,ne,0),lt.emplace(dt++,Vt,qt,oe,ne,1),lt.emplace(dt++,Vt,qt,oe,ne,2),lt.emplace(dt++,Vt,qt,oe,ne,3)}(!Na||Na.length<2*q)&&(Na=function(gt){const Ct=2*gt,Nt=new a.aS;Nt.resize(Ct),Nt._trim();for(let Vt=0;Vt<Ct;Vt++){const qt=6*Vt;Nt.uint16[qt+0]=4*Vt+0,Nt.uint16[qt+1]=4*Vt+1,Nt.uint16[qt+2]=4*Vt+2,Nt.uint16[qt+3]=4*Vt+2,Nt.uint16[qt+4]=4*Vt+3,Nt.uint16[qt+5]=4*Vt+0}return Nt}(q));const it=I.createIndexBuffer(Na,!0),wt=I.createVertexBuffer(lt,a.aR.members,!0);for(const gt of U){const Ct={u_matrix:gt.transform,u_inv_matrix:gt.invTransform,u_camera_to_center_distance:(Ft=y.transform).cameraToCenterDistance,u_viewport_size:[Ft.width,Ft.height]};ht.draw(I,D.TRIANGLES,Di.disabled,Xi.disabled,y.colorModeForRenderPass(),Wi.disabled,Ct,y.style.map.terrain&&y.style.map.terrain.getTerrainData(gt.coord),u.id,wt,it,a.$.simpleSegment(0,2*gt.circleOffset,gt.circleArray.length,gt.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Ft;wt.destroy(),it.destroy()}Wi.disabled=new Wi(!1,1029,2305),Wi.backCCW=new Wi(!0,1029,2305);const Gd=a.an(new Float32Array(16));function kl(y,n,u,p,m,x){const{horizontalAlign:E,verticalAlign:I}=a.at(y);return new a.P((-(E-.5)*n/m+p[0])*x,(-(I-.5)*u/m+p[1])*x)}function Fl(y,n,u,p,m,x,E,I,D,B,U){const q=y.text.placedSymbolArray,Y=y.text.dynamicLayoutVertexArray,ht=y.icon.dynamicLayoutVertexArray,lt={};Y.clear();for(let dt=0;dt<q.length;dt++){const it=q.get(dt),wt=it.hidden||!it.crossTileID||y.allowVerticalPlacement&&!it.placedOrientation?null:p[it.crossTileID];if(wt){const Ft=new a.P(it.anchorX,it.anchorY),gt=tt(Ft,u?E:x,U),Ct=V(m.cameraToCenterDistance,gt.signedDistanceFromCamera);let Nt=a.ai(y.textSizeData,D,it)*Ct/a.ao;u&&(Nt*=y.tilePixelRatio/I);const{width:Vt,height:qt,anchor:oe,textOffset:ne,textBoxScale:ae}=wt,Be=kl(oe,Vt,qt,ne,ae,Nt),_i=u?tt(Ft.add(Be),x,U).point:gt.point.add(n?Be.rotate(-m.angle):Be),Se=y.allowVerticalPlacement&&it.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let hi=0;hi<it.numGlyphs;hi++)a.aj(Y,_i,Se);B&&it.associatedIconIndex>=0&&(lt[it.associatedIconIndex]={shiftedAnchor:_i,angle:Se})}else We(it.numGlyphs,Y)}if(B){ht.clear();const dt=y.icon.placedSymbolArray;for(let it=0;it<dt.length;it++){const wt=dt.get(it);if(wt.hidden)We(wt.numGlyphs,ht);else{const Ft=lt[it];if(Ft)for(let gt=0;gt<wt.numGlyphs;gt++)a.aj(ht,Ft.shiftedAnchor,Ft.angle);else We(wt.numGlyphs,ht)}}y.icon.dynamicLayoutVertexBuffer.updateData(ht)}y.text.dynamicLayoutVertexBuffer.updateData(Y)}function gc(y,n,u){return u.iconsInText&&n?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function Hd(y,n,u,p,m,x,E,I,D,B,U,q){const Y=y.context,ht=Y.gl,lt=y.transform,dt=I==="map",it=D==="map",wt=I!=="viewport"&&u.layout.get("symbol-placement")!=="point",Ft=dt&&!it&&!wt,gt=!u.layout.get("symbol-sort-key").isConstant();let Ct=!1;const Nt=y.depthModeForSublayer(0,Di.ReadOnly),Vt=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),qt=[];for(const oe of p){const ne=n.getTile(oe),ae=ne.getBucket(u);if(!ae)continue;const Be=m?ae.text:ae.icon;if(!Be||!Be.segments.get().length||!Be.hasVisibleVertices)continue;const _i=Be.programConfigurations.get(u.id),Se=m||ae.sdfIcons,hi=m?ae.textSizeData:ae.iconSizeData,vi=it||lt.pitch!==0,Ei=y.useProgram(gc(Se,m,ae),_i),fi=a.ag(hi,lt.zoom),bi=y.style.map.terrain&&y.style.map.terrain.getTerrainData(oe);let wi,an,qi,os,vn=[0,0],Yi=null;if(m)an=ne.glyphAtlasTexture,qi=ht.LINEAR,wi=ne.glyphAtlasTexture.size,ae.iconsInText&&(vn=ne.imageAtlasTexture.size,Yi=ne.imageAtlasTexture,os=vi||y.options.rotating||y.options.zooming||hi.kind==="composite"||hi.kind==="camera"?ht.LINEAR:ht.NEAREST);else{const en=u.layout.get("icon-size").constantOr(0)!==1||ae.iconsNeedLinear;an=ne.imageAtlasTexture,qi=Se||y.options.rotating||y.options.zooming||en||vi?ht.LINEAR:ht.NEAREST,wi=ne.imageAtlasTexture.size}const $n=St(ne,1,y.transform.zoom),qs=Jt(oe.posMatrix,it,dt,y.transform,$n),lr=fe(oe.posMatrix,it,dt,y.transform,$n),oa=Vt&&ae.hasTextData(),la=u.layout.get("icon-text-fit")!=="none"&&oa&&ae.hasIconData();if(wt){const en=y.style.map.terrain?(bs,Ti)=>y.style.map.terrain.getElevation(oe,bs,Ti):null,On=u.layout.get("text-rotation-alignment")==="map";Z(ae,oe.posMatrix,y,m,qs,lr,it,B,On,en)}const hr=y.translatePosMatrix(oe.posMatrix,ne,x,E),$s=wt||m&&Vt||la?Gd:qs,hn=y.translatePosMatrix(lr,ne,x,E,!0),Qi=Se&&u.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let dn;dn=Se?ae.iconsInText?dm(hi.kind,fi,Ft,it,y,hr,$s,hn,wi,vn):Ra(hi.kind,fi,Ft,it,y,hr,$s,hn,m,wi,!0):Lo(hi.kind,fi,Ft,it,y,hr,$s,hn,m,wi);const Ya={program:Ei,buffers:Be,uniformValues:dn,atlasTexture:an,atlasTextureIcon:Yi,atlasInterpolation:qi,atlasInterpolationIcon:os,isSDF:Se,hasHalo:Qi};if(gt&&ae.canOverlap){Ct=!0;const en=Be.segments.get();for(const On of en)qt.push({segments:new a.$([On]),sortKey:On.sortKey,state:Ya,terrainData:bi})}else qt.push({segments:Be.segments,sortKey:0,state:Ya,terrainData:bi})}Ct&&qt.sort((oe,ne)=>oe.sortKey-ne.sortKey);for(const oe of qt){const ne=oe.state;if(Y.activeTexture.set(ht.TEXTURE0),ne.atlasTexture.bind(ne.atlasInterpolation,ht.CLAMP_TO_EDGE),ne.atlasTextureIcon&&(Y.activeTexture.set(ht.TEXTURE1),ne.atlasTextureIcon&&ne.atlasTextureIcon.bind(ne.atlasInterpolationIcon,ht.CLAMP_TO_EDGE)),ne.isSDF){const ae=ne.uniformValues;ne.hasHalo&&(ae.u_is_halo=1,Bl(ne.buffers,oe.segments,u,y,ne.program,Nt,U,q,ae,oe.terrainData)),ae.u_is_halo=0}Bl(ne.buffers,oe.segments,u,y,ne.program,Nt,U,q,ne.uniformValues,oe.terrainData)}}function Bl(y,n,u,p,m,x,E,I,D,B){const U=p.context;m.draw(U,U.gl.TRIANGLES,x,E,I,Wi.disabled,D,B,u.id,y.layoutVertexBuffer,y.indexBuffer,n,u.paint,p.transform.zoom,y.programConfigurations.get(u.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Wd(y,n,u,p,m){if(!u||!p||!p.imageAtlas)return;const x=p.imageAtlas.patternPositions;let E=x[u.to.toString()],I=x[u.from.toString()];if(!E&&I&&(E=I),!I&&E&&(I=E),!E||!I){const D=m.getPaintProperty(n);E=x[D],I=x[D]}E&&I&&y.setConstantPatternPositions(E,I)}function _c(y,n,u,p,m,x,E){const I=y.context.gl,D="fill-pattern",B=u.paint.get(D),U=B&&B.constantOr(1),q=u.getCrossfadeParameters();let Y,ht,lt,dt,it;E?(ht=U&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=I.LINES):(ht=U?"fillPattern":"fill",Y=I.TRIANGLES);const wt=B.constantOr(null);for(const Ft of p){const gt=n.getTile(Ft);if(U&&!gt.patternsLoaded())continue;const Ct=gt.getBucket(u);if(!Ct)continue;const Nt=Ct.programConfigurations.get(u.id),Vt=y.useProgram(ht,Nt),qt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ft);U&&(y.context.activeTexture.set(I.TEXTURE0),gt.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Nt.updatePaintBuffers(q)),Wd(Nt,D,wt,gt,u);const oe=qt?Ft:null,ne=y.translatePosMatrix(oe?oe.posMatrix:Ft.posMatrix,gt,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(E){dt=Ct.indexBuffer2,it=Ct.segments2;const ae=[I.drawingBufferWidth,I.drawingBufferHeight];lt=ht==="fillOutlinePattern"&&U?cm(ne,y,q,gt,ae):Id(ne,ae)}else dt=Ct.indexBuffer,it=Ct.segments,lt=U?Cd(ne,y,q,gt):Sl(ne);Vt.draw(y.context,Y,m,y.stencilModeForClipping(Ft),x,Wi.disabled,lt,qt,u.id,Ct.layoutVertexBuffer,dt,it,u.paint,y.transform.zoom,Nt)}}function Ua(y,n,u,p,m,x,E){const I=y.context,D=I.gl,B="fill-extrusion-pattern",U=u.paint.get(B),q=U.constantOr(1),Y=u.getCrossfadeParameters(),ht=u.paint.get("fill-extrusion-opacity"),lt=U.constantOr(null);for(const dt of p){const it=n.getTile(dt),wt=it.getBucket(u);if(!wt)continue;const Ft=y.style.map.terrain&&y.style.map.terrain.getTerrainData(dt),gt=wt.programConfigurations.get(u.id),Ct=y.useProgram(q?"fillExtrusionPattern":"fillExtrusion",gt);q&&(y.context.activeTexture.set(D.TEXTURE0),it.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),gt.updatePaintBuffers(Y)),Wd(gt,B,lt,it,u);const Nt=y.translatePosMatrix(dt.posMatrix,it,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Vt=u.paint.get("fill-extrusion-vertical-gradient"),qt=q?hm(Nt,y,Vt,ht,dt,Y,it):Ed(Nt,y,Vt,ht);Ct.draw(I,I.gl.TRIANGLES,m,x,E,Wi.backCCW,qt,Ft,u.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,u.paint,y.transform.zoom,gt,y.style.map.terrain&&wt.centroidVertexBuffer)}}function yc(y,n,u,p,m,x,E){const I=y.context,D=I.gl,B=u.fbo;if(!B)return;const U=y.useProgram("hillshade"),q=y.style.map.terrain&&y.style.map.terrain.getTerrainData(n);I.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,B.colorAttachment.get()),U.draw(I,D.TRIANGLES,m,x,E,Wi.disabled,((Y,ht,lt,dt)=>{const it=lt.paint.get("hillshade-shadow-color"),wt=lt.paint.get("hillshade-highlight-color"),Ft=lt.paint.get("hillshade-accent-color");let gt=lt.paint.get("hillshade-illumination-direction")*(Math.PI/180);lt.paint.get("hillshade-illumination-anchor")==="viewport"&&(gt-=Y.transform.angle);const Ct=!Y.options.moving;return{u_matrix:dt?dt.posMatrix:Y.transform.calculatePosMatrix(ht.tileID.toUnwrapped(),Ct),u_image:0,u_latrange:Rd(0,ht.tileID),u_light:[lt.paint.get("hillshade-exaggeration"),gt],u_shadow:it,u_highlight:wt,u_accent:Ft}})(y,u,p,q?n:null),q,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function qd(y,n,u,p,m,x){const E=y.context,I=E.gl,D=n.dem;if(D&&D.data){const B=D.dim,U=D.stride,q=D.getPixels();if(E.activeTexture.set(I.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||y.getTileTexture(U),n.demTexture){const ht=n.demTexture;ht.update(q,{premultiply:!1}),ht.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else n.demTexture=new zt(E,q,I.RGBA,{premultiply:!1}),n.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);E.activeTexture.set(I.TEXTURE0);let Y=n.fbo;if(!Y){const ht=new zt(E,{width:B,height:B,data:null},I.RGBA);ht.bind(I.LINEAR,I.CLAMP_TO_EDGE),Y=n.fbo=E.createFramebuffer(B,B,!0,!1),Y.colorAttachment.set(ht.texture)}E.bindFramebuffer.set(Y.framebuffer),E.viewport.set([0,0,B,B]),y.useProgram("hillshadePrepare").draw(E,I.TRIANGLES,p,m,x,Wi.disabled,((ht,lt)=>{const dt=lt.stride,it=a.F();return a.aN(it,0,a.W,-a.W,0,0,1),a.H(it,it,[0,-a.W,0]),{u_matrix:it,u_image:1,u_dimension:[dt,dt],u_zoom:ht.overscaledZ,u_unpack:lt.getUnpackVector()}})(n.tileID,D),null,u.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function $d(y,n,u,p,m,x){const E=p.paint.get("raster-fade-duration");if(!x&&E>0){const I=M.now(),D=(I-y.timeAdded)/E,B=n?(I-n.timeAdded)/E:-1,U=u.getSource(),q=m.coveringZoomLevel({tileSize:U.tileSize,roundZoom:U.roundZoom}),Y=!n||Math.abs(n.tileID.overscaledZ-q)>Math.abs(y.tileID.overscaledZ-q),ht=Y&&y.refreshedUponExpiration?1:a.ac(Y?D:1-B,0,1);return y.refreshedUponExpiration&&D>=1&&(y.refreshedUponExpiration=!1),n?{opacity:1,mix:1-ht}:{opacity:ht,mix:0}}return{opacity:1,mix:0}}const Ol=new a.aO(1,0,0,1),vc=new a.aO(0,1,0,1),Mm=new a.aO(0,0,1,1),jd=new a.aO(1,0,1,1),un=new a.aO(0,1,1,1);function Dr(y,n,u,p){Va(y,0,n+u/2,y.transform.width,u,p)}function xs(y,n,u,p){Va(y,n-u/2,0,u,y.transform.height,p)}function Va(y,n,u,p,m,x){const E=y.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(n*y.pixelRatio,u*y.pixelRatio,p*y.pixelRatio,m*y.pixelRatio),E.clear({color:x}),I.disable(I.SCISSOR_TEST)}function xc(y,n,u){const p=y.context,m=p.gl,x=u.posMatrix,E=y.useProgram("debug"),I=Di.disabled,D=Xi.disabled,B=y.colorModeForRenderPass(),U="$debug",q=y.style.map.terrain&&y.style.map.terrain.getTerrainData(u);p.activeTexture.set(m.TEXTURE0);const Y=n.getTileByID(u.key).latestRawTileData,ht=Math.floor((Y&&Y.byteLength||0)/1024),lt=n.getTile(u).tileSize,dt=512/Math.min(lt,512)*(u.overscaledZ/y.transform.zoom)*.5;let it=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(it+=` => ${u.overscaledZ}`),function(wt,Ft){wt.initDebugOverlayCanvas();const gt=wt.debugOverlayCanvas,Ct=wt.context.gl,Nt=wt.debugOverlayCanvas.getContext("2d");Nt.clearRect(0,0,gt.width,gt.height),Nt.shadowColor="white",Nt.shadowBlur=2,Nt.lineWidth=1.5,Nt.strokeStyle="white",Nt.textBaseline="top",Nt.font="bold 36px Open Sans, sans-serif",Nt.fillText(Ft,5,5),Nt.strokeText(Ft,5,5),wt.debugOverlayTexture.update(gt),wt.debugOverlayTexture.bind(Ct.LINEAR,Ct.CLAMP_TO_EDGE)}(y,`${it} ${ht}kB`),E.draw(p,m.TRIANGLES,I,D,pn.alphaBlended,Wi.disabled,Al(x,a.aO.transparent,dt),null,U,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),E.draw(p,m.LINE_STRIP,I,D,B,Wi.disabled,Al(x,a.aO.red),q,U,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function bc(y,n,u){const p=y.context,m=p.gl,x=y.colorModeForRenderPass(),E=new Di(m.LEQUAL,Di.ReadWrite,y.depthRangeFor3D),I=y.useProgram("terrain"),D=n.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,y.width,y.height]);for(const B of u){const U=y.renderToTexture.getTexture(B),q=n.getTerrainData(B.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,U.texture);const Y={u_matrix:y.transform.calculatePosMatrix(B.tileID.toUnwrapped()),u_texture:0,u_ele_delta:n.getMeshFrameDelta(y.transform.zoom)};I.draw(p,m.TRIANGLES,E,Xi.disabled,x,Wi.backCCW,Y,q,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}class Ga{constructor(n,u){this.context=new Vd(n),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Bt.maxUnderzooming+Bt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new rn}resize(n,u,p){if(this.width=Math.floor(n*p),this.height=Math.floor(u*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const n=this.context,u=new a.aV;u.emplaceBack(0,0),u.emplaceBack(a.W,0),u.emplaceBack(0,a.W),u.emplaceBack(a.W,a.W),this.tileExtentBuffer=n.createVertexBuffer(u,sr.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const p=new a.aV;p.emplaceBack(0,0),p.emplaceBack(a.W,0),p.emplaceBack(0,a.W),p.emplaceBack(a.W,a.W),this.debugBuffer=n.createVertexBuffer(p,sr.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const m=new a.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(a.W,0,a.W,0),m.emplaceBack(0,a.W,0,a.W),m.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=n.createVertexBuffer(m,gi.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const x=new a.aV;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,sr.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const E=new a.aW;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(E);const I=new a.aX;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(I);const D=this.context.gl;this.stencilClearMode=new Xi({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)}clearStencil(){const n=this.context,u=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.F();a.aN(p,0,this.width,this.height,0,0,1),a.J(p,p,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,u.TRIANGLES,Di.disabled,this.stencilClearMode,pn.disabled,Wi.disabled,ac(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,u){if(this.currentStencilSource===n.source||!n.isTileClipped()||!u||!u.length)return;this.currentStencilSource=n.source;const p=this.context,m=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(pn.disabled),p.setDepthMode(Di.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of u){const I=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);x.draw(p,m.TRIANGLES,Di.disabled,new Xi({func:m.ALWAYS,mask:0},I,255,m.KEEP,m.KEEP,m.REPLACE),pn.disabled,Wi.disabled,ac(E.posMatrix),D,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,u=this.context.gl;return new Xi({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(n){const u=this.context.gl;return new Xi({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(n){const u=this.context.gl,p=n.sort((E,I)=>I.overscaledZ-E.overscaledZ),m=p[p.length-1].overscaledZ,x=p[0].overscaledZ-m+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let I=0;I<x;I++)E[I+m]=new Xi({func:u.GEQUAL,mask:255},I+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=x,[E,p]}return[{[m]:Xi.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new pn([n.CONSTANT_COLOR,n.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?pn.unblended:pn.alphaBlended}depthModeForSublayer(n,u,p){if(!this.opaquePassEnabledForLayer())return Di.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Di(p||this.context.gl.LEQUAL,u,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,u){this.style=n,this.options=u,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(M.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,x={},E={},I={};for(const D in m){const B=m[D];B.used&&B.prepare(this.context),x[D]=B.getVisibleCoordinates(),E[D]=x[D].slice().reverse(),I[D]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<p.length;D++)if(this.style._layers[p[D]].is3D()){this.opaquePassCutoff=D;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const D of p){const B=this.style._layers[D];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const U=E[B.source];(B.type==="custom"||U.length)&&this.renderLayer(this,m[B.source],B,U)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[p[this.currentLayer]],B=m[D.source],U=x[D.source];this._renderTileClippingMasks(D,U),this.renderLayer(this,B,D,U)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const D=this.style._layers[p[this.currentLayer]],B=m[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D))continue;const U=(D.type==="symbol"?I:E)[D.source];this._renderTileClippingMasks(D,x[D.source]),this.renderLayer(this,B,D,U)}if(this.options.showTileBoundaries){const D=function(B,U){let q=null;const Y=Object.values(B._layers).flatMap(it=>it.source&&!it.isHidden(U)?[B.sourceCaches[it.source]]:[]),ht=Y.filter(it=>it.getSource().type==="vector"),lt=Y.filter(it=>it.getSource().type!=="vector"),dt=it=>{(!q||q.getSource().maxzoom<it.getSource().maxzoom)&&(q=it)};return ht.forEach(it=>dt(it)),q||lt.forEach(it=>dt(it)),q}(this.style,this.transform.zoom);D&&function(B,U,q){for(let Y=0;Y<q.length;Y++)xc(B,U,q[Y])}(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const B=D.transform.padding;Dr(D,D.transform.height-(B.top||0),3,Ol),Dr(D,B.bottom||0,3,vc),xs(D,B.left||0,3,Mm),xs(D,D.transform.width-(B.right||0),3,jd);const U=D.transform.centerPoint;(function(q,Y,ht,lt){Va(q,Y-1,ht-10,2,20,lt),Va(q,Y-10,ht-1,20,2,lt)})(D,U.x,D.transform.height-U.y,un)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(n){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,p=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=n?!a.aY(u,p):!a.aZ(u,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.a_(u,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(x,E){const I=x.context,D=I.gl,B=pn.unblended,U=new Di(D.LEQUAL,Di.ReadWrite,[0,1]),q=E.getTerrainMesh(),Y=E.sourceCache.getRenderableTiles(),ht=x.useProgram("terrainDepth");I.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),I.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),I.clear({color:a.aO.transparent,depth:1});for(const lt of Y){const dt=E.getTerrainData(lt.tileID),it={u_matrix:x.transform.calculatePosMatrix(lt.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(x.transform.zoom)};ht.draw(I,D.TRIANGLES,U,Xi.disabled,B,Wi.backCCW,it,dt,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}I.bindFramebuffer.set(null),I.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain),function(x,E){const I=x.context,D=I.gl,B=pn.unblended,U=new Di(D.LEQUAL,Di.ReadWrite,[0,1]),q=E.getTerrainMesh(),Y=E.getCoordsTexture(),ht=E.sourceCache.getRenderableTiles(),lt=x.useProgram("terrainCoords");I.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),I.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),I.clear({color:a.aO.transparent,depth:1}),E.coordsIndex=[];for(const dt of ht){const it=E.getTerrainData(dt.tileID);I.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,Y.texture);const wt={u_matrix:x.transform.calculatePosMatrix(dt.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(x.transform.zoom)};lt.draw(I,D.TRIANGLES,U,Xi.disabled,B,Wi.backCCW,wt,it,"terrain",q.vertexBuffer,q.indexBuffer,q.segments),E.coordsIndex.push(dt.tileID.key)}I.bindFramebuffer.set(null),I.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain))}renderLayer(n,u,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(x,E,I,D,B){if(x.renderPass!=="translucent")return;const U=Xi.disabled,q=x.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Y,ht,lt,dt,it,wt,Ft){const gt=ht.transform,Ct=it==="map",Nt=wt==="map";for(const Vt of Y){const qt=dt.getTile(Vt),oe=qt.getBucket(lt);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const ne=a.ag(oe.textSizeData,gt.zoom),ae=St(qt,1,ht.transform.zoom),Be=Jt(Vt.posMatrix,Nt,Ct,ht.transform,ae),_i=lt.layout.get("icon-text-fit")!=="none"&&oe.hasIconData();if(ne){const Se=Math.pow(2,gt.zoom-qt.tileID.overscaledZ);Fl(oe,Ct,Nt,Ft,gt,Be,Vt.posMatrix,Se,ne,_i,ht.style.map.terrain?(hi,vi)=>ht.style.map.terrain.getElevation(Vt,hi,vi):null)}}}(D,x,I,E,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),B),I.paint.get("icon-opacity").constantOr(1)!==0&&Hd(x,E,I,D,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),U,q),I.paint.get("text-opacity").constantOr(1)!==0&&Hd(x,E,I,D,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),U,q),E.map.showCollisionBoxes&&(zl(x,E,I,D,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),!0),zl(x,E,I,D,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),!1))})(n,u,p,m,this.style.placement.variableOffsets);break;case"circle":(function(x,E,I,D){if(x.renderPass!=="translucent")return;const B=I.paint.get("circle-opacity"),U=I.paint.get("circle-stroke-width"),q=I.paint.get("circle-stroke-opacity"),Y=!I.layout.get("circle-sort-key").isConstant();if(B.constantOr(1)===0&&(U.constantOr(1)===0||q.constantOr(1)===0))return;const ht=x.context,lt=ht.gl,dt=x.depthModeForSublayer(0,Di.ReadOnly),it=Xi.disabled,wt=x.colorModeForRenderPass(),Ft=[];for(let gt=0;gt<D.length;gt++){const Ct=D[gt],Nt=E.getTile(Ct),Vt=Nt.getBucket(I);if(!Vt)continue;const qt=Vt.programConfigurations.get(I.id),oe=x.useProgram("circle",qt),ne=Vt.layoutVertexBuffer,ae=Vt.indexBuffer,Be=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ct),_i={programConfiguration:qt,program:oe,layoutVertexBuffer:ne,indexBuffer:ae,uniformValues:Pd(x,Ct,Nt,I),terrainData:Be};if(Y){const Se=Vt.segments.get();for(const hi of Se)Ft.push({segments:new a.$([hi]),sortKey:hi.sortKey,state:_i})}else Ft.push({segments:Vt.segments,sortKey:0,state:_i})}Y&&Ft.sort((gt,Ct)=>gt.sortKey-Ct.sortKey);for(const gt of Ft){const{programConfiguration:Ct,program:Nt,layoutVertexBuffer:Vt,indexBuffer:qt,uniformValues:oe,terrainData:ne}=gt.state;Nt.draw(ht,lt.TRIANGLES,dt,it,wt,Wi.disabled,oe,ne,I.id,Vt,qt,gt.segments,I.paint,x.transform.zoom,Ct)}})(n,u,p,m);break;case"heatmap":(function(x,E,I,D){if(I.paint.get("heatmap-opacity")!==0)if(x.renderPass==="offscreen"){const B=x.context,U=B.gl,q=Xi.disabled,Y=new pn([U.ONE,U.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(ht,lt,dt){const it=ht.gl;ht.activeTexture.set(it.TEXTURE1),ht.viewport.set([0,0,lt.width/4,lt.height/4]);let wt=dt.heatmapFbo;if(wt)it.bindTexture(it.TEXTURE_2D,wt.colorAttachment.get()),ht.bindFramebuffer.set(wt.framebuffer);else{const Ft=it.createTexture();it.bindTexture(it.TEXTURE_2D,Ft),it.texParameteri(it.TEXTURE_2D,it.TEXTURE_WRAP_S,it.CLAMP_TO_EDGE),it.texParameteri(it.TEXTURE_2D,it.TEXTURE_WRAP_T,it.CLAMP_TO_EDGE),it.texParameteri(it.TEXTURE_2D,it.TEXTURE_MIN_FILTER,it.LINEAR),it.texParameteri(it.TEXTURE_2D,it.TEXTURE_MAG_FILTER,it.LINEAR),wt=dt.heatmapFbo=ht.createFramebuffer(lt.width/4,lt.height/4,!1,!1),function(gt,Ct,Nt,Vt){var qt,oe;const ne=gt.gl,ae=(qt=gt.HALF_FLOAT)!==null&&qt!==void 0?qt:ne.UNSIGNED_BYTE,Be=(oe=gt.RGBA16F)!==null&&oe!==void 0?oe:ne.RGBA;ne.texImage2D(ne.TEXTURE_2D,0,Be,Ct.width/4,Ct.height/4,0,ne.RGBA,ae,null),Vt.colorAttachment.set(Nt)}(ht,lt,Ft,wt)}})(B,x,I),B.clear({color:a.aO.transparent});for(let ht=0;ht<D.length;ht++){const lt=D[ht];if(E.hasRenderableParent(lt))continue;const dt=E.getTile(lt),it=dt.getBucket(I);if(!it)continue;const wt=it.programConfigurations.get(I.id),Ft=x.useProgram("heatmap",wt),{zoom:gt}=x.transform;Ft.draw(B,U.TRIANGLES,Di.disabled,q,Y,Wi.disabled,Ld(lt.posMatrix,dt,gt,I.paint.get("heatmap-intensity")),null,I.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,I.paint,x.transform.zoom,wt)}B.viewport.set([0,0,x.width,x.height])}else x.renderPass==="translucent"&&(x.context.setColorMode(x.colorModeForRenderPass()),function(B,U){const q=B.context,Y=q.gl,ht=U.heatmapFbo;if(!ht)return;q.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,ht.colorAttachment.get()),q.activeTexture.set(Y.TEXTURE1);let lt=U.colorRampTexture;lt||(lt=U.colorRampTexture=new zt(q,U.colorRamp,Y.RGBA)),lt.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),B.useProgram("heatmapTexture").draw(q,Y.TRIANGLES,Di.disabled,Xi.disabled,B.colorModeForRenderPass(),Wi.disabled,((dt,it,wt,Ft)=>{const gt=a.F();a.aN(gt,0,dt.width,dt.height,0,0,1);const Ct=dt.context.gl;return{u_matrix:gt,u_world:[Ct.drawingBufferWidth,Ct.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:it.paint.get("heatmap-opacity")}})(B,U),null,U.id,B.viewportBuffer,B.quadTriangleIndexBuffer,B.viewportSegments,U.paint,B.transform.zoom)}(x,I))})(n,u,p,m);break;case"line":(function(x,E,I,D){if(x.renderPass!=="translucent")return;const B=I.paint.get("line-opacity"),U=I.paint.get("line-width");if(B.constantOr(1)===0||U.constantOr(1)===0)return;const q=x.depthModeForSublayer(0,Di.ReadOnly),Y=x.colorModeForRenderPass(),ht=I.paint.get("line-dasharray"),lt=I.paint.get("line-pattern"),dt=lt.constantOr(1),it=I.paint.get("line-gradient"),wt=I.getCrossfadeParameters(),Ft=dt?"linePattern":ht?"lineSDF":it?"lineGradient":"line",gt=x.context,Ct=gt.gl;let Nt=!0;for(const Vt of D){const qt=E.getTile(Vt);if(dt&&!qt.patternsLoaded())continue;const oe=qt.getBucket(I);if(!oe)continue;const ne=oe.programConfigurations.get(I.id),ae=x.context.program.get(),Be=x.useProgram(Ft,ne),_i=Nt||Be.program!==ae,Se=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Vt),hi=lt.constantOr(null);if(hi&&qt.imageAtlas){const fi=qt.imageAtlas,bi=fi.patternPositions[hi.to.toString()],wi=fi.patternPositions[hi.from.toString()];bi&&wi&&ne.setConstantPatternPositions(bi,wi)}const vi=Se?Vt:null,Ei=dt?El(x,qt,I,wt,vi):ht?Ls(x,qt,I,ht,wt,vi):it?Qr(x,qt,I,oe.lineClipsArray.length,vi):Tl(x,qt,I,vi);if(dt)gt.activeTexture.set(Ct.TEXTURE0),qt.imageAtlasTexture.bind(Ct.LINEAR,Ct.CLAMP_TO_EDGE),ne.updatePaintBuffers(wt);else if(ht&&(_i||x.lineAtlas.dirty))gt.activeTexture.set(Ct.TEXTURE0),x.lineAtlas.bind(gt);else if(it){const fi=oe.gradients[I.id];let bi=fi.texture;if(I.gradientVersion!==fi.version){let wi=256;if(I.stepInterpolant){const an=E.getSource().maxzoom,qi=Vt.canonical.z===an?Math.ceil(1<<x.transform.maxZoom-Vt.canonical.z):1;wi=a.ac(a.aT(oe.maxLineLength/a.W*1024*qi),256,gt.maxTextureSize)}fi.gradient=a.aU({expression:I.gradientExpression(),evaluationKey:"lineProgress",resolution:wi,image:fi.gradient||void 0,clips:oe.lineClipsArray}),fi.texture?fi.texture.update(fi.gradient):fi.texture=new zt(gt,fi.gradient,Ct.RGBA),fi.version=I.gradientVersion,bi=fi.texture}gt.activeTexture.set(Ct.TEXTURE0),bi.bind(I.stepInterpolant?Ct.NEAREST:Ct.LINEAR,Ct.CLAMP_TO_EDGE)}Be.draw(gt,Ct.TRIANGLES,q,x.stencilModeForClipping(Vt),Y,Wi.disabled,Ei,Se,I.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,I.paint,x.transform.zoom,ne,oe.layoutVertexBuffer2),Nt=!1}})(n,u,p,m);break;case"fill":(function(x,E,I,D){const B=I.paint.get("fill-color"),U=I.paint.get("fill-opacity");if(U.constantOr(1)===0)return;const q=x.colorModeForRenderPass(),Y=I.paint.get("fill-pattern"),ht=x.opaquePassEnabledForLayer()&&!Y.constantOr(1)&&B.constantOr(a.aO.transparent).a===1&&U.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===ht){const lt=x.depthModeForSublayer(1,x.renderPass==="opaque"?Di.ReadWrite:Di.ReadOnly);_c(x,E,I,D,lt,q,!1)}if(x.renderPass==="translucent"&&I.paint.get("fill-antialias")){const lt=x.depthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,Di.ReadOnly);_c(x,E,I,D,lt,q,!0)}})(n,u,p,m);break;case"fill-extrusion":(function(x,E,I,D){const B=I.paint.get("fill-extrusion-opacity");if(B!==0&&x.renderPass==="translucent"){const U=new Di(x.context.gl.LEQUAL,Di.ReadWrite,x.depthRangeFor3D);if(B!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))Ua(x,E,I,D,U,Xi.disabled,pn.disabled),Ua(x,E,I,D,U,x.stencilModeFor3D(),x.colorModeForRenderPass());else{const q=x.colorModeForRenderPass();Ua(x,E,I,D,U,Xi.disabled,q)}}})(n,u,p,m);break;case"hillshade":(function(x,E,I,D){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const B=x.context,U=x.depthModeForSublayer(0,Di.ReadOnly),q=x.colorModeForRenderPass(),[Y,ht]=x.renderPass==="translucent"?x.stencilConfigForOverlap(D):[{},D];for(const lt of ht){const dt=E.getTile(lt);dt.needsHillshadePrepare!==void 0&&dt.needsHillshadePrepare&&x.renderPass==="offscreen"?qd(x,dt,I,U,Xi.disabled,q):x.renderPass==="translucent"&&yc(x,lt,dt,I,U,Y[lt.overscaledZ],q)}B.viewport.set([0,0,x.width,x.height])})(n,u,p,m);break;case"raster":(function(x,E,I,D){if(x.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!D.length)return;const B=x.context,U=B.gl,q=E.getSource(),Y=x.useProgram("raster"),ht=x.colorModeForRenderPass(),[lt,dt]=q instanceof mt?[{},D]:x.stencilConfigForOverlap(D),it=dt[dt.length-1].overscaledZ,wt=!x.options.moving;for(const Ft of dt){const gt=x.depthModeForSublayer(Ft.overscaledZ-it,I.paint.get("raster-opacity")===1?Di.ReadWrite:Di.ReadOnly,U.LESS),Ct=E.getTile(Ft);Ct.registerFadeDuration(I.paint.get("raster-fade-duration"));const Nt=E.findLoadedParent(Ft,0),Vt=$d(Ct,Nt,E,I,x.transform,x.style.map.terrain);let qt,oe;const ne=I.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR;B.activeTexture.set(U.TEXTURE0),Ct.texture.bind(ne,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(U.TEXTURE1),Nt?(Nt.texture.bind(ne,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST),qt=Math.pow(2,Nt.tileID.overscaledZ-Ct.tileID.overscaledZ),oe=[Ct.tileID.canonical.x*qt%1,Ct.tileID.canonical.y*qt%1]):Ct.texture.bind(ne,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST);const ae=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ft),Be=ae?Ft:null,_i=Be?Be.posMatrix:x.transform.calculatePosMatrix(Ft.toUnwrapped(),wt),Se=Po(_i,oe||[0,0],qt||1,Vt,I);q instanceof mt?Y.draw(B,U.TRIANGLES,gt,Xi.disabled,ht,Wi.disabled,Se,ae,I.id,q.boundsBuffer,x.quadTriangleIndexBuffer,q.boundsSegments):Y.draw(B,U.TRIANGLES,gt,lt[Ft.overscaledZ],ht,Wi.disabled,Se,ae,I.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}})(n,u,p,m);break;case"background":(function(x,E,I,D){const B=I.paint.get("background-color"),U=I.paint.get("background-opacity");if(U===0)return;const q=x.context,Y=q.gl,ht=x.transform,lt=ht.tileSize,dt=I.paint.get("background-pattern");if(x.isPatternMissing(dt))return;const it=!dt&&B.a===1&&U===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==it)return;const wt=Xi.disabled,Ft=x.depthModeForSublayer(0,it==="opaque"?Di.ReadWrite:Di.ReadOnly),gt=x.colorModeForRenderPass(),Ct=x.useProgram(dt?"backgroundPattern":"background"),Nt=D||ht.coveringTiles({tileSize:lt,terrain:x.style.map.terrain});dt&&(q.activeTexture.set(Y.TEXTURE0),x.imageManager.bind(x.context));const Vt=I.getCrossfadeParameters();for(const qt of Nt){const oe=D?qt.posMatrix:x.transform.calculatePosMatrix(qt.toUnwrapped()),ne=dt?Dd(oe,U,x,dt,{tileID:qt,tileSize:lt},Vt):fm(oe,U,B),ae=x.style.map.terrain&&x.style.map.terrain.getTerrainData(qt);Ct.draw(q,Y.TRIANGLES,Ft,wt,gt,Wi.disabled,ne,ae,I.id,x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}})(n,0,p,m);break;case"custom":(function(x,E,I){const D=x.context,B=I.implementation;if(x.renderPass==="offscreen"){const U=B.prerender;U&&(x.setCustomLayerDefaults(),D.setColorMode(x.colorModeForRenderPass()),U.call(B,D.gl,x.transform.customLayerMatrix()),D.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),D.setColorMode(x.colorModeForRenderPass()),D.setStencilMode(Xi.disabled);const U=B.renderingMode==="3d"?new Di(x.context.gl.LEQUAL,Di.ReadWrite,x.depthRangeFor3D):x.depthModeForSublayer(0,Di.ReadOnly);D.setDepthMode(U),B.render(D.gl,x.transform.customLayerMatrix()),D.setDirty(),x.setBaseState(),D.bindFramebuffer.set(null)}})(n,0,p)}}translatePosMatrix(n,u,p,m,x){if(!p[0]&&!p[1])return n;const E=x?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(E){const B=Math.sin(E),U=Math.cos(E);p=[p[0]*U-p[1]*B,p[0]*B+p[1]*U]}const I=[x?p[0]:St(u,p[0],this.transform.zoom),x?p[1]:St(u,p[1],this.transform.zoom),0],D=new Float32Array(16);return a.H(D,n,I),D}saveTileTexture(n){const u=this._tileTextures[n.size[0]];u?u.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const u=this._tileTextures[n];return u&&u.length>0?u.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const u=this.imageManager.getPattern(n.from.toString()),p=this.imageManager.getPattern(n.to.toString());return!u||!p}useProgram(n,u){this.cache=this.cache||{};const p=n+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new rc(this.context,La[n],u,pm[n],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new zt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:n,drawingBufferHeight:u}=this.context.gl;return this.width!==n||this.height!==u}}class ia{constructor(n,u){this.points=n,this.planes=u}static fromInvProjectionMatrix(n,u,p){const m=Math.pow(2,p),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const D=1/(I=a.af([],I,n))[3]/u*m;return a.a$(I,I,[D,D,1/I[3],D])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const D=function(Y,ht){var lt=ht[0],dt=ht[1],it=ht[2],wt=lt*lt+dt*dt+it*it;return wt>0&&(wt=1/Math.sqrt(wt)),Y[0]=ht[0]*wt,Y[1]=ht[1]*wt,Y[2]=ht[2]*wt,Y}([],function(Y,ht,lt){var dt=ht[0],it=ht[1],wt=ht[2],Ft=lt[0],gt=lt[1],Ct=lt[2];return Y[0]=it*Ct-wt*gt,Y[1]=wt*Ft-dt*Ct,Y[2]=dt*gt-it*Ft,Y}([],K([],x[I[0]],x[I[1]]),K([],x[I[2]],x[I[1]]))),B=-((U=D)[0]*(q=x[I[1]])[0]+U[1]*q[1]+U[2]*q[2]);var U,q;return D.concat(B)});return new ia(x,E)}}class Ha{constructor(n,u){this.min=n,this.max=u,this.center=function(p,m,x){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,x){return p[0]=m[0]+x[0],p[1]=m[1]+x[1],p[2]=m[2]+x[2],p}([],this.min,this.max))}quadrant(n){const u=[n%2==0,n<2],p=pt(this.min),m=pt(this.max);for(let x=0;x<u.length;x++)p[x]=u[x]?this.min[x]:this.center[x],m[x]=u[x]?this.center[x]:this.max[x];return m[2]=this.max[2],new Ha(p,m)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersects(n){const u=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<n.planes.length;m++){const x=n.planes[m];let E=0;for(let I=0;I<u.length;I++)a.b0(x,u[I])>=0&&E++;if(E===0)return 0;E!==u.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let x=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let I=0;I<n.points.length;I++){const D=n.points[I][m]-this.min[m];x=Math.min(x,D),E=Math.max(E,D)}if(E<0||x>this.max[m]-this.min[m])return 0}return 1}}class zo{constructor(n=0,u=0,p=0,m=0){if(isNaN(n)||n<0||isNaN(u)||u<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=p,this.right=m}interpolate(n,u,p){return u.top!=null&&n.top!=null&&(this.top=a.z.number(n.top,u.top,p)),u.bottom!=null&&n.bottom!=null&&(this.bottom=a.z.number(n.bottom,u.bottom,p)),u.left!=null&&n.left!=null&&(this.left=a.z.number(n.left,u.left,p)),u.right!=null&&n.right!=null&&(this.right=a.z.number(n.right,u.right,p)),this}getCenter(n,u){const p=a.ac((this.left+n-this.right)/2,0,n),m=a.ac((this.top+u-this.bottom)/2,0,u);return new a.P(p,m)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new zo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const wc=85.051129;class Nl{constructor(n,u,p,m,x){this.tileSize=512,this._renderWorldCopies=x===void 0||!!x,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new zo,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const n=new Nl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.apply(this),n}apply(n){this.tileSize=n.tileSize,this.latRange=n.latRange,this.width=n.width,this.height=n.height,this._center=n._center,this._elevation=n._elevation,this.minElevationForCurrentTile=n.minElevationForCurrentTile,this.zoom=n.zoom,this.angle=n.angle,this._fov=n._fov,this._pitch=n._pitch,this._unmodified=n._unmodified,this._edgeInsets=n._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(n){const u=-a.b1(n,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,x){var E=m[0],I=m[1],D=m[2],B=m[3],U=Math.sin(x),q=Math.cos(x);p[0]=E*q+D*U,p[1]=I*q+B*U,p[2]=E*-U+D*q,p[3]=I*-U+B*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const u=a.ac(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(n){const u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.tileZoom=Math.max(0,Math.floor(u)),this.scale=this.zoomScale(u),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(n){n!==this._elevation&&(this._elevation=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,u,p){this._unmodified=!1,this._edgeInsets.interpolate(n,u,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(n){const u=[new a.b2(0,n)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),x=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),I=Math.floor(Math.min(p.x,m.x,x.x,E.x)),D=Math.floor(Math.max(p.x,m.x,x.x,E.x)),B=1;for(let U=I-B;U<=D+B;U++)U!==0&&u.push(new a.b2(U,n))}return u}coveringTiles(n){var u,p;let m=this.coveringZoomLevel(n);const x=m;if(n.minzoom!==void 0&&m<n.minzoom)return[];n.maxzoom!==void 0&&m>n.maxzoom&&(m=n.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),I=a.Y.fromLngLat(this.center),D=Math.pow(2,m),B=[D*E.x,D*E.y,0],U=[D*I.x,D*I.y,0],q=ia.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let Y=n.minzoom||0;!n.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Y=m);const ht=n.terrain?2/Math.min(this.tileSize,n.tileSize)*this.tileSize:3,lt=gt=>({aabb:new Ha([gt*D,0,0],[(gt+1)*D,D,0]),zoom:0,x:0,y:0,wrap:gt,fullyVisible:!1}),dt=[],it=[],wt=m,Ft=n.reparseOverscaled?x:m;if(this._renderWorldCopies)for(let gt=1;gt<=3;gt++)dt.push(lt(-gt)),dt.push(lt(gt));for(dt.push(lt(0));dt.length>0;){const gt=dt.pop(),Ct=gt.x,Nt=gt.y;let Vt=gt.fullyVisible;if(!Vt){const Be=gt.aabb.intersects(q);if(Be===0)continue;Vt=Be===2}const qt=n.terrain?B:U,oe=gt.aabb.distanceX(qt),ne=gt.aabb.distanceY(qt),ae=Math.max(Math.abs(oe),Math.abs(ne));if(gt.zoom===wt||ae>ht+(1<<wt-gt.zoom)-2&&gt.zoom>=Y){const Be=wt-gt.zoom,_i=B[0]-.5-(Ct<<Be),Se=B[1]-.5-(Nt<<Be);it.push({tileID:new a.Q(gt.zoom===wt?Ft:gt.zoom,gt.wrap,gt.zoom,Ct,Nt),distanceSq:ot([U[0]-.5-Ct,U[1]-.5-Nt]),tileDistanceToCamera:Math.sqrt(_i*_i+Se*Se)})}else for(let Be=0;Be<4;Be++){const _i=(Ct<<1)+Be%2,Se=(Nt<<1)+(Be>>1),hi=gt.zoom+1;let vi=gt.aabb.quadrant(Be);if(n.terrain){const Ei=new a.Q(hi,gt.wrap,hi,_i,Se),fi=n.terrain.getMinMaxElevation(Ei),bi=(u=fi.minElevation)!==null&&u!==void 0?u:this.elevation,wi=(p=fi.maxElevation)!==null&&p!==void 0?p:this.elevation;vi=new Ha([vi.min[0],vi.min[1],bi],[vi.max[0],vi.max[1],wi])}dt.push({aabb:vi,zoom:hi,x:_i,y:Se,wrap:gt.wrap,fullyVisible:Vt})}}return it.sort((gt,Ct)=>gt.distanceSq-Ct.distanceSq).map(gt=>gt.tileID)}resize(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const u=a.ac(n.lat,-85.051129,wc);return new a.P(a.N(n.lng)*this.worldSize,a.O(u)*this.worldSize)}unproject(n){return new a.Y(n.x/this.worldSize,n.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(n){const u=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,n),x=n.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-x))return;const E=p+u-x,I=Math.cos(this._pitch)*this.cameraToCenterDistance/E/a.b3(1,m.lat),D=this.scaleZoom(I/this.tileSize);this._elevation=x,this._center=m,this.zoom=D}setLocationAtPoint(n,u){const p=this.pointCoordinate(u),m=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(n),E=new a.Y(x.x-(p.x-m.x),x.y-(p.y-m.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(n,u){return u?this.coordinatePoint(this.locationCoordinate(n),u.getElevationForLngLatZoom(n,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(n))}pointLocation(n,u){return this.coordinateLocation(this.pointCoordinate(n,u))}locationCoordinate(n){return a.Y.fromLngLat(n)}coordinateLocation(n){return n&&n.toLngLat()}pointCoordinate(n,u){if(u){const Y=u.pointCoordinate(n);if(Y!=null)return Y}const p=[n.x,n.y,0,1],m=[n.x,n.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const x=p[3],E=m[3],I=p[1]/x,D=m[1]/E,B=p[2]/x,U=m[2]/E,q=B===U?0:(0-B)/(U-B);return new a.Y(a.z.number(p[0]/x,m[0]/E,q)/this.worldSize,a.z.number(I,D,q)/this.worldSize)}coordinatePoint(n,u=0,p=this.pixelMatrix){const m=[n.x*this.worldSize,n.y*this.worldSize,u,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const n=Math.max(0,this.height/2-this.getHorizon());return new Ee().extend(this.pointLocation(new a.P(0,n))).extend(this.pointLocation(new a.P(this.width,n))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ee([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,wc])}calculatePosMatrix(n,u=!1){const p=n.key,m=u?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const x=n.canonical,E=this.worldSize/this.zoomScale(x.z),I=x.x+Math.pow(2,x.z)*n.wrap,D=a.an(new Float64Array(16));return a.H(D,D,[I*E,x.y*E,0]),a.J(D,D,[E/a.W,E/a.W,1]),a.K(D,u?this.alignedProjMatrix:this.projMatrix,D),m[p]=new Float32Array(D),m[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(n,u){u=a.ac(+u,this.minZoom,this.maxZoom);const p={center:new a.M(n.lng,n.lat),zoom:u};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const gt=179.9999999999;m=[-gt,gt]}const x=this.tileSize*this.zoomScale(p.zoom);let E=0,I=x,D=0,B=x,U=0,q=0;const{x:Y,y:ht}=this.size;if(this.latRange){const gt=this.latRange;E=a.O(gt[1])*x,I=a.O(gt[0])*x,I-E<ht&&(U=ht/(I-E))}m&&(D=a.b1(a.N(m[0])*x,0,x),B=a.b1(a.N(m[1])*x,0,x),B<D&&(B+=x),B-D<Y&&(q=Y/(B-D)));const{x:lt,y:dt}=this.project.call({worldSize:x},n);let it,wt;const Ft=Math.max(q||0,U||0);if(Ft){const gt=new a.P(q?(B+D)/2:lt,U?(I+E)/2:dt);return p.center=this.unproject.call({worldSize:x},gt).wrap(),p.zoom+=this.scaleZoom(Ft),p}if(this.latRange){const gt=ht/2;dt-gt<E&&(wt=E+gt),dt+gt>I&&(wt=I-gt)}if(m){const gt=(D+B)/2;let Ct=lt;this._renderWorldCopies&&(Ct=a.b1(lt,gt-x/2,gt+x/2));const Nt=Y/2;Ct-Nt<D&&(it=D+Nt),Ct+Nt>B&&(it=B-Nt)}if(it!==void 0||wt!==void 0){const gt=new a.P(it??lt,wt??dt);p.center=this.unproject.call({worldSize:x},gt).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this._unmodified,{center:u,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=u,this.zoom=p,this._unmodified=n,this._constraining=!1}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,u=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.J(m,m,[this.width/2,-this.height/2,1]),a.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.J(m,m,[1,-1,1]),a.H(m,m,[-1,-1,0]),a.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const x=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this.minElevationForCurrentTile),I=x-E*this._pixelPerMeter/Math.cos(this._pitch),D=E<0?I:x,B=Math.PI/2+this._pitch,U=this._fov*(.5+n.y/this.height),q=Math.sin(U)*D/Math.sin(a.ac(Math.PI-B-U,.01,Math.PI-.01)),Y=this.getHorizon(),ht=2*Math.atan(Y/this.cameraToCenterDistance)*(.5+n.y/(2*Y)),lt=Math.sin(ht)*D/Math.sin(a.ac(Math.PI-B-ht,.01,Math.PI-.01)),dt=Math.min(q,lt),it=1.01*(Math.cos(Math.PI/2-this._pitch)*dt+D),wt=this.height/50;m=new Float64Array(16),a.b4(m,this._fov,this.width/this.height,wt,it),m[8]=2*-n.x/this.width,m[9]=2*n.y/this.height,a.J(m,m,[1,-1,1]),a.H(m,m,[0,0,-this.cameraToCenterDistance]),a.b5(m,m,this._pitch),a.ad(m,m,this.angle),a.H(m,m,[-u,-p,0]),this.mercatorMatrix=a.J([],m,[this.worldSize,this.worldSize,this.worldSize]),a.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,m),a.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=a.ar([],m),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,m);const Ft=this.width%2/2,gt=this.height%2/2,Ct=Math.cos(this.angle),Nt=Math.sin(this.angle),Vt=u-Math.round(u)+Ct*Ft+Nt*gt,qt=p-Math.round(p)+Ct*gt+Nt*Ft,oe=new Float64Array(m);if(a.H(oe,oe,[Vt>.5?Vt-1:Vt,qt>.5?qt-1:qt,0]),this.alignedProjMatrix=oe,m=a.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const n=this.pointCoordinate(new a.P(0,0)),u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return a.af(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,n))}getCameraQueryGeometry(n){const u=this.getCameraPoint();if(n.length===1)return[n[0],u];{let p=u.x,m=u.y,x=u.x,E=u.y;for(const I of n)p=Math.min(p,I.x),m=Math.min(m,I.y),x=Math.max(x,I.x),E=Math.max(E,I.y);return[new a.P(p,m),new a.P(x,m),new a.P(x,E),new a.P(p,E),new a.P(p,m)]}}lngLatToCameraDepth(n,u){const p=this.locationCoordinate(n),m=[p.x*this.worldSize,p.y*this.worldSize,u,1];return a.af(m,m,this.projMatrix),m[2]/m[3]}}function Mc(y,n){let u,p=!1,m=null,x=null;const E=()=>{m=null,p&&(y.apply(x,u),m=setTimeout(E,n),p=!1)};return(...I)=>(p=!0,x=this,u=I,m||E(),m)}class Sc{constructor(n){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let p;return u.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(u.length>=3&&!u.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:p,pitch:+(u[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,u)}catch{}},this._updateHash=Mc(this._updateHashUnthrottled,300),this._hashName=n&&encodeURIComponent(n)}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){const u=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,m),E=Math.round(u.lng*x)/x,I=Math.round(u.lat*x)/x,D=this._map.getBearing(),B=this._map.getPitch();let U="";if(U+=n?`/${E}/${I}/${p}`:`${p}/${I}/${E}`,(D||B)&&(U+="/"+Math.round(10*D)/10),B&&(U+=`/${Math.round(B)}`),this._hashName){const q=this._hashName;let Y=!1;const ht=window.location.hash.slice(1).split("&").map(lt=>{const dt=lt.split("=")[0];return dt===q?(Y=!0,`${dt}=${U}`):lt}).filter(lt=>lt);return Y||ht.push(`${q}=${U}`),`#${ht.join("&")}`}return`#${U}`}}const ar={linearity:.3,easing:a.b6(0,0,.3,1)},Zd=a.e({deceleration:2500,maxSpeed:1400},ar),Xd=a.e({deceleration:20,maxSpeed:1400},ar),Yd=a.e({deceleration:1e3,maxSpeed:360},ar),Jd=a.e({deceleration:1e3,maxSpeed:90},ar);class Kd{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:M.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,u=M.now();for(;n.length>0&&u-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)u.zoom+=x.zoomDelta||0,u.bearing+=x.bearingDelta||0,u.pitch+=x.pitchDelta||0,x.panDelta&&u.pan._add(x.panDelta),x.around&&(u.around=x.around),x.pinchAround&&(u.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(u.pan.mag()){const x=Fo(u.pan.mag(),p,a.e({},Zd,n||{}));m.offset=u.pan.mult(x.amount/u.pan.mag()),m.center=this._map.transform.center,ko(m,x)}if(u.zoom){const x=Fo(u.zoom,p,Xd);m.zoom=this._map.transform.zoom+x.amount,ko(m,x)}if(u.bearing){const x=Fo(u.bearing,p,Yd);m.bearing=this._map.transform.bearing+a.ac(x.amount,-179,179),ko(m,x)}if(u.pitch){const x=Fo(u.pitch,p,Jd);m.pitch=this._map.transform.pitch+x.amount,ko(m,x)}if(m.zoom||m.bearing){const x=u.pinchAround===void 0?u.around:u.pinchAround;m.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function ko(y,n){(!y.duration||y.duration<n.duration)&&(y.duration=n.duration,y.easing=n.easing)}function Fo(y,n,u){const{maxSpeed:p,linearity:m,deceleration:x}=u,E=a.ac(y*m/(n/1e3),-p,p),I=Math.abs(E)/(x*m);return{easing:u.easing,duration:1e3*I,amount:E*(I/2)}}class Bn extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,p,m={}){const x=A.mousePos(u.getCanvas(),p),E=u.unproject(x);super(n,a.e({point:x,lngLat:E,originalEvent:p},m)),this._defaultPrevented=!1,this.target=u}}class Wa extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,p){const m=n==="touchend"?p.changedTouches:p.touches,x=A.touchPos(u.getCanvasContainer(),m),E=x.map(D=>u.unproject(D)),I=x.reduce((D,B,U,q)=>D.add(B.div(q.length)),new a.P(0,0));super(n,{points:x,point:I,lngLats:E,lngLat:u.unproject(I),originalEvent:p}),this._defaultPrevented=!1}}class Rs extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,p){super(n,{originalEvent:p}),this._defaultPrevented=!1}}class or{constructor(n,u){this._map=n,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new Rs(n.type,this._map,n))}mousedown(n,u){return this._mousedownPos=u,this._firePreventable(new Bn(n.type,this._map,n))}mouseup(n){this._map.fire(new Bn(n.type,this._map,n))}click(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Bn(n.type,this._map,n))}dblclick(n){return this._firePreventable(new Bn(n.type,this._map,n))}mouseover(n){this._map.fire(new Bn(n.type,this._map,n))}mouseout(n){this._map.fire(new Bn(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Wa(n.type,this._map,n))}touchmove(n){this._map.fire(new Wa(n.type,this._map,n))}touchend(n){this._map.fire(new Wa(n.type,this._map,n))}touchcancel(n){this._map.fire(new Wa(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qd{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(n){this._map.fire(new Bn(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Bn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._ignoreContextMenu||this._map.fire(new Bn(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rs{constructor(n){this._map=n}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(n){return this.transform.pointLocation(a.P.convert(n),this._map.terrain)}}class qa{constructor(n,u){this._map=n,this._tr=new rs(n),this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,u){this.isEnabled()&&n.shiftKey&&n.button===0&&(A.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(n,u){if(!this._active)return;const p=u;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=A.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",n));const x=Math.min(m.x,p.x),E=Math.max(m.x,p.x),I=Math.min(m.y,p.y),D=Math.max(m.y,p.y);A.setTransform(this._box,`translate(${x}px,${I}px)`),this._box.style.width=E-x+"px",this._box.style.height=D-I+"px"}mouseupWindow(n,u){if(!this._active||n.button!==0)return;const p=this._startPos,m=u;if(this.reset(),A.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:n})),{cameraAnimation:x=>x.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(A.remove(this._box),this._box=null),A.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,u){return this._map.fire(new a.k(n,{originalEvent:u}))}}function Ac(y,n){if(y.length!==n.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${n.length}`);const u={};for(let p=0;p<y.length;p++)u[y[p].identifier]=n[p];return u}class Sm{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,u,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const x=new a.P(0,0);for(const E of m)x._add(E);return x.div(m.length)}(u),this.touches=Ac(p,u)))}touchmove(n,u,p){if(this.aborted||!this.centroid)return;const m=Ac(p,u);for(const x in this.touches){const E=m[x];(!E||E.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(n,u,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Tc{constructor(n){this.singleTap=new Sm(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,u,p){this.singleTap.touchstart(n,u,p)}touchmove(n,u,p){this.singleTap.touchmove(n,u,p)}touchend(n,u,p){const m=this.singleTap.touchend(n,u,p);if(m){const x=n.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(m)<30;if(x&&E||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class tf{constructor(n){this._tr=new rs(n),this._zoomIn=new Tc({numTouches:1,numTaps:2}),this._zoomOut=new Tc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,u,p){this._zoomIn.touchstart(n,u,p),this._zoomOut.touchstart(n,u,p)}touchmove(n,u,p){this._zoomIn.touchmove(n,u,p),this._zoomOut.touchmove(n,u,p)}touchend(n,u,p){const m=this._zoomIn.touchend(n,u,p),x=this._zoomOut.touchend(n,u,p),E=this._tr;return m?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(m)},{originalEvent:n})}):x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(x)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _r{constructor(n){this._enabled=!!n.enable,this._moveStateManager=n.moveStateManager,this._clickTolerance=n.clickTolerance||1,this._moveFunction=n.move,this._activateOnStart=!!n.activateOnStart,n.assignEvents(this),this.reset()}reset(n){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(n)}_move(...n){const u=this._moveFunction(...n);if(u.bearingDelta||u.pitchDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(n,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(n)&&(this._moveStateManager.startMove(n),this._lastPoint=u.length?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(n,u){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(n.preventDefault(),!this._moveStateManager.isValidMoveEvent(n))return void this.reset(n);const m=u.length?u[0]:u;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(n){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(n)&&(this._moved&&A.suppressClick(),this.reset(n))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const zr={0:1,2:2};class Ne{constructor(n){this._correctEvent=n.checkCorrectEvent}startMove(n){const u=A.mouseButton(n);this._eventButton=u}endMove(n){delete this._eventButton}isValidStartEvent(n){return this._correctEvent(n)}isValidMoveEvent(n){return!function(u,p){const m=zr[p];return u.buttons===void 0||(u.buttons&m)!==m}(n,this._eventButton)}isValidEndEvent(n){return A.mouseButton(n)===this._eventButton}}class Ec{constructor(){this._firstTouch=void 0}_isOneFingerTouch(n){return n.targetTouches.length===1}_isSameTouchEvent(n){return n.targetTouches[0].identifier===this._firstTouch}startMove(n){this._firstTouch=n.targetTouches[0].identifier}endMove(n){delete this._firstTouch}isValidStartEvent(n){return this._isOneFingerTouch(n)}isValidMoveEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}isValidEndEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}}const na=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(n){n.preventDefault()}},$a=({enable:y,clickTolerance:n,bearingDegreesPerPixelMoved:u=.8})=>{const p=new Ne({checkCorrectEvent:m=>A.mouseButton(m)===0&&m.ctrlKey||A.mouseButton(m)===2});return new _r({clickTolerance:n,move:(m,x)=>({bearingDelta:(x.x-m.x)*u}),moveStateManager:p,enable:y,assignEvents:na})},Cc=({enable:y,clickTolerance:n,pitchDegreesPerPixelMoved:u=-.5})=>{const p=new Ne({checkCorrectEvent:m=>A.mouseButton(m)===0&&m.ctrlKey||A.mouseButton(m)===2});return new _r({clickTolerance:n,move:(m,x)=>({pitchDelta:(x.y-m.y)*u}),moveStateManager:p,enable:y,assignEvents:na})};class ze{constructor(n,u){this._clickTolerance=n.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(n,u,p){return this._calculateTransform(n,u,p)}touchmove(n,u,p){if(this._active&&!(p.length<this.minTouchs()))return n.preventDefault(),this._calculateTransform(n,u,p)}touchend(n,u,p){this._calculateTransform(n,u,p),this._active&&p.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,u,p){p.length>0&&(this._active=!0);const m=Ac(p,u),x=new a.P(0,0),E=new a.P(0,0);let I=0;for(const B in m){const U=m[B],q=this._touches[B];q&&(x._add(U),E._add(U.sub(q)),I++,m[B]=U)}if(this._touches=m,I<this.minTouchs()||!E.mag())return;const D=E.div(I);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(I),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(n,u,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([u[0],u[1]]))}touchmove(n,u,p){if(!this._firstTwoTouches)return;n.preventDefault();const[m,x]=this._firstTwoTouches,E=Ul(p,u,m),I=Ul(p,u,x);if(!E||!I)return;const D=this._aroundCenter?null:E.add(I).div(2);return this._move([E,I],D,n)}touchend(n,u,p){if(!this._firstTwoTouches)return;const[m,x]=this._firstTwoTouches,E=Ul(p,u,m),I=Ul(p,u,x);E&&I||(this._active&&A.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ul(y,n,u){for(let p=0;p<y.length;p++)if(y[p].identifier===u)return n[p]}function ef(y,n){return Math.log(y/n)/Math.LN2}class Vl extends Bo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,u){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(ef(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ef(this._distance,p),pinchAround:u}}}function Ic(y,n){return 180*y.angleWith(n)/Math.PI}class Pc extends Bo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,u,p){const m=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ic(this._vector,m),pinchAround:u}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const u=25/(Math.PI*this._minDiameter)*360,p=Ic(n,this._startVector);return Math.abs(p)<u}}function Lc(y){return Math.abs(y.y)>Math.abs(y.x)}class nf extends Bo{constructor(n){super(),this._currentTouchCount=0,this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(n,u,p){super.touchstart(n,u,p),this._currentTouchCount=p.length}_start(n){this._lastPoints=n,Lc(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,u,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=n[0].sub(this._lastPoints[0]),x=n[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,x,p.timeStamp),this._valid?(this._lastPoints=n,this._active=!0,{pitchDelta:(m.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(n,u,p){if(this._valid!==void 0)return this._valid;const m=n.mag()>=2,x=u.mag()>=2;if(!m&&!x)return;if(!m||!x)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=n.y>0==u.y>0;return Lc(n)&&Lc(u)&&E}}const sa={panStep:100,bearingStep:15,pitchStep:10};class Ki{constructor(n){this._tr=new rs(n);const u=sa;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let u=0,p=0,m=0,x=0,E=0;switch(n.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),x=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),x=1);break;case 38:n.shiftKey?m=1:(n.preventDefault(),E=-1);break;case 40:n.shiftKey?m=-1:(n.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:I=>{const D=this._tr;I.easeTo({duration:300,easeId:"keyboardHandler",easing:Gl,zoom:u?Math.round(D.zoom)+u*(n.shiftKey?2:1):D.zoom,bearing:D.bearing+p*this._bearingStep,pitch:D.pitch+m*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:D.center},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gl(y){return y*(2-y)}const Hl=4.000244140625;class Rc{constructor(n,u){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=n,this._tr=new rs(n),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(n){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!n[this._map.cooperativeGestures._bypassKey])return;let u=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=M.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,u!==0&&u%Hl==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(m*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=A.mousePos(this._map.getCanvas(),n),p=this._tr;this._around=u.y>p.transform.height/2-p.transform.getHorizon()?a.M.convert(this._aroundCenter?p.center:p.unproject(u)):a.M.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._tr.transform;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Hl?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&D!==0&&(D=1/D);const B=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(B*D))),this._type==="wheel"&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:n.zoom,p=this._startZoom,m=this._easing;let x,E=!1;if(this._type==="wheel"&&p&&m){const I=Math.min((M.now()-this._lastWheelEventTime)/200,1),D=m(I);x=a.z.number(p,u,D),I<1?this._frameId||(this._frameId=!0):E=!0}else x=u,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:x-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let u=a.b7;if(this._prevEase){const p=this._prevEase,m=(M.now()-p.start)/p.duration,x=p.easing(m+.01)-p.easing(m),E=.27/Math.sqrt(x*x+1e-4)*.01,I=Math.sqrt(.0729-E*E);u=a.b6(E,I,.25,1)}return this._prevEase={start:M.now(),duration:n,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Dc{constructor(n,u){this._clickZoom=n,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class sf{constructor(n){this._tr=new rs(n),this.reset()}reset(){this._active=!1}dblclick(n,u){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(n.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Am{constructor(){this._tap=new Tc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(n,u,p){if(!this._swipePoint)if(this._tapTime){const m=u[0],x=n.timeStamp-this._tapTime<500,E=this._tapPoint.dist(m)<30;x&&E?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(n,u,p)}touchmove(n,u,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=u[0],x=m.y-this._swipePoint.y;return this._swipePoint=m,n.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(n,u,p)}touchend(n,u,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(n,u,p);m&&(this._tapTime=n.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hs{constructor(n,u,p){this._el=n,this._mousePan=u,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Oo{constructor(n,u,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ye{constructor(n,u,p,m){this._el=n,this._touchZoom=u,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ri{constructor(n,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=n,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const n=this._map.getCanvasContainer();n.classList.add("maplibregl-cooperative-gestures"),this._container=A.create("div","maplibregl-cooperative-gesture-screen",n);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=u,this._container.appendChild(m);const x=document.createElement("div");x.className="maplibregl-mobile-message",x.textContent=p,this._container.appendChild(x),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(A.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(n){this._onCooperativeGesture(n.touches.length===1)}wheel(n){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!n[this._bypassKey])}_onCooperativeGesture(n){this._enabled&&n&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ra=y=>y.zoom||y.drag||y.pitch||y.rotate;class zc extends a.k{}function No(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class as{constructor(n,u){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,x)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=m.type==="renderFrame"?void 0:m,I={needsRenderFrame:!1},D={},B={},U=m.touches,q=U?this._getMapTouches(U):void 0,Y=q?A.touchPos(this._map.getCanvas(),q):A.mousePos(this._map.getCanvas(),m);for(const{handlerName:dt,handler:it,allowed:wt}of this._handlers){if(!it.isEnabled())continue;let Ft;this._blockedByActive(B,wt,dt)?it.reset():it[x||m.type]&&(Ft=it[x||m.type](m,Y,q),this.mergeHandlerResult(I,D,Ft,dt,E),Ft&&Ft.needsRenderFrame&&this._triggerRenderFrame()),(Ft||it.isActive())&&(B[dt]=it)}const ht={};for(const dt in this._previousActiveHandlers)B[dt]||(ht[dt]=E);this._previousActiveHandlers=B,(Object.keys(ht).length||No(I))&&(this._changes.push([I,D,ht]),this._triggerRenderFrame()),(Object.keys(B).length||No(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:lt}=I;lt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],lt(this._map))},this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Kd(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,x,E]of this._listeners)A.addEventListener(m,x,m===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[n,u,p]of this._listeners)A.removeEventListener(n,u,n===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(n){const u=this._map,p=u.getCanvasContainer();this._add("mapEvent",new or(u,n));const m=u.boxZoom=new qa(u,n);this._add("boxZoom",m),n.interactive&&n.boxZoom&&m.enable();const x=u.cooperativeGestures=new ri(u,n.cooperativeGestures);this._add("cooperativeGestures",x),n.cooperativeGestures&&x.enable();const E=new tf(u),I=new sf(u);u.doubleClickZoom=new Dc(I,E),this._add("tapZoom",E),this._add("clickZoom",I),n.interactive&&n.doubleClickZoom&&u.doubleClickZoom.enable();const D=new Am;this._add("tapDragZoom",D);const B=u.touchPitch=new nf(u);this._add("touchPitch",B),n.interactive&&n.touchPitch&&u.touchPitch.enable(n.touchPitch);const U=$a(n),q=Cc(n);u.dragRotate=new Oo(n,U,q),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]),n.interactive&&n.dragRotate&&u.dragRotate.enable();const Y=(({enable:Ft,clickTolerance:gt})=>{const Ct=new Ne({checkCorrectEvent:Nt=>A.mouseButton(Nt)===0&&!Nt.ctrlKey});return new _r({clickTolerance:gt,move:(Nt,Vt)=>({around:Vt,panDelta:Vt.sub(Nt)}),activateOnStart:!0,moveStateManager:Ct,enable:Ft,assignEvents:na})})(n),ht=new ze(n,u);u.dragPan=new Hs(p,Y,ht),this._add("mousePan",Y),this._add("touchPan",ht,["touchZoom","touchRotate"]),n.interactive&&n.dragPan&&u.dragPan.enable(n.dragPan);const lt=new Pc,dt=new Vl;u.touchZoomRotate=new Ye(p,dt,lt,D),this._add("touchRotate",lt,["touchPan","touchZoom"]),this._add("touchZoom",dt,["touchPan","touchRotate"]),n.interactive&&n.touchZoomRotate&&u.touchZoomRotate.enable(n.touchZoomRotate);const it=u.scrollZoom=new Rc(u,()=>this._triggerRenderFrame());this._add("scrollZoom",it,["mousePan"]),n.interactive&&n.scrollZoom&&u.scrollZoom.enable(n.scrollZoom);const wt=u.keyboard=new Ki(u);this._add("keyboard",wt),n.interactive&&n.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new Qd(u))}_add(n,u,p){this._handlers.push({handlerName:n,handler:u,allowed:p}),this._handlersById[n]=u}stop(n){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ra(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,u,p){for(const m in n)if(m!==p&&(!u||u.indexOf(m)<0))return!0;return!1}_getMapTouches(n){const u=[];for(const p of n)this._el.contains(p.target)&&u.push(p);return u}mergeHandlerResult(n,u,p,m,x){if(!p)return;a.e(n,p);const E={handlerName:m,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(u.zoom=E),p.panDelta!==void 0&&(u.drag=E),p.pitchDelta!==void 0&&(u.pitch=E),p.bearingDelta!==void 0&&(u.rotate=E)}_applyChanges(){const n={},u={},p={};for(const[m,x,E]of this._changes)m.panDelta&&(n.panDelta=(n.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(n.around=m.around),m.pinchAround!==void 0&&(n.pinchAround=m.pinchAround),m.noInertia&&(n.noInertia=m.noInertia),a.e(u,x),a.e(p,E);this._updateMapTransform(n,u,p),this._changes=[]}_updateMapTransform(n,u,p){const m=this._map,x=m._getTransformForUpdate(),E=m.terrain;if(!(No(n)||E&&this._terrainMovement))return this._fireEvents(u,p,!0);let{panDelta:I,zoomDelta:D,bearingDelta:B,pitchDelta:U,around:q,pinchAround:Y}=n;Y!==void 0&&(q=Y),m._stop(!0),q=q||m.transform.centerPoint;const ht=x.pointLocation(I?q.sub(I):q);B&&(x.bearing+=B),U&&(x.pitch+=U),D&&(x.zoom+=D),E?this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?x.center=x.pointLocation(x.centerPoint.sub(I)):x.setLocationAtPoint(ht,q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,x.setLocationAtPoint(ht,q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,x.recalculateZoom(m.terrain)})):x.setLocationAtPoint(ht,q),m._applyUpdatedTransform(x),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,p,!0)}_fireEvents(n,u,p){const m=ra(this._eventsInProgress),x=ra(n),E={};for(const U in n){const{originalEvent:q}=n[U];this._eventsInProgress[U]||(E[`${U}start`]=q),this._eventsInProgress[U]=n[U]}!m&&x&&this._fireEvent("movestart",x.originalEvent);for(const U in E)this._fireEvent(U,E[U]);x&&this._fireEvent("move",x.originalEvent);for(const U in n){const{originalEvent:q}=n[U];this._fireEvent(U,q)}const I={};let D;for(const U in this._eventsInProgress){const{handlerName:q,originalEvent:Y}=this._eventsInProgress[U];this._handlersById[q].isActive()||(delete this._eventsInProgress[U],D=u[q]||Y,I[`${U}end`]=D)}for(const U in I)this._fireEvent(U,I[U]);const B=ra(this._eventsInProgress);if(p&&(m||x)&&!B){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;!U||!U.essential&&M.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:D})),q(this._map.getBearing())&&this._map.resetNorth()):(q(U.bearing||this._map.getBearing())&&(U.bearing=0),U.freezeElevation=!0,this._map.easeTo(U,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(n,u){this._map.fire(new a.k(n,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new zc("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class rf extends a.E{constructor(n,u){super(),this._renderFrameCallback=()=>{const p=Math.min((M.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=u.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(n,u){return this.jumpTo({center:n},u)}panBy(n,u,p){return n=a.P.convert(n).mult(-1),this.panTo(this.transform.center,a.e({offset:n},u),p)}panTo(n,u,p){return this.easeTo(a.e({center:n},u),p)}getZoom(){return this.transform.zoom}setZoom(n,u){return this.jumpTo({zoom:n},u),this}zoomTo(n,u,p){return this.easeTo(a.e({zoom:n},u),p)}zoomIn(n,u){return this.zoomTo(this.getZoom()+1,n,u),this}zoomOut(n,u){return this.zoomTo(this.getZoom()-1,n,u),this}getBearing(){return this.transform.bearing}setBearing(n,u){return this.jumpTo({bearing:n},u),this}getPadding(){return this.transform.padding}setPadding(n,u){return this.jumpTo({padding:n},u),this}rotateTo(n,u,p){return this.easeTo(a.e({bearing:n},u),p)}resetNorth(n,u){return this.rotateTo(0,a.e({duration:1e3},n),u),this}resetNorthPitch(n,u){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},n),u),this}snapToNorth(n,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,u):this}getPitch(){return this.transform.pitch}setPitch(n,u){return this.jumpTo({pitch:n},u),this}cameraForBounds(n,u){n=Ee.convert(n);const p=u&&u.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),p,u)}_cameraForBoxAndBearing(n,u,p,m){const x={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Be=m.padding;m.padding={top:Be,bottom:Be,right:Be,left:Be}}m.padding=a.e(x,m.padding);const E=this.transform,I=E.padding,D=new Ee(n,u),B=E.project(D.getNorthWest()),U=E.project(D.getNorthEast()),q=E.project(D.getSouthEast()),Y=E.project(D.getSouthWest()),ht=a.b8(-p),lt=B.rotate(ht),dt=U.rotate(ht),it=q.rotate(ht),wt=Y.rotate(ht),Ft=new a.P(Math.max(lt.x,dt.x,wt.x,it.x),Math.max(lt.y,dt.y,wt.y,it.y)),gt=new a.P(Math.min(lt.x,dt.x,wt.x,it.x),Math.min(lt.y,dt.y,wt.y,it.y)),Ct=Ft.sub(gt),Nt=(E.width-(I.left+I.right+m.padding.left+m.padding.right))/Ct.x,Vt=(E.height-(I.top+I.bottom+m.padding.top+m.padding.bottom))/Ct.y;if(Vt<0||Nt<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const qt=Math.min(E.scaleZoom(E.scale*Math.min(Nt,Vt)),m.maxZoom),oe=a.P.convert(m.offset),ne=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.b8(p)),ae=oe.add(ne).mult(E.scale/E.zoomScale(qt));return{center:E.unproject(B.add(q).div(2).sub(ae)),zoom:qt,bearing:p}}fitBounds(n,u,p){return this._fitInternal(this.cameraForBounds(n,u),u,p)}fitScreenCoordinates(n,u,p,m,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(n)),this.transform.pointLocation(a.P.convert(u)),p,m),m,x)}_fitInternal(n,u,p){return n?(delete(u=a.e(n,u)).padding,u.linear?this.easeTo(u,p):this.flyTo(u,p)):this}jumpTo(n,u){this.stop();const p=this._getTransformForUpdate();let m=!1,x=!1,E=!1;return"zoom"in n&&p.zoom!==+n.zoom&&(m=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=a.M.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(x=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(E=!0,p.pitch=+n.pitch),n.padding==null||p.isPaddingEqual(n.padding)||(p.padding=n.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",u)).fire(new a.k("move",u)),m&&this.fire(new a.k("zoomstart",u)).fire(new a.k("zoom",u)).fire(new a.k("zoomend",u)),x&&this.fire(new a.k("rotatestart",u)).fire(new a.k("rotate",u)).fire(new a.k("rotateend",u)),E&&this.fire(new a.k("pitchstart",u)).fire(new a.k("pitch",u)).fire(new a.k("pitchend",u)),this.fire(new a.k("moveend",u))}calculateCameraOptionsFromTo(n,u,p,m=0){const x=a.Y.fromLngLat(n,u),E=a.Y.fromLngLat(p,m),I=E.x-x.x,D=E.y-x.y,B=E.z-x.z,U=Math.hypot(I,D,B);if(U===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(I,D),Y=this.transform.scaleZoom(this.transform.cameraToCenterDistance/U/this.transform.tileSize),ht=180*Math.atan2(I,-D)/Math.PI;let lt=180*Math.acos(q/U)/Math.PI;return lt=B<0?90-lt:90+lt,{center:E.toLngLat(),zoom:Y,pitch:lt,bearing:ht}}easeTo(n,u){var p;this._stop(!1,n.easeId),((n=a.e({offset:[0,0],duration:500,easing:a.b7},n)).animate===!1||!n.essential&&M.prefersReducedMotion)&&(n.duration=0);const m=this._getTransformForUpdate(),x=this.getZoom(),E=this.getBearing(),I=this.getPitch(),D=this.getPadding(),B="bearing"in n?this._normalizeBearing(n.bearing,E):E,U="pitch"in n?+n.pitch:I,q="padding"in n?n.padding:m.padding,Y=a.P.convert(n.offset);let ht=m.centerPoint.add(Y);const lt=m.pointLocation(ht),{center:dt,zoom:it}=m.getConstrained(a.M.convert(n.center||lt),(p=n.zoom)!==null&&p!==void 0?p:x);this._normalizeCenter(dt);const wt=m.project(lt),Ft=m.project(dt).sub(wt),gt=m.zoomScale(it-x);let Ct,Nt;n.around&&(Ct=a.M.convert(n.around),Nt=m.locationPoint(Ct));const Vt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||it!==x,this._rotating=this._rotating||E!==B,this._pitching=this._pitching||U!==I,this._padding=!m.isPaddingEqual(q),this._easeId=n.easeId,this._prepareEase(u,n.noMoveStart,Vt),this.terrain&&this._prepareElevation(dt),this._ease(qt=>{if(this._zooming&&(m.zoom=a.z.number(x,it,qt)),this._rotating&&(m.bearing=a.z.number(E,B,qt)),this._pitching&&(m.pitch=a.z.number(I,U,qt)),this._padding&&(m.interpolatePadding(D,q,qt),ht=m.centerPoint.add(Y)),this.terrain&&!n.freezeElevation&&this._updateElevation(qt),Ct)m.setLocationAtPoint(Ct,Nt);else{const oe=m.zoomScale(m.zoom-x),ne=it>x?Math.min(2,gt):Math.max(.5,gt),ae=Math.pow(ne,1-qt),Be=m.unproject(wt.add(Ft.mult(qt*ae)).mult(oe));m.setLocationAtPoint(m.renderWorldCopies?Be.wrap():Be,ht)}this._applyUpdatedTransform(m),this._fireMoveEvents(u)},qt=>{this.terrain&&this._finalizeElevation(),this._afterEase(u,qt)},n),this}_prepareEase(n,u,p={}){this._moving=!0,u||p.moving||this.fire(new a.k("movestart",n)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",n))}_prepareElevation(n){this._elevationCenter=n,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(n){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(n<1&&u!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=n*(p-(u-(p*n+this._elevationStart))/(1-n)),this._elevationTarget=u}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,n)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(n){if(!this.transformCameraUpdate)return;const u=n.clone(),{center:p,zoom:m,pitch:x,bearing:E,elevation:I}=this.transformCameraUpdate(u);p&&(u.center=p),m!==void 0&&(u.zoom=m),x!==void 0&&(u.pitch=x),E!==void 0&&(u.bearing=E),I!==void 0&&(u.elevation=I),this.transform.apply(u)}_fireMoveEvents(n){this.fire(new a.k("move",n)),this._zooming&&this.fire(new a.k("zoom",n)),this._rotating&&this.fire(new a.k("rotate",n)),this._pitching&&this.fire(new a.k("pitch",n))}_afterEase(n,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const p=this._zooming,m=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",n)),m&&this.fire(new a.k("rotateend",n)),x&&this.fire(new a.k("pitchend",n)),this.fire(new a.k("moveend",n))}flyTo(n,u){var p;if(!n.essential&&M.prefersReducedMotion){const Ei=a.L(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ei,u)}this.stop(),n=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},n);const m=this._getTransformForUpdate(),x=this.getZoom(),E=this.getBearing(),I=this.getPitch(),D=this.getPadding(),B="bearing"in n?this._normalizeBearing(n.bearing,E):E,U="pitch"in n?+n.pitch:I,q="padding"in n?n.padding:m.padding,Y=a.P.convert(n.offset);let ht=m.centerPoint.add(Y);const lt=m.pointLocation(ht),{center:dt,zoom:it}=m.getConstrained(a.M.convert(n.center||lt),(p=n.zoom)!==null&&p!==void 0?p:x);this._normalizeCenter(dt);const wt=m.zoomScale(it-x),Ft=m.project(lt),gt=m.project(dt).sub(Ft);let Ct=n.curve;const Nt=Math.max(m.width,m.height),Vt=Nt/wt,qt=gt.mag();if("minZoom"in n){const Ei=a.ac(Math.min(n.minZoom,x,it),m.minZoom,m.maxZoom),fi=Nt/m.zoomScale(Ei-x);Ct=Math.sqrt(fi/qt*2)}const oe=Ct*Ct;function ne(Ei){const fi=(Vt*Vt-Nt*Nt+(Ei?-1:1)*oe*oe*qt*qt)/(2*(Ei?Vt:Nt)*oe*qt);return Math.log(Math.sqrt(fi*fi+1)-fi)}function ae(Ei){return(Math.exp(Ei)-Math.exp(-Ei))/2}function Be(Ei){return(Math.exp(Ei)+Math.exp(-Ei))/2}const _i=ne(!1);let Se=function(Ei){return Be(_i)/Be(_i+Ct*Ei)},hi=function(Ei){return Nt*((Be(_i)*(ae(fi=_i+Ct*Ei)/Be(fi))-ae(_i))/oe)/qt;var fi},vi=(ne(!0)-_i)/Ct;if(Math.abs(qt)<1e-6||!isFinite(vi)){if(Math.abs(Nt-Vt)<1e-6)return this.easeTo(n,u);const Ei=Vt<Nt?-1:1;vi=Math.abs(Math.log(Vt/Nt))/Ct,hi=function(){return 0},Se=function(fi){return Math.exp(Ei*Ct*fi)}}return n.duration="duration"in n?+n.duration:1e3*vi/("screenSpeed"in n?+n.screenSpeed/Ct:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=E!==B,this._pitching=U!==I,this._padding=!m.isPaddingEqual(q),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(dt),this._ease(Ei=>{const fi=Ei*vi,bi=1/Se(fi);m.zoom=Ei===1?it:x+m.scaleZoom(bi),this._rotating&&(m.bearing=a.z.number(E,B,Ei)),this._pitching&&(m.pitch=a.z.number(I,U,Ei)),this._padding&&(m.interpolatePadding(D,q,Ei),ht=m.centerPoint.add(Y)),this.terrain&&!n.freezeElevation&&this._updateElevation(Ei);const wi=Ei===1?dt:m.unproject(Ft.add(gt.mult(hi(fi))).mult(bi));m.setLocationAtPoint(m.renderWorldCopies?wi.wrap():wi,ht),this._applyUpdatedTransform(m),this._fireMoveEvents(u)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(u)},n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,u)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,u,p){p.animate===!1||p.duration===0?(n(1),u()):(this._easeStart=M.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(n,u){n=a.b1(n,-180,180);const p=Math.abs(n-u);return Math.abs(n-360-u)<p&&(n-=360),Math.abs(n+360-u)<p&&(n+=360),n}_normalizeCenter(n){const u=this.transform;if(!u.renderWorldCopies||u.lngRange)return;const p=n.lng-u.center.lng;n.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(n){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(n),this.transform.tileZoom)-this.transform.elevation:null}}const Ws={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class af{constructor(n=Ws){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=n}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options.compact,this._container=A.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=A.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=A.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){A.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(n,u){const p=this._map._getUIString(`AttributionControl.${u}`);n.title=p,n.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const u=this._map.style.sourceCaches;for(const m in u){const x=u[m];if(x.used||x.usedForTerrain){const E=x.getSource();E.attribution&&n.indexOf(E.attribution)<0&&n.push(E.attribution)}}n=n.filter(m=>String(m).trim()),n.sort((m,x)=>m.length-x.length),n=n.filter((m,x)=>{for(let E=x+1;E<n.length;E++)if(n[E].indexOf(m)>=0)return!1;return!0});const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ja{constructor(n={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const p=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=n}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=A.create("div","maplibregl-ctrl");const u=A.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){A.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ln{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u}remove(n){const u=this._currentlyRunning,p=u?this._queue.concat(u):this._queue;for(const m of p)if(m.id===n)return void(m.cancelled=!0)}run(n=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const p of u)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var mn=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class of extends a.E{constructor(n){super(),this.sourceCache=n,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,n.usedForTerrain=!0,n.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(n,u){this.sourceCache.update(n,u),this._renderableTilesKeys=[];const p={};for(const m of n.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aN(m.posMatrix,0,a.W,0,a.W,0,1),this._tiles[m.key]=new Ge(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(n){for(const u in this._tiles){const p=this._tiles[u];(!n||p.tileID.equals(n)||p.tileID.isChildOf(n)||n.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(n=>this.getTileByID(n))}getTileByID(n){return this._tiles[n]}getTerrainCoords(n){const u={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(n.canonical)){const x=n.clone();x.posMatrix=new Float64Array(16),a.aN(x.posMatrix,0,a.W,0,a.W,0,1),u[p]=x}else if(m.canonical.isChildOf(n.canonical)){const x=n.clone();x.posMatrix=new Float64Array(16);const E=m.canonical.z-n.canonical.z,I=m.canonical.x-(m.canonical.x>>E<<E),D=m.canonical.y-(m.canonical.y>>E<<E),B=a.W>>E;a.aN(x.posMatrix,0,B,0,B,0,1),a.H(x.posMatrix,x.posMatrix,[-I*B,-D*B,0]),u[p]=x}else if(n.canonical.isChildOf(m.canonical)){const x=n.clone();x.posMatrix=new Float64Array(16);const E=n.canonical.z-m.canonical.z,I=n.canonical.x-(n.canonical.x>>E<<E),D=n.canonical.y-(n.canonical.y>>E<<E),B=a.W>>E;a.aN(x.posMatrix,0,a.W,0,a.W,0,1),a.H(x.posMatrix,x.posMatrix,[I*B,D*B,0]),a.J(x.posMatrix,x.posMatrix,[1/2**E,1/2**E,0]),u[p]=x}}return u}getSourceTile(n,u){const p=this.sourceCache._source;let m=n.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[n.key]||(this._sourceTileCache[n.key]=n.scaledTo(m).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[n.key]);if((!x||!x.dem)&&u)for(;m>=p.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(n.scaledTo(m--).key);return x}tilesAfterTime(n=Date.now()){return Object.values(this._tiles).filter(u=>u.timeAdded>=n)}}class Uo{constructor(n,u,p){this.painter=n,this.sourceCache=new of(u),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(n,u,p,m=a.W){var x;if(!(u>=0&&u<m&&p>=0&&p<m))return 0;const E=this.getTerrainData(n),I=(x=E.tile)===null||x===void 0?void 0:x.dem;if(!I)return 0;const D=function(lt,dt,it){var wt=dt[0],Ft=dt[1];return lt[0]=it[0]*wt+it[4]*Ft+it[12],lt[1]=it[1]*wt+it[5]*Ft+it[13],lt}([],[u/m*a.W,p/m*a.W],E.u_terrain_matrix),B=[D[0]*I.dim,D[1]*I.dim],U=Math.floor(B[0]),q=Math.floor(B[1]),Y=B[0]-U,ht=B[1]-q;return I.get(U,q)*(1-Y)*(1-ht)+I.get(U+1,q)*Y*(1-ht)+I.get(U,q+1)*(1-Y)*ht+I.get(U+1,q+1)*Y*ht}getElevationForLngLatZoom(n,u){const{tileID:p,mercatorX:m,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(n,u);return this.getElevation(p,m%a.W,x%a.W,a.W)}getElevation(n,u,p,m=a.W){return this.getDEMElevation(n,u,p,m)*this.exaggeration}getTerrainData(n){if(!this._emptyDemTexture){const m=this.painter.context,x=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new zt(m,x,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new zt(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const u=this.sourceCache.getSourceTile(n,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const m=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new zt(m,u.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),u.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const p=u&&u+u.tileID.key+n.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let x=n.canonical.z-u.tileID.canonical.z;n.overscaledZ>n.canonical.z&&(n.canonical.z>=m?x=n.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=n.canonical.x-(n.canonical.x>>x<<x),I=n.canonical.y-(n.canonical.y>>x<<x),D=a.b9(new Float64Array(16),[1/(a.W<<x),1/(a.W<<x),0]);a.H(D,D,[E*a.W,I*a.W,0]),this._demMatrixCache[n.key]={matrix:D,coord:n}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[n.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(n){const u=this.painter,p=u.width/devicePixelRatio,m=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new zt(u.context,{width:p,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new zt(u.context,{width:p,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(n==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const n=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,E=0;x<this._coordsTextureSize;x++)for(let I=0;I<this._coordsTextureSize;I++,E+=4)u[E+0]=255&I,u[E+1]=255&x,u[E+2]=I>>8<<4|x>>8,u[E+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),m=new zt(n,p,n.gl.RGBA,{premultiply:!1});return m.bind(n.gl.NEAREST,n.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(n){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),p=this.painter.context,m=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(n.x,this.painter.height/devicePixelRatio-n.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null);const x=u[0]+(u[2]>>4<<8),E=u[1]+((15&u[2])<<8),I=this.coordsIndex[255-u[3]],D=I&&this.sourceCache.getTileByID(I);if(!D)return null;const B=this._coordsTextureSize,U=(1<<D.tileID.canonical.z)*B;return new a.Y((D.tileID.canonical.x*B+x)/U+D.tileID.wrap,(D.tileID.canonical.y*B+E)/U,this.getElevation(D.tileID,x,E,B))}depthAtPoint(n){const u=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(n.x,this.painter.height/devicePixelRatio-n.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const n=this.painter.context,u=new a.ba,p=new a.aX,m=this.meshSize,x=a.W/m,E=m*m;for(let q=0;q<=m;q++)for(let Y=0;Y<=m;Y++)u.emplaceBack(Y*x,q*x,0);for(let q=0;q<E;q+=m+1)for(let Y=0;Y<m;Y++)p.emplaceBack(Y+q,m+Y+q+1,m+Y+q+2),p.emplaceBack(Y+q,m+Y+q+2,Y+q+1);const I=u.length,D=I+2*(m+1);for(const q of[0,1])for(let Y=0;Y<=m;Y++)for(const ht of[0,1])u.emplaceBack(Y*x,q*a.W,ht);for(let q=0;q<2*m;q+=2)p.emplaceBack(D+q,D+q+1,D+q+3),p.emplaceBack(D+q,D+q+3,D+q+2),p.emplaceBack(I+q,I+q+3,I+q+1),p.emplaceBack(I+q,I+q+2,I+q+3);const B=u.length,U=B+2*(m+1);for(const q of[0,1])for(let Y=0;Y<=m;Y++)for(const ht of[0,1])u.emplaceBack(q*a.W,Y*x,ht);for(let q=0;q<2*m;q+=2)p.emplaceBack(B+q,B+q+1,B+q+3),p.emplaceBack(B+q,B+q+3,B+q+2),p.emplaceBack(U+q,U+q+3,U+q+1),p.emplaceBack(U+q,U+q+2,U+q+3);return this._mesh={indexBuffer:n.createIndexBuffer(p),vertexBuffer:n.createVertexBuffer(u,mn.members),segments:a.$.simpleSegment(0,0,u.length,p.length)},this._mesh}getMeshFrameDelta(n){return 2*Math.PI*a.bb/Math.pow(2,n)/5}getMinTileElevationForLngLatZoom(n,u){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(n,u);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(n){const u=this.getTerrainData(n).tile,p={minElevation:null,maxElevation:null};return u&&u.dem&&(p.minElevation=u.dem.min*this.exaggeration,p.maxElevation=u.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(n,u){const p=a.Y.fromLngLat(n.wrap()),m=(1<<u)*a.W,x=p.x*m,E=p.y*m,I=Math.floor(x/a.W),D=Math.floor(E/a.W);return{tileID:new a.Q(u,0,u,I,D),mercatorX:x,mercatorY:E}}}class Wl{constructor(n,u,p){this._context=n,this._size=u,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const n of this._objects)n.texture.destroy(),n.fbo.destroy()}_createObject(n){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new zt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(p.texture),{id:n,fbo:u,texture:p,stamp:-1,inUse:!1}}getObjectForId(n){return this._objects[n]}useObject(n){n.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>n.id!==u),this._recentlyUsed.push(n.id)}stampObject(n){n.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const n=this._createObject(this._objects.length);return this._objects.push(n),n}freeObject(n){n.inUse=!1}freeAllObjects(){for(const n of this._objects)this.freeObject(n)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(n=>!n.inUse)===!1}}const kr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class kc{constructor(n,u){this.painter=n,this.terrain=u,this.pool=new Wl(n.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(n){return this.pool.getObjectForId(n.rtt[this._stacks.length-1].id).texture}prepareForRender(n,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=n._order.filter(p=>!n._layers[p].isHidden(u)),this._coordsDescendingInv={};for(const p in n.sourceCaches){this._coordsDescendingInv[p]={};const m=n.sourceCaches[p].getVisibleCoordinates();for(const x of m){const E=this.terrain.sourceCache.getTerrainCoords(x);for(const I in E)this._coordsDescendingInv[p][I]||(this._coordsDescendingInv[p][I]=[]),this._coordsDescendingInv[p][I].push(E[I])}}this._coordsDescendingInvStr={};for(const p of n._order){const m=n._layers[p],x=m.source;if(kr[m.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const E in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][E]=this._coordsDescendingInv[x][E].map(I=>I.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[m][p.tileID.key];x&&x!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(n){if(n.isHidden(this.painter.transform.zoom))return!1;const u=n.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===n.id;if(kr[u]&&(this._prevType&&kr[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(n.id),!m))return!0;if(kr[this._prevType]||kr[u]&&m){this._prevType=u;const x=this._stacks.length-1,E=this._stacks[x]||[];for(const I of this._renderableTiles){if(this.pool.isFull()&&(bc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(I),I.rtt[x]){const B=this.pool.getObjectForId(I.rtt[x].id);if(B.stamp===I.rtt[x].stamp){this.pool.useObject(B);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),I.rtt[x]={id:D.id,stamp:D.stamp},p.context.bindFramebuffer.set(D.fbo.framebuffer),p.context.clear({color:a.aO.transparent,stencil:0}),p.currentStencilSource=void 0;for(let B=0;B<E.length;B++){const U=p.style._layers[E[B]],q=U.source?this._coordsDescendingInv[U.source][I.tileID.key]:[I.tileID];p.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),p._renderTileClippingMasks(U,q),p.renderLayer(p,p.style.sourceCaches[U.source],U,q),U.source&&(I.rttCoords[U.source]=this._coordsDescendingInvStr[U.source][I.tileID.key])}}return bc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),kr[u]}return!1}}const Fc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Vo=_,Bc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Ws,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},ql=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Oc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Nc{constructor(n,u,p=!1){this.mousedown=E=>{this.startMouse(a.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),A.mousePos(this.element,E)),A.addEventListener(window,"mousemove",this.mousemove),A.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,A.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=A.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),A.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=A.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=n.dragRotate._mouseRotate.getClickTolerance(),x=n.dragRotate._mousePitch.getClickTolerance();this.element=u,this.mouseRotate=$a({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:I,bearingDegreesPerPixelMoved:D=.8})=>{const B=new Ec;return new _r({clickTolerance:I,move:(U,q)=>({bearingDelta:(q.x-U.x)*D}),moveStateManager:B,enable:E,assignEvents:ql})})({clickTolerance:m,enable:!0}),this.map=n,p&&(this.mousePitch=Cc({clickTolerance:x,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:I,pitchDegreesPerPixelMoved:D=-.5})=>{const B=new Ec;return new _r({clickTolerance:I,move:(U,q)=>({pitchDelta:(q.y-U.y)*D}),moveStateManager:B,enable:E,assignEvents:ql})})({clickTolerance:x,enable:!0})),A.addEventListener(u,"mousedown",this.mousedown),A.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),A.addEventListener(u,"touchcancel",this.reset)}startMouse(n,u){this.mouseRotate.dragStart(n,u),this.mousePitch&&this.mousePitch.dragStart(n,u),A.disableDrag()}startTouch(n,u){this.touchRotate.dragStart(n,u),this.touchPitch&&this.touchPitch.dragStart(n,u),A.disableDrag()}moveMouse(n,u){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(n,u)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:x}=this.mousePitch.dragMove(n,u)||{};x&&p.setPitch(p.getPitch()+x)}}moveTouch(n,u){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(n,u)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:x}=this.touchPitch.dragMove(n,u)||{};x&&p.setPitch(p.getPitch()+x)}}off(){const n=this.element;A.removeEventListener(n,"mousedown",this.mousedown),A.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),A.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.removeEventListener(window,"touchend",this.touchend),A.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){A.enableDrag(),A.removeEventListener(window,"mousemove",this.mousemove),A.removeEventListener(window,"mouseup",this.mouseup),A.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.removeEventListener(window,"touchend",this.touchend)}}let yr;function $l(y,n,u){const p=new a.M(y.lng,y.lat);if(y=new a.M(y.lng,y.lat),n){const m=new a.M(y.lng-360,y.lat),x=new a.M(y.lng+360,y.lat),E=u.locationPoint(y).distSqr(n);u.locationPoint(m).distSqr(n)<E?y=m:u.locationPoint(x).distSqr(n)<E&&(y=x)}for(;Math.abs(y.lng-u.center.lng)>180;){const m=u.locationPoint(y);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;y.lng>u.center.lng?y.lng-=360:y.lng+=360}return y.lng!==p.lng&&u.locationPoint(y).y>u.height/2-u.getHorizon()?y:p}const Go={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jl(y,n,u){const p=y.classList;for(const m in Go)p.remove(`maplibregl-${u}-anchor-${m}`);p.add(`maplibregl-${u}-anchor-${n}`)}class Za extends a.E{constructor(n){if(super(),this._onKeyPress=u=>{const p=u.code,m=u.charCode||u.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=u=>{const p=u.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=u=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((u==null?void 0:u.type)==="terrain"||(u==null?void 0:u.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?$l(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let x="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?x=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(x=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),u&&u.type!=="moveend"||(this._pos=this._pos.round()),A.setTransform(this._element,`${Go[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${x}`),M.frameAsync(new AbortController).then(()=>{this._updateOpacity(u&&u.type==="moveend")}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(n==null?void 0:n.opacity,n==null?void 0:n.opacityWhenCovered),n&&n.element)this._element=n.element,this._offset=a.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=A.create("div"),this._element.setAttribute("aria-label","Map marker");const u=A.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${p}px`),u.setAttributeNS(null,"width",`${m}px`),u.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const x=A.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const E=A.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const I=A.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const wt of D){const Ft=A.createNS("http://www.w3.org/2000/svg","ellipse");Ft.setAttributeNS(null,"opacity","0.04"),Ft.setAttributeNS(null,"cx","10.5"),Ft.setAttributeNS(null,"cy","5.80029008"),Ft.setAttributeNS(null,"rx",wt.rx),Ft.setAttributeNS(null,"ry",wt.ry),I.appendChild(Ft)}const B=A.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const U=A.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(U);const q=A.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const Y=A.createNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(Y);const ht=A.createNS("http://www.w3.org/2000/svg","g");ht.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ht.setAttributeNS(null,"fill","#FFFFFF");const lt=A.createNS("http://www.w3.org/2000/svg","g");lt.setAttributeNS(null,"transform","translate(8.0, 8.0)");const dt=A.createNS("http://www.w3.org/2000/svg","circle");dt.setAttributeNS(null,"fill","#000000"),dt.setAttributeNS(null,"opacity","0.25"),dt.setAttributeNS(null,"cx","5.5"),dt.setAttributeNS(null,"cy","5.5"),dt.setAttributeNS(null,"r","5.4999962");const it=A.createNS("http://www.w3.org/2000/svg","circle");it.setAttributeNS(null,"fill","#FFFFFF"),it.setAttributeNS(null,"cx","5.5"),it.setAttributeNS(null,"cy","5.5"),it.setAttributeNS(null,"r","5.4999962"),lt.appendChild(dt),lt.appendChild(it),E.appendChild(I),E.appendChild(B),E.appendChild(q),E.appendChild(ht),E.appendChild(lt),u.appendChild(E),u.setAttributeNS(null,"height",p*this._scale+"px"),u.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(u),this._offset=a.P.convert(n&&n.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),jl(this._element,this._anchor,"marker"),n&&n.className)for(const u of n.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(n){return this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),n.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),A.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=a.M.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const m=Math.abs(13.5)/Math.SQRT2;n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const n=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:n?(n.isOpen()?n.remove():(n.setLngLat(this._lngLat),n.addTo(this._map)),this):this}_updateOpacity(n=!1){var u,p;if(!(!((u=this._map)===null||u===void 0)&&u.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(n)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,x=m.terrain.depthAtPoint(this._pos),E=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,E)-x<.006)return void(this._element.style.opacity=this._opacity);const I=-this._offset.y/m.transform._pixelPerMeter,D=Math.sin(m.getPitch()*Math.PI/180)*I,B=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),U=m.transform.lngLatToCameraDepth(this._lngLat,E+D)-B>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&U&&this._popup.remove(),this._element.style.opacity=U?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(n){return this._offset=a.P.convert(n),this._update(),this}addClassName(n){this._element.classList.add(n)}removeClassName(n){this._element.classList.remove(n)}toggleClassName(n){return this._element.classList.toggle(n)}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(n,u){return n===void 0&&u===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),n!==void 0&&(this._opacity=n),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const Uc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Xa=0,Fr=!1;const Vc={maxWidth:100,unit:"metric"};function Zl(y,n,u){const p=u&&u.maxWidth||100,m=y._container.clientHeight/2,x=y.unproject([0,m]),E=y.unproject([p,m]),I=x.distanceTo(E);if(u&&u.unit==="imperial"){const D=3.2808*I;D>5280?aa(n,p,D/5280,y._getUIString("ScaleControl.Miles")):aa(n,p,D,y._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?aa(n,p,I/1852,y._getUIString("ScaleControl.NauticalMiles")):I>=1e3?aa(n,p,I/1e3,y._getUIString("ScaleControl.Kilometers")):aa(n,p,I,y._getUIString("ScaleControl.Meters"))}function aa(y,n,u,p){const m=function(x){const E=Math.pow(10,`${Math.floor(x)}`.length-1);let I=x/E;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(D){const B=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*B)/B}(I),E*I}(u);y.style.width=n*(m/u)+"px",y.innerHTML=`${m}&nbsp;${p}`}const Gc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Hc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wc(y){if(y){if(typeof y=="number"){const n=Math.round(Math.abs(y)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,y),"top-left":new a.P(n,n),"top-right":new a.P(-n,n),bottom:new a.P(0,-y),"bottom-left":new a.P(n,-n),"bottom-right":new a.P(-n,-n),left:new a.P(y,0),right:new a.P(-y,0)}}if(y instanceof a.P||Array.isArray(y)){const n=a.P.convert(y);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:a.P.convert(y.center||[0,0]),top:a.P.convert(y.top||[0,0]),"top-left":a.P.convert(y["top-left"]||[0,0]),"top-right":a.P.convert(y["top-right"]||[0,0]),bottom:a.P.convert(y.bottom||[0,0]),"bottom-left":a.P.convert(y["bottom-left"]||[0,0]),"bottom-right":a.P.convert(y["bottom-right"]||[0,0]),left:a.P.convert(y.left||[0,0]),right:a.P.convert(y.right||[0,0])}}return Wc(new a.P(0,0))}const lf=_;d.AJAXError=a.be,d.Evented=a.E,d.LngLat=a.M,d.MercatorCoordinate=a.Y,d.Point=a.P,d.addProtocol=a.bf,d.config=a.a,d.removeProtocol=a.bg,d.AttributionControl=af,d.BoxZoomHandler=qa,d.CanvasSource=$t,d.CooperativeGesturesHandler=ri,d.DoubleClickZoomHandler=Dc,d.DragPanHandler=Hs,d.DragRotateHandler=Oo,d.EdgeInsets=zo,d.FullscreenControl=class extends a.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var n;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((n=u==null?void 0:u.shadowRoot)===null||n===void 0)&&n.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){A.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=A.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);A.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=Oe,d.GeolocateControl=class extends a.E{constructor(y){super(),this._onSuccess=n=>{if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(n),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(n),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",n)),this._finish()}},this._updateCamera=n=>{const u=new a.M(n.coords.longitude,n.coords.latitude),p=n.coords.accuracy,m=this._map.getBearing(),x=a.e({bearing:m},this.options.fitBoundsOptions),E=Ee.fromLngLat(u,p);this._map.fitBounds(E,x,{geolocateSource:!0})},this._updateMarker=n=>{if(n){const u=new a.M(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=n.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=n=>{if(this._map){if(this.options.trackUserLocation)if(n.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(n.code===3&&Fr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",n)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=n=>{if(this._map){if(this._container.addEventListener("contextmenu",u=>u.preventDefault()),this._geolocateButton=A.create("button","maplibregl-ctrl-geolocate",this._container),A.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",n===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=A.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Za({element:this._dotElement}),this._circleElement=A.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Za({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},Uc,y)}onAdd(y){return this._map=y,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(n=!1){if(yr!==void 0&&!n)return yr;if(window.navigator.permissions===void 0)return yr=!!window.navigator.geolocation,yr;try{yr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{yr=!!window.navigator.geolocation}return yr})}().then(n=>this._setupUI(n)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),A.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Xa=0,Fr=!1}_isOutOfMapMaxBounds(y){const n=this._map.getMaxBounds(),u=y.coords;return n&&(u.longitude<n.getWest()||u.longitude>n.getEast()||u.latitude<n.getSouth()||u.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),n=y.getSouthEast(),u=y.getNorthEast(),p=n.distanceTo(u),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Xa--,Fr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Xa++,Xa>1?(y={maximumAge:6e5,timeout:0},Fr=!0):(y=this.options.positionOptions,Fr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.Hash=Sc,d.ImageSource=mt,d.KeyboardHandler=Ki,d.LngLatBounds=Ee,d.LogoControl=ja,d.Map=class extends rf{constructor(y){if(a.bc.mark(a.bd.create),(y=a.e({},Bc,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Nl(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=n=>{n.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new ln,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},Fc,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=G.addThrottleControl(()=>this.isMoving()),this._requestManager=new Q(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1;const u=Mc(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{n?u(p):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new as(this,y),this._hash=y.hash&&new Sc(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,a.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new af(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new ja,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new a.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new a.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new a.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(y,n){if(n===void 0&&(n=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(u,p.firstChild):p.appendChild(u),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(y);return n>-1&&this._controls.splice(n,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,n,u,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,n,u,p)}resize(y){var n;const u=this._containerDimensions(),p=u[0],m=u[1],x=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,x),this.painter.resize(p,m,x),this.painter.overLimit()){const I=this.painter.context.gl;this._maxCanvasSize=[I.drawingBufferWidth,I.drawingBufferHeight];const D=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,D),this.painter.resize(p,m,D)}this.transform.resize(p,m),(n=this._requestedCameraState)===null||n===void 0||n.resize(p,m);const E=!this._moving;return E&&(this.stop(),this.fire(new a.k("movestart",y)).fire(new a.k("move",y))),this.fire(new a.k("resize",y)),E&&this.fire(new a.k("moveend",y)),this}_getClampedPixelRatio(y,n){const{0:u,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),x=y*m,E=n*m;return Math.min(x>u?u/x:1,E>p?p/E:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Ee.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(a.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(a.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,n,u){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layer:n,listener:u,delegates:{mousemove:x=>{const E=this.getLayer(n)?this.queryRenderedFeatures(x.point,{layers:[n]}):[];E.length?p||(p=!0,u.call(this,new Bn(y,this,x.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layer:n,listener:u,delegates:{mousemove:E=>{(this.getLayer(n)?this.queryRenderedFeatures(E.point,{layers:[n]}):[]).length?p=!0:p&&(p=!1,u.call(this,new Bn(y,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,u.call(this,new Bn(y,this,E.originalEvent)))}}}}{const p=m=>{const x=this.getLayer(n)?this.queryRenderedFeatures(m.point,{layers:[n]}):[];x.length&&(m.features=x,u.call(this,m),delete m.features)};return{layer:n,listener:u,delegates:{[y]:p}}}}on(y,n,u){if(u===void 0)return super.on(y,n);const p=this._createDelegatedListener(y,n,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(y,n,u){if(u===void 0)return super.once(y,n);const p=this._createDelegatedListener(y,n,u);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(y,n,u){return u===void 0?super.off(y,n):(this._delegatedListeners&&this._delegatedListeners[y]&&(p=>{const m=this._delegatedListeners[y];for(let x=0;x<m.length;x++){const E=m[x];if(E.layer===n&&E.listener===u){for(const I in E.delegates)this.off(I,E.delegates[I]);return m.splice(x,1),this}}})(),this)}queryRenderedFeatures(y,n){if(!this.style)return[];let u;const p=y instanceof a.P||Array.isArray(y),m=p?y:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(p?{}:y)||{},m instanceof a.P||typeof m[0]=="number")u=[a.P.convert(m)];else{const x=a.P.convert(m[0]),E=a.P.convert(m[1]);u=[x,new a.P(E.x,x.y),E,new a.P(x.x,E.y),x]}return this.style.queryRenderedFeatures(u,n,this.transform)}querySourceFeatures(y,n){return this.style.querySourceFeatures(y,n)}setStyle(y,n){return(n=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(y,n))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const n=this._locale[y];if(n==null)throw new Error(`Missing UI string '${y}'`);return n}_updateStyle(y,n){if(n.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,n));const u=this.style&&n.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new wl(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,n,u):this.style.loadJSON(y,n,u),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new wl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,n){if(typeof y=="string"){const u=this._requestManager.transformRequest(y,H.Style);a.h(u,new AbortController).then(p=>{this._updateDiff(p.data,n)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof y=="object"&&this._updateDiff(y,n)}_updateDiff(y,n){try{this.style.setState(y,n)&&this._update(!0)}catch(u){a.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(y,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(y,n){return this._lazyInitEmptyStyle(),this.style.addSource(y,n),this._update(!0)}isSourceLoaded(y){const n=this.style&&this.style.sourceCaches[y];if(n!==void 0)return n.loaded();this.fire(new a.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const n=this.style.sourceCaches[y.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&n.reload();for(const u in this.style._layers){const p=this.style._layers[u];p.type==="hillshade"&&p.source===y.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Uo(this.painter,n,y),this.painter.renderToTexture=new kc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=u=>{u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:y})),this}getTerrain(){var y,n;return(n=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&n!==void 0?n:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const n in y){const u=y[n]._tiles;for(const p in u){const m=u[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,n,u={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:x,stretchY:E,content:I}=u;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||a.b(n))){if(n.width===void 0||n.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:B,data:U}=n,q=n;return this.style.addImage(y,{data:new a.R({width:D,height:B},new Uint8Array(U)),pixelRatio:p,stretchX:x,stretchY:E,content:I,sdf:m,version:0,userImage:q}),q.onAdd&&q.onAdd(this,y),this}}{const{width:D,height:B,data:U}=M.getImageData(n);this.style.addImage(y,{data:new a.R({width:D,height:B},U),pixelRatio:p,stretchX:x,stretchY:E,content:I,sdf:m,version:0})}}updateImage(y,n){const u=this.style.getImage(y);if(!u)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=n instanceof HTMLImageElement||a.b(n)?M.getImageData(n):n,{width:m,height:x,data:E}=p;if(m===void 0||x===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==u.data.width||x!==u.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(n instanceof HTMLImageElement||a.b(n));return u.data.replace(E,I),this.style.updateImage(y,u),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return G.getImage(this._requestManager.transformRequest(y,H.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,n){return this._lazyInitEmptyStyle(),this.style.addLayer(y,n),this._update(!0)}moveLayer(y,n){return this.style.moveLayer(y,n),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,n,u){return this.style.setLayerZoomRange(y,n,u),this._update(!0)}setFilter(y,n,u={}){return this.style.setFilter(y,n,u),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,n,u,p={}){return this.style.setPaintProperty(y,n,u,p),this._update(!0)}getPaintProperty(y,n){return this.style.getPaintProperty(y,n)}setLayoutProperty(y,n,u,p={}){return this.style.setLayoutProperty(y,n,u,p),this._update(!0)}getLayoutProperty(y,n){return this.style.getLayoutProperty(y,n)}setGlyphs(y,n={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,n),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,n,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,n,u,p=>{p||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,n={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,n,u=>{u||this._update(!0)}),this}setLight(y,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,n),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,n){return this.style.setFeatureState(y,n),this._update()}removeFeatureState(y,n){return this.style.removeFeatureState(y,n),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,n=0;return this._container&&(y=this._container.clientWidth||400,n=this._container.clientHeight||300),[y,n]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const n=this._canvasContainer=A.create("div","maplibregl-canvas-container",y);this._interactive&&n.classList.add("maplibregl-interactive"),this._canvas=A.create("canvas","maplibregl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),p=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],p);const m=this._controlContainer=A.create("div","maplibregl-control-container",y),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{x[E]=A.create("div",`maplibregl-ctrl-${E} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,n,u){this._canvas.width=Math.floor(u*y),this._canvas.height=Math.floor(u*n),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${n}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let n=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{n={requestedAttributes:y},p&&(n.statusMessage=p.statusMessage,n.type=p.type)},{once:!0});const u=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!u){const p="Failed to initialize WebGL";throw n?(n.message=p,new Error(JSON.stringify(n))):new Error(p)}this.painter=new Ga(u,this.transform),C.testSupport(u)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const n=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,x=M.now();this.style.zoomHistory.update(m,x);const E=new a.a8(m,{now:x,fadeDuration:n,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),I=E.crossFadingFactor();I===1&&I===this._crossFadingFactor||(u=!0,this._crossFadingFactor=I),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,n,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:n,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),G.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),A.remove(this._canvasContainer),A.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,M.frameAsync(this._frameRequest).then(y=>{a.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Vo}getCameraTargetElevation(){return this.transform.elevation}},d.MapMouseEvent=Bn,d.MapTouchEvent=Wa,d.MapWheelEvent=Rs,d.Marker=Za,d.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const n=this._map.getZoom(),u=n===this._map.getMaxZoom(),p=n===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=n},this._setButtonTitle=(n,u)=>{const p=this._map._getUIString(`NavigationControl.${u}`);n.title=p,n.setAttribute("aria-label",p)},this.options=a.e({},Oc,y),this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),A.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),A.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=A.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){A.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,n){const u=A.create("button",y,this._container);return u.type="button",u.addEventListener("click",n),u}},d.Popup=class extends a.E{constructor(y){super(),this.remove=()=>(this._content&&A.remove(this._content),this._container&&(A.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=n=>{this._update(n.point)},this._onMouseMove=n=>{this._update(n.point)},this._onDrag=n=>{this._update(n.point)},this._update=n=>{var u;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=A.create("div","maplibregl-popup",this._map.getContainer()),this._tip=A.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?$l(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._trackPointer&&!n)return;const p=this._flatPos=this._pos=this._trackPointer&&n?n:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&n?n:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const x=Wc(this.options.offset);if(!m){const I=this._container.offsetWidth,D=this._container.offsetHeight;let B;B=p.y+x.bottom.y<D?["top"]:p.y>this._map.transform.height-D?["bottom"]:[],p.x<I/2?B.push("left"):p.x>this._map.transform.width-I/2&&B.push("right"),m=B.length===0?"bottom":B.join("-")}let E=p.add(x[m]);this.options.subpixelPositioning||(E=E.round()),A.setTransform(this._container,`${Go[m]} translate(${E.x}px,${E.y}px)`),jl(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Gc),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=a.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const n=document.createDocumentFragment(),u=document.createElement("body");let p;for(u.innerHTML=y;p=u.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=A.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=A.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Hc);y&&y.focus()}},d.RasterDEMTileSource=ni,d.RasterTileSource=ai,d.ScaleControl=class{constructor(y){this._onMove=()=>{Zl(this._map,this._container,this.options)},this.setUnit=n=>{this.options.unit=n,Zl(this._map,this._container,this.options)},this.options=a.e({},Vc,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){A.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=Rc,d.Style=wl,d.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=A.create("button","maplibregl-ctrl-terrain",this._container),A.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){A.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=nf,d.TwoFingersTouchRotateHandler=Pc,d.TwoFingersTouchZoomHandler=Vl,d.TwoFingersTouchZoomRotateHandler=Ye,d.VectorTileSource=Pt,d.VideoSource=rt,d.addSourceType=(y,n)=>a._(void 0,void 0,void 0,function*(){if(ye(y))throw new Error(`A source type called "${y}" already exists.`);((u,p)=>{pe[u]=p})(y,n)}),d.clearPrewarmedResources=function(){const y=Fe;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Yt),Fe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return Zt().getRTLTextPluginStatus()},d.getVersion=function(){return lf},d.getWorkerCount=function(){return re.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(y){return xe().broadcast("importScript",y)},d.prewarm=function(){ei().acquire(Yt)},d.setMaxParallelImageRequests=function(y){a.a.MAX_PARALLEL_IMAGE_REQUESTS=y},d.setRTLTextPlugin=function(y,n){return Zt().setRTLTextPlugin(y,n)},d.setWorkerCount=function(y){re.workerCount=y},d.setWorkerUrl=function(y){a.a.WORKER_URL=y}});var c=e;return c})})(iw);var WP=iw.exports;const Lu=UP(WP);function qP(l){l("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),l("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),l("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),l.WGS84=l["EPSG:4326"],l["EPSG:3785"]=l["EPSG:3857"],l.GOOGLE=l["EPSG:3857"],l["EPSG:900913"]=l["EPSG:3857"],l["EPSG:102113"]=l["EPSG:3857"]}var _l=1,yl=2,Uh=3,$P=4,z_=5,Rx=6378137,jP=6356752314e-3,Dx=.0066943799901413165,Ru=484813681109536e-20,Me=Math.PI/2,ZP=.16666666666666666,XP=.04722222222222222,YP=.022156084656084655,He=1e-10,is=.017453292519943295,Gr=57.29577951308232,$i=Math.PI/4,ed=Math.PI*2,Ln=3.14159265359,Us={};Us.greenwich=0;Us.lisbon=-9.131906111111;Us.paris=2.337229166667;Us.bogota=-74.080916666667;Us.madrid=-3.687938888889;Us.rome=12.452333333333;Us.bern=7.439583333333;Us.jakarta=106.807719444444;Us.ferro=-17.666666666667;Us.brussels=4.367975;Us.stockholm=18.058277777778;Us.athens=23.7163375;Us.oslo=10.722916666667;const JP={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var zx=/[\s_\-\/\(\)]/g;function xo(l,t){if(l[t])return l[t];for(var e=Object.keys(l),s=t.toLowerCase().replace(zx,""),o=-1,c,d;++o<e.length;)if(c=e[o],d=c.toLowerCase().replace(zx,""),d===s)return l[c]}function k_(l){var t={},e=l.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,_){var v=_.split("=");return v.push(!0),a[v[0].toLowerCase()]=v[1],a},{}),s,o,c,d={proj:"projName",datum:"datumCode",rf:function(a){t.rf=parseFloat(a)},lat_0:function(a){t.lat0=a*is},lat_1:function(a){t.lat1=a*is},lat_2:function(a){t.lat2=a*is},lat_ts:function(a){t.lat_ts=a*is},lon_0:function(a){t.long0=a*is},lon_1:function(a){t.long1=a*is},lon_2:function(a){t.long2=a*is},alpha:function(a){t.alpha=parseFloat(a)*is},gamma:function(a){t.rectified_grid_angle=parseFloat(a)},lonc:function(a){t.longc=a*is},x_0:function(a){t.x0=parseFloat(a)},y_0:function(a){t.y0=parseFloat(a)},k_0:function(a){t.k0=parseFloat(a)},k:function(a){t.k0=parseFloat(a)},a:function(a){t.a=parseFloat(a)},b:function(a){t.b=parseFloat(a)},r:function(a){t.a=t.b=parseFloat(a)},r_a:function(){t.R_A=!0},zone:function(a){t.zone=parseInt(a,10)},south:function(){t.utmSouth=!0},towgs84:function(a){t.datum_params=a.split(",").map(function(_){return parseFloat(_)})},to_meter:function(a){t.to_meter=parseFloat(a)},units:function(a){t.units=a;var _=xo(JP,a);_&&(t.to_meter=_.to_meter)},from_greenwich:function(a){t.from_greenwich=a*is},pm:function(a){var _=xo(Us,a);t.from_greenwich=(_||parseFloat(a))*is},nadgrids:function(a){a==="@null"?t.datumCode="none":t.nadgrids=a},axis:function(a){var _="ewnsud";a.length===3&&_.indexOf(a.substr(0,1))!==-1&&_.indexOf(a.substr(1,1))!==-1&&_.indexOf(a.substr(2,1))!==-1&&(t.axis=a)},approx:function(){t.approx=!0}};for(s in e)o=e[s],s in d?(c=d[s],typeof c=="function"?c(o):t[c]=o):t[s]=o;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var id=1,sw=2,rw=3,Bp=4,aw=5,S0=-1,KP=/\s/,QP=/[A-Za-z]/,tL=/[A-Za-z84_]/,om=/[,\]]/,ow=/[\d\.E\-\+]/;function Pa(l){if(typeof l!="string")throw new Error("not a string");this.text=l.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=id}Pa.prototype.readCharicter=function(){var l=this.text[this.place++];if(this.state!==Bp)for(;KP.test(l);){if(this.place>=this.text.length)return;l=this.text[this.place++]}switch(this.state){case id:return this.neutral(l);case sw:return this.keyword(l);case Bp:return this.quoted(l);case aw:return this.afterquote(l);case rw:return this.number(l);case S0:return}};Pa.prototype.afterquote=function(l){if(l==='"'){this.word+='"',this.state=Bp;return}if(om.test(l)){this.word=this.word.trim(),this.afterItem(l);return}throw new Error(`havn't handled "`+l+'" in afterquote yet, index '+this.place)};Pa.prototype.afterItem=function(l){if(l===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=id;return}if(l==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=id,this.currentObject=this.stack.pop(),this.currentObject||(this.state=S0);return}};Pa.prototype.number=function(l){if(ow.test(l)){this.word+=l;return}if(om.test(l)){this.word=parseFloat(this.word),this.afterItem(l);return}throw new Error(`havn't handled "`+l+'" in number yet, index '+this.place)};Pa.prototype.quoted=function(l){if(l==='"'){this.state=aw;return}this.word+=l};Pa.prototype.keyword=function(l){if(tL.test(l)){this.word+=l;return}if(l==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=id;return}if(om.test(l)){this.afterItem(l);return}throw new Error(`havn't handled "`+l+'" in keyword yet, index '+this.place)};Pa.prototype.neutral=function(l){if(QP.test(l)){this.word=l,this.state=sw;return}if(l==='"'){this.word="",this.state=Bp;return}if(ow.test(l)){this.word=l,this.state=rw;return}if(om.test(l)){this.afterItem(l);return}throw new Error(`havn't handled "`+l+'" in neutral yet, index '+this.place)};Pa.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===S0)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function eL(l){var t=new Pa(l);return t.output()}function kx(l,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var s=t?{}:l,o=e.reduce(function(c,d){return Dh(d,c),c},s);t&&(l[t]=o)}function Dh(l,t){if(!Array.isArray(l)){t[l]=!0;return}var e=l.shift();if(e==="PARAMETER"&&(e=l.shift()),l.length===1){if(Array.isArray(l[0])){t[e]={},Dh(l[0],t[e]);return}t[e]=l[0];return}if(!l.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=l;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(l);return}Array.isArray(e)||(t[e]={});var s;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:l[0].toLowerCase(),convert:l[1]},l.length===3&&Dh(l[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:l[0],a:l[1],rf:l[2]},l.length===4&&Dh(l[3],t[e]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":l[0]=["name",l[0]],kx(t,e,l);return;default:for(s=-1;++s<l.length;)if(!Array.isArray(l[s]))return Dh(l,t[e]);return kx(t,e,l)}}var iL=.017453292519943295;function nL(l,t){var e=t[0],s=t[1];!(e in l)&&s in l&&(l[e]=l[s],t.length===3&&(l[e]=t[2](l[e])))}function Ur(l){return l*iL}function sL(l){if(l.type==="GEOGCS"?l.projName="longlat":l.type==="LOCAL_CS"?(l.projName="identity",l.local=!0):typeof l.PROJECTION=="object"?l.projName=Object.keys(l.PROJECTION)[0]:l.projName=l.PROJECTION,l.AXIS){for(var t="",e=0,s=l.AXIS.length;e<s;++e){var o=[l.AXIS[e][0].toLowerCase(),l.AXIS[e][1].toLowerCase()];o[0].indexOf("north")!==-1||(o[0]==="y"||o[0]==="lat")&&o[1]==="north"?t+="n":o[0].indexOf("south")!==-1||(o[0]==="y"||o[0]==="lat")&&o[1]==="south"?t+="s":o[0].indexOf("east")!==-1||(o[0]==="x"||o[0]==="lon")&&o[1]==="east"?t+="e":(o[0].indexOf("west")!==-1||(o[0]==="x"||o[0]==="lon")&&o[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(l.axis=t)}l.UNIT&&(l.units=l.UNIT.name.toLowerCase(),l.units==="metre"&&(l.units="meter"),l.UNIT.convert&&(l.type==="GEOGCS"?l.DATUM&&l.DATUM.SPHEROID&&(l.to_meter=l.UNIT.convert*l.DATUM.SPHEROID.a):l.to_meter=l.UNIT.convert));var c=l.GEOGCS;l.type==="GEOGCS"&&(c=l),c&&(c.DATUM?l.datumCode=c.DATUM.name.toLowerCase():l.datumCode=c.name.toLowerCase(),l.datumCode.slice(0,2)==="d_"&&(l.datumCode=l.datumCode.slice(2)),(l.datumCode==="new_zealand_geodetic_datum_1949"||l.datumCode==="new_zealand_1949")&&(l.datumCode="nzgd49"),(l.datumCode==="wgs_1984"||l.datumCode==="world_geodetic_system_1984")&&(l.PROJECTION==="Mercator_Auxiliary_Sphere"&&(l.sphere=!0),l.datumCode="wgs84"),l.datumCode.slice(-6)==="_ferro"&&(l.datumCode=l.datumCode.slice(0,-6)),l.datumCode.slice(-8)==="_jakarta"&&(l.datumCode=l.datumCode.slice(0,-8)),~l.datumCode.indexOf("belge")&&(l.datumCode="rnb72"),c.DATUM&&c.DATUM.SPHEROID&&(l.ellps=c.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),l.ellps.toLowerCase().slice(0,13)==="international"&&(l.ellps="intl"),l.a=c.DATUM.SPHEROID.a,l.rf=parseFloat(c.DATUM.SPHEROID.rf,10)),c.DATUM&&c.DATUM.TOWGS84&&(l.datum_params=c.DATUM.TOWGS84),~l.datumCode.indexOf("osgb_1936")&&(l.datumCode="osgb36"),~l.datumCode.indexOf("osni_1952")&&(l.datumCode="osni52"),(~l.datumCode.indexOf("tm65")||~l.datumCode.indexOf("geodetic_datum_of_1965"))&&(l.datumCode="ire65"),l.datumCode==="ch1903+"&&(l.datumCode="ch1903"),~l.datumCode.indexOf("israel")&&(l.datumCode="isr93")),l.b&&!isFinite(l.b)&&(l.b=l.a);function d(v){var S=l.to_meter||1;return v*S}var a=function(v){return nL(l,v)},_=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Ur],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Ur],["x0","false_easting",d],["y0","false_northing",d],["long0","central_meridian",Ur],["lat0","latitude_of_origin",Ur],["lat0","standard_parallel_1",Ur],["lat1","standard_parallel_1",Ur],["lat2","standard_parallel_2",Ur],["azimuth","Azimuth"],["alpha","azimuth",Ur],["srsCode","name"]];_.forEach(a),!l.long0&&l.longc&&(l.projName==="Albers_Conic_Equal_Area"||l.projName==="Lambert_Azimuthal_Equal_Area")&&(l.long0=l.longc),!l.lat_ts&&l.lat1&&(l.projName==="Stereographic_South_Pole"||l.projName==="Polar Stereographic (variant B)")?(l.lat0=Ur(l.lat1>0?90:-90),l.lat_ts=l.lat1):!l.lat_ts&&l.lat0&&l.projName==="Polar_Stereographic"&&(l.lat_ts=l.lat0,l.lat0=Ur(l.lat0>0?90:-90))}function lw(l){var t=eL(l),e=t.shift(),s=t.shift();t.unshift(["name",s]),t.unshift(["type",e]);var o={};return Dh(t,o),sL(o),o}function Cs(l){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?Cs[l]=k_(arguments[1]):Cs[l]=lw(arguments[1]):Cs[l]=e}else if(arguments.length===1){if(Array.isArray(l))return l.map(function(s){Array.isArray(s)?Cs.apply(t,s):Cs(s)});if(typeof l=="string"){if(l in Cs)return Cs[l]}else"EPSG"in l?Cs["EPSG:"+l.EPSG]=l:"ESRI"in l?Cs["ESRI:"+l.ESRI]=l:"IAU2000"in l?Cs["IAU2000:"+l.IAU2000]=l:console.log(l);return}}qP(Cs);function rL(l){return typeof l=="string"}function aL(l){return l in Cs}var oL=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function lL(l){return oL.some(function(t){return l.indexOf(t)>-1})}var hL=["3857","900913","3785","102113"];function cL(l){var t=xo(l,"authority");if(t){var e=xo(t,"epsg");return e&&hL.indexOf(e)>-1}}function uL(l){var t=xo(l,"extension");if(t)return xo(t,"proj4")}function dL(l){return l[0]==="+"}function fL(l){if(rL(l)){if(aL(l))return Cs[l];if(lL(l)){var t=lw(l);if(cL(t))return Cs["EPSG:3857"];var e=uL(t);return e?k_(e):t}if(dL(l))return k_(l)}else return l}function Fx(l,t){l=l||{};var e,s;if(!t)return l;for(s in t)e=t[s],e!==void 0&&(l[s]=e);return l}function Xr(l,t,e){var s=l*t;return e/Math.sqrt(1-s*s)}function wd(l){return l<0?-1:1}function Xe(l){return Math.abs(l)<=Ln?l:l-wd(l)*ed}function Cr(l,t,e){var s=l*e,o=.5*l;return s=Math.pow((1-s)/(1+s),o),Math.tan(.5*(Me-t))/s}function nd(l,t){for(var e=.5*l,s,o,c=Me-2*Math.atan(t),d=0;d<=15;d++)if(s=l*Math.sin(c),o=Me-2*Math.atan(t*Math.pow((1-s)/(1+s),e))-c,c+=o,Math.abs(o)<=1e-10)return c;return-9999}function pL(){var l=this.b/this.a;this.es=1-l*l,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Xr(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function mL(l){var t=l.x,e=l.y;if(e*Gr>90&&e*Gr<-90&&t*Gr>180&&t*Gr<-180)return null;var s,o;if(Math.abs(Math.abs(e)-Me)<=He)return null;if(this.sphere)s=this.x0+this.a*this.k0*Xe(t-this.long0),o=this.y0+this.a*this.k0*Math.log(Math.tan($i+.5*e));else{var c=Math.sin(e),d=Cr(this.e,e,c);s=this.x0+this.a*this.k0*Xe(t-this.long0),o=this.y0-this.a*this.k0*Math.log(d)}return l.x=s,l.y=o,l}function gL(l){var t=l.x-this.x0,e=l.y-this.y0,s,o;if(this.sphere)o=Me-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var c=Math.exp(-e/(this.a*this.k0));if(o=nd(this.e,c),o===-9999)return null}return s=Xe(this.long0+t/(this.a*this.k0)),l.x=s,l.y=o,l}var _L=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const yL={init:pL,forward:mL,inverse:gL,names:_L};function vL(){}function Bx(l){return l}var xL=["longlat","identity"];const bL={init:vL,forward:Bx,inverse:Bx,names:xL};var wL=[yL,bL],Lp={},Op=[];function hw(l,t){var e=Op.length;return l.names?(Op[e]=l,l.names.forEach(function(s){Lp[s.toLowerCase()]=e}),this):(console.log(t),!0)}function ML(l){if(!l)return!1;var t=l.toLowerCase();if(typeof Lp[t]<"u"&&Op[Lp[t]])return Op[Lp[t]]}function SL(){wL.forEach(hw)}const AL={start:SL,add:hw,get:ML};var Si={};Si.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};Si.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};Si.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};Si.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};Si.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};Si.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};Si.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};Si.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};Si.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};Si.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};Si.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};Si.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};Si.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};Si.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};Si.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};Si.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};Si.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};Si.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};Si.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};Si.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};Si.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};Si.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};Si.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};Si.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};Si.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};Si.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};Si.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};Si.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};Si.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};Si.hough={a:6378270,rf:297,ellipseName:"Hough"};Si.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};Si.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};Si.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};Si.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};Si.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};Si.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};Si.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};Si.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};Si.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};Si.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};Si.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};Si.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var TL=Si.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Si.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function EL(l,t,e,s){var o=l*l,c=t*t,d=(o-c)/o,a=0;s?(l*=1-d*(ZP+d*(XP+d*YP)),o=l*l,d=0):a=Math.sqrt(d);var _=(o-c)/c;return{es:d,e:a,ep2:_}}function CL(l,t,e,s,o){if(!l){var c=xo(Si,s);c||(c=TL),l=c.a,t=c.b,e=c.rf}return e&&!t&&(t=(1-1/e)*l),(e===0||Math.abs(l-t)<He)&&(o=!0,t=l),{a:l,b:t,rf:e,sphere:o}}var kn={};kn.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};kn.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};kn.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};kn.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};kn.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};kn.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};kn.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};kn.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};kn.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};kn.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};kn.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};kn.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};kn.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};kn.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};kn.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};kn.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};kn.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};kn.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function IL(l,t,e,s,o,c,d){var a={};return l===void 0||l==="none"?a.datum_type=z_:a.datum_type=$P,t&&(a.datum_params=t.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=_l),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=yl,a.datum_params[3]*=Ru,a.datum_params[4]*=Ru,a.datum_params[5]*=Ru,a.datum_params[6]=a.datum_params[6]/1e6+1)),d&&(a.datum_type=Uh,a.grids=d),a.a=e,a.b=s,a.es=o,a.ep2=c,a}var cw={};function PL(l,t){var e=new DataView(t),s=DL(e),o=zL(e,s),c=kL(e,o,s),d={header:o,subgrids:c};return cw[l]=d,d}function LL(l){if(l===void 0)return null;var t=l.split(",");return t.map(RL)}function RL(l){if(l.length===0)return null;var t=l[0]==="@";return t&&(l=l.slice(1)),l==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:l,mandatory:!t,grid:cw[l]||null,isNull:!1}}function zh(l){return l/3600*Math.PI/180}function DL(l){var t=l.getInt32(8,!1);return t===11?!1:(t=l.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function zL(l,t){return{nFields:l.getInt32(8,t),nSubgridFields:l.getInt32(24,t),nSubgrids:l.getInt32(40,t),shiftType:F_(l,56,56+8).trim(),fromSemiMajorAxis:l.getFloat64(120,t),fromSemiMinorAxis:l.getFloat64(136,t),toSemiMajorAxis:l.getFloat64(152,t),toSemiMinorAxis:l.getFloat64(168,t)}}function F_(l,t,e){return String.fromCharCode.apply(null,new Uint8Array(l.buffer.slice(t,e)))}function kL(l,t,e){for(var s=176,o=[],c=0;c<t.nSubgrids;c++){var d=BL(l,s,e),a=OL(l,s,d,e),_=Math.round(1+(d.upperLongitude-d.lowerLongitude)/d.longitudeInterval),v=Math.round(1+(d.upperLatitude-d.lowerLatitude)/d.latitudeInterval);o.push({ll:[zh(d.lowerLongitude),zh(d.lowerLatitude)],del:[zh(d.longitudeInterval),zh(d.latitudeInterval)],lim:[_,v],count:d.gridNodeCount,cvs:FL(a)}),s+=176+d.gridNodeCount*16}return o}function FL(l){return l.map(function(t){return[zh(t.longitudeShift),zh(t.latitudeShift)]})}function BL(l,t,e){return{name:F_(l,t+8,t+16).trim(),parent:F_(l,t+24,t+24+8).trim(),lowerLatitude:l.getFloat64(t+72,e),upperLatitude:l.getFloat64(t+88,e),lowerLongitude:l.getFloat64(t+104,e),upperLongitude:l.getFloat64(t+120,e),latitudeInterval:l.getFloat64(t+136,e),longitudeInterval:l.getFloat64(t+152,e),gridNodeCount:l.getInt32(t+168,e)}}function OL(l,t,e,s){for(var o=t+176,c=16,d=[],a=0;a<e.gridNodeCount;a++){var _={latitudeShift:l.getFloat32(o+a*c,s),longitudeShift:l.getFloat32(o+a*c+4,s),latitudeAccuracy:l.getFloat32(o+a*c+8,s),longitudeAccuracy:l.getFloat32(o+a*c+12,s)};d.push(_)}return d}function $r(l,t){if(!(this instanceof $r))return new $r(l);t=t||function(v){if(v)throw v};var e=fL(l);if(typeof e!="object"){t(l);return}var s=$r.projections.get(e.projName);if(!s){t(l);return}if(e.datumCode&&e.datumCode!=="none"){var o=xo(kn,e.datumCode);o&&(e.datum_params=e.datum_params||(o.towgs84?o.towgs84.split(","):null),e.ellps=o.ellipse,e.datumName=o.datumName?o.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var c=CL(e.a,e.b,e.rf,e.ellps,e.sphere),d=EL(c.a,c.b,c.rf,e.R_A),a=LL(e.nadgrids),_=e.datum||IL(e.datumCode,e.datum_params,c.a,c.b,d.es,d.ep2,a);Fx(this,e),Fx(this,s),this.a=c.a,this.b=c.b,this.rf=c.rf,this.sphere=c.sphere,this.es=d.es,this.e=d.e,this.ep2=d.ep2,this.datum=_,this.init(),t(null,this)}$r.projections=AL;$r.projections.start();function NL(l,t){return l.datum_type!==t.datum_type||l.a!==t.a||Math.abs(l.es-t.es)>5e-11?!1:l.datum_type===_l?l.datum_params[0]===t.datum_params[0]&&l.datum_params[1]===t.datum_params[1]&&l.datum_params[2]===t.datum_params[2]:l.datum_type===yl?l.datum_params[0]===t.datum_params[0]&&l.datum_params[1]===t.datum_params[1]&&l.datum_params[2]===t.datum_params[2]&&l.datum_params[3]===t.datum_params[3]&&l.datum_params[4]===t.datum_params[4]&&l.datum_params[5]===t.datum_params[5]&&l.datum_params[6]===t.datum_params[6]:!0}function uw(l,t,e){var s=l.x,o=l.y,c=l.z?l.z:0,d,a,_,v;if(o<-Me&&o>-1.001*Me)o=-Me;else if(o>Me&&o<1.001*Me)o=Me;else{if(o<-Me)return{x:-1/0,y:-1/0,z:l.z};if(o>Me)return{x:1/0,y:1/0,z:l.z}}return s>Math.PI&&(s-=2*Math.PI),a=Math.sin(o),v=Math.cos(o),_=a*a,d=e/Math.sqrt(1-t*_),{x:(d+c)*v*Math.cos(s),y:(d+c)*v*Math.sin(s),z:(d*(1-t)+c)*a}}function dw(l,t,e,s){var o=1e-12,c=o*o,d=30,a,_,v,S,M,A,C,R,F,z,L,W,G,H=l.x,Q=l.y,nt=l.z?l.z:0,pt,ft,K;if(a=Math.sqrt(H*H+Q*Q),_=Math.sqrt(H*H+Q*Q+nt*nt),a/e<o){if(pt=0,_/e<o)return ft=Me,K=-s,{x:l.x,y:l.y,z:l.z}}else pt=Math.atan2(Q,H);v=nt/_,S=a/_,M=1/Math.sqrt(1-t*(2-t)*S*S),R=S*(1-t)*M,F=v*M,G=0;do G++,C=e/Math.sqrt(1-t*F*F),K=a*R+nt*F-C*(1-t*F*F),A=t*C/(C+K),M=1/Math.sqrt(1-A*(2-A)*S*S),z=S*(1-A)*M,L=v*M,W=L*R-z*F,R=z,F=L;while(W*W>c&&G<d);return ft=Math.atan(L/Math.abs(z)),{x:pt,y:ft,z:K}}function UL(l,t,e){if(t===_l)return{x:l.x+e[0],y:l.y+e[1],z:l.z+e[2]};if(t===yl){var s=e[0],o=e[1],c=e[2],d=e[3],a=e[4],_=e[5],v=e[6];return{x:v*(l.x-_*l.y+a*l.z)+s,y:v*(_*l.x+l.y-d*l.z)+o,z:v*(-a*l.x+d*l.y+l.z)+c}}}function VL(l,t,e){if(t===_l)return{x:l.x-e[0],y:l.y-e[1],z:l.z-e[2]};if(t===yl){var s=e[0],o=e[1],c=e[2],d=e[3],a=e[4],_=e[5],v=e[6],S=(l.x-s)/v,M=(l.y-o)/v,A=(l.z-c)/v;return{x:S+_*M-a*A,y:-_*S+M+d*A,z:a*S-d*M+A}}}function xp(l){return l===_l||l===yl}function GL(l,t,e){if(NL(l,t)||l.datum_type===z_||t.datum_type===z_)return e;var s=l.a,o=l.es;if(l.datum_type===Uh){var c=Ox(l,!1,e);if(c!==0)return;s=Rx,o=Dx}var d=t.a,a=t.b,_=t.es;if(t.datum_type===Uh&&(d=Rx,a=jP,_=Dx),o===_&&s===d&&!xp(l.datum_type)&&!xp(t.datum_type))return e;if(e=uw(e,o,s),xp(l.datum_type)&&(e=UL(e,l.datum_type,l.datum_params)),xp(t.datum_type)&&(e=VL(e,t.datum_type,t.datum_params)),e=dw(e,_,d,a),t.datum_type===Uh){var v=Ox(t,!0,e);if(v!==0)return}return e}function Ox(l,t,e){if(l.grids===null||l.grids.length===0)return console.log("Grid shift grids not found"),-1;var s={x:-e.x,y:e.y},o={x:Number.NaN,y:Number.NaN},c=[];t:for(var d=0;d<l.grids.length;d++){var a=l.grids[d];if(c.push(a.name),a.isNull){o=s;break}if(a.mandatory,a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}for(var _=a.grid.subgrids,v=0,S=_.length;v<S;v++){var M=_[v],A=(Math.abs(M.del[1])+Math.abs(M.del[0]))/1e4,C=M.ll[0]-A,R=M.ll[1]-A,F=M.ll[0]+(M.lim[0]-1)*M.del[0]+A,z=M.ll[1]+(M.lim[1]-1)*M.del[1]+A;if(!(R>s.y||C>s.x||z<s.y||F<s.x)&&(o=HL(s,t,M),!isNaN(o.x)))break t}}return isNaN(o.x)?(console.log("Failed to find a grid shift table for location '"+-s.x*Gr+" "+s.y*Gr+" tried: '"+c+"'"),-1):(e.x=-o.x,e.y=o.y,0)}function HL(l,t,e){var s={x:Number.NaN,y:Number.NaN};if(isNaN(l.x))return s;var o={x:l.x,y:l.y};o.x-=e.ll[0],o.y-=e.ll[1],o.x=Xe(o.x-Math.PI)+Math.PI;var c=Nx(o,e);if(t){if(isNaN(c.x))return s;c.x=o.x-c.x,c.y=o.y-c.y;var d=9,a=1e-12,_,v;do{if(v=Nx(c,e),isNaN(v.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}_={x:o.x-(v.x+c.x),y:o.y-(v.y+c.y)},c.x+=_.x,c.y+=_.y}while(d--&&Math.abs(_.x)>a&&Math.abs(_.y)>a);if(d<0)return console.log("Inverse grid shift iterator failed to converge."),s;s.x=Xe(c.x+e.ll[0]),s.y=c.y+e.ll[1]}else isNaN(c.x)||(s.x=l.x+c.x,s.y=l.y+c.y);return s}function Nx(l,t){var e={x:l.x/t.del[0],y:l.y/t.del[1]},s={x:Math.floor(e.x),y:Math.floor(e.y)},o={x:e.x-1*s.x,y:e.y-1*s.y},c={x:Number.NaN,y:Number.NaN},d;if(s.x<0||s.x>=t.lim[0]||s.y<0||s.y>=t.lim[1])return c;d=s.y*t.lim[0]+s.x;var a={x:t.cvs[d][0],y:t.cvs[d][1]};d++;var _={x:t.cvs[d][0],y:t.cvs[d][1]};d+=t.lim[0];var v={x:t.cvs[d][0],y:t.cvs[d][1]};d--;var S={x:t.cvs[d][0],y:t.cvs[d][1]},M=o.x*o.y,A=o.x*(1-o.y),C=(1-o.x)*(1-o.y),R=(1-o.x)*o.y;return c.x=C*a.x+A*_.x+R*S.x+M*v.x,c.y=C*a.y+A*_.y+R*S.y+M*v.y,c}function Ux(l,t,e){var s=e.x,o=e.y,c=e.z||0,d,a,_,v={};for(_=0;_<3;_++)if(!(t&&_===2&&e.z===void 0))switch(_===0?(d=s,"ew".indexOf(l.axis[_])!==-1?a="x":a="y"):_===1?(d=o,"ns".indexOf(l.axis[_])!==-1?a="y":a="x"):(d=c,a="z"),l.axis[_]){case"e":v[a]=d;break;case"w":v[a]=-d;break;case"n":v[a]=d;break;case"s":v[a]=-d;break;case"u":e[a]!==void 0&&(v.z=d);break;case"d":e[a]!==void 0&&(v.z=-d);break;default:return null}return v}function fw(l){var t={x:l[0],y:l[1]};return l.length>2&&(t.z=l[2]),l.length>3&&(t.m=l[3]),t}function WL(l){Vx(l.x),Vx(l.y)}function Vx(l){if(typeof Number.isFinite=="function"){if(Number.isFinite(l))return;throw new TypeError("coordinates must be finite numbers")}if(typeof l!="number"||l!==l||!isFinite(l))throw new TypeError("coordinates must be finite numbers")}function qL(l,t){return(l.datum.datum_type===_l||l.datum.datum_type===yl||l.datum.datum_type===Uh)&&t.datumCode!=="WGS84"||(t.datum.datum_type===_l||t.datum.datum_type===yl||t.datum.datum_type===Uh)&&l.datumCode!=="WGS84"}function Np(l,t,e,s){var o;Array.isArray(e)?e=fw(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var c=e.z!==void 0;if(WL(e),l.datum&&t.datum&&qL(l,t)&&(o=new $r("WGS84"),e=Np(l,o,e,s),l=o),s&&l.axis!=="enu"&&(e=Ux(l,!1,e)),l.projName==="longlat")e={x:e.x*is,y:e.y*is,z:e.z||0};else if(l.to_meter&&(e={x:e.x*l.to_meter,y:e.y*l.to_meter,z:e.z||0}),e=l.inverse(e),!e)return;if(l.from_greenwich&&(e.x+=l.from_greenwich),e=GL(l.datum,t.datum,e),!!e)return t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*Gr,y:e.y*Gr,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),s&&t.axis!=="enu"?Ux(t,!0,e):(e&&!c&&delete e.z,e)}var Gx=$r("WGS84");function Hg(l,t,e,s){var o,c,d;return Array.isArray(e)?(o=Np(l,t,e,s)||{x:NaN,y:NaN},e.length>2?typeof l.name<"u"&&l.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof o.z=="number"?[o.x,o.y,o.z].concat(e.splice(3)):[o.x,o.y,e[2]].concat(e.splice(3)):[o.x,o.y].concat(e.splice(2)):[o.x,o.y]):(c=Np(l,t,e,s),d=Object.keys(e),d.length===2||d.forEach(function(a){if(typeof l.name<"u"&&l.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;c[a]=e[a]}),c)}function Hx(l){return l instanceof $r?l:l.oProj?l.oProj:$r(l)}function Ns(l,t,e){l=Hx(l);var s=!1,o;return typeof t>"u"?(t=l,l=Gx,s=!0):(typeof t.x<"u"||Array.isArray(t))&&(e=t,t=l,l=Gx,s=!0),t=Hx(t),e?Hg(l,t,e):(o={forward:function(c,d){return Hg(l,t,c,d)},inverse:function(c,d){return Hg(t,l,c,d)}},s&&(o.oProj=t),o)}var Wx=6,pw="AJSAJS",mw="AFAFAF",kh=65,Fs=73,fr=79,Su=86,Au=90;const $L={forward:gw,inverse:jL,toPoint:_w};function gw(l,t){return t=t||5,YL(ZL({lat:l[1],lon:l[0]}),t)}function jL(l){var t=A0(vw(l.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function _w(l){var t=A0(vw(l.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Wg(l){return l*(Math.PI/180)}function qx(l){return 180*(l/Math.PI)}function ZL(l){var t=l.lat,e=l.lon,s=6378137,o=.00669438,c=.9996,d,a,_,v,S,M,A,C=Wg(t),R=Wg(e),F,z;z=Math.floor((e+180)/6)+1,e===180&&(z=60),t>=56&&t<64&&e>=3&&e<12&&(z=32),t>=72&&t<84&&(e>=0&&e<9?z=31:e>=9&&e<21?z=33:e>=21&&e<33?z=35:e>=33&&e<42&&(z=37)),d=(z-1)*6-180+3,F=Wg(d),a=o/(1-o),_=s/Math.sqrt(1-o*Math.sin(C)*Math.sin(C)),v=Math.tan(C)*Math.tan(C),S=a*Math.cos(C)*Math.cos(C),M=Math.cos(C)*(R-F),A=s*((1-o/4-3*o*o/64-5*o*o*o/256)*C-(3*o/8+3*o*o/32+45*o*o*o/1024)*Math.sin(2*C)+(15*o*o/256+45*o*o*o/1024)*Math.sin(4*C)-35*o*o*o/3072*Math.sin(6*C));var L=c*_*(M+(1-v+S)*M*M*M/6+(5-18*v+v*v+72*S-58*a)*M*M*M*M*M/120)+5e5,W=c*(A+_*Math.tan(C)*(M*M/2+(5-v+9*S+4*S*S)*M*M*M*M/24+(61-58*v+v*v+600*S-330*a)*M*M*M*M*M*M/720));return t<0&&(W+=1e7),{northing:Math.round(W),easting:Math.round(L),zoneNumber:z,zoneLetter:XL(t)}}function A0(l){var t=l.northing,e=l.easting,s=l.zoneLetter,o=l.zoneNumber;if(o<0||o>60)return null;var c=.9996,d=6378137,a=.00669438,_,v=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),S,M,A,C,R,F,z,L,W,G=e-5e5,H=t;s<"N"&&(H-=1e7),z=(o-1)*6-180+3,_=a/(1-a),F=H/c,L=F/(d*(1-a/4-3*a*a/64-5*a*a*a/256)),W=L+(3*v/2-27*v*v*v/32)*Math.sin(2*L)+(21*v*v/16-55*v*v*v*v/32)*Math.sin(4*L)+151*v*v*v/96*Math.sin(6*L),S=d/Math.sqrt(1-a*Math.sin(W)*Math.sin(W)),M=Math.tan(W)*Math.tan(W),A=_*Math.cos(W)*Math.cos(W),C=d*(1-a)/Math.pow(1-a*Math.sin(W)*Math.sin(W),1.5),R=G/(S*c);var Q=W-S*Math.tan(W)/C*(R*R/2-(5+3*M+10*A-4*A*A-9*_)*R*R*R*R/24+(61+90*M+298*A+45*M*M-252*_-3*A*A)*R*R*R*R*R*R/720);Q=qx(Q);var nt=(R-(1+2*M+A)*R*R*R/6+(5-2*A+28*M-3*A*A+8*_+24*M*M)*R*R*R*R*R/120)/Math.cos(W);nt=z+qx(nt);var pt;if(l.accuracy){var ft=A0({northing:l.northing+l.accuracy,easting:l.easting+l.accuracy,zoneLetter:l.zoneLetter,zoneNumber:l.zoneNumber});pt={top:ft.lat,right:ft.lon,bottom:Q,left:nt}}else pt={lat:Q,lon:nt};return pt}function XL(l){var t="Z";return 84>=l&&l>=72?t="X":72>l&&l>=64?t="W":64>l&&l>=56?t="V":56>l&&l>=48?t="U":48>l&&l>=40?t="T":40>l&&l>=32?t="S":32>l&&l>=24?t="R":24>l&&l>=16?t="Q":16>l&&l>=8?t="P":8>l&&l>=0?t="N":0>l&&l>=-8?t="M":-8>l&&l>=-16?t="L":-16>l&&l>=-24?t="K":-24>l&&l>=-32?t="J":-32>l&&l>=-40?t="H":-40>l&&l>=-48?t="G":-48>l&&l>=-56?t="F":-56>l&&l>=-64?t="E":-64>l&&l>=-72?t="D":-72>l&&l>=-80&&(t="C"),t}function YL(l,t){var e="00000"+l.easting,s="00000"+l.northing;return l.zoneNumber+l.zoneLetter+JL(l.easting,l.northing,l.zoneNumber)+e.substr(e.length-5,t)+s.substr(s.length-5,t)}function JL(l,t,e){var s=yw(e),o=Math.floor(l/1e5),c=Math.floor(t/1e5)%20;return KL(o,c,s)}function yw(l){var t=l%Wx;return t===0&&(t=Wx),t}function KL(l,t,e){var s=e-1,o=pw.charCodeAt(s),c=mw.charCodeAt(s),d=o+l-1,a=c+t,_=!1;d>Au&&(d=d-Au+kh-1,_=!0),(d===Fs||o<Fs&&d>Fs||(d>Fs||o<Fs)&&_)&&d++,(d===fr||o<fr&&d>fr||(d>fr||o<fr)&&_)&&(d++,d===Fs&&d++),d>Au&&(d=d-Au+kh-1),a>Su?(a=a-Su+kh-1,_=!0):_=!1,(a===Fs||c<Fs&&a>Fs||(a>Fs||c<Fs)&&_)&&a++,(a===fr||c<fr&&a>fr||(a>fr||c<fr)&&_)&&(a++,a===Fs&&a++),a>Su&&(a=a-Su+kh-1);var v=String.fromCharCode(d)+String.fromCharCode(a);return v}function vw(l){if(l&&l.length===0)throw"MGRSPoint coverting from nothing";for(var t=l.length,e=null,s="",o,c=0;!/[A-Z]/.test(o=l.charAt(c));){if(c>=2)throw"MGRSPoint bad conversion from: "+l;s+=o,c++}var d=parseInt(s,10);if(c===0||c+3>t)throw"MGRSPoint bad conversion from: "+l;var a=l.charAt(c++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+l;e=l.substring(c,c+=2);for(var _=yw(d),v=QL(e.charAt(0),_),S=tR(e.charAt(1),_);S<eR(a);)S+=2e6;var M=t-c;if(M%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+l;var A=M/2,C=0,R=0,F,z,L,W,G;return A>0&&(F=1e5/Math.pow(10,A),z=l.substring(c,c+A),C=parseFloat(z)*F,L=l.substring(c+A),R=parseFloat(L)*F),W=C+v,G=R+S,{easting:W,northing:G,zoneLetter:a,zoneNumber:d,accuracy:F}}function QL(l,t){for(var e=pw.charCodeAt(t-1),s=1e5,o=!1;e!==l.charCodeAt(0);){if(e++,e===Fs&&e++,e===fr&&e++,e>Au){if(o)throw"Bad character: "+l;e=kh,o=!0}s+=1e5}return s}function tR(l,t){if(l>"V")throw"MGRSPoint given invalid Northing "+l;for(var e=mw.charCodeAt(t-1),s=0,o=!1;e!==l.charCodeAt(0);){if(e++,e===Fs&&e++,e===fr&&e++,e>Su){if(o)throw"Bad character: "+l;e=kh,o=!0}s+=1e5}return s}function eR(l){var t;switch(l){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+l}function jh(l,t,e){if(!(this instanceof jh))return new jh(l,t,e);if(Array.isArray(l))this.x=l[0],this.y=l[1],this.z=l[2]||0;else if(typeof l=="object")this.x=l.x,this.y=l.y,this.z=l.z||0;else if(typeof l=="string"&&typeof t>"u"){var s=l.split(",");this.x=parseFloat(s[0],10),this.y=parseFloat(s[1],10),this.z=parseFloat(s[2],10)||0}else this.x=l,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}jh.fromMGRS=function(l){return new jh(_w(l))};jh.prototype.toMGRS=function(l){return gw([this.x,this.y],l)};var iR=1,nR=.25,$x=.046875,jx=.01953125,Zx=.01068115234375,sR=.75,rR=.46875,aR=.013020833333333334,oR=.007120768229166667,lR=.3645833333333333,hR=.005696614583333333,cR=.3076171875;function xw(l){var t=[];t[0]=iR-l*(nR+l*($x+l*(jx+l*Zx))),t[1]=l*(sR-l*($x+l*(jx+l*Zx)));var e=l*l;return t[2]=e*(rR-l*(aR+l*oR)),e*=l,t[3]=e*(lR-l*hR),t[4]=e*l*cR,t}function lm(l,t,e,s){return e*=t,t*=t,s[0]*l-e*(s[1]+t*(s[2]+t*(s[3]+t*s[4])))}var uR=20;function bw(l,t,e){for(var s=1/(1-t),o=l,c=uR;c;--c){var d=Math.sin(o),a=1-t*d*d;if(a=(lm(o,d,Math.cos(o),e)-l)*(a*Math.sqrt(a))*s,o-=a,Math.abs(a)<He)return o}return o}function dR(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=xw(this.es),this.ml0=lm(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function fR(l){var t=l.x,e=l.y,s=Xe(t-this.long0),o,c,d,a=Math.sin(e),_=Math.cos(e);if(this.es){var S=_*s,M=Math.pow(S,2),A=this.ep2*Math.pow(_,2),C=Math.pow(A,2),R=Math.abs(_)>He?Math.tan(e):0,F=Math.pow(R,2),z=Math.pow(F,2);o=1-this.es*Math.pow(a,2),S=S/Math.sqrt(o);var L=lm(e,a,_,this.en);c=this.a*(this.k0*S*(1+M/6*(1-F+A+M/20*(5-18*F+z+14*A-58*F*A+M/42*(61+179*z-z*F-479*F)))))+this.x0,d=this.a*(this.k0*(L-this.ml0+a*s*S/2*(1+M/12*(5-F+9*A+4*C+M/30*(61+z-58*F+270*A-330*F*A+M/56*(1385+543*z-z*F-3111*F))))))+this.y0}else{var v=_*Math.sin(s);if(Math.abs(Math.abs(v)-1)<He)return 93;if(c=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,d=_*Math.cos(s)/Math.sqrt(1-Math.pow(v,2)),v=Math.abs(d),v>=1){if(v-1>He)return 93;d=0}else d=Math.acos(d);e<0&&(d=-d),d=this.a*this.k0*(d-this.lat0)+this.y0}return l.x=c,l.y=d,l}function pR(l){var t,e,s,o,c=(l.x-this.x0)*(1/this.a),d=(l.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+d/this.k0,e=bw(t,this.es,this.en),Math.abs(e)<Me){var M=Math.sin(e),A=Math.cos(e),C=Math.abs(A)>He?Math.tan(e):0,R=this.ep2*Math.pow(A,2),F=Math.pow(R,2),z=Math.pow(C,2),L=Math.pow(z,2);t=1-this.es*Math.pow(M,2);var W=c*Math.sqrt(t)/this.k0,G=Math.pow(W,2);t=t*C,s=e-t*G/(1-this.es)*.5*(1-G/12*(5+3*z-9*R*z+R-4*F-G/30*(61+90*z-252*R*z+45*L+46*R-G/56*(1385+3633*z+4095*L+1574*L*z)))),o=Xe(this.long0+W*(1-G/6*(1+2*z+R-G/20*(5+28*z+24*L+8*R*z+6*R-G/42*(61+662*z+1320*L+720*L*z))))/A)}else s=Me*wd(d),o=0;else{var a=Math.exp(c/this.k0),_=.5*(a-1/a),v=this.lat0+d/this.k0,S=Math.cos(v);t=Math.sqrt((1-Math.pow(S,2))/(1+Math.pow(_,2))),s=Math.asin(t),d<0&&(s=-s),_===0&&S===0?o=0:o=Xe(Math.atan2(_,S)+this.long0)}return l.x=o,l.y=s,l}var mR=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Rp={init:dR,forward:fR,inverse:pR,names:mR};function ww(l){var t=Math.exp(l);return t=(t-1/t)/2,t}function mr(l,t){l=Math.abs(l),t=Math.abs(t);var e=Math.max(l,t),s=Math.min(l,t)/(e||1);return e*Math.sqrt(1+Math.pow(s,2))}function gR(l){var t=1+l,e=t-1;return e===0?l:l*Math.log(t)/e}function _R(l){var t=Math.abs(l);return t=gR(t*(1+t/(mr(1,t)+1))),l<0?-t:t}function T0(l,t){for(var e=2*Math.cos(2*t),s=l.length-1,o=l[s],c=0,d;--s>=0;)d=-c+e*o+l[s],c=o,o=d;return t+d*Math.sin(2*t)}function yR(l,t){for(var e=2*Math.cos(t),s=l.length-1,o=l[s],c=0,d;--s>=0;)d=-c+e*o+l[s],c=o,o=d;return Math.sin(t)*d}function vR(l){var t=Math.exp(l);return t=(t+1/t)/2,t}function Mw(l,t,e){for(var s=Math.sin(t),o=Math.cos(t),c=ww(e),d=vR(e),a=2*o*d,_=-2*s*c,v=l.length-1,S=l[v],M=0,A=0,C=0,R,F;--v>=0;)R=A,F=M,A=S,M=C,S=-R+a*A-_*M+l[v],C=-F+_*A+a*M;return a=s*d,_=o*c,[a*S-_*C,a*C+_*S]}function xR(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Rp.init.apply(this),this.forward=Rp.forward,this.inverse=Rp.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var l=this.es/(1+Math.sqrt(1-this.es)),t=l/(2-l),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var s=T0(this.cbg,this.lat0);this.Zb=-this.Qn*(s+yR(this.gtu,2*s))}function bR(l){var t=Xe(l.x-this.long0),e=l.y;e=T0(this.cbg,e);var s=Math.sin(e),o=Math.cos(e),c=Math.sin(t),d=Math.cos(t);e=Math.atan2(s,d*o),t=Math.atan2(c*o,mr(s,o*d)),t=_R(Math.tan(t));var a=Mw(this.gtu,2*e,2*t);e=e+a[0],t=t+a[1];var _,v;return Math.abs(t)<=2.623395162778?(_=this.a*(this.Qn*t)+this.x0,v=this.a*(this.Qn*e+this.Zb)+this.y0):(_=1/0,v=1/0),l.x=_,l.y=v,l}function wR(l){var t=(l.x-this.x0)*(1/this.a),e=(l.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var s,o;if(Math.abs(t)<=2.623395162778){var c=Mw(this.utg,2*e,2*t);e=e+c[0],t=t+c[1],t=Math.atan(ww(t));var d=Math.sin(e),a=Math.cos(e),_=Math.sin(t),v=Math.cos(t);e=Math.atan2(d*v,mr(_,v*a)),t=Math.atan2(_,v*a),s=Xe(t+this.long0),o=T0(this.cgb,e)}else s=1/0,o=1/0;return l.x=s,l.y=o,l}var MR=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Dp={init:xR,forward:bR,inverse:wR,names:MR};function SR(l,t){if(l===void 0){if(l=Math.floor((Xe(t)+Math.PI)*30/Math.PI)+1,l<0)return 0;if(l>60)return 60}return l}var AR="etmerc";function TR(){var l=SR(this.zone,this.long0);if(l===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(l)-183)*is,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Dp.init.apply(this),this.forward=Dp.forward,this.inverse=Dp.inverse}var ER=["Universal Transverse Mercator System","utm"];const CR={init:TR,names:ER,dependsOn:AR};function E0(l,t){return Math.pow((1-l)/(1+l),t)}var IR=20;function PR(){var l=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*l*l),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(l/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+$i)/(Math.pow(Math.tan(.5*this.lat0+$i),this.C)*E0(this.e*l,this.ratexp))}function LR(l){var t=l.x,e=l.y;return l.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+$i),this.C)*E0(this.e*Math.sin(e),this.ratexp))-Me,l.x=this.C*t,l}function RR(l){for(var t=1e-14,e=l.x/this.C,s=l.y,o=Math.pow(Math.tan(.5*s+$i)/this.K,1/this.C),c=IR;c>0&&(s=2*Math.atan(o*E0(this.e*Math.sin(l.y),-.5*this.e))-Me,!(Math.abs(s-l.y)<t));--c)l.y=s;return c?(l.x=e,l.y=s,l):null}var DR=["gauss"];const C0={init:PR,forward:LR,inverse:RR,names:DR};function zR(){C0.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function kR(l){var t,e,s,o;return l.x=Xe(l.x-this.long0),C0.forward.apply(this,[l]),t=Math.sin(l.y),e=Math.cos(l.y),s=Math.cos(l.x),o=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*s),l.x=o*e*Math.sin(l.x),l.y=o*(this.cosc0*t-this.sinc0*e*s),l.x=this.a*l.x+this.x0,l.y=this.a*l.y+this.y0,l}function FR(l){var t,e,s,o,c;if(l.x=(l.x-this.x0)/this.a,l.y=(l.y-this.y0)/this.a,l.x/=this.k0,l.y/=this.k0,c=mr(l.x,l.y)){var d=2*Math.atan2(c,this.R2);t=Math.sin(d),e=Math.cos(d),o=Math.asin(e*this.sinc0+l.y*t*this.cosc0/c),s=Math.atan2(l.x*t,c*this.cosc0*e-l.y*this.sinc0*t)}else o=this.phic0,s=0;return l.x=s,l.y=o,C0.inverse.apply(this,[l]),l.x=Xe(l.x+this.long0),l}var BR=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const OR={init:zR,forward:kR,inverse:FR,names:BR};function NR(l,t,e){return t*=e,Math.tan(.5*(Me+l))*Math.pow((1-t)/(1+t),.5*e)}function UR(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=He&&(this.k0=.5*(1+wd(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=He&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=He&&Math.abs(Math.cos(this.lat_ts))>He&&(this.k0=.5*this.cons*Xr(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Cr(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Xr(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Me,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function VR(l){var t=l.x,e=l.y,s=Math.sin(e),o=Math.cos(e),c,d,a,_,v,S,M=Xe(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=He&&Math.abs(e+this.lat0)<=He?(l.x=NaN,l.y=NaN,l):this.sphere?(c=2*this.k0/(1+this.sinlat0*s+this.coslat0*o*Math.cos(M)),l.x=this.a*c*o*Math.sin(M)+this.x0,l.y=this.a*c*(this.coslat0*s-this.sinlat0*o*Math.cos(M))+this.y0,l):(d=2*Math.atan(this.ssfn_(e,s,this.e))-Me,_=Math.cos(d),a=Math.sin(d),Math.abs(this.coslat0)<=He?(v=Cr(this.e,e*this.con,this.con*s),S=2*this.a*this.k0*v/this.cons,l.x=this.x0+S*Math.sin(t-this.long0),l.y=this.y0-this.con*S*Math.cos(t-this.long0),l):(Math.abs(this.sinlat0)<He?(c=2*this.a*this.k0/(1+_*Math.cos(M)),l.y=c*a):(c=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*_*Math.cos(M))),l.y=c*(this.cosX0*a-this.sinX0*_*Math.cos(M))+this.y0),l.x=c*_*Math.sin(M)+this.x0,l))}function GR(l){l.x-=this.x0,l.y-=this.y0;var t,e,s,o,c,d=Math.sqrt(l.x*l.x+l.y*l.y);if(this.sphere){var a=2*Math.atan(d/(2*this.a*this.k0));return t=this.long0,e=this.lat0,d<=He?(l.x=t,l.y=e,l):(e=Math.asin(Math.cos(a)*this.sinlat0+l.y*Math.sin(a)*this.coslat0/d),Math.abs(this.coslat0)<He?this.lat0>0?t=Xe(this.long0+Math.atan2(l.x,-1*l.y)):t=Xe(this.long0+Math.atan2(l.x,l.y)):t=Xe(this.long0+Math.atan2(l.x*Math.sin(a),d*this.coslat0*Math.cos(a)-l.y*this.sinlat0*Math.sin(a))),l.x=t,l.y=e,l)}else if(Math.abs(this.coslat0)<=He){if(d<=He)return e=this.lat0,t=this.long0,l.x=t,l.y=e,l;l.x*=this.con,l.y*=this.con,s=d*this.cons/(2*this.a*this.k0),e=this.con*nd(this.e,s),t=this.con*Xe(this.con*this.long0+Math.atan2(l.x,-1*l.y))}else o=2*Math.atan(d*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,d<=He?c=this.X0:(c=Math.asin(Math.cos(o)*this.sinX0+l.y*Math.sin(o)*this.cosX0/d),t=Xe(this.long0+Math.atan2(l.x*Math.sin(o),d*this.cosX0*Math.cos(o)-l.y*this.sinX0*Math.sin(o)))),e=-1*nd(this.e,Math.tan(.5*(Me+c)));return l.x=t,l.y=e,l}var HR=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const WR={init:UR,forward:VR,inverse:GR,names:HR,ssfn_:NR};function qR(){var l=this.lat0;this.lambda0=this.long0;var t=Math.sin(l),e=this.a,s=this.rf,o=1/s,c=2*o-Math.pow(o,2),d=this.e=Math.sqrt(c);this.R=this.k0*e*Math.sqrt(1-c)/(1-c*Math.pow(t,2)),this.alpha=Math.sqrt(1+c/(1-c)*Math.pow(Math.cos(l),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),_=Math.log(Math.tan(Math.PI/4+l/2)),v=Math.log((1+d*t)/(1-d*t));this.K=a-this.alpha*_+this.alpha*d/2*v}function $R(l){var t=Math.log(Math.tan(Math.PI/4-l.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(l.y))/(1-this.e*Math.sin(l.y))),s=-this.alpha*(t+e)+this.K,o=2*(Math.atan(Math.exp(s))-Math.PI/4),c=this.alpha*(l.x-this.lambda0),d=Math.atan(Math.sin(c)/(Math.sin(this.b0)*Math.tan(o)+Math.cos(this.b0)*Math.cos(c))),a=Math.asin(Math.cos(this.b0)*Math.sin(o)-Math.sin(this.b0)*Math.cos(o)*Math.cos(c));return l.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,l.x=this.R*d+this.x0,l}function jR(l){for(var t=l.x-this.x0,e=l.y-this.y0,s=t/this.R,o=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),c=Math.asin(Math.cos(this.b0)*Math.sin(o)+Math.sin(this.b0)*Math.cos(o)*Math.cos(s)),d=Math.atan(Math.sin(s)/(Math.cos(this.b0)*Math.cos(s)-Math.sin(this.b0)*Math.tan(o))),a=this.lambda0+d/this.alpha,_=0,v=c,S=-1e3,M=0;Math.abs(v-S)>1e-7;){if(++M>20)return;_=1/this.alpha*(Math.log(Math.tan(Math.PI/4+c/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(v))/2)),S=v,v=2*Math.atan(Math.exp(_))-Math.PI/2}return l.x=a,l.y=v,l}var ZR=["somerc"];const XR={init:qR,forward:$R,inverse:jR,names:ZR};var Ch=1e-7;function YR(l){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof l.PROJECTION=="object"?Object.keys(l.PROJECTION)[0]:l.PROJECTION;return"no_uoff"in l||"no_off"in l||t.indexOf(e)!==-1}function JR(){var l,t,e,s,o,c,d,a,_,v,S=0,M,A=0,C=0,R=0,F=0,z=0,L=0;this.no_off=YR(this),this.no_rot="no_rot"in this;var W=!1;"alpha"in this&&(W=!0);var G=!1;if("rectified_grid_angle"in this&&(G=!0),W&&(L=this.alpha),G&&(S=this.rectified_grid_angle*is),W||G)A=this.longc;else if(C=this.long1,F=this.lat1,R=this.long2,z=this.lat2,Math.abs(F-z)<=Ch||(l=Math.abs(F))<=Ch||Math.abs(l-Me)<=Ch||Math.abs(Math.abs(this.lat0)-Me)<=Ch||Math.abs(Math.abs(z)-Me)<=Ch)throw new Error;var H=1-this.es;t=Math.sqrt(H),Math.abs(this.lat0)>He?(a=Math.sin(this.lat0),e=Math.cos(this.lat0),l=1-this.es*a*a,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/H),this.A=this.B*this.k0*t/l,s=this.B*t/(e*Math.sqrt(l)),o=s*s-1,o<=0?o=0:(o=Math.sqrt(o),this.lat0<0&&(o=-o)),this.E=o+=s,this.E*=Math.pow(Cr(this.e,this.lat0,a),this.B)):(this.B=1/t,this.A=this.k0,this.E=s=o=1),W||G?(W?(M=Math.asin(Math.sin(L)/s),G||(S=L)):(M=S,L=Math.asin(s*Math.sin(M))),this.lam0=A-Math.asin(.5*(o-1/o)*Math.tan(M))/this.B):(c=Math.pow(Cr(this.e,F,Math.sin(F)),this.B),d=Math.pow(Cr(this.e,z,Math.sin(z)),this.B),o=this.E/c,_=(d-c)/(d+c),v=this.E*this.E,v=(v-d*c)/(v+d*c),l=C-R,l<-Math.pi?R-=ed:l>Math.pi&&(R+=ed),this.lam0=Xe(.5*(C+R)-Math.atan(v*Math.tan(.5*this.B*(C-R))/_)/this.B),M=Math.atan(2*Math.sin(this.B*Xe(C-this.lam0))/(o-1/o)),S=L=Math.asin(s*Math.sin(M))),this.singam=Math.sin(M),this.cosgam=Math.cos(M),this.sinrot=Math.sin(S),this.cosrot=Math.cos(S),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(s*s-1)/Math.cos(L))),this.lat0<0&&(this.u_0=-this.u_0)),o=.5*M,this.v_pole_n=this.ArB*Math.log(Math.tan($i-o)),this.v_pole_s=this.ArB*Math.log(Math.tan($i+o))}function KR(l){var t={},e,s,o,c,d,a,_,v;if(l.x=l.x-this.lam0,Math.abs(Math.abs(l.y)-Me)>He){if(d=this.E/Math.pow(Cr(this.e,l.y,Math.sin(l.y)),this.B),a=1/d,e=.5*(d-a),s=.5*(d+a),c=Math.sin(this.B*l.x),o=(e*this.singam-c*this.cosgam)/s,Math.abs(Math.abs(o)-1)<He)throw new Error;v=.5*this.ArB*Math.log((1-o)/(1+o)),a=Math.cos(this.B*l.x),Math.abs(a)<Ch?_=this.A*l.x:_=this.ArB*Math.atan2(e*this.cosgam+c*this.singam,a)}else v=l.y>0?this.v_pole_n:this.v_pole_s,_=this.ArB*l.y;return this.no_rot?(t.x=_,t.y=v):(_-=this.u_0,t.x=v*this.cosrot+_*this.sinrot,t.y=_*this.cosrot-v*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function QR(l){var t,e,s,o,c,d,a,_={};if(l.x=(l.x-this.x0)*(1/this.a),l.y=(l.y-this.y0)*(1/this.a),this.no_rot?(e=l.y,t=l.x):(e=l.x*this.cosrot-l.y*this.sinrot,t=l.y*this.cosrot+l.x*this.sinrot+this.u_0),s=Math.exp(-this.BrA*e),o=.5*(s-1/s),c=.5*(s+1/s),d=Math.sin(this.BrA*t),a=(d*this.cosgam+o*this.singam)/c,Math.abs(Math.abs(a)-1)<He)_.x=0,_.y=a<0?-Me:Me;else{if(_.y=this.E/Math.sqrt((1+a)/(1-a)),_.y=nd(this.e,Math.pow(_.y,1/this.B)),_.y===1/0)throw new Error;_.x=-this.rB*Math.atan2(o*this.cosgam-d*this.singam,Math.cos(this.BrA*t))}return _.x+=this.lam0,_}var tD=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const eD={init:JR,forward:KR,inverse:QR,names:tD};function iD(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<He)){var l=this.b/this.a;this.e=Math.sqrt(1-l*l);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),s=Xr(this.e,t,e),o=Cr(this.e,this.lat1,t),c=Math.sin(this.lat2),d=Math.cos(this.lat2),a=Xr(this.e,c,d),_=Cr(this.e,this.lat2,c),v=Cr(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>He?this.ns=Math.log(s/a)/Math.log(o/_):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=s/(this.ns*Math.pow(o,this.ns)),this.rh=this.a*this.f0*Math.pow(v,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function nD(l){var t=l.x,e=l.y;Math.abs(2*Math.abs(e)-Math.PI)<=He&&(e=wd(e)*(Me-2*He));var s=Math.abs(Math.abs(e)-Me),o,c;if(s>He)o=Cr(this.e,e,Math.sin(e)),c=this.a*this.f0*Math.pow(o,this.ns);else{if(s=e*this.ns,s<=0)return null;c=0}var d=this.ns*Xe(t-this.long0);return l.x=this.k0*(c*Math.sin(d))+this.x0,l.y=this.k0*(this.rh-c*Math.cos(d))+this.y0,l}function sD(l){var t,e,s,o,c,d=(l.x-this.x0)/this.k0,a=this.rh-(l.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(d*d+a*a),e=1):(t=-Math.sqrt(d*d+a*a),e=-1);var _=0;if(t!==0&&(_=Math.atan2(e*d,e*a)),t!==0||this.ns>0){if(e=1/this.ns,s=Math.pow(t/(this.a*this.f0),e),o=nd(this.e,s),o===-9999)return null}else o=-Me;return c=Xe(_/this.ns+this.long0),l.x=c,l.y=o,l}var rD=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const aD={init:iD,forward:nD,inverse:sD,names:rD};function oD(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function lD(l){var t,e,s,o,c,d,a,_=l.x,v=l.y,S=Xe(_-this.long0);return t=Math.pow((1+this.e*Math.sin(v))/(1-this.e*Math.sin(v)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(v/2+this.s45),this.alfa)/t)-this.s45),s=-S*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(s)),c=Math.asin(Math.cos(e)*Math.sin(s)/Math.cos(o)),d=this.n*c,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),l.y=a*Math.cos(d)/1,l.x=a*Math.sin(d)/1,this.czech||(l.y*=-1,l.x*=-1),l}function hD(l){var t,e,s,o,c,d,a,_,v=l.x;l.x=l.y,l.y=v,this.czech||(l.y*=-1,l.x*=-1),d=Math.sqrt(l.x*l.x+l.y*l.y),c=Math.atan2(l.y,l.x),o=c/Math.sin(this.s0),s=2*(Math.atan(Math.pow(this.ro0/d,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(s)-Math.sin(this.ad)*Math.cos(s)*Math.cos(o)),e=Math.asin(Math.cos(s)*Math.sin(o)/Math.cos(t)),l.x=this.long0-e/this.alfa,a=t,_=0;var S=0;do l.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-l.y)<1e-10&&(_=1),a=l.y,S+=1;while(_===0&&S<15);return S>=15?null:l}var cD=["Krovak","krovak"];const uD={init:oD,forward:lD,inverse:hD,names:cD};function Is(l,t,e,s,o){return l*o-t*Math.sin(2*o)+e*Math.sin(4*o)-s*Math.sin(6*o)}function Md(l){return 1-.25*l*(1+l/16*(3+1.25*l))}function Sd(l){return .375*l*(1+.25*l*(1+.46875*l))}function Ad(l){return .05859375*l*l*(1+.75*l)}function Td(l){return l*l*l*(35/3072)}function Zh(l,t,e){var s=t*e;return l/Math.sqrt(1-s*s)}function nc(l){return Math.abs(l)<Me?l:l-wd(l)*Math.PI}function Up(l,t,e,s,o){var c,d;c=l/t;for(var a=0;a<15;a++)if(d=(l-(t*c-e*Math.sin(2*c)+s*Math.sin(4*c)-o*Math.sin(6*c)))/(t-2*e*Math.cos(2*c)+4*s*Math.cos(4*c)-6*o*Math.cos(6*c)),c+=d,Math.abs(d)<=1e-10)return c;return NaN}function dD(){this.sphere||(this.e0=Md(this.es),this.e1=Sd(this.es),this.e2=Ad(this.es),this.e3=Td(this.es),this.ml0=this.a*Is(this.e0,this.e1,this.e2,this.e3,this.lat0))}function fD(l){var t,e,s=l.x,o=l.y;if(s=Xe(s-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(o)*Math.sin(s)),e=this.a*(Math.atan2(Math.tan(o),Math.cos(s))-this.lat0);else{var c=Math.sin(o),d=Math.cos(o),a=Zh(this.a,this.e,c),_=Math.tan(o)*Math.tan(o),v=s*Math.cos(o),S=v*v,M=this.es*d*d/(1-this.es),A=this.a*Is(this.e0,this.e1,this.e2,this.e3,o);t=a*v*(1-S*_*(1/6-(8-_+8*M)*S/120)),e=A-this.ml0+a*c/d*S*(.5+(5-_+6*M)*S/24)}return l.x=t+this.x0,l.y=e+this.y0,l}function pD(l){l.x-=this.x0,l.y-=this.y0;var t=l.x/this.a,e=l.y/this.a,s,o;if(this.sphere){var c=e+this.lat0;s=Math.asin(Math.sin(c)*Math.cos(t)),o=Math.atan2(Math.tan(t),Math.cos(c))}else{var d=this.ml0/this.a+e,a=Up(d,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-Me)<=He)return l.x=this.long0,l.y=Me,e<0&&(l.y*=-1),l;var _=Zh(this.a,this.e,Math.sin(a)),v=_*_*_/this.a/this.a*(1-this.es),S=Math.pow(Math.tan(a),2),M=t*this.a/_,A=M*M;s=a-_*Math.tan(a)/v*M*M*(.5-(1+3*S)*M*M/24),o=M*(1-A*(S/3+(1+3*S)*S*A/15))/Math.cos(a)}return l.x=Xe(o+this.long0),l.y=nc(s),l}var mD=["Cassini","Cassini_Soldner","cass"];const gD={init:dD,forward:fD,inverse:pD,names:mD};function fo(l,t){var e;return l>1e-7?(e=l*t,(1-l*l)*(t/(1-e*e)-.5/l*Math.log((1-e)/(1+e)))):2*t}var _D=1,yD=2,vD=3,xD=4;function bD(){var l=Math.abs(this.lat0);if(Math.abs(l-Me)<He?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(l)<He?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=fo(this.e,1),this.mmf=.5/(1-this.es),this.apa=PD(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=fo(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function wD(l){var t,e,s,o,c,d,a,_,v,S,M=l.x,A=l.y;if(M=Xe(M-this.long0),this.sphere){if(c=Math.sin(A),S=Math.cos(A),s=Math.cos(M),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+S*s:1+this.sinph0*c+this.cosph0*S*s,e<=He)return null;e=Math.sqrt(2/e),t=e*S*Math.sin(M),e*=this.mode===this.EQUIT?c:this.cosph0*c-this.sinph0*S*s}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),Math.abs(A+this.lat0)<He)return null;e=$i-A*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(M),e*=s}}else{switch(a=0,_=0,v=0,s=Math.cos(M),o=Math.sin(M),c=Math.sin(A),d=fo(this.e,c),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=d/this.qp,_=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:v=1+this.sinb1*a+this.cosb1*_*s;break;case this.EQUIT:v=1+_*s;break;case this.N_POLE:v=Me+A,d=this.qp-d;break;case this.S_POLE:v=A-Me,d=this.qp+d;break}if(Math.abs(v)<He)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:v=Math.sqrt(2/v),this.mode===this.OBLIQ?e=this.ymf*v*(this.cosb1*a-this.sinb1*_*s):e=(v=Math.sqrt(2/(1+_*s)))*a*this.ymf,t=this.xmf*v*_*o;break;case this.N_POLE:case this.S_POLE:d>=0?(t=(v=Math.sqrt(d))*o,e=s*(this.mode===this.S_POLE?v:-v)):t=e=0;break}}return l.x=this.a*t+this.x0,l.y=this.a*e+this.y0,l}function MD(l){l.x-=this.x0,l.y-=this.y0;var t=l.x/this.a,e=l.y/this.a,s,o,c,d,a,_,v;if(this.sphere){var S=0,M,A=0;if(M=Math.sqrt(t*t+e*e),o=M*.5,o>1)return null;switch(o=2*Math.asin(o),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(A=Math.sin(o),S=Math.cos(o)),this.mode){case this.EQUIT:o=Math.abs(M)<=He?0:Math.asin(e*A/M),t*=A,e=S*M;break;case this.OBLIQ:o=Math.abs(M)<=He?this.lat0:Math.asin(S*this.sinph0+e*A*this.cosph0/M),t*=A*this.cosph0,e=(S-Math.sin(o)*this.sinph0)*M;break;case this.N_POLE:e=-e,o=Me-o;break;case this.S_POLE:o-=Me;break}s=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(v=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,_=Math.sqrt(t*t+e*e),_<He)return l.x=this.long0,l.y=this.lat0,l;d=2*Math.asin(.5*_/this.rq),c=Math.cos(d),t*=d=Math.sin(d),this.mode===this.OBLIQ?(v=c*this.sinb1+e*d*this.cosb1/_,a=this.qp*v,e=_*this.cosb1*c-e*this.sinb1*d):(v=e*d/_,a=this.qp*v,e=_*c)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),a=t*t+e*e,!a)return l.x=this.long0,l.y=this.lat0,l;v=1-a/this.qp,this.mode===this.S_POLE&&(v=-v)}s=Math.atan2(t,e),o=LD(Math.asin(v),this.apa)}return l.x=Xe(this.long0+s),l.y=o,l}var SD=.3333333333333333,AD=.17222222222222222,TD=.10257936507936508,ED=.06388888888888888,CD=.0664021164021164,ID=.016415012942191543;function PD(l){var t,e=[];return e[0]=l*SD,t=l*l,e[0]+=t*AD,e[1]=t*ED,t*=l,e[0]+=t*TD,e[1]+=t*CD,e[2]=t*ID,e}function LD(l,t){var e=l+l;return l+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var RD=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const DD={init:bD,forward:wD,inverse:MD,names:RD,S_POLE:_D,N_POLE:yD,EQUIT:vD,OBLIQ:xD};function bo(l){return Math.abs(l)>1&&(l=l>1?1:-1),Math.asin(l)}function zD(){Math.abs(this.lat1+this.lat2)<He||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Xr(this.e3,this.sin_po,this.cos_po),this.qs1=fo(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Xr(this.e3,this.sin_po,this.cos_po),this.qs2=fo(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=fo(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>He?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function kD(l){var t=l.x,e=l.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var s=fo(this.e3,this.sin_phi),o=this.a*Math.sqrt(this.c-this.ns0*s)/this.ns0,c=this.ns0*Xe(t-this.long0),d=o*Math.sin(c)+this.x0,a=this.rh-o*Math.cos(c)+this.y0;return l.x=d,l.y=a,l}function FD(l){var t,e,s,o,c,d;return l.x-=this.x0,l.y=this.rh-l.y+this.y0,this.ns0>=0?(t=Math.sqrt(l.x*l.x+l.y*l.y),s=1):(t=-Math.sqrt(l.x*l.x+l.y*l.y),s=-1),o=0,t!==0&&(o=Math.atan2(s*l.x,s*l.y)),s=t*this.ns0/this.a,this.sphere?d=Math.asin((this.c-s*s)/(2*this.ns0)):(e=(this.c-s*s)/this.ns0,d=this.phi1z(this.e3,e)),c=Xe(o/this.ns0+this.long0),l.x=c,l.y=d,l}function BD(l,t){var e,s,o,c,d,a=bo(.5*t);if(l<He)return a;for(var _=l*l,v=1;v<=25;v++)if(e=Math.sin(a),s=Math.cos(a),o=l*e,c=1-o*o,d=.5*c*c/s*(t/(1-_)-e/c+.5/l*Math.log((1-o)/(1+o))),a=a+d,Math.abs(d)<=1e-7)return a;return null}var OD=["Albers_Conic_Equal_Area","Albers","aea"];const ND={init:zD,forward:kD,inverse:FD,names:OD,phi1z:BD};function UD(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function VD(l){var t,e,s,o,c,d,a,_,v=l.x,S=l.y;return s=Xe(v-this.long0),t=Math.sin(S),e=Math.cos(S),o=Math.cos(s),d=this.sin_p14*t+this.cos_p14*e*o,c=1,d>0||Math.abs(d)<=He?(a=this.x0+this.a*c*e*Math.sin(s)/d,_=this.y0+this.a*c*(this.cos_p14*t-this.sin_p14*e*o)/d):(a=this.x0+this.infinity_dist*e*Math.sin(s),_=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*o)),l.x=a,l.y=_,l}function GD(l){var t,e,s,o,c,d;return l.x=(l.x-this.x0)/this.a,l.y=(l.y-this.y0)/this.a,l.x/=this.k0,l.y/=this.k0,(t=Math.sqrt(l.x*l.x+l.y*l.y))?(o=Math.atan2(t,this.rc),e=Math.sin(o),s=Math.cos(o),d=bo(s*this.sin_p14+l.y*e*this.cos_p14/t),c=Math.atan2(l.x*e,t*this.cos_p14*s-l.y*this.sin_p14*e),c=Xe(this.long0+c)):(d=this.phic0,c=0),l.x=c,l.y=d,l}var HD=["gnom"];const WD={init:UD,forward:VD,inverse:GD,names:HD};function qD(l,t){var e=1-(1-l*l)/(2*l)*Math.log((1-l)/(1+l));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*Me:Me;for(var s=Math.asin(.5*t),o,c,d,a,_=0;_<30;_++)if(c=Math.sin(s),d=Math.cos(s),a=l*c,o=Math.pow(1-a*a,2)/(2*d)*(t/(1-l*l)-c/(1-a*a)+.5/l*Math.log((1-a)/(1+a))),s+=o,Math.abs(o)<=1e-10)return s;return NaN}function $D(){this.sphere||(this.k0=Xr(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function jD(l){var t=l.x,e=l.y,s,o,c=Xe(t-this.long0);if(this.sphere)s=this.x0+this.a*c*Math.cos(this.lat_ts),o=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var d=fo(this.e,Math.sin(e));s=this.x0+this.a*this.k0*c,o=this.y0+this.a*d*.5/this.k0}return l.x=s,l.y=o,l}function ZD(l){l.x-=this.x0,l.y-=this.y0;var t,e;return this.sphere?(t=Xe(this.long0+l.x/this.a/Math.cos(this.lat_ts)),e=Math.asin(l.y/this.a*Math.cos(this.lat_ts))):(e=qD(this.e,2*l.y*this.k0/this.a),t=Xe(this.long0+l.x/(this.a*this.k0))),l.x=t,l.y=e,l}var XD=["cea"];const YD={init:$D,forward:jD,inverse:ZD,names:XD};function JD(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function KD(l){var t=l.x,e=l.y,s=Xe(t-this.long0),o=nc(e-this.lat0);return l.x=this.x0+this.a*s*this.rc,l.y=this.y0+this.a*o,l}function QD(l){var t=l.x,e=l.y;return l.x=Xe(this.long0+(t-this.x0)/(this.a*this.rc)),l.y=nc(this.lat0+(e-this.y0)/this.a),l}var tz=["Equirectangular","Equidistant_Cylindrical","eqc"];const ez={init:JD,forward:KD,inverse:QD,names:tz};var Xx=20;function iz(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Md(this.es),this.e1=Sd(this.es),this.e2=Ad(this.es),this.e3=Td(this.es),this.ml0=this.a*Is(this.e0,this.e1,this.e2,this.e3,this.lat0)}function nz(l){var t=l.x,e=l.y,s,o,c,d=Xe(t-this.long0);if(c=d*Math.sin(e),this.sphere)Math.abs(e)<=He?(s=this.a*d,o=-1*this.a*this.lat0):(s=this.a*Math.sin(c)/Math.tan(e),o=this.a*(nc(e-this.lat0)+(1-Math.cos(c))/Math.tan(e)));else if(Math.abs(e)<=He)s=this.a*d,o=-1*this.ml0;else{var a=Zh(this.a,this.e,Math.sin(e))/Math.tan(e);s=a*Math.sin(c),o=this.a*Is(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+a*(1-Math.cos(c))}return l.x=s+this.x0,l.y=o+this.y0,l}function sz(l){var t,e,s,o,c,d,a,_,v;if(s=l.x-this.x0,o=l.y-this.y0,this.sphere)if(Math.abs(o+this.a*this.lat0)<=He)t=Xe(s/this.a+this.long0),e=0;else{d=this.lat0+o/this.a,a=s*s/this.a/this.a+d*d,_=d;var S;for(c=Xx;c;--c)if(S=Math.tan(_),v=-1*(d*(_*S+1)-_-.5*(_*_+a)*S)/((_-d)/S-1),_+=v,Math.abs(v)<=He){e=_;break}t=Xe(this.long0+Math.asin(s*Math.tan(_)/this.a)/Math.sin(e))}else if(Math.abs(o+this.ml0)<=He)e=0,t=Xe(this.long0+s/this.a);else{d=(this.ml0+o)/this.a,a=s*s/this.a/this.a+d*d,_=d;var M,A,C,R,F;for(c=Xx;c;--c)if(F=this.e*Math.sin(_),M=Math.sqrt(1-F*F)*Math.tan(_),A=this.a*Is(this.e0,this.e1,this.e2,this.e3,_),C=this.e0-2*this.e1*Math.cos(2*_)+4*this.e2*Math.cos(4*_)-6*this.e3*Math.cos(6*_),R=A/this.a,v=(d*(M*R+1)-R-.5*M*(R*R+a))/(this.es*Math.sin(2*_)*(R*R+a-2*d*R)/(4*M)+(d-R)*(M*C-2/Math.sin(2*_))-C),_-=v,Math.abs(v)<=He){e=_;break}M=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=Xe(this.long0+Math.asin(s*M/this.a)/Math.sin(e))}return l.x=t,l.y=e,l}var rz=["Polyconic","poly"];const az={init:iz,forward:nz,inverse:sz,names:rz};function oz(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function lz(l){var t,e=l.x,s=l.y,o=s-this.lat0,c=e-this.long0,d=o/Ru*1e-5,a=c,_=1,v=0;for(t=1;t<=10;t++)_=_*d,v=v+this.A[t]*_;var S=v,M=a,A=1,C=0,R,F,z=0,L=0;for(t=1;t<=6;t++)R=A*S-C*M,F=C*S+A*M,A=R,C=F,z=z+this.B_re[t]*A-this.B_im[t]*C,L=L+this.B_im[t]*A+this.B_re[t]*C;return l.x=L*this.a+this.x0,l.y=z*this.a+this.y0,l}function hz(l){var t,e=l.x,s=l.y,o=e-this.x0,c=s-this.y0,d=c/this.a,a=o/this.a,_=1,v=0,S,M,A=0,C=0;for(t=1;t<=6;t++)S=_*d-v*a,M=v*d+_*a,_=S,v=M,A=A+this.C_re[t]*_-this.C_im[t]*v,C=C+this.C_im[t]*_+this.C_re[t]*v;for(var R=0;R<this.iterations;R++){var F=A,z=C,L,W,G=d,H=a;for(t=2;t<=6;t++)L=F*A-z*C,W=z*A+F*C,F=L,z=W,G=G+(t-1)*(this.B_re[t]*F-this.B_im[t]*z),H=H+(t-1)*(this.B_im[t]*F+this.B_re[t]*z);F=1,z=0;var Q=this.B_re[1],nt=this.B_im[1];for(t=2;t<=6;t++)L=F*A-z*C,W=z*A+F*C,F=L,z=W,Q=Q+t*(this.B_re[t]*F-this.B_im[t]*z),nt=nt+t*(this.B_im[t]*F+this.B_re[t]*z);var pt=Q*Q+nt*nt;A=(G*Q+H*nt)/pt,C=(H*Q-G*nt)/pt}var ft=A,K=C,ot=1,kt=0;for(t=1;t<=9;t++)ot=ot*ft,kt=kt+this.D[t]*ot;var zt=this.lat0+kt*Ru*1e5,It=this.long0+K;return l.x=It,l.y=zt,l}var cz=["New_Zealand_Map_Grid","nzmg"];const uz={init:oz,forward:lz,inverse:hz,names:cz};function dz(){}function fz(l){var t=l.x,e=l.y,s=Xe(t-this.long0),o=this.x0+this.a*s,c=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return l.x=o,l.y=c,l}function pz(l){l.x-=this.x0,l.y-=this.y0;var t=Xe(this.long0+l.x/this.a),e=2.5*(Math.atan(Math.exp(.8*l.y/this.a))-Math.PI/4);return l.x=t,l.y=e,l}var mz=["Miller_Cylindrical","mill"];const gz={init:dz,forward:fz,inverse:pz,names:mz};var _z=20;function yz(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=xw(this.es)}function vz(l){var t,e,s=l.x,o=l.y;if(s=Xe(s-this.long0),this.sphere){if(!this.m)o=this.n!==1?Math.asin(this.n*Math.sin(o)):o;else for(var c=this.n*Math.sin(o),d=_z;d;--d){var a=(this.m*o+Math.sin(o)-c)/(this.m+Math.cos(o));if(o-=a,Math.abs(a)<He)break}t=this.a*this.C_x*s*(this.m+Math.cos(o)),e=this.a*this.C_y*o}else{var _=Math.sin(o),v=Math.cos(o);e=this.a*lm(o,_,v,this.en),t=this.a*s*v/Math.sqrt(1-this.es*_*_)}return l.x=t,l.y=e,l}function xz(l){var t,e,s,o;return l.x-=this.x0,s=l.x/this.a,l.y-=this.y0,t=l.y/this.a,this.sphere?(t/=this.C_y,s=s/(this.C_x*(this.m+Math.cos(t))),this.m?t=bo((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=bo(Math.sin(t)/this.n)),s=Xe(s+this.long0),t=nc(t)):(t=bw(l.y/this.a,this.es,this.en),o=Math.abs(t),o<Me?(o=Math.sin(t),e=this.long0+l.x*Math.sqrt(1-this.es*o*o)/(this.a*Math.cos(t)),s=Xe(e)):o-He<Me&&(s=this.long0)),l.x=s,l.y=t,l}var bz=["Sinusoidal","sinu"];const wz={init:yz,forward:vz,inverse:xz,names:bz};function Mz(){}function Sz(l){for(var t=l.x,e=l.y,s=Xe(t-this.long0),o=e,c=Math.PI*Math.sin(e);;){var d=-(o+Math.sin(o)-c)/(1+Math.cos(o));if(o+=d,Math.abs(d)<He)break}o/=2,Math.PI/2-Math.abs(e)<He&&(s=0);var a=.900316316158*this.a*s*Math.cos(o)+this.x0,_=1.4142135623731*this.a*Math.sin(o)+this.y0;return l.x=a,l.y=_,l}function Az(l){var t,e;l.x-=this.x0,l.y-=this.y0,e=l.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var s=Xe(this.long0+l.x/(.900316316158*this.a*Math.cos(t)));s<-Math.PI&&(s=-Math.PI),s>Math.PI&&(s=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var o=Math.asin(e);return l.x=s,l.y=o,l}var Tz=["Mollweide","moll"];const Ez={init:Mz,forward:Sz,inverse:Az,names:Tz};function Cz(){Math.abs(this.lat1+this.lat2)<He||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Md(this.es),this.e1=Sd(this.es),this.e2=Ad(this.es),this.e3=Td(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Xr(this.e,this.sinphi,this.cosphi),this.ml1=Is(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<He?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Xr(this.e,this.sinphi,this.cosphi),this.ml2=Is(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Is(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function Iz(l){var t=l.x,e=l.y,s;if(this.sphere)s=this.a*(this.g-e);else{var o=Is(this.e0,this.e1,this.e2,this.e3,e);s=this.a*(this.g-o)}var c=this.ns*Xe(t-this.long0),d=this.x0+s*Math.sin(c),a=this.y0+this.rh-s*Math.cos(c);return l.x=d,l.y=a,l}function Pz(l){l.x-=this.x0,l.y=this.rh-l.y+this.y0;var t,e,s,o;this.ns>=0?(e=Math.sqrt(l.x*l.x+l.y*l.y),t=1):(e=-Math.sqrt(l.x*l.x+l.y*l.y),t=-1);var c=0;if(e!==0&&(c=Math.atan2(t*l.x,t*l.y)),this.sphere)return o=Xe(this.long0+c/this.ns),s=nc(this.g-e/this.a),l.x=o,l.y=s,l;var d=this.g-e/this.a;return s=Up(d,this.e0,this.e1,this.e2,this.e3),o=Xe(this.long0+c/this.ns),l.x=o,l.y=s,l}var Lz=["Equidistant_Conic","eqdc"];const Rz={init:Cz,forward:Iz,inverse:Pz,names:Lz};function Dz(){this.R=this.a}function zz(l){var t=l.x,e=l.y,s=Xe(t-this.long0),o,c;Math.abs(e)<=He&&(o=this.x0+this.R*s,c=this.y0);var d=bo(2*Math.abs(e/Math.PI));(Math.abs(s)<=He||Math.abs(Math.abs(e)-Me)<=He)&&(o=this.x0,e>=0?c=this.y0+Math.PI*this.R*Math.tan(.5*d):c=this.y0+Math.PI*this.R*-Math.tan(.5*d));var a=.5*Math.abs(Math.PI/s-s/Math.PI),_=a*a,v=Math.sin(d),S=Math.cos(d),M=S/(v+S-1),A=M*M,C=M*(2/v-1),R=C*C,F=Math.PI*this.R*(a*(M-R)+Math.sqrt(_*(M-R)*(M-R)-(R+_)*(A-R)))/(R+_);s<0&&(F=-F),o=this.x0+F;var z=_+M;return F=Math.PI*this.R*(C*z-a*Math.sqrt((R+_)*(_+1)-z*z))/(R+_),e>=0?c=this.y0+F:c=this.y0-F,l.x=o,l.y=c,l}function kz(l){var t,e,s,o,c,d,a,_,v,S,M,A,C;return l.x-=this.x0,l.y-=this.y0,M=Math.PI*this.R,s=l.x/M,o=l.y/M,c=s*s+o*o,d=-Math.abs(o)*(1+c),a=d-2*o*o+s*s,_=-2*d+1+2*o*o+c*c,C=o*o/_+(2*a*a*a/_/_/_-9*d*a/_/_)/27,v=(d-a*a/3/_)/_,S=2*Math.sqrt(-v/3),M=3*C/v/S,Math.abs(M)>1&&(M>=0?M=1:M=-1),A=Math.acos(M)/3,l.y>=0?e=(-S*Math.cos(A+Math.PI/3)-a/3/_)*Math.PI:e=-(-S*Math.cos(A+Math.PI/3)-a/3/_)*Math.PI,Math.abs(s)<He?t=this.long0:t=Xe(this.long0+Math.PI*(c-1+Math.sqrt(1+2*(s*s-o*o)+c*c))/2/s),l.x=t,l.y=e,l}var Fz=["Van_der_Grinten_I","VanDerGrinten","vandg"];const Bz={init:Dz,forward:zz,inverse:kz,names:Fz};function Oz(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function Nz(l){var t=l.x,e=l.y,s=Math.sin(l.y),o=Math.cos(l.y),c=Xe(t-this.long0),d,a,_,v,S,M,A,C,R,F,z,L,W,G,H,Q,nt,pt,ft,K,ot,kt,zt;return this.sphere?Math.abs(this.sin_p12-1)<=He?(l.x=this.x0+this.a*(Me-e)*Math.sin(c),l.y=this.y0-this.a*(Me-e)*Math.cos(c),l):Math.abs(this.sin_p12+1)<=He?(l.x=this.x0+this.a*(Me+e)*Math.sin(c),l.y=this.y0+this.a*(Me+e)*Math.cos(c),l):(pt=this.sin_p12*s+this.cos_p12*o*Math.cos(c),Q=Math.acos(pt),nt=Q?Q/Math.sin(Q):1,l.x=this.x0+this.a*nt*o*Math.sin(c),l.y=this.y0+this.a*nt*(this.cos_p12*s-this.sin_p12*o*Math.cos(c)),l):(d=Md(this.es),a=Sd(this.es),_=Ad(this.es),v=Td(this.es),Math.abs(this.sin_p12-1)<=He?(S=this.a*Is(d,a,_,v,Me),M=this.a*Is(d,a,_,v,e),l.x=this.x0+(S-M)*Math.sin(c),l.y=this.y0-(S-M)*Math.cos(c),l):Math.abs(this.sin_p12+1)<=He?(S=this.a*Is(d,a,_,v,Me),M=this.a*Is(d,a,_,v,e),l.x=this.x0+(S+M)*Math.sin(c),l.y=this.y0+(S+M)*Math.cos(c),l):(A=s/o,C=Zh(this.a,this.e,this.sin_p12),R=Zh(this.a,this.e,s),F=Math.atan((1-this.es)*A+this.es*C*this.sin_p12/(R*o)),z=Math.atan2(Math.sin(c),this.cos_p12*Math.tan(F)-this.sin_p12*Math.cos(c)),z===0?ft=Math.asin(this.cos_p12*Math.sin(F)-this.sin_p12*Math.cos(F)):Math.abs(Math.abs(z)-Math.PI)<=He?ft=-Math.asin(this.cos_p12*Math.sin(F)-this.sin_p12*Math.cos(F)):ft=Math.asin(Math.sin(c)*Math.cos(F)/Math.sin(z)),L=this.e*this.sin_p12/Math.sqrt(1-this.es),W=this.e*this.cos_p12*Math.cos(z)/Math.sqrt(1-this.es),G=L*W,H=W*W,K=ft*ft,ot=K*ft,kt=ot*ft,zt=kt*ft,Q=C*ft*(1-K*H*(1-H)/6+ot/8*G*(1-2*H)+kt/120*(H*(4-7*H)-3*L*L*(1-7*H))-zt/48*G),l.x=this.x0+Q*Math.sin(z),l.y=this.y0+Q*Math.cos(z),l))}function Uz(l){l.x-=this.x0,l.y-=this.y0;var t,e,s,o,c,d,a,_,v,S,M,A,C,R,F,z,L,W,G,H,Q,nt,pt,ft;return this.sphere?(t=Math.sqrt(l.x*l.x+l.y*l.y),t>2*Me*this.a?void 0:(e=t/this.a,s=Math.sin(e),o=Math.cos(e),c=this.long0,Math.abs(t)<=He?d=this.lat0:(d=bo(o*this.sin_p12+l.y*s*this.cos_p12/t),a=Math.abs(this.lat0)-Me,Math.abs(a)<=He?this.lat0>=0?c=Xe(this.long0+Math.atan2(l.x,-l.y)):c=Xe(this.long0-Math.atan2(-l.x,l.y)):c=Xe(this.long0+Math.atan2(l.x*s,t*this.cos_p12*o-l.y*this.sin_p12*s))),l.x=c,l.y=d,l)):(_=Md(this.es),v=Sd(this.es),S=Ad(this.es),M=Td(this.es),Math.abs(this.sin_p12-1)<=He?(A=this.a*Is(_,v,S,M,Me),t=Math.sqrt(l.x*l.x+l.y*l.y),C=A-t,d=Up(C/this.a,_,v,S,M),c=Xe(this.long0+Math.atan2(l.x,-1*l.y)),l.x=c,l.y=d,l):Math.abs(this.sin_p12+1)<=He?(A=this.a*Is(_,v,S,M,Me),t=Math.sqrt(l.x*l.x+l.y*l.y),C=t-A,d=Up(C/this.a,_,v,S,M),c=Xe(this.long0+Math.atan2(l.x,l.y)),l.x=c,l.y=d,l):(t=Math.sqrt(l.x*l.x+l.y*l.y),z=Math.atan2(l.x,l.y),R=Zh(this.a,this.e,this.sin_p12),L=Math.cos(z),W=this.e*this.cos_p12*L,G=-W*W/(1-this.es),H=3*this.es*(1-G)*this.sin_p12*this.cos_p12*L/(1-this.es),Q=t/R,nt=Q-G*(1+G)*Math.pow(Q,3)/6-H*(1+3*G)*Math.pow(Q,4)/24,pt=1-G*nt*nt/2-Q*nt*nt*nt/6,F=Math.asin(this.sin_p12*Math.cos(nt)+this.cos_p12*Math.sin(nt)*L),c=Xe(this.long0+Math.asin(Math.sin(z)*Math.sin(nt)/Math.cos(F))),ft=Math.sin(F),d=Math.atan2((ft-this.es*pt*this.sin_p12)*Math.tan(F),ft*(1-this.es)),l.x=c,l.y=d,l))}var Vz=["Azimuthal_Equidistant","aeqd"];const Gz={init:Oz,forward:Nz,inverse:Uz,names:Vz};function Hz(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function Wz(l){var t,e,s,o,c,d,a,_,v=l.x,S=l.y;return s=Xe(v-this.long0),t=Math.sin(S),e=Math.cos(S),o=Math.cos(s),d=this.sin_p14*t+this.cos_p14*e*o,c=1,(d>0||Math.abs(d)<=He)&&(a=this.a*c*e*Math.sin(s),_=this.y0+this.a*c*(this.cos_p14*t-this.sin_p14*e*o)),l.x=a,l.y=_,l}function qz(l){var t,e,s,o,c,d,a;return l.x-=this.x0,l.y-=this.y0,t=Math.sqrt(l.x*l.x+l.y*l.y),e=bo(t/this.a),s=Math.sin(e),o=Math.cos(e),d=this.long0,Math.abs(t)<=He?(a=this.lat0,l.x=d,l.y=a,l):(a=bo(o*this.sin_p14+l.y*s*this.cos_p14/t),c=Math.abs(this.lat0)-Me,Math.abs(c)<=He?(this.lat0>=0?d=Xe(this.long0+Math.atan2(l.x,-l.y)):d=Xe(this.long0-Math.atan2(-l.x,l.y)),l.x=d,l.y=a,l):(d=Xe(this.long0+Math.atan2(l.x*s,t*this.cos_p14*o-l.y*this.sin_p14*s)),l.x=d,l.y=a,l))}var $z=["ortho"];const jz={init:Hz,forward:Wz,inverse:qz,names:$z};var _n={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},ji={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Zz(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Me-$i/2?this.face=_n.TOP:this.lat0<=-(Me-$i/2)?this.face=_n.BOTTOM:Math.abs(this.long0)<=$i?this.face=_n.FRONT:Math.abs(this.long0)<=Me+$i?this.face=this.long0>0?_n.RIGHT:_n.LEFT:this.face=_n.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function Xz(l){var t={x:0,y:0},e,s,o,c,d,a,_={value:0};if(l.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(l.y)):e=l.y,s=l.x,this.face===_n.TOP)c=Me-e,s>=$i&&s<=Me+$i?(_.value=ji.AREA_0,o=s-Me):s>Me+$i||s<=-(Me+$i)?(_.value=ji.AREA_1,o=s>0?s-Ln:s+Ln):s>-(Me+$i)&&s<=-$i?(_.value=ji.AREA_2,o=s+Me):(_.value=ji.AREA_3,o=s);else if(this.face===_n.BOTTOM)c=Me+e,s>=$i&&s<=Me+$i?(_.value=ji.AREA_0,o=-s+Me):s<$i&&s>=-$i?(_.value=ji.AREA_1,o=-s):s<-$i&&s>=-(Me+$i)?(_.value=ji.AREA_2,o=-s-Me):(_.value=ji.AREA_3,o=s>0?-s+Ln:-s-Ln);else{var v,S,M,A,C,R,F;this.face===_n.RIGHT?s=Vh(s,+Me):this.face===_n.BACK?s=Vh(s,+Ln):this.face===_n.LEFT&&(s=Vh(s,-Me)),A=Math.sin(e),C=Math.cos(e),R=Math.sin(s),F=Math.cos(s),v=C*F,S=C*R,M=A,this.face===_n.FRONT?(c=Math.acos(v),o=bp(c,M,S,_)):this.face===_n.RIGHT?(c=Math.acos(S),o=bp(c,M,-v,_)):this.face===_n.BACK?(c=Math.acos(-v),o=bp(c,M,-S,_)):this.face===_n.LEFT?(c=Math.acos(-S),o=bp(c,M,v,_)):(c=o=0,_.value=ji.AREA_0)}return a=Math.atan(12/Ln*(o+Math.acos(Math.sin(o)*Math.cos($i))-Me)),d=Math.sqrt((1-Math.cos(c))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(o))))),_.value===ji.AREA_1?a+=Me:_.value===ji.AREA_2?a+=Ln:_.value===ji.AREA_3&&(a+=1.5*Ln),t.x=d*Math.cos(a),t.y=d*Math.sin(a),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,l.x=t.x,l.y=t.y,l}function Yz(l){var t={lam:0,phi:0},e,s,o,c,d,a,_,v,S,M={value:0};if(l.x=(l.x-this.x0)/this.a,l.y=(l.y-this.y0)/this.a,s=Math.atan(Math.sqrt(l.x*l.x+l.y*l.y)),e=Math.atan2(l.y,l.x),l.x>=0&&l.x>=Math.abs(l.y)?M.value=ji.AREA_0:l.y>=0&&l.y>=Math.abs(l.x)?(M.value=ji.AREA_1,e-=Me):l.x<0&&-l.x>=Math.abs(l.y)?(M.value=ji.AREA_2,e=e<0?e+Ln:e-Ln):(M.value=ji.AREA_3,e+=Me),S=Ln/12*Math.tan(e),d=Math.sin(S)/(Math.cos(S)-1/Math.sqrt(2)),a=Math.atan(d),o=Math.cos(e),c=Math.tan(s),_=1-o*o*c*c*(1-Math.cos(Math.atan(1/Math.cos(a)))),_<-1?_=-1:_>1&&(_=1),this.face===_n.TOP)v=Math.acos(_),t.phi=Me-v,M.value===ji.AREA_0?t.lam=a+Me:M.value===ji.AREA_1?t.lam=a<0?a+Ln:a-Ln:M.value===ji.AREA_2?t.lam=a-Me:t.lam=a;else if(this.face===_n.BOTTOM)v=Math.acos(_),t.phi=v-Me,M.value===ji.AREA_0?t.lam=-a+Me:M.value===ji.AREA_1?t.lam=-a:M.value===ji.AREA_2?t.lam=-a-Me:t.lam=a<0?-a-Ln:-a+Ln;else{var A,C,R;A=_,S=A*A,S>=1?R=0:R=Math.sqrt(1-S)*Math.sin(a),S+=R*R,S>=1?C=0:C=Math.sqrt(1-S),M.value===ji.AREA_1?(S=C,C=-R,R=S):M.value===ji.AREA_2?(C=-C,R=-R):M.value===ji.AREA_3&&(S=C,C=R,R=-S),this.face===_n.RIGHT?(S=A,A=-C,C=S):this.face===_n.BACK?(A=-A,C=-C):this.face===_n.LEFT&&(S=A,A=C,C=-S),t.phi=Math.acos(-R)-Me,t.lam=Math.atan2(C,A),this.face===_n.RIGHT?t.lam=Vh(t.lam,-Me):this.face===_n.BACK?t.lam=Vh(t.lam,-Ln):this.face===_n.LEFT&&(t.lam=Vh(t.lam,+Me))}if(this.es!==0){var F,z,L;F=t.phi<0?1:0,z=Math.tan(t.phi),L=this.b/Math.sqrt(z*z+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-L*L)/(this.one_minus_f*L)),F&&(t.phi=-t.phi)}return t.lam+=this.long0,l.x=t.lam,l.y=t.phi,l}function bp(l,t,e,s){var o;return l<He?(s.value=ji.AREA_0,o=0):(o=Math.atan2(t,e),Math.abs(o)<=$i?s.value=ji.AREA_0:o>$i&&o<=Me+$i?(s.value=ji.AREA_1,o-=Me):o>Me+$i||o<=-(Me+$i)?(s.value=ji.AREA_2,o=o>=0?o-Ln:o+Ln):(s.value=ji.AREA_3,o+=Me)),o}function Vh(l,t){var e=l+t;return e<-Ln?e+=ed:e>+Ln&&(e-=ed),e}var Jz=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const Kz={init:Zz,forward:Xz,inverse:Yz,names:Jz};var B_=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Tu=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Sw=.8487,Aw=1.3523,Tw=Gr/5,Qz=1/Tw,Fh=18,Vp=function(l,t){return l[0]+t*(l[1]+t*(l[2]+t*l[3]))},tk=function(l,t){return l[1]+t*(2*l[2]+t*3*l[3])};function ek(l,t,e,s){for(var o=t;s;--s){var c=l(o);if(o-=c,Math.abs(c)<e)break}return o}function ik(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function nk(l){var t=Xe(l.x-this.long0),e=Math.abs(l.y),s=Math.floor(e*Tw);s<0?s=0:s>=Fh&&(s=Fh-1),e=Gr*(e-Qz*s);var o={x:Vp(B_[s],e)*t,y:Vp(Tu[s],e)};return l.y<0&&(o.y=-o.y),o.x=o.x*this.a*Sw+this.x0,o.y=o.y*this.a*Aw+this.y0,o}function sk(l){var t={x:(l.x-this.x0)/(this.a*Sw),y:Math.abs(l.y-this.y0)/(this.a*Aw)};if(t.y>=1)t.x/=B_[Fh][0],t.y=l.y<0?-Me:Me;else{var e=Math.floor(t.y*Fh);for(e<0?e=0:e>=Fh&&(e=Fh-1);;)if(Tu[e][0]>t.y)--e;else if(Tu[e+1][0]<=t.y)++e;else break;var s=Tu[e],o=5*(t.y-s[0])/(Tu[e+1][0]-s[0]);o=ek(function(c){return(Vp(s,c)-t.y)/tk(s,c)},o,He,100),t.x/=Vp(B_[e],o),t.y=(5*e+o)*is,l.y<0&&(t.y=-t.y)}return t.x=Xe(t.x+this.long0),t}var rk=["Robinson","robin"];const ak={init:ik,forward:nk,inverse:sk,names:rk};function ok(){this.name="geocent"}function lk(l){var t=uw(l,this.es,this.a);return t}function hk(l){var t=dw(l,this.es,this.a,this.b);return t}var ck=["Geocentric","geocentric","geocent","Geocent"];const uk={init:ok,forward:lk,inverse:hk,names:ck};var ms={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},bu={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function dk(){if(Object.keys(bu).forEach((function(e){if(typeof this[e]>"u")this[e]=bu[e].def;else{if(bu[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);bu[e].num&&(this[e]=parseFloat(this[e]))}bu[e].degrees&&(this[e]=this[e]*is)}).bind(this)),Math.abs(Math.abs(this.lat0)-Me)<He?this.mode=this.lat0<0?ms.S_POLE:ms.N_POLE:Math.abs(this.lat0)<He?this.mode=ms.EQUIT:(this.mode=ms.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var l=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(l),this.sw=Math.sin(l)}function fk(l){l.x-=this.long0;var t=Math.sin(l.y),e=Math.cos(l.y),s=Math.cos(l.x),o,c;switch(this.mode){case ms.OBLIQ:c=this.sinph0*t+this.cosph0*e*s;break;case ms.EQUIT:c=e*s;break;case ms.S_POLE:c=-t;break;case ms.N_POLE:c=t;break}switch(c=this.pn1/(this.p-c),o=c*e*Math.sin(l.x),this.mode){case ms.OBLIQ:c*=this.cosph0*t-this.sinph0*e*s;break;case ms.EQUIT:c*=t;break;case ms.N_POLE:c*=-(e*s);break;case ms.S_POLE:c*=e*s;break}var d,a;return d=c*this.cg+o*this.sg,a=1/(d*this.sw*this.h1+this.cw),o=(o*this.cg-c*this.sg)*this.cw*a,c=d*a,l.x=o*this.a,l.y=c*this.a,l}function pk(l){l.x/=this.a,l.y/=this.a;var t={x:l.x,y:l.y},e,s,o;o=1/(this.pn1-l.y*this.sw),e=this.pn1*l.x*o,s=this.pn1*l.y*this.cw*o,l.x=e*this.cg+s*this.sg,l.y=s*this.cg-e*this.sg;var c=mr(l.x,l.y);if(Math.abs(c)<He)t.x=0,t.y=l.y;else{var d,a;switch(a=1-c*c*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/c+c/this.pn1),d=Math.sqrt(1-a*a),this.mode){case ms.OBLIQ:t.y=Math.asin(d*this.sinph0+l.y*a*this.cosph0/c),l.y=(d-this.sinph0*Math.sin(t.y))*c,l.x*=a*this.cosph0;break;case ms.EQUIT:t.y=Math.asin(l.y*a/c),l.y=d*c,l.x*=a;break;case ms.N_POLE:t.y=Math.asin(d),l.y=-l.y;break;case ms.S_POLE:t.y=-Math.asin(d);break}t.x=Math.atan2(l.x,l.y)}return l.x=t.x+this.long0,l.y=t.y,l}var mk=["Tilted_Perspective","tpers"];const gk={init:dk,forward:fk,inverse:pk,names:mk};function _k(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var l=1-this.es,t=1/l;this.radius_p=Math.sqrt(l),this.radius_p2=l,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function yk(l){var t=l.x,e=l.y,s,o,c,d;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var a=this.radius_p/mr(this.radius_p*Math.cos(e),Math.sin(e));if(o=a*Math.cos(t)*Math.cos(e),c=a*Math.sin(t)*Math.cos(e),d=a*Math.sin(e),(this.radius_g-o)*o-c*c-d*d*this.radius_p_inv2<0)return l.x=Number.NaN,l.y=Number.NaN,l;s=this.radius_g-o,this.flip_axis?(l.x=this.radius_g_1*Math.atan(c/mr(d,s)),l.y=this.radius_g_1*Math.atan(d/s)):(l.x=this.radius_g_1*Math.atan(c/s),l.y=this.radius_g_1*Math.atan(d/mr(c,s)))}else this.shape==="sphere"&&(s=Math.cos(e),o=Math.cos(t)*s,c=Math.sin(t)*s,d=Math.sin(e),s=this.radius_g-o,this.flip_axis?(l.x=this.radius_g_1*Math.atan(c/mr(d,s)),l.y=this.radius_g_1*Math.atan(d/s)):(l.x=this.radius_g_1*Math.atan(c/s),l.y=this.radius_g_1*Math.atan(d/mr(c,s))));return l.x=l.x*this.a,l.y=l.y*this.a,l}function vk(l){var t=-1,e=0,s=0,o,c,d,a;if(l.x=l.x/this.a,l.y=l.y/this.a,this.shape==="ellipse"){this.flip_axis?(s=Math.tan(l.y/this.radius_g_1),e=Math.tan(l.x/this.radius_g_1)*mr(1,s)):(e=Math.tan(l.x/this.radius_g_1),s=Math.tan(l.y/this.radius_g_1)*mr(1,e));var _=s/this.radius_p;if(o=e*e+_*_+t*t,c=2*this.radius_g*t,d=c*c-4*o*this.C,d<0)return l.x=Number.NaN,l.y=Number.NaN,l;a=(-c-Math.sqrt(d))/(2*o),t=this.radius_g+a*t,e*=a,s*=a,l.x=Math.atan2(e,t),l.y=Math.atan(s*Math.cos(l.x)/t),l.y=Math.atan(this.radius_p_inv2*Math.tan(l.y))}else if(this.shape==="sphere"){if(this.flip_axis?(s=Math.tan(l.y/this.radius_g_1),e=Math.tan(l.x/this.radius_g_1)*Math.sqrt(1+s*s)):(e=Math.tan(l.x/this.radius_g_1),s=Math.tan(l.y/this.radius_g_1)*Math.sqrt(1+e*e)),o=e*e+s*s+t*t,c=2*this.radius_g*t,d=c*c-4*o*this.C,d<0)return l.x=Number.NaN,l.y=Number.NaN,l;a=(-c-Math.sqrt(d))/(2*o),t=this.radius_g+a*t,e*=a,s*=a,l.x=Math.atan2(e,t),l.y=Math.atan(s*Math.cos(l.x)/t)}return l.x=l.x+this.long0,l}var xk=["Geostationary Satellite View","Geostationary_Satellite","geos"];const bk={init:_k,forward:yk,inverse:vk,names:xk};var Du=1.340264,zu=-.081106,ku=893e-6,Fu=.003796,Gp=Math.sqrt(3)/2;function wk(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function Mk(l){var t=Xe(l.x-this.long0),e=l.y,s=Math.asin(Gp*Math.sin(e)),o=s*s,c=o*o*o;return l.x=t*Math.cos(s)/(Gp*(Du+3*zu*o+c*(7*ku+9*Fu*o))),l.y=s*(Du+zu*o+c*(ku+Fu*o)),l.x=this.a*l.x+this.x0,l.y=this.a*l.y+this.y0,l}function Sk(l){l.x=(l.x-this.x0)/this.a,l.y=(l.y-this.y0)/this.a;var t=1e-9,e=12,s=l.y,o,c,d,a,_,v;for(v=0;v<e&&(o=s*s,c=o*o*o,d=s*(Du+zu*o+c*(ku+Fu*o))-l.y,a=Du+3*zu*o+c*(7*ku+9*Fu*o),s-=_=d/a,!(Math.abs(_)<t));++v);return o=s*s,c=o*o*o,l.x=Gp*l.x*(Du+3*zu*o+c*(7*ku+9*Fu*o))/Math.cos(s),l.y=Math.asin(Math.sin(s)/Gp),l.x=Xe(l.x+this.long0),l}var Ak=["eqearth","Equal Earth","Equal_Earth"];const Tk={init:wk,forward:Mk,inverse:Sk,names:Ak};function Ek(l){l.Proj.projections.add(Rp),l.Proj.projections.add(Dp),l.Proj.projections.add(CR),l.Proj.projections.add(OR),l.Proj.projections.add(WR),l.Proj.projections.add(XR),l.Proj.projections.add(eD),l.Proj.projections.add(aD),l.Proj.projections.add(uD),l.Proj.projections.add(gD),l.Proj.projections.add(DD),l.Proj.projections.add(ND),l.Proj.projections.add(WD),l.Proj.projections.add(YD),l.Proj.projections.add(ez),l.Proj.projections.add(az),l.Proj.projections.add(uz),l.Proj.projections.add(gz),l.Proj.projections.add(wz),l.Proj.projections.add(Ez),l.Proj.projections.add(Rz),l.Proj.projections.add(Bz),l.Proj.projections.add(Gz),l.Proj.projections.add(jz),l.Proj.projections.add(Kz),l.Proj.projections.add(ak),l.Proj.projections.add(uk),l.Proj.projections.add(gk),l.Proj.projections.add(bk),l.Proj.projections.add(Tk)}Ns.defaultDatum="WGS84";Ns.Proj=$r;Ns.WGS84=new Ns.Proj("WGS84");Ns.Point=jh;Ns.toPoint=fw;Ns.defs=Cs;Ns.nadgrid=PL;Ns.transform=Np;Ns.mgrs=$L;Ns.version="__VERSION__";Ek(Ns);const Yx={width:window.innerWidth,height:window.innerHeight},Ck=document.createElement("canvas"),sd=new Jp({canvas:Ck,alpha:!0});sd.setSize(Yx.width,Yx.height);sd.setPixelRatio(Math.min(window.devicePixelRatio,2));const Ik=()=>{const l=window.innerWidth,t=window.innerHeight;sd.setPixelRatio(window.devicePixelRatio),sd.setSize(l,t),camera.aspect=l/t,camera.updateProjectionMatrix()};window.addEventListener("resize",Ik);const O_=new M0({width:150});window.innerWidth<768&&O_.close();const Ew=[-12035.29,-34261.85],Cw="+proj=tmerc +lat_0=36 +lon_0=139.833333333333 +k=0.9999 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs",Iw=Ns(Cw,"EPSG:3857",Ew),I0=Ns(Cw,"EPSG:4326",Ew),qg=Iw;console.log(Iw);console.log(I0);const Bh=new Lu.Map({container:"map",style:{version:8,sources:{gsi_vector:{type:"vector",tiles:["https://cyberjapandata.gsi.go.jp/xyz/experimental_bvmap/{z}/{x}/{y}.pbf"],maxzoom:16,minzoom:4,attribution:"<a href='https://www.gsi.go.jp/' target='_blank'></a> |  <a href='https://www.geospatial.jp/ckan/dataset/mlit-indoor-shinjuku-r2/' target='_blank'></a>"},geojson:{type:"geojson",data:"./fg_4326.geojson",attribution:"<a href='https://www.geospatial.jp/ckan/dataset/mlit-indoor-shinjuku-r2/' target='_blank'></a>"}},layers:[{id:"railway",source:"gsi_vector","source-layer":"railway",type:"line",paint:{"line-color":"#4cf100","line-width":2},layout:{}},{id:"road",source:"gsi_vector","source-layer":"road",type:"line",paint:{"line-color":"rgb(209, 102, 255)","line-width":1},layout:{}}]},center:I0,zoom:17,pitch:60,bearing:130,minZoom:10,antialias:!0}),Pk=I0,Lk=0,$g=[Math.PI/2,0,0],wp=Lu.MercatorCoordinate.fromLngLat(Pk,Lk),Ma={translateX:wp.x,translateY:wp.y,translateZ:wp.z,rotateX:$g[0],rotateY:$g[1],rotateZ:$g[2],scale:wp.meterInMercatorCoordinateUnits()*.81},Rk={id:"3d-model",type:"custom",renderingMode:"3d",onAdd:function(l,t){this.camera=new ld,this.scene=new t0;const e=[4,3,2,1,0,-1,-2,-3],s=["4F","3F","2F","1F","0","B1","B2","B3"];e.forEach((z,L)=>{const W=new ll;W.name=`group${z}`,this.scene.add(W);const G=`group${z}`;O_.add({[G]:!0},G).onChange(H=>{this.scene.getObjectByName(G).visible=H}).name(s[L])});const o=new Zr().setResponseType("json"),c=(z,L)=>{const W=new RegExp(`ShinjukuTerminal_([-B\\d]+)(out)?_${L}`),G=z.match(W);if(!G)return null;let H=G[1].replace("B","-");return parseInt(G[2]==="out"?H.replace("out",""):H,10)},d=(z,L)=>{const W=new uo;return z[0].forEach((G,H)=>{const[Q,nt]=G.map((pt,ft)=>pt-qg[ft]);H===0?W.moveTo(Q,nt):H+1===z[0].length?W.closePath():W.lineTo(Q,nt)}),new Qh(W,{steps:1,depth:L,bevelEnabled:!1})},a=30,_=(z,L,W)=>{o.load(z,G=>{const H=new ys({color:"rgb(255, 255, 255)"});G.features.filter(Q=>Q.geometry).forEach(Q=>{const nt=d(Q.geometry.coordinates,W),pt=new xi().makeRotationX(Math.PI/-2);nt.applyMatrix4(pt);const ft=new u0(nt),K=new Pr(ft,H);K.position.y+=L*a-1,this.scene.getObjectByName(`group${L}`).add(K)})})};["./ShinjukuTerminal/3857/ShinjukuTerminal_B3_Space.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_B2_Space.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_B1_Space.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_0_Space.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_1_Space.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_2_Space.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_2out_Space.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_3_Space.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_3out_Space.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_4_Space.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_4out_Space.geojson"].forEach(z=>{const L=c(z,"Space");L!==null&&_(z,L,5)}),["./ShinjukuTerminal/3857/ShinjukuTerminal_B3_Floor.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_B2_Floor.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_B1_Floor.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_0_Floor.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_1_Floor.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_2_Floor.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_2out_Floor.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_3_Floor.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_3out_Floor.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_4_Floor.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_4out_Floor.geojson"].forEach(z=>{const L=c(z,"Floor");L!==null&&_(z,L,.5)}),["./ShinjukuTerminal/3857/ShinjukuTerminal_B3_Fixture.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_B2_Fixture.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_B1_Fixture.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_0_Fixture.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_2_Fixture.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_2out_Fixture.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_3_Fixture.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_3out_Fixture.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_4_Fixture.geojson","./ShinjukuTerminal/3857/ShinjukuTerminal_4out_Fixture.geojson"].forEach(z=>{const L=c(z,"Fixture");L!==null&&_(z,L,5)});const A=new Lx.MeshLineMaterial({transparent:!0,lineWidth:1,color:new Je("rgb(0, 255, 255)")});A.onBeforeCompile=z=>{Object.assign(z.uniforms,A.userData.uniforms);const L="void main() {";z.vertexShader=z.vertexShader.replace(L,`
        varying vec2 vUv;
        attribute float uDistance;
        attribute float uDirection;
        varying float vDistance;
        varying float vDirection;
        ${L}`);const W="vUV = uv;";z.vertexShader=z.vertexShader.replace(W,`
        ${W}
        vUv = uv;
        vDistance = uDistance;
        vDirection = uDirection;
        `);const G="void main() {";z.fragmentShader=z.fragmentShader.replace(G,`
        uniform float uTime;
        varying float vDirection;
        varying float vDistance;
        varying vec2 vUv;
        ${G}`);const H="gl_FragColor.a *= step(vCounters, visibility);";z.fragmentShader=z.fragmentShader.replace(H,`${H}
        vec2 p;
        p.x = vUv.x * vDistance;
        p.y = vUv.y * 1.0 - 0.5;

        float centerDistY = p.y; // Y
        float offset = abs(centerDistY) * 0.5; // 

        float time = uTime;
        // 
        if(centerDistY < 0.0) {
            if(vDirection == 1.0){
                time = -uTime;
                offset = -offset;
            }else if(vDirection == 2.0) {
                offset = offset;
            }
        }

        // mody
        float line = mod(p.x - time + offset, 1.9) < 0.9 ? 1.0 : 0.0;
        vec3 mainColor;

        // 
        if(vDirection == 1.0) {
            mainColor = vec3(0.0, 1.0, 1.0);
        } else if(vDirection == 2.0) {
            mainColor = vec3(1.0, 1.0, 0.0);
        }
        vec3 color = mix(mainColor, mainColor, line);

        gl_FragColor = vec4(color, line * 0.7);
        `)};const C=[],R=z=>{o.load("./nw/3857/Shinjuku_link.geojson",L=>{L.features.forEach(Q=>{const nt=Q.geometry.coordinates,pt=z.find(ot=>ot.node_id===Q.properties.start_id),ft=z.find(ot=>ot.node_id===Q.properties.end_id),K=nt.map((ot,kt)=>{let zt;return!pt&&!ft?zt=0:pt&&!ft?zt=pt.ordinal:!pt&&ft?zt=ft.ordinal:kt===0?zt=pt.ordinal:kt===nt.length-1||pt.ordinal===ft.ordinal?zt=ft.ordinal:zt=Math.round((pt.ordinal+ft.ordinal)/2),new ut(ot[0]-qg[0],zt*a+1,-(ot[1]-qg[1]))});K.forEach((ot,kt)=>{if(kt+1===K.length)return;const zt=new Ii().setFromPoints([ot,K[kt+1]]),It=new Lx.MeshLine;It.setGeometry(zt);const Dt=ot.distanceTo(K[kt+1]),Wt=It.geometry.getAttribute("position").count,se=new Float32Array(Wt).fill(Dt);It.setAttribute("uDistance",new Zi(se,1));const ce=new Float32Array(Wt).fill(Q.properties.direction);It.setAttribute("uDirection",new Zi(ce,1)),Object.assign(A.userData,{uniforms:{uTime:{value:0}}});const ie=new Vn(It,A);C.push(ie.geometry)})});const W=new Vn(NP(C),A);W.name="link",this.scene.add(W);const G=document.getElementById("loading"),H=G.animate({opacity:[1,0]},{duration:300,fill:"forwards"});H.onfinish=()=>{G.remove()}})};O_.add({hasCheck:!0},"hasCheck").onChange(z=>{this.scene.getObjectByName("link").visible=z}).name(""),o.load("./nw/3857/Shinjuku_node.geojson",z=>{const L=z.features.map(W=>({node_id:W.properties.node_id,ordinal:W.properties.ordinal}));R(L)});const F=()=>{requestAnimationFrame(F),A.uniforms.uTime&&(A.uniforms.uTime.value+=.1),sd.render(this.scene,this.camera)};F(),this.map=l,this.renderer=new Jp({canvas:l.getCanvas(),context:t,antialias:!0}),this.renderer.autoClear=!1},render:function(l,t){const e=new xi().makeRotationAxis(new ut(1,0,0),Ma.rotateX),s=new xi().makeRotationAxis(new ut(0,1,0),Ma.rotateY),o=new xi().makeRotationAxis(new ut(0,0,1),Ma.rotateZ),c=new xi().fromArray(t),d=new xi().makeTranslation(Ma.translateX,Ma.translateY,Ma.translateZ).scale(new ut(Ma.scale,-Ma.scale,Ma.scale)).multiply(e).multiply(s).multiply(o);this.camera.projectionMatrix=c.multiply(d),this.camera.far=1e4,this.renderer.resetState(),this.renderer.render(this.scene,this.camera),this.map.triggerRepaint()}};Bh.on("style.load",function(){Bh.addLayer(Rk)});Bh.on("load",()=>{Bh.addControl(new Lu.NavigationControl),Bh.addControl(new Lu.ScaleControl,"bottom-left"),Bh.addControl(new Lu.LogoControl({compact:!1}),"bottom-right")})});export default Dk();
